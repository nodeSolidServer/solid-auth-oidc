var SolidClient=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}(function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))switch(typeof e[t]){case"function":break;case"object":e[t]=function(t){var n=t.slice(1),r=e[t[0]];return function(e,t,i){r.apply(this,[e,t,i].concat(n))}}(e[t]);break;default:e[t]=e[e[t]]}return e}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";var r=n(2),i=n(87),o=new i,a=n(139)(r,{auth:o}),s=n(152),u=new s(a),l=n(154),c=n(160)(r),f=n(167),h={acl:f,AppRegistration:n(157),appRegistry:n(156),auth:o,tls:u,config:n(173),currentUser:u.currentUser.bind(u),identity:n(154),login:u.login.bind(u),meta:n(174),rdflib:r,signup:u.signup.bind(u),status:n(176),typeRegistry:n(165),vocab:c,web:a};h.clearPermissions=function(e){return f.clearPermissions(e,a)},h.discoverWebID=function(e){return l.discoverWebID(e,a,c)},h.getPermissions=function(e){return f.getPermissions(e,a,r)},h.getProfile=function(e,t){return l.getProfile(e,t,a,r)},e.exports=h},function(e,t,n){"use strict";var r;r="undefined"!=typeof $rdf?$rdf:"undefined"!=typeof tabulator?tabulator.rdf:n(3),e.exports=r},function(e,t,n){"use strict";var r={BlankNode:n(4),Collection:n(7),convert:n(11),DataFactory:n(58),Empty:n(81),Fetcher:n(60),Formula:n(75),IndexedFormula:n(74),jsonParser:n(82),Literal:n(8),log:n(61),N3Parser:n(62),NamedNode:n(9),Namespace:n(69),Node:n(6),parse:n(70),Query:n(80).Query,queryToSPARQL:n(83),RDFaProcessor:n(71),RDFParser:n(72),serialize:n(76),Serializer:n(77),SPARQLToQuery:n(84),sparqlUpdateParser:n(73),Statement:n(78),term:n(6).fromValue,UpdateManager:n(85),UpdatesSocket:n(86).UpdatesSocket,UpdatesVia:n(86).UpdatesVia,uri:n(63),Util:n(64),Variable:n(79)};r.NextId=r.BlankNode.nextId,r.fromNT=r.Formula.prototype.fromNT,r.fetcher=r.DataFactory.fetcher,r.graph=r.DataFactory.graph,r.lit=r.DataFactory.lit,r.st=r.DataFactory.st,r.sym=r.DataFactory.namedNode,r.variable=r.DataFactory.variable,r.blankNode=r.DataFactory.blankNode,r.defaultGraph=r.DataFactory.defaultGraph,r.literal=r.DataFactory.literal,r.namedNode=r.DataFactory.namedNode,r.quad=r.DataFactory.quad,r.triple=r.DataFactory.triple,e.exports=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(5),l=n(6),c=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.termType=t.termType,n.id=t.nextId++,n.value=e||n.id.toString(),n}return o(t,e),s(t,[{key:"compareTerm",value:function(e){return this.classOrder<e.classOrder?-1:this.classOrder>e.classOrder?1:this.id<e.id?-1:this.id>e.id?1:0}},{key:"copy",value:function(e){var n=new t;return e.copyTo(this,n),n}},{key:"toCanonical",value:function(){return"_:"+this.value}},{key:"toString",value:function(){return t.NTAnonymousNodePrefix+this.id}}]),t}(l);c.nextId=0,c.termType="BlankNode",c.NTAnonymousNodePrefix="_:n",c.prototype.classOrder=u.BlankNode,c.prototype.isBlank=1,c.prototype.isVar=1,e.exports=c},function(e,t){"use strict";var n={Literal:1,Collection:3,Formula:4,NamedNode:5,BlankNode:6,Variable:7};e.exports=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"substitute",value:function(e){return this}},{key:"compareTerm",value:function(e){return this.classOrder<e.classOrder?-1:this.classOrder>e.classOrder?1:this.value<e.value?-1:this.value>e.value?1:0}},{key:"equals",value:function(e){return!!e&&(this.termType===e.termType&&this.value===e.value)}},{key:"hashString",value:function(){return this.toCanonical()}},{key:"sameTerm",value:function(e){return this.equals(e)}},{key:"toCanonical",value:function(){return this.toNT()}},{key:"toNT",value:function(){return this.toString()}},{key:"toString",value:function(){throw new Error("Node.toString() is abstract - see the subclasses instead")}}]),e}();e.exports=o,o.fromValue=function(e){var t=n(7),r=n(8);n(9);if("undefined"==typeof e||null===e)return e;var i=e&&e.termType;return i?e:Array.isArray(e)?new t(e):r.fromValue(e)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(4),l=n(5),c=n(6),f=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.termType=t.termType,n.id=u.nextId++,n.elements=[],n.closed=!1,e&&e.length>0&&e.forEach(function(e){n.elements.push(c.fromValue(e))}),n}return o(t,e),s(t,[{key:"append",value:function(e){return this.elements.push(e)}},{key:"close",value:function(){return this.closed=!0,this.closed}},{key:"shift",value:function(){return this.elements.shift()}},{key:"substitute",value:function(e){var n=this.elements.map(function(t){t.substitute(e)});return new t(n)}},{key:"toNT",value:function(){return u.NTAnonymousNodePrefix+this.id}},{key:"toString",value:function(){return"("+this.elements.join(" ")+")"}},{key:"unshift",value:function(e){return this.elements.unshift(e)}}]),t}(c);f.termType="collection",f.prototype.classOrder=l.Collection,f.prototype.compareTerm=u.prototype.compareTerm,f.prototype.isVar=0,e.exports=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":a(e)},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(5),c=n(9),f=n(6),h=n(10),d=function(e){function t(e,n,o){r(this,t);var a=i(this,Object.getPrototypeOf(t).call(this));return a.termType=t.termType,a.value=e,n&&(a.lang=n,o=h.langString),o&&(a.datatype=c.fromValue(o)),a}return o(t,e),u(t,[{key:"copy",value:function(){return new t(this.value,this.lang,this.datatype)}},{key:"equals",value:function(e){return!!e&&(this.termType===e.termType&&this.value===e.value&&this.language===e.language&&(!this.datatype&&!e.datatype||this.datatype&&this.datatype.equals(e.datatype)))}},{key:"toNT",value:function(){if("number"==typeof this.value)return this.toString();if("string"!=typeof this.value)throw new Error("Value of RDF literal is not string or number: "+this.value);var e=this.value;return e=e.replace(/\\/g,"\\\\"),e=e.replace(/\"/g,'\\"'),e=e.replace(/\n/g,"\\n"),e='"'+e+'"',this.language?e+="@"+this.language:this.datatype.equals(h.string)||(e+="^^"+this.datatype.toCanonical()),e}},{key:"toString",value:function(){return""+this.value}},{key:"language",get:function(){return this.lang},set:function(e){this.lang=e||""}}],[{key:"fromBoolean",value:function(e){var n=e?"1":"0";return new t(n,null,h.boolean)}},{key:"fromDate",value:function(e){if(!(e instanceof Date))throw new TypeError("Invalid argument to Literal.fromDate()");var n=function(e){return(""+(100+e)).slice(1,3)},r=""+e.getUTCFullYear()+"-"+n(e.getUTCMonth()+1)+"-"+n(e.getUTCDate())+"T"+n(e.getUTCHours())+":"+n(e.getUTCMinutes())+":"+n(e.getUTCSeconds())+"Z";return new t(r,null,h.dateTime)}},{key:"fromNumber",value:function(e){if("number"!=typeof e)throw new TypeError("Invalid argument to Literal.fromNumber()");var n=void 0;return n=(""+e).indexOf("e")>=0?h.float:(""+e).indexOf(".")>=0?h.decimal:h.integer,new t(""+e,null,n)}},{key:"fromValue",value:function(e){if("undefined"==typeof e||null===e)return e;if(e&&e.termType)return e;switch("undefined"==typeof e?"undefined":s(e)){case"object":if(e instanceof Date)return t.fromDate(e);case"boolean":return t.fromBoolean(e);case"number":return t.fromNumber(e);case"string":return new t(e)}throw new Error("Can't make literal from "+e+" of type "+("undefined"==typeof e?"undefined":s(e)))}}]),t}(f);d.termType="Literal",d.prototype.classOrder=l.Literal,d.prototype.datatype=h.string,d.prototype.lang="",d.prototype.isVar=0,e.exports=d},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(5),l=n(6),c=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.termType=t.termType,e.indexOf(":")<0&&console.log("Warning: NamedNode URI must be absolute. Relative URIs will fail in future versions"),n.value=e,n}return o(t,e),s(t,[{key:"dir",value:function(){var e=this.uri.split("#")[0],n=e.slice(0,-1).lastIndexOf("/"),r=e.indexOf("//");return r>=0&&n<r+2||n<0?null:new t(e.slice(0,n+1))}},{key:"doc",value:function(){return this.uri.indexOf("#")<0?this:new t(this.uri.split("#")[0])}},{key:"toString",value:function(){return"<"+this.uri+">"}},{key:"uri",get:function(){return this.value},set:function(e){this.value=e}}],[{key:"fromValue",value:function(e){if("undefined"==typeof e||null===e)return e;var n=e&&e.termType;return n?e:new t(e)}}]),t}(l);c.termType="NamedNode",c.prototype.classOrder=u.NamedNode,c.prototype.isVar=0,e.exports=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(9),o=function e(){r(this,e)};o.boolean=new i("http://www.w3.org/2001/XMLSchema#boolean"),o.dateTime=new i("http://www.w3.org/2001/XMLSchema#dateTime"),o.decimal=new i("http://www.w3.org/2001/XMLSchema#decimal"),o.float=new i("http://www.w3.org/2001/XMLSchema#float"),o.integer=new i("http://www.w3.org/2001/XMLSchema#integer"),o.langString=new i("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"),o.string=new i("http://www.w3.org/2001/XMLSchema#string"),e.exports=o},function(e,t,n){"use strict";function r(e,t){var n,r=s.Parser(),i=s.Writer({format:"N-Quads"});o.waterfall([function(t){r.parse(e,t)},function(e,t,n){null!==e&&i.addTriple(e),"function"==typeof n&&i.end(n)},function(e,t){try{a.fromRDF(e,{format:"application/nquads"},t)}catch(e){t(e)}},function(e,r){n=JSON.stringify(e),t(null,n)}],function(e,r){t(e,n)})}function i(e,t){var n,r=s.Parser(),i=s.Writer({format:"N-Quads"});o.waterfall([function(t){r.parse(e,t)},function(e,t,n){null!==e&&i.addTriple(e),"function"==typeof n&&i.end(n)},function(e,r){n=e,t(null,n)}],function(e,r){t(e,n)})}e.exports.convertToJson=r,e.exports.convertToNQuads=i;var o=n(12),a=n(16),s=n(22)},function(e,t,n){var r,i;(function(n,o){/*!
	 * async
	 * https://github.com/caolan/async
	 *
	 * Copyright 2010-2014 Caolan McMahon
	 * Released under the MIT license
	 */
!function(){function a(e){var t=!1;return function(){if(t)throw new Error("Callback was already called.");t=!0,e.apply(s,arguments)}}var s,u,l={};s=this,null!=s&&(u=s.async),l.noConflict=function(){return s.async=u,l};var c=Object.prototype.toString,f=Array.isArray||function(e){return"[object Array]"===c.call(e)},h=function(e,t){for(var n=0;n<e.length;n+=1)t(e[n],n,e)},d=function(e,t){if(e.map)return e.map(t);var n=[];return h(e,function(e,r,i){n.push(t(e,r,i))}),n},p=function(e,t,n){return e.reduce?e.reduce(t,n):(h(e,function(e,r,i){n=t(n,e,r,i)}),n)},y=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};"undefined"!=typeof n&&n.nextTick?(l.nextTick=n.nextTick,"undefined"!=typeof o?l.setImmediate=function(e){o(e)}:l.setImmediate=l.nextTick):"function"==typeof o?(l.nextTick=function(e){o(e)},l.setImmediate=l.nextTick):(l.nextTick=function(e){setTimeout(e,0)},l.setImmediate=l.nextTick),l.each=function(e,t,n){function r(t){t?(n(t),n=function(){}):(i+=1,i>=e.length&&n())}if(n=n||function(){},!e.length)return n();var i=0;h(e,function(e){t(e,a(r))})},l.forEach=l.each,l.eachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var r=0,i=function(){t(e[r],function(t){t?(n(t),n=function(){}):(r+=1,r>=e.length?n():i())})};i()},l.forEachSeries=l.eachSeries,l.eachLimit=function(e,t,n,r){var i=v(t);i.apply(null,[e,n,r])},l.forEachLimit=l.eachLimit;var v=function(e){return function(t,n,r){if(r=r||function(){},!t.length||e<=0)return r();var i=0,o=0,a=0;!function s(){if(i>=t.length)return r();for(;a<e&&o<t.length;)o+=1,a+=1,n(t[o-1],function(e){e?(r(e),r=function(){}):(i+=1,a-=1,i>=t.length?r():s())})}()}},g=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[l.each].concat(t))}},m=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[v(e)].concat(n))}},b=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[l.eachSeries].concat(t))}},w=function(e,t,n,r){if(t=d(t,function(e,t){return{index:t,value:e}}),r){var i=[];e(t,function(e,t){n(e.value,function(n,r){i[e.index]=r,t(n)})},function(e){r(e,i)})}else e(t,function(e,t){n(e.value,function(e){t(e)})})};l.map=g(w),l.mapSeries=b(w),l.mapLimit=function(e,t,n,r){return x(t)(e,n,r)};var x=function(e){return m(e,w)};l.reduce=function(e,t,n,r){l.eachSeries(e,function(e,r){n(t,e,function(e,n){t=n,r(e)})},function(e){r(e,t)})},l.inject=l.reduce,l.foldl=l.reduce,l.reduceRight=function(e,t,n,r){var i=d(e,function(e){return e}).reverse();l.reduce(i,t,n,r)},l.foldr=l.reduceRight;var _=function(e,t,n,r){var i=[];t=d(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&i.push(e),t()})},function(e){r(d(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};l.filter=g(_),l.filterSeries=b(_),l.select=l.filter,l.selectSeries=l.filterSeries;var k=function(e,t,n,r){var i=[];t=d(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||i.push(e),t()})},function(e){r(d(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};l.reject=g(k),l.rejectSeries=b(k);var T=function(e,t,n,r){e(t,function(e,t){n(e,function(n){n?(r(e),r=function(){}):t()})},function(e){r()})};l.detect=g(T),l.detectSeries=b(T),l.some=function(e,t,n){l.each(e,function(e,r){t(e,function(e){e&&(n(!0),n=function(){}),r()})},function(e){n(!1)})},l.any=l.some,l.every=function(e,t,n){l.each(e,function(e,r){t(e,function(e){e||(n(!1),n=function(){}),r()})},function(e){n(!0)})},l.all=l.every,l.sortBy=function(e,t,n){l.map(e,function(e,n){t(e,function(t,r){t?n(t):n(null,{value:e,criteria:r})})},function(e,t){if(e)return n(e);var r=function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0};n(null,d(t.sort(r),function(e){return e.value}))})},l.auto=function(e,t){t=t||function(){};var n=y(e),r=n.length;if(!r)return t();var i={},o=[],a=function(e){o.unshift(e)},s=function(e){for(var t=0;t<o.length;t+=1)if(o[t]===e)return void o.splice(t,1)},u=function(){r--,h(o.slice(0),function(e){e()})};a(function(){if(!r){var e=t;t=function(){},e(null,i)}}),h(n,function(n){var r=f(e[n])?e[n]:[e[n]],o=function(e){var r=Array.prototype.slice.call(arguments,1);if(r.length<=1&&(r=r[0]),e){var o={};h(y(i),function(e){o[e]=i[e]}),o[n]=r,t(e,o),t=function(){}}else i[n]=r,l.setImmediate(u)},c=r.slice(0,Math.abs(r.length-1))||[],d=function(){return p(c,function(e,t){return e&&i.hasOwnProperty(t)},!0)&&!i.hasOwnProperty(n)};if(d())r[r.length-1](o,i);else{var v=function(){d()&&(s(v),r[r.length-1](o,i))};a(v)}})},l.retry=function(e,t,n){var r=5,i=[];"function"==typeof e&&(n=t,t=e,e=r),e=parseInt(e,10)||r;var o=function(r,o){for(var a=function(e,t){return function(n){e(function(e,r){n(!e||t,{err:e,result:r})},o)}};e;)i.push(a(t,!(e-=1)));l.series(i,function(e,t){t=t[t.length-1],(r||n)(t.err,t.result)})};return n?o():o},l.waterfall=function(e,t){if(t=t||function(){},!f(e)){var n=new Error("First argument to waterfall must be an array of functions");return t(n)}if(!e.length)return t();var r=function(e){return function(n){if(n)t.apply(null,arguments),t=function(){};else{var i=Array.prototype.slice.call(arguments,1),o=e.next();o?i.push(r(o)):i.push(t),l.setImmediate(function(){e.apply(null,i)})}}};r(l.iterator(e))()};var S=function(e,t,n){if(n=n||function(){},f(t))e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.each(y(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}};l.parallel=function(e,t){S({map:l.map,each:l.each},e,t)},l.parallelLimit=function(e,t,n){S({map:x(t),each:v(t)},e,n)},l.series=function(e,t){if(t=t||function(){},f(e))l.mapSeries(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};l.eachSeries(y(e),function(t,r){e[t](function(e){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),n[t]=i,r(e)})},function(e){t(e,n)})}},l.iterator=function(e){var t=function(n){var r=function(){return e.length&&e[n].apply(null,arguments),r.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r};return t(0)},l.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var E=function(e,t,n,r){var i=[];e(t,function(e,t){n(e,function(e,n){i=i.concat(n||[]),t(e)})},function(e){r(e,i)})};l.concat=g(E),l.concatSeries=b(E),l.whilst=function(e,t,n){e()?t(function(r){return r?n(r):void l.whilst(e,t,n)}):n()},l.doWhilst=function(e,t,n){e(function(r){if(r)return n(r);var i=Array.prototype.slice.call(arguments,1);t.apply(null,i)?l.doWhilst(e,t,n):n()})},l.until=function(e,t,n){e()?n():t(function(r){return r?n(r):void l.until(e,t,n)})},l.doUntil=function(e,t,n){e(function(r){if(r)return n(r);var i=Array.prototype.slice.call(arguments,1);t.apply(null,i)?n():l.doUntil(e,t,n)})},l.queue=function(e,t){function n(e,t,n,r){return e.started||(e.started=!0),f(t)||(t=[t]),0==t.length?l.setImmediate(function(){e.drain&&e.drain()}):void h(t,function(t){var i={data:t,callback:"function"==typeof r?r:null};n?e.tasks.unshift(i):e.tasks.push(i),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),l.setImmediate(e.process)})}void 0===t&&(t=1);var r=0,i={tasks:[],concurrency:t,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,t){n(i,e,!1,t)},kill:function(){i.drain=null,i.tasks=[]},unshift:function(e,t){n(i,e,!0,t)},process:function(){if(!i.paused&&r<i.concurrency&&i.tasks.length){var t=i.tasks.shift();i.empty&&0===i.tasks.length&&i.empty(),r+=1;var n=function(){r-=1,t.callback&&t.callback.apply(t,arguments),i.drain&&i.tasks.length+r===0&&i.drain(),i.process()},o=a(n);e(t.data,o)}},length:function(){return i.tasks.length},running:function(){return r},idle:function(){return i.tasks.length+r===0},pause:function(){i.paused!==!0&&(i.paused=!0)},resume:function(){if(i.paused!==!1){i.paused=!1;for(var e=1;e<=i.concurrency;e++)l.setImmediate(i.process)}}};return i},l.priorityQueue=function(e,t){function n(e,t){return e.priority-t.priority}function r(e,t,n){for(var r=-1,i=e.length-1;r<i;){var o=r+(i-r+1>>>1);n(t,e[o])>=0?r=o:i=o-1}return r}function i(e,t,i,o){return e.started||(e.started=!0),f(t)||(t=[t]),0==t.length?l.setImmediate(function(){e.drain&&e.drain()}):void h(t,function(t){var a={data:t,priority:i,callback:"function"==typeof o?o:null};e.tasks.splice(r(e.tasks,a,n)+1,0,a),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),l.setImmediate(e.process)})}var o=l.queue(e,t);return o.push=function(e,t,n){i(o,e,t,n)},delete o.unshift,o},l.cargo=function(e,t){var n=!1,r=[],i={tasks:r,payload:t,saturated:null,empty:null,drain:null,drained:!0,push:function(e,n){f(e)||(e=[e]),h(e,function(e){r.push({data:e,callback:"function"==typeof n?n:null}),i.drained=!1,i.saturated&&r.length===t&&i.saturated()}),l.setImmediate(i.process)},process:function o(){if(!n){if(0===r.length)return i.drain&&!i.drained&&i.drain(),void(i.drained=!0);var a="number"==typeof t?r.splice(0,t):r.splice(0,r.length),s=d(a,function(e){return e.data});i.empty&&i.empty(),n=!0,e(s,function(){n=!1;var e=arguments;h(a,function(t){t.callback&&t.callback.apply(null,e)}),o()})}},length:function(){return r.length},running:function(){return n}};return i};var N=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&h(n,function(t){console[e](t)}))}]))}};l.log=N("log"),l.dir=N("dir"),l.memoize=function(e,t){var n={},r={};t=t||function(e){return e};var i=function(){var i=Array.prototype.slice.call(arguments),o=i.pop(),a=t.apply(null,i);a in n?l.nextTick(function(){o.apply(null,n[a])}):a in r?r[a].push(o):(r[a]=[o],e.apply(null,i.concat([function(){n[a]=arguments;var e=r[a];delete r[a];for(var t=0,i=e.length;t<i;t++)e[t].apply(null,arguments)}])))};return i.memo=n,i.unmemoized=e,i},l.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},l.times=function(e,t,n){for(var r=[],i=0;i<e;i++)r.push(i);return l.map(r,t,n)},l.timesSeries=function(e,t,n){for(var r=[],i=0;i<e;i++)r.push(i);return l.mapSeries(r,t,n)},l.seq=function(){var e=arguments;return function(){var t=this,n=Array.prototype.slice.call(arguments),r=n.pop();l.reduce(e,n,function(e,n,r){n.apply(t,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);r(e,t)}]))},function(e,n){r.apply(t,[e].concat(n))})}},l.compose=function(){return l.seq.apply(null,Array.prototype.reverse.call(arguments))};var R=function(e,t){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return e(t,function(e,t){e.apply(n,r.concat([t]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};l.applyEach=g(R),l.applyEachSeries=b(R),l.forever=function(e,t){function n(r){if(r){if(t)return t(r);throw r}e(n)}n()},"undefined"!=typeof e&&e.exports?e.exports=l:(r=[],i=function(){return l}.apply(t,r),!(void 0!==i&&(e.exports=i)))}()}).call(t,n(13),n(14).setImmediate)},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(c===setTimeout)return setTimeout(e,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function o(e){if(f===clearTimeout)return clearTimeout(e);if((f===r||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){y&&d&&(y=!1,d.length?p=d.concat(p):v=-1,p.length&&s())}function s(){if(!y){var e=i(a);y=!0;for(var t=p.length;t;){for(d=p,p=[];++v<t;)d&&d[v].run();v=-1,t=p.length}d=null,y=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function l(){}var c,f,h=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(e){c=n}try{f="function"==typeof clearTimeout?clearTimeout:r}catch(e){f=r}}();var d,p=[],y=!1,v=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new u(e,t)),1!==p.length||y||i(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t,n){function r(e,t){this._id=e,this._clearFn=t}var i=Function.prototype.apply;t.setTimeout=function(){return new r(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(15),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return y[p]=r,d(p),p++}function i(e){delete y[e]}function o(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}function a(e){if(v)setTimeout(a,0,e);else{var t=y[e];if(t){v=!0;try{o(t)}finally{i(e),v=!1}}}}function s(){d=function(e){t.nextTick(function(){a(e)})}}function u(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function l(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&a(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),d=function(n){e.postMessage(t+n,"*")}}function c(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;a(t)},d=function(t){e.port2.postMessage(t)}}function f(){var e=g.documentElement;d=function(t){var n=g.createElement("script");n.onreadystatechange=function(){a(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function h(){d=function(e){setTimeout(a,0,e)}}if(!e.setImmediate){var d,p=1,y={},v=!1,g=e.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(e);m=m&&m.setTimeout?m:e,"[object process]"==={}.toString.call(e.process)?s():u()?l():e.MessageChannel?c():g&&"onreadystatechange"in g.createElement("script")?f():h(),m.setImmediate=r,m.clearImmediate=i}}("undefined"==typeof self?"undefined"==typeof e?this:e:self)}).call(t,function(){return this}(),n(13))},function(e,t,n){var r,i;(function(o,a,s,u){/**
	 * A JavaScript implementation of the JSON-LD API.
	 *
	 * @author Dave Longley
	 *
	 * @license BSD 3-Clause License
	 * Copyright (c) 2011-2015 Digital Bazaar, Inc.
	 * All rights reserved.
	 *
	 * Redistribution and use in source and binary forms, with or without
	 * modification, are permitted provided that the following conditions are met:
	 *
	 * Redistributions of source code must retain the above copyright notice,
	 * this list of conditions and the following disclaimer.
	 *
	 * Redistributions in binary form must reproduce the above copyright
	 * notice, this list of conditions and the following disclaimer in the
	 * documentation and/or other materials provided with the distribution.
	 *
	 * Neither the name of the Digital Bazaar, Inc. nor the names of its
	 * contributors may be used to endorse or promote products derived from
	 * this software without specific prior written permission.
	 *
	 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	 * IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
	 * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
	 * PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
	 * HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
	 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
	 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	 */
!function(){var l="undefined"!=typeof o&&o.versions&&o.versions.node,c=!l&&("undefined"!=typeof window||"undefined"!=typeof self);c&&"undefined"==typeof a&&("undefined"!=typeof window?a=window:"undefined"!=typeof self?a=self:"undefined"!=typeof $&&(a=$));var f=function(e){function t(){}function r(e){for(var t=[],n=Object.keys(e).sort(),r=0;r<n.length;++r){var i=n[r],o=e[i];B(o)||(o=[o]);for(var a=0;a<o.length;++a){var s=o[a];if(null!==s){if(!z(s))throw new Ce("Invalid JSON-LD syntax; language map values must be strings.","jsonld.SyntaxError",{code:"invalid language map value",languageMap:e});t.push({"@value":s,"@language":i.toLowerCase()})}}}return t}function i(e,t){if(B(t))for(var n=0;n<t.length;++n)t[n]=i(e,t[n]);else if(K(t))t["@list"]=i(e,t["@list"]);else if(q(t)){Z(t)&&(t["@id"]=e.getId(t["@id"]));for(var r=Object.keys(t).sort(),o=0;o<r.length;++o){var a=r[o];"@id"!==a&&(t[a]=i(e,t[a]))}}return t}function f(t,n,r){if(null===r||void 0===r)return null;var i=L(t,n,{vocab:!0});if("@id"===i)return L(t,r,{base:!0});if("@type"===i)return L(t,r,{vocab:!0,base:!0});var o=e.getContextValue(t,n,"@type");if("@id"===o||"@graph"===i&&z(r))return{"@id":L(t,r,{base:!0})};if("@vocab"===o)return{"@id":L(t,r,{vocab:!0,base:!0})};if(M(i))return r;var a={};if(null!==o)a["@type"]=o;else if(z(r)){var s=e.getContextValue(t,n,"@language");null!==s&&(a["@language"]=s)}return["boolean","number","string"].indexOf(typeof r)===-1&&(r=r.toString()),a["@value"]=r,a}function h(e,t,n){for(var r=[],i=Object.keys(e).sort(),o=0;o<i.length;++o)for(var a=i[o],s=e[a],u=Object.keys(s).sort(),l=0;l<u.length;++l){var c=u[l],f=s[c];if("@type"===c)c=Se;else if(M(c))continue;for(var h=0;h<f.length;++h){var y=f[h],v={};if(v.type=0===a.indexOf("_:")?"blank node":"IRI",v.value=a,ee(a)){var g={};if(g.type=0===c.indexOf("_:")?"blank node":"IRI",g.value=c,ee(c)&&("blank node"!==g.type||n.produceGeneralizedRdf))if(K(y))d(y["@list"],t,v,g,r);else{var m=p(y);m&&r.push({subject:v,predicate:g,object:m})}}}}return r}function d(e,t,n,r,i){for(var o={type:"IRI",value:_e},a={type:"IRI",value:ke},s={type:"IRI",value:Te},u=0;u<e.length;++u){var l=e[u],c={type:"blank node",value:t.getId()};i.push({subject:n,predicate:r,object:c}),n=c,r=o;var f=p(l);f&&i.push({subject:n,predicate:r,object:f}),r=a}i.push({subject:n,predicate:r,object:s})}function p(e){var t={};if(Q(e)){t.type="literal";var n=e["@value"],r=e["@type"]||null;J(n)?(t.value=n.toString(),t.datatype=r||ve):W(n)||r===ge?(W(n)||(n=parseFloat(n)),t.value=n.toExponential(15).replace(/(\d)0*e\+?/,"$1E"),t.datatype=r||ge):V(n)?(t.value=n.toFixed(0),t.datatype=r||me):"@language"in e?(t.value=n,t.datatype=r||je,t.language=e["@language"]):(t.value=n,t.datatype=r||be)}else{var i=q(e)?e["@id"]:e;t.type=0===i.indexOf("_:")?"blank node":"IRI",t.value=i}return"IRI"!==t.type||ee(t.value)?t:null}function y(e,t){if("IRI"===e.type||"blank node"===e.type)return{"@id":e.value};var n={"@value":e.value};if(e.language)n["@language"]=e.language;else{var r=e.datatype;if(r||(r=be),t){if(r===ve)"true"===n["@value"]?n["@value"]=!0:"false"===n["@value"]&&(n["@value"]=!1);else if(X(n["@value"]))if(r===me){var i=parseInt(n["@value"],10);i.toFixed(0)===n["@value"]&&(n["@value"]=i)}else r===ge&&(n["@value"]=parseFloat(n["@value"]));[ve,me,ge,be].indexOf(r)===-1&&(n["@type"]=r)}else r!==be&&(n["@type"]=r)}return n}function v(e,t){for(var n=["subject","predicate","object"],r=0;r<n.length;++r){var i=n[r];if(e[i].type!==t[i].type||e[i].value!==t[i].value)return!1}return e.object.language===t.object.language&&e.object.datatype===t.object.datatype}function g(t,n,r,i,o,a){if(B(t))for(var s=0;s<t.length;++s)g(t[s],n,r,i,void 0,a);else{if(!q(t))return void(a&&a.push(t));if(Q(t)){if("@type"in t){var u=t["@type"];0===u.indexOf("_:")&&(t["@type"]=u=i.getId(u))}return void(a&&a.push(t))}if("@type"in t)for(var l=t["@type"],s=0;s<l.length;++s){var u=l[s];0===u.indexOf("_:")&&i.getId(u)}G(o)&&(o=Z(t)?i.getId(t["@id"]):t["@id"]),a&&a.push({"@id":o});var c=n[r],f=c[o]=c[o]||{};f["@id"]=o;for(var h=Object.keys(t).sort(),d=0;d<h.length;++d){var p=h[d];if("@id"!==p)if("@reverse"!==p)if("@graph"!==p)if("@type"!==p&&M(p)){if("@index"===p&&p in f&&(t[p]!==f[p]||t[p]["@id"]!==f[p]["@id"]))throw new Ce("Invalid JSON-LD syntax; conflicting @index property detected.","jsonld.SyntaxError",{code:"conflicting indexes",subject:f});f[p]=t[p]}else{var y=t[p];if(0===p.indexOf("_:")&&(p=i.getId(p)),0!==y.length)for(var v=0;v<y.length;++v){var m=y[v];if("@type"===p&&(m=0===m.indexOf("_:")?i.getId(m):m),$(m)||Y(m)){var b=Z(m)?i.getId(m["@id"]):m["@id"];e.addValue(f,p,{"@id":b},{propertyIsArray:!0,allowDuplicate:!1}),g(m,n,r,i,b)}else if(K(m)){var w=[];g(m["@list"],n,r,i,o,w),m={"@list":w},e.addValue(f,p,m,{propertyIsArray:!0,allowDuplicate:!1})}else g(m,n,r,i,o),e.addValue(f,p,m,{propertyIsArray:!0,allowDuplicate:!1})}else e.addValue(f,p,[],{propertyIsArray:!0})}else{o in n||(n[o]={});var x="@merged"===r?r:o;g(t[p],n,x,i)}else{var _={"@id":o},k=t["@reverse"];for(var T in k)for(var S=k[T],E=0;E<S.length;++E){var N=S[E],R=N["@id"];Z(N)&&(R=i.getId(R)),g(N,n,r,i,R),e.addValue(c[R],T,_,{propertyIsArray:!0,allowDuplicate:!1})}}}}}function m(e){for(var t=e["@default"],n=Object.keys(e).sort(),r=0;r<n.length;++r){var i=n[r];if("@default"!==i){var o=e[i],a=t[i];a?"@graph"in a||(a["@graph"]=[]):t[i]=a={"@id":i,"@graph":[]};for(var s=a["@graph"],u=Object.keys(o).sort(),l=0;l<u.length;++l){var c=o[u[l]];Y(c)||s.push(c)}}}return t}function b(e,t,n,r,i){k(n),n=n[0];for(var o=e.options,a={embed:_(n,o,"embed"),explicit:_(n,o,"explicit"),requireAll:_(n,o,"requireAll")},s=T(e,t,n,a),u=Object.keys(s).sort(),l=0;l<u.length;++l){var c=u[l],f=s[c];if("@link"===a.embed&&c in e.link)N(r,i,e.link[c]);else{null===i&&(e.uniqueEmbeds={});var h={};if(h["@id"]=c,e.link[c]=h,"@never"===a.embed||x(f,e.subjectStack))N(r,i,h);else{"@last"===a.embed&&(c in e.uniqueEmbeds&&E(e,c),e.uniqueEmbeds[c]={parent:r,property:i}),e.subjectStack.push(f);for(var d=Object.keys(f).sort(),p=0;p<d.length;p++){var y=d[p];if(M(y))h[y]=te(f[y]);else if(!a.explicit||y in n)for(var v=f[y],g=0;g<v.length;++g){var m=v[g];if(K(m)){var S={"@list":[]};N(h,y,S);var R=m["@list"];for(var j in R)if(m=R[j],Y(m)){var O=y in n?n[y][0]["@list"]:w(a);b(e,[m["@id"]],O,S,"@list")}else N(S,"@list",te(m))}else if(Y(m)){var O=y in n?n[y]:w(a);b(e,[m["@id"]],O,h,y)}else N(h,y,te(m))}}for(var d=Object.keys(n).sort(),p=0;p<d.length;++p){var y=d[p];if(!M(y)){var I=n[y][0],C=_(I,o,"omitDefault");if(!(C||y in h)){var A="@null";"@default"in I&&(A=te(I["@default"])),B(A)||(A=[A]),h[y]=[{"@preserve":A}]}}}N(r,i,h),e.subjectStack.pop()}}}}function w(e){var t={};for(var n in e)void 0!==e[n]&&(t["@"+n]=[e[n]]);return[t]}function x(e,t){for(var n=t.length-1;n>=0;--n)if(t[n]["@id"]===e["@id"])return!0;return!1}function _(e,t,n){var r="@"+n,i=r in e?e[r][0]:t[n];return"embed"===n&&(i===!0?i="@last":i===!1?i="@never":"@always"!==i&&"@never"!==i&&"@link"!==i&&(i="@last")),i}function k(e){if(!B(e)||1!==e.length||!q(e[0]))throw new Ce("Invalid JSON-LD syntax; a JSON-LD frame must be a single object.","jsonld.SyntaxError",{frame:e})}function T(e,t,n,r){for(var i={},o=0;o<t.length;++o){var a=t[o],s=e.subjects[a];S(s,n,r)&&(i[a]=s)}return i}function S(t,n,r){if("@type"in n&&(1!==n["@type"].length||!q(n["@type"][0]))){for(var i=n["@type"],o=0;o<i.length;++o)if(e.hasValue(t,"@type",i[o]))return!0;return!1}var a=!0,s=!1;for(var u in n){if(M(u)){if("@id"!==u&&"@type"!==u)continue;if(a=!1,"@id"===u&&z(n[u])){if(t[u]!==n[u])return!1;s=!0;continue}}if(a=!1,u in t){if(B(n[u])&&0===n[u].length&&void 0!==t[u])return!1;s=!0}else{var l=B(n[u])&&q(n[u][0])&&"@default"in n[u][0];if(r.requireAll&&!l)return!1}}return a||s}function E(t,n){var r=t.uniqueEmbeds,i=r[n],o=i.parent,a=i.property,s={"@id":n};if(B(o)){for(var u=0;u<o.length;++u)if(e.compareValues(o[u],s)){o[u]=s;break}}else{var l=B(o[a]);e.removeValue(o,a,s,{propertyIsArray:l}),e.addValue(o,a,s,{propertyIsArray:l})}var c=function(e){for(var t=Object.keys(r),n=0;n<t.length;++n){var i=t[n];i in r&&q(r[i].parent)&&r[i].parent["@id"]===e&&(delete r[i],c(i))}};c(n)}function N(t,n,r){q(t)?e.addValue(t,n,r,{propertyIsArray:!0}):t.push(r)}/**
	 * Removes the @preserve keywords as the last step of the framing algorithm.
	 *
	 * @param ctx the active context used to compact the input.
	 * @param input the framed, compacted output.
	 * @param options the compaction options used.
	 *
	 * @return the resulting output.
	 */
function R(t,n,r){if(B(n)){for(var i=[],o=0;o<n.length;++o){var a=R(t,n[o],r);null!==a&&i.push(a)}n=i}else if(q(n)){
// remove @preserve
if("@preserve"in n)return"@null"===n["@preserve"]?null:n["@preserve"];if(Q(n))return n;if(K(n))return n["@list"]=R(t,n["@list"],r),n;var s=I(t,"@id");if(s in n){var u=n[s];if(u in r.link){var l=r.link[u].indexOf(n);if(l!==-1)return r.link[u][l];r.link[u].push(n)}else r.link[u]=[n]}for(var c in n){var a=R(t,n[c],r),f=e.getContextValue(t,c,"@container");r.compactArrays&&B(a)&&1===a.length&&null===f&&(a=a[0]),n[c]=a}}return n}function j(e,t){return e.length<t.length?-1:t.length<e.length?1:e===t?0:e<t?-1:1}function O(e,t,n,r,i,o){null===o&&(o="@null");var a=[];if("@id"!==o&&"@reverse"!==o||!Y(n))a.push(o);else{"@reverse"===o&&a.push("@reverse");var s=I(e,n["@id"],null,{vocab:!0});s in e.mappings&&e.mappings[s]&&e.mappings[s]["@id"]===n["@id"]?a.push.apply(a,["@vocab","@id"]):a.push.apply(a,["@id","@vocab"])}a.push("@none");for(var u=e.inverse[t],l=0;l<r.length;++l){var c=r[l];if(c in u)for(var f=u[c][i],h=0;h<a.length;++h){var d=a[h];if(d in f)return f[d]}}return null}function I(e,t,n,r,i){if(null===t)return t;if(G(n)&&(n=null),G(i)&&(i=!1),r=r||{},M(t)&&(r.vocab=!0),r.vocab&&t in e.getInverse()){var o=e["@language"]||"@none",a=[];q(n)&&"@index"in n&&a.push("@index");var s="@language",u="@null";if(i)s="@type",u="@reverse",a.push("@set");else if(K(n)){"@index"in n||a.push("@list");for(var l=n["@list"],c=0===l.length?o:null,f=null,h=0;h<l.length;++h){var d=l[h],p="@none",y="@none";if(Q(d)?"@language"in d?p=d["@language"]:"@type"in d?y=d["@type"]:p="@null":y="@id",null===c?c=p:p!==c&&Q(d)&&(c="@none"),null===f?f=y:y!==f&&(f="@none"),"@none"===c&&"@none"===f)break}c=c||"@none",f=f||"@none","@none"!==f?(s="@type",u=f):u=c}else Q(n)?"@language"in n&&!("@index"in n)?(a.push("@language"),u=n["@language"]):"@type"in n&&(s="@type",u=n["@type"]):(s="@type",u="@id"),a.push("@set");a.push("@none");var v=O(e,t,n,a,s,u);if(null!==v)return v}if(r.vocab&&"@vocab"in e){var g=e["@vocab"];if(0===t.indexOf(g)&&t!==g){var m=t.substr(g.length);if(!(m in e.mappings))return m}}var b=null;for(var v in e.mappings)if(v.indexOf(":")===-1){var w=e.mappings[v];if(w&&w["@id"]!==t&&0===t.indexOf(w["@id"])){var x=v+":"+t.substr(w["@id"].length),_=!(x in e.mappings)||null===n&&e.mappings[x]&&e.mappings[x]["@id"]===t;_&&(null===b||j(x,b)<0)&&(b=x)}}return null!==b?b:r.vocab?t:P(e["@base"],t)}function C(t,n,r){if(Q(r)){var i=e.getContextValue(t,n,"@type"),o=e.getContextValue(t,n,"@language"),a=e.getContextValue(t,n,"@container"),s="@index"in r&&"@index"!==a;if(!s&&(r["@type"]===i||r["@language"]===o))return r["@value"];var u=Object.keys(r).length,l=1===u||2===u&&"@index"in r&&!s,c="@language"in t,f=z(r["@value"]),h=t.mappings[n]&&null===t.mappings[n]["@language"];if(l&&(!c||!f||h))return r["@value"];var d={};return s&&(d[I(t,"@index")]=r["@index"]),"@type"in r?d[I(t,"@type")]=I(t,r["@type"],null,{vocab:!0}):"@language"in r&&(d[I(t,"@language")]=r["@language"]),d[I(t,"@value")]=r["@value"],d}var p=L(t,n,{vocab:!0}),i=e.getContextValue(t,n,"@type"),y=I(t,r["@id"],null,{vocab:"@vocab"===i});if("@id"===i||"@vocab"===i||"@graph"===p)return y;var d={};return d[I(t,"@id")]=y,d}function A(e,t,n,r){if(n in r){if(r[n])return;throw new Ce("Cyclical context definition detected.","jsonld.CyclicalContext",{code:"cyclic IRI mapping",context:t,term:n})}if(r[n]=!1,M(n))throw new Ce("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{code:"keyword redefinition",context:t,term:n});if(""===n)throw new Ce("Invalid JSON-LD syntax; a term cannot be an empty string.","jsonld.SyntaxError",{code:"invalid term definition",context:t});e.mappings[n]&&delete e.mappings[n];var i=t[n];if(null===i||q(i)&&null===i["@id"])return e.mappings[n]=null,void(r[n]=!0);if(z(i)&&(i={"@id":i}),!q(i))throw new Ce("Invalid JSON-LD syntax; @context property values must be strings or objects.","jsonld.SyntaxError",{code:"invalid term definition",context:t});var o=e.mappings[n]={};if(o.reverse=!1,"@reverse"in i){if("@id"in i)throw new Ce("Invalid JSON-LD syntax; a @reverse term definition must not contain @id.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});var a=i["@reverse"];if(!z(a))throw new Ce("Invalid JSON-LD syntax; a @context @reverse value must be a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});var s=L(e,a,{vocab:!0,base:!1},t,r);if(!ee(s))throw new Ce("Invalid JSON-LD syntax; a @context @reverse value must be an absolute IRI or a blank node identifier.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});o["@id"]=s,o.reverse=!0}else if("@id"in i){var s=i["@id"];if(!z(s))throw new Ce("Invalid JSON-LD syntax; a @context @id value must be an array of strings or a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});if(s!==n){if(s=L(e,s,{vocab:!0,base:!1},t,r),!ee(s)&&!M(s))throw new Ce("Invalid JSON-LD syntax; a @context @id value must be an absolute IRI, a blank node identifier, or a keyword.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});o["@id"]=s}}if(!("@id"in o)){var u=n.indexOf(":");if(u!==-1){var l=n.substr(0,u);if(l in t&&A(e,t,l,r),e.mappings[l]){var c=n.substr(u+1);o["@id"]=e.mappings[l]["@id"]+c}else o["@id"]=n}else{if(!("@vocab"in e))throw new Ce("Invalid JSON-LD syntax; @context terms must define an @id.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t,term:n});o["@id"]=e["@vocab"]+n}}if(r[n]=!0,"@type"in i){var f=i["@type"];if(!z(f))throw new Ce("Invalid JSON-LD syntax; an @context @type values must be a string.","jsonld.SyntaxError",{code:"invalid type mapping",context:t});if("@id"!==f&&"@vocab"!==f){if(f=L(e,f,{vocab:!0,base:!1},t,r),!ee(f))throw new Ce("Invalid JSON-LD syntax; an @context @type value must be an absolute IRI.","jsonld.SyntaxError",{code:"invalid type mapping",context:t});if(0===f.indexOf("_:"))throw new Ce("Invalid JSON-LD syntax; an @context @type values must be an IRI, not a blank node identifier.","jsonld.SyntaxError",{code:"invalid type mapping",context:t})}o["@type"]=f}if("@container"in i){var h=i["@container"];if("@list"!==h&&"@set"!==h&&"@index"!==h&&"@language"!==h)throw new Ce("Invalid JSON-LD syntax; @context @container value must be one of the following: @list, @set, @index, or @language.","jsonld.SyntaxError",{code:"invalid container mapping",context:t});if(o.reverse&&"@index"!==h&&"@set"!==h&&null!==h)throw new Ce("Invalid JSON-LD syntax; @context @container value for a @reverse type definition must be @index or @set.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});o["@container"]=h}if("@language"in i&&!("@type"in i)){var d=i["@language"];if(null!==d&&!z(d))throw new Ce("Invalid JSON-LD syntax; @context @language value must be a string or null.","jsonld.SyntaxError",{code:"invalid language mapping",context:t});null!==d&&(d=d.toLowerCase()),o["@language"]=d}
// disallow aliasing @context and @preserve
var s=o["@id"];if("@context"===s||"@preserve"===s)throw new Ce("Invalid JSON-LD syntax; @context and @preserve cannot be aliased.","jsonld.SyntaxError",{code:"invalid keyword alias",context:t})}function L(t,n,r,i,o){if(null===n||M(n))return n;if(n=String(n),i&&n in i&&o[n]!==!0&&A(t,i,n,o),r=r||{},r.vocab){var a=t.mappings[n];if(null===a)return null;if(a)return a["@id"]}var s=n.indexOf(":");if(s!==-1){var u=n.substr(0,s),l=n.substr(s+1);if("_"===u||0===l.indexOf("//"))return n;i&&u in i&&A(t,i,u,o);var a=t.mappings[u];return a?a["@id"]+l:n}if(r.vocab&&"@vocab"in t)return t["@vocab"]+n;var c=n;return r.base&&(c=e.prependBase(t["@base"],c)),c}function D(t,n){if(null===t)return n;if(n.indexOf(":")!==-1)return n;z(t)&&(t=e.url.parse(t||""));var r=e.url.parse(n),i={protocol:t.protocol||""};if(null!==r.authority)i.authority=r.authority,i.path=r.path,i.query=r.query;else if(i.authority=t.authority,""===r.path)i.path=t.path,null!==r.query?i.query=r.query:i.query=t.query;else{if(0===r.path.indexOf("/"))i.path=r.path;else{var o=t.path;""!==r.path&&(o=o.substr(0,o.lastIndexOf("/")+1),o.length>0&&"/"!==o.substr(-1)&&(o+="/"),o+=r.path),i.path=o}i.query=r.query}i.path=le(i.path,!!i.authority);var a=i.protocol;return null!==i.authority&&(a+="//"+i.authority),a+=i.path,null!==i.query&&(a+="?"+i.query),null!==r.fragment&&(a+="#"+r.fragment),""===a&&(a="./"),a}function P(t,n){if(null===t)return n;z(t)&&(t=e.url.parse(t||""));var r="";if(""!==t.href?r+=(t.protocol||"")+"//"+(t.authority||""):n.indexOf("//")&&(r+="//"),0!==n.indexOf(r))return n;for(var i=e.url.parse(n.substr(r.length)),o=t.normalizedPath.split("/"),a=i.normalizedPath.split("/"),s=i.fragment||i.query?0:1;o.length>0&&a.length>s&&o[0]===a[0];)o.shift(),a.shift();var u="";if(o.length>0){o.pop();for(var l=0;l<o.length;++l)u+="../"}return u+=a.join("/"),null!==i.query&&(u+="?"+i.query),null!==i.fragment&&(u+="#"+i.fragment),""===u&&(u="./"),u}function U(t){function n(){var e=this;if(e.inverse)return e.inverse;for(var t=e.inverse={},n=e["@language"]||"@none",i=e.mappings,o=Object.keys(i).sort(j),a=0;a<o.length;++a){var s=o[a],u=i[s];if(null!==u){var l=u["@container"]||"@none",c=u["@id"];B(c)||(c=[c]);for(var f=0;f<c.length;++f){var h=c[f],d=t[h];if(d||(t[h]=d={}),d[l]||(d[l]={"@language":{},"@type":{}}),d=d[l],u.reverse)r(u,s,d["@type"],"@reverse");else if("@type"in u)r(u,s,d["@type"],u["@type"]);else if("@language"in u){var p=u["@language"]||"@null";r(u,s,d["@language"],p)}else r(u,s,d["@language"],n),r(u,s,d["@type"],"@none"),r(u,s,d["@language"],"@none")}}}return t}function r(e,t,n,r){r in n||(n[r]=t)}function i(){var e={};return e["@base"]=this["@base"],e.mappings=te(this.mappings),e.clone=this.clone,e.inverse=null,e.getInverse=this.getInverse,"@language"in this&&(e["@language"]=this["@language"]),"@vocab"in this&&(e["@vocab"]=this["@vocab"]),e}var o=e.url.parse(t.base||"");return{"@base":o,mappings:{},inverse:null,getInverse:n,clone:i}}function M(e){if(!z(e))return!1;switch(e){case"@base":case"@context":case"@container":case"@default":case"@embed":case"@explicit":case"@graph":case"@id":case"@index":case"@language":case"@list":case"@omitDefault":case"@preserve":case"@requireAll":case"@reverse":case"@set":case"@type":case"@value":case"@vocab":return!0}return!1}function q(e){return"[object Object]"===Object.prototype.toString.call(e)}function F(e){return q(e)&&0===Object.keys(e).length}function B(e){return Array.isArray(e)}function H(e){if(!z(e)&&!F(e)){var t=!1;if(B(e)){t=!0;for(var n=0;n<e.length;++n)if(!z(e[n])){t=!1;break}}if(!t)throw new Ce('Invalid JSON-LD syntax; "@type" value must a string, an array of strings, or an empty object.',"jsonld.SyntaxError",{code:"invalid type value",value:e})}}function z(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)}function V(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function W(e){return V(e)&&String(e).indexOf(".")!==-1}function X(e){return!isNaN(parseFloat(e))&&isFinite(e)}function J(e){return"boolean"==typeof e||"[object Boolean]"===Object.prototype.toString.call(e)}function G(e){return"undefined"==typeof e}function $(e){var t=!1;if(q(e)&&!("@value"in e||"@set"in e||"@list"in e)){var n=Object.keys(e).length;t=n>1||!("@id"in e)}return t}function Y(e){return q(e)&&1===Object.keys(e).length&&"@id"in e}function Q(e){return q(e)&&"@value"in e}function K(e){return q(e)&&"@list"in e}function Z(e){var t=!1;return q(e)&&(t="@id"in e?0===e["@id"].indexOf("_:"):0===Object.keys(e).length||!("@value"in e||"@set"in e||"@list"in e)),t}function ee(e){return z(e)&&e.indexOf(":")!==-1}function te(e){if(e&&"object"==typeof e){var t;if(B(e)){t=[];for(var n=0;n<e.length;++n)t[n]=te(e[n])}else if(q(e)){t={};for(var r in e)t[r]=te(e[r])}else t=e.toString();return t}return e}function ne(t,n,r,i){var o=Object.keys(n).length;if(B(t)){for(var a=0;a<t.length;++a)ne(t[a],n,r,i);return o<Object.keys(n).length}if(q(t)){for(var s in t)if("@context"===s){var u=t[s];if(B(u))for(var l=u.length,a=0;a<l;++a){var c=u[a];z(c)&&(c=e.prependBase(i,c),r?(c=n[c],B(c)?(Array.prototype.splice.apply(u,[a,1].concat(c)),a+=c.length-1,l=u.length):u[a]=c):c in n||(n[c]=!1))}else z(u)&&(u=e.prependBase(i,u),r?t[s]=n[u]:u in n||(n[u]=!1))}else ne(t[s],n,r,i);return o<Object.keys(n).length}return!1}function re(e,t,n){var r=null,i=t.documentLoader,o=function(e,t,n,i,a){if(Object.keys(t).length>Ie)return r=new Ce("Maximum number of @context URLs exceeded.","jsonld.ContextUrlError",{code:"loading remote context failed",max:Ie}),a(r);var s={},u=function(){ne(e,s,!0,i),a(null,e)};ne(e,s,!1,i)||u();var l=[];for(var c in s)s[c]===!1&&l.push(c);for(var f=l.length,h=0;h<l.length;++h)!function(e){if(e in t)return r=new Ce("Cyclical @context URLs detected.","jsonld.ContextUrlError",{code:"recursive context inclusion",url:e}),a(r);var i=te(t);i[e]=!0;var l=function(t,l){if(!r){var c=l?l.document:null;if(!t&&z(c))try{c=JSON.parse(c)}catch(e){t=e}if(t?t=new Ce("Dereferencing a URL did not result in a valid JSON-LD object. Possible causes are an inaccessible URL perhaps due to a same-origin policy (ensure the server uses CORS if you are using client-side JavaScript), too many redirects, a non-JSON response, or more than one HTTP Link Header was provided for a remote context.","jsonld.InvalidUrl",{code:"loading remote context failed",url:e,cause:t}):q(c)||(t=new Ce("Dereferencing a URL did not result in a JSON object. The response was valid JSON, but it was not a JSON object.","jsonld.InvalidUrl",{code:"invalid remote context",url:e,cause:t})),t)return r=t,a(r);c="@context"in c?{"@context":c["@context"]}:{"@context":{}},l.contextUrl&&(B(c["@context"])||(c["@context"]=[c["@context"]]),c["@context"].push(l.contextUrl)),o(c,i,n,e,function(t,n){return t?a(t):(s[e]=n["@context"],f-=1,void(0===f&&u()))})}},c=n(e,l);c&&"then"in c&&c.then(l.bind(null,null),l)}(l[h])};o(e,{},i,t.base,n)}function ie(e){for(var t="(?:<([^:]+:[^>]*)>)",n="(_:(?:[A-Za-z0-9]+))",r='"([^"\\\\]*(?:\\\\.[^"\\\\]*)*)"',i="(?:\\^\\^"+t+")",o="(?:@([a-z]+(?:-[a-z0-9]+)*))",a="(?:"+r+"(?:"+i+"|"+o+")?)",s="(?:#.*)?",u="[ \\t]+",l="[ \\t]*",c=/(?:\r\n)|(?:\n)|(?:\r)/g,f=new RegExp("^"+l+s+"$"),h="(?:"+t+"|"+n+")"+u,d=t+u,p="(?:"+t+"|"+n+"|"+a+")"+l,y="(?:\\.|(?:(?:"+t+"|"+n+")"+l+"\\.))",g=new RegExp("^"+l+h+d+p+y+l+s+"$"),m={},b=e.split(c),w=0,x=0;x<b.length;++x){var _=b[x];if(w++,!f.test(_)){var k=_.match(g);if(null===k)throw console.log(g),new Ce("Error while parsing N-Quads; invalid quad.","jsonld.ParseError",{line:w});var T={};if(G(k[1])?T.subject={type:"blank node",value:k[2]}:T.subject={type:"IRI",value:k[1]},T.predicate={type:"IRI",value:k[3]},G(k[4]))if(G(k[5])){T.object={type:"literal"},G(k[7])?G(k[8])?T.object.datatype=be:(T.object.datatype=je,T.object.language=k[8]):T.object.datatype=k[7];var S=k[6].replace(/\\"/g,'"').replace(/\\t/g,"\t").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\/g,"\\");T.object.value=S}else T.object={type:"blank node",value:k[5]};else T.object={type:"IRI",value:k[4]};var E="@default";if(G(k[9])?G(k[10])||(E=k[10]):E=k[9],E in m){for(var N=!0,R=m[E],j=0;N&&j<R.length;++j)v(R[j],T)&&(N=!1);N&&R.push(T)}else m[E]=[T]}}return m}function oe(e){var t=[];for(var n in e)for(var r=e[n],i=0;i<r.length;++i){var o=r[i];"@default"===n&&(n=null),t.push(ae(o,n))}return t.sort().join("")}function ae(e,t){var n=e.subject,r=e.predicate,i=e.object,o=t||null;"name"in e&&e.name&&(o=e.name.value);var a="";if(a+="IRI"===n.type?"<"+n.value+">":n.value,a+=" ",a+="IRI"===r.type?"<"+r.value+">":r.value,a+=" ","IRI"===i.type)a+="<"+i.value+">";else if("blank node"===i.type)a+=i.value;else{var s=i.value.replace(/\\/g,"\\\\").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\"/g,'\\"');a+='"'+s+'"',i.datatype===je?i.language&&(a+="@"+i.language):i.datatype!==be&&(a+="^^<"+i.datatype+">")}return null!==o&&void 0!==o&&(a+=0!==o.indexOf("_:")?" <"+o+">":" "+o),a+=" .\n"}function se(e){var t={};t["@default"]=[];for(var n=e.getSubjects(),r=0;r<n.length;++r){var i=n[r];if(null!==i){var o=e.getSubjectTriples(i);if(null!==o){var a=o.predicates;for(var s in a)for(var u=a[s].objects,l=0;l<u.length;++l){var c=u[l],f={};0===i.indexOf("_:")?f.subject={type:"blank node",value:i}:f.subject={type:"IRI",value:i},0===s.indexOf("_:")?f.predicate={type:"blank node",value:s}:f.predicate={type:"IRI",value:s};var h=c.value;if(c.type===Ne){pe||Me();var d=new pe;h="";for(var p=0;p<c.value.length;p++)c.value[p].nodeType===ye.ELEMENT_NODE?h+=d.serializeToString(c.value[p]):c.value[p].nodeType===ye.TEXT_NODE&&(h+=c.value[p].nodeValue)}f.object={},c.type===Re?0===c.value.indexOf("_:")?f.object.type="blank node":f.object.type="IRI":(f.object.type="literal",c.type===Ee?c.language?(f.object.datatype=je,f.object.language=c.language):f.object.datatype=be:f.object.datatype=c.type),f.object.value=h,t["@default"].push(f)}}}}return t}function ue(e){this.prefix=e,this.counter=0,this.existing={}}function le(e,t){var n="";0===e.indexOf("/")&&(n="/");for(var r=e.split("/"),i=[];r.length>0;)"."===r[0]||""===r[0]&&r.length>1?r.shift():".."!==r[0]?i.push(r.shift()):(r.shift(),t||i.length>0&&".."!==i[i.length-1]?i.pop():i.push(".."));return n+i.join("/")}e.compact=function(t,n,r,i){function o(e,t,r,o){if(e)return i(e);o.compactArrays&&!o.graph&&B(t)?1===t.length?t=t[0]:0===t.length&&(t={}):o.graph&&q(t)&&(t=[t]),q(n)&&"@context"in n&&(n=n["@context"]),n=te(n),B(n)||(n=[n]);var a=n;n=[];for(var s=0;s<a.length;++s)(!q(a[s])||Object.keys(a[s]).length>0)&&n.push(a[s]);var u=n.length>0;if(1===n.length&&(n=n[0]),B(t)){var l=I(r,"@graph"),c=t;t={},u&&(t["@context"]=n),t[l]=c}else if(q(t)&&u){var c=t;t={"@context":n};for(var f in c)t[f]=c[f]}i(null,t,r)}if(arguments.length<2)return e.nextTick(function(){i(new TypeError("Could not compact, too few arguments."))});if("function"==typeof r&&(i=r,r={}),r=r||{},null===n)return e.nextTick(function(){i(new Ce("The compaction context must not be null.","jsonld.CompactError",{code:"invalid local context"}))});if(null===t)return e.nextTick(function(){i(null,null)});"base"in r||(r.base="string"==typeof t?t:""),"compactArrays"in r||(r.compactArrays=!0),"graph"in r||(r.graph=!1),"skipExpansion"in r||(r.skipExpansion=!1),"documentLoader"in r||(r.documentLoader=e.loadDocument),"link"in r||(r.link=!1),r.link&&(r.skipExpansion=!0);var a=function(t,n,r){e.nextTick(function(){return n.skipExpansion?r(null,t):void e.expand(t,n,r)})};a(t,r,function(t,a){if(t)return i(new Ce("Could not expand input before compaction.","jsonld.CompactError",{cause:t}));var s=U(r);e.processContext(s,n,r,function(e,t){if(e)return i(new Ce("Could not process context before compaction.","jsonld.CompactError",{cause:e}));var n;try{n=(new Ae).compact(t,null,a,r)}catch(e){return i(e)}o(null,n,t,r)})})},e.expand=function(t,n,r){function i(e){"base"in n||(n.base=e.documentUrl||"");var t={document:te(e.document),remoteContext:{"@context":e.contextUrl}};if("expandContext"in n){var i=te(n.expandContext);"object"==typeof i&&"@context"in i?t.expandContext=i:t.expandContext={"@context":i}}re(t,n,function(e,t){if(e)return r(e);var i;try{var o=new Ae,a=U(n),s=t.document,u=t.remoteContext["@context"];t.expandContext&&(a=o.processContext(a,t.expandContext["@context"],n)),u&&(a=o.processContext(a,u,n)),i=o.expand(a,null,s,n,!1),q(i)&&"@graph"in i&&1===Object.keys(i).length?i=i["@graph"]:null===i&&(i=[]),B(i)||(i=[i])}catch(e){return r(e)}r(null,i)})}return arguments.length<1?e.nextTick(function(){r(new TypeError("Could not expand, too few arguments."))}):("function"==typeof n&&(r=n,n={}),n=n||{},"documentLoader"in n||(n.documentLoader=e.loadDocument),"keepFreeFloatingNodes"in n||(n.keepFreeFloatingNodes=!1),void e.nextTick(function(){if("string"==typeof t){var e=function(e,t){if(e)return r(e);try{if(!t.document)throw new Ce("No remote document found at the given URL.","jsonld.NullRemoteDocument");"string"==typeof t.document&&(t.document=JSON.parse(t.document))}catch(e){return r(new Ce("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:e,remoteDoc:t}))}i(t)},o=n.documentLoader(t,e);return void(o&&"then"in o&&o.then(e.bind(null,null),e))}i({contextUrl:null,documentUrl:null,document:t})}))},e.flatten=function(t,n,r,i){return arguments.length<1?e.nextTick(function(){i(new TypeError("Could not flatten, too few arguments."))}):("function"==typeof r?(i=r,r={}):"function"==typeof n&&(i=n,n=null,r={}),r=r||{},"base"in r||(r.base="string"==typeof t?t:""),"documentLoader"in r||(r.documentLoader=e.loadDocument),void e.expand(t,r,function(t,o){if(t)return i(new Ce("Could not expand input before flattening.","jsonld.FlattenError",{cause:t}));var a;try{a=(new Ae).flatten(o)}catch(e){return i(e)}return null===n?i(null,a):(r.graph=!0,r.skipExpansion=!0,void e.compact(a,n,r,function(e,t){return e?i(new Ce("Could not compact flattened output.","jsonld.FlattenError",{cause:e})):void i(null,t)}))}))},e.frame=function(t,n,r,i){function o(n){var o,a=n.document;a?(o=a["@context"],n.contextUrl?(o?B(o)?o.push(n.contextUrl):o=[o,n.contextUrl]:o=n.contextUrl,a["@context"]=o):o=o||{}):o={},e.expand(t,r,function(t,n){if(t)return i(new Ce("Could not expand input before framing.","jsonld.FrameError",{cause:t}));var s=te(r);s.isFrame=!0,s.keepFreeFloatingNodes=!0,e.expand(a,s,function(t,r){if(t)return i(new Ce("Could not expand frame before framing.","jsonld.FrameError",{cause:t}));var a;try{a=(new Ae).frame(n,r,s)}catch(e){return i(e)}s.graph=!0,s.skipExpansion=!0,s.link={},e.compact(a,o,s,function(e,t,n){if(e)return i(new Ce("Could not compact framed output.","jsonld.FrameError",{cause:e}));var r=I(n,"@graph");
// remove @preserve from results
s.link={},t[r]=R(n,t[r],s),i(null,t)})})})}return arguments.length<2?e.nextTick(function(){i(new TypeError("Could not frame, too few arguments."))}):("function"==typeof r&&(i=r,r={}),r=r||{},"base"in r||(r.base="string"==typeof t?t:""),"documentLoader"in r||(r.documentLoader=e.loadDocument),"embed"in r||(r.embed="@last"),r.explicit=r.explicit||!1,"requireAll"in r||(r.requireAll=!0),r.omitDefault=r.omitDefault||!1,void e.nextTick(function(){if("string"==typeof n){var e=function(e,t){if(e)return i(e);try{if(!t.document)throw new Ce("No remote document found at the given URL.","jsonld.NullRemoteDocument");"string"==typeof t.document&&(t.document=JSON.parse(t.document))}catch(e){return i(new Ce("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:e,remoteDoc:t}))}o(t)},t=r.documentLoader(n,e);return void(t&&"then"in t&&t.then(e.bind(null,null),e))}o({contextUrl:null,documentUrl:null,document:n})}))},e.link=function(t,n,r,i){var o={};n&&(o["@context"]=n),o["@embed"]="@link",e.frame(t,o,r,i)},e.objectify=function(t,n,r,i){"function"==typeof r&&(i=r,r={}),r=r||{},"base"in r||(r.base="string"==typeof t?t:""),"documentLoader"in r||(r.documentLoader=e.loadDocument),e.expand(t,r,function(t,o){if(t)return i(new Ce("Could not expand input before linking.","jsonld.LinkError",{cause:t}));var a;try{a=(new Ae).flatten(o)}catch(e){return i(e)}r.graph=!0,r.skipExpansion=!0,e.compact(a,n,r,function(t,n,r){if(t)return i(new Ce("Could not compact flattened output before linking.","jsonld.LinkError",{cause:t}));var o=I(r,"@graph"),a=n[o][0],s=function(t){if(q(t)||B(t)){if(q(t)){if(s.visited[t["@id"]])return;s.visited[t["@id"]]=!0}for(var n in t){var i=t[n],o="@id"===e.getContextValue(r,n,"@type");if(B(i)||q(i)||o)if(z(i)&&o)t[n]=i=a[i],s(i);else if(B(i))for(var u=0;u<i.length;++u)z(i[u])&&o?i[u]=a[i[u]]:q(i[u])&&"@id"in i[u]&&(i[u]=a[i[u]["@id"]]),s(i[u]);else if(q(i)){var l=i["@id"];t[n]=i=a[l],s(i)}}}};s.visited={},s(a),n.of_type={};for(var u in a)if("@type"in a[u]){var l=a[u]["@type"];B(l)||(l=[l]);for(var c=0;c<l.length;++c)l[c]in n.of_type||(n.of_type[l[c]]=[]),n.of_type[l[c]].push(a[u])}i(null,n)})})},e.normalize=function(t,n,r){if(arguments.length<1)return e.nextTick(function(){r(new TypeError("Could not normalize, too few arguments."))});if("function"==typeof n&&(r=n,n={}),n=n||{},"algorithm"in n||(n.algorithm="URGNA2012"),"base"in n||(n.base="string"==typeof t?t:""),"documentLoader"in n||(n.documentLoader=e.loadDocument),"inputFormat"in n){if("application/nquads"!==n.inputFormat)return r(new Ce("Unknown normalization input format.","jsonld.NormalizeError"));var i=ie(t);(new Ae).normalize(i,n,r)}else{var o=te(n);delete o.format,o.produceGeneralizedRdf=!1,e.toRDF(t,o,function(e,t){return e?r(new Ce("Could not convert input to RDF dataset before normalization.","jsonld.NormalizeError",{cause:e})):void(new Ae).normalize(t,n,r)})}},e.fromRDF=function(t,n,r){return arguments.length<1?e.nextTick(function(){r(new TypeError("Could not convert from RDF, too few arguments."))}):("function"==typeof n&&(r=n,n={}),n=n||{},"useRdfType"in n||(n.useRdfType=!1),"useNativeTypes"in n||(n.useNativeTypes=!1),"format"in n||!z(t)||"format"in n||(n.format="application/nquads"),void e.nextTick(function(){function e(e,t,n){(new Ae).fromRDF(e,t,n)}var i;if(n.format){if(i=n.rdfParser||de[n.format],!i)return r(new Ce("Unknown input format.","jsonld.UnknownFormat",{format:n.format}))}else i=function(){return t};var o=!1;try{t=i(t,function(t,i){return o=!0,t?r(t):void e(i,n,r)})}catch(e){if(!o)return r(e);throw e}if(t){if("then"in t)return t.then(function(t){e(t,n,r)},r);e(t,n,r)}}))},e.toRDF=function(t,n,r){return arguments.length<1?e.nextTick(function(){r(new TypeError("Could not convert to RDF, too few arguments."))}):("function"==typeof n&&(r=n,n={}),n=n||{},"base"in n||(n.base="string"==typeof t?t:""),"documentLoader"in n||(n.documentLoader=e.loadDocument),void e.expand(t,n,function(e,t){if(e)return r(new Ce("Could not expand input before serialization to RDF.","jsonld.RdfError",{cause:e}));var i;try{if(i=Ae.prototype.toRDF(t,n),n.format){if("application/nquads"===n.format)return r(null,oe(i));throw new Ce("Unknown output format.","jsonld.UnknownFormat",{format:n.format})}}catch(e){return r(e)}r(null,i)}))},e.createNodeMap=function(t,n,r){return arguments.length<1?e.nextTick(function(){r(new TypeError("Could not create node map, too few arguments."))}):("function"==typeof n&&(r=n,n={}),n=n||{},"base"in n||(n.base="string"==typeof t?t:""),"documentLoader"in n||(n.documentLoader=e.loadDocument),void e.expand(t,n,function(e,t){if(e)return r(new Ce("Could not expand input before creating node map.","jsonld.CreateNodeMapError",{cause:e}));var i;try{i=(new Ae).createNodeMap(t,n)}catch(e){return r(e)}r(null,i)}))},e.merge=function(t,n,r,i){function o(e,t){if(!u){if(e)return u=e,i(new Ce("Could not expand input before flattening.","jsonld.FlattenError",{cause:e}));s.push(t),0===--l&&a(s)}}function a(t){var o=!0;"mergeNodes"in r&&(o=r.mergeNodes);var a,s=r.namer||r.issuer||new ue("_:b"),u={"@default":{}};try{for(var l=0;l<t.length;++l){var c=t[l];c=e.relabelBlankNodes(c,{issuer:new ue("_:b"+l+"-")});var f=o||0===l?u:{"@default":{}};if(g(c,f,"@default",s),f!==u)for(var h in f){var d=f[h];if(h in u){var p=u[h];for(var y in d)y in p||(p[y]=d[y])}else u[h]=d}}a=m(u)}catch(e){return i(e)}for(var v=[],b=Object.keys(a).sort(),w=0;w<b.length;++w){var x=a[b[w]];Y(x)||v.push(x)}return null===n?i(null,v):(r.graph=!0,r.skipExpansion=!0,void e.compact(v,n,r,function(e,t){return e?i(new Ce("Could not compact merged output.","jsonld.MergeError",{cause:e})):void i(null,t)}))}if(arguments.length<1)return e.nextTick(function(){i(new TypeError("Could not merge, too few arguments."))});if(!B(t))return e.nextTick(function(){i(new TypeError('Could not merge, "docs" must be an array.'))});"function"==typeof r?(i=r,r={}):"function"==typeof n&&(i=n,n=null,r={}),r=r||{};for(var s=[],u=null,l=t.length,c=0;c<t.length;++c){var f={};for(var h in r)f[h]=r[h];e.expand(t[c],f,o)}},e.relabelBlankNodes=function(e,t){t=t||{};var n=t.namer||t.issuer||new ue("_:b");return i(n,e)},e.prependBase=function(e,t){return D(e,t)},e.documentLoader=function(t,n){var r=new Ce("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed"});return l?n(r,{contextUrl:null,documentUrl:t,document:null}):e.promisify(function(e){e(r)})},e.loadDocument=function(t,n){var r=e.documentLoader(t,n);r&&"then"in r&&r.then(n.bind(null,null),n)},e.promises=function(t){t=t||{};var r=Array.prototype.slice,i=e.promisify,o=t.api||{},s=t.version||"jsonld.js";"string"==typeof t.api&&(t.version||(s=t.api),o={}),o.expand=function(t){if(arguments.length<1)throw new TypeError("Could not expand, too few arguments.");return i.apply(null,[e.expand].concat(r.call(arguments)))},o.compact=function(t,n){if(arguments.length<2)throw new TypeError("Could not compact, too few arguments.");var o=function(t,n,r,i){e.compact(t,n,r,function(e,t){i(e,t)})};return i.apply(null,[o].concat(r.call(arguments)))},o.flatten=function(t){if(arguments.length<1)throw new TypeError("Could not flatten, too few arguments.");return i.apply(null,[e.flatten].concat(r.call(arguments)))},o.frame=function(t,n){if(arguments.length<2)throw new TypeError("Could not frame, too few arguments.");return i.apply(null,[e.frame].concat(r.call(arguments)))},o.fromRDF=function(t){if(arguments.length<1)throw new TypeError("Could not convert from RDF, too few arguments.");return i.apply(null,[e.fromRDF].concat(r.call(arguments)))},o.toRDF=function(t){if(arguments.length<1)throw new TypeError("Could not convert to RDF, too few arguments.");return i.apply(null,[e.toRDF].concat(r.call(arguments)))},o.normalize=function(t){if(arguments.length<1)throw new TypeError("Could not normalize, too few arguments.");return i.apply(null,[e.normalize].concat(r.call(arguments)))},"jsonld.js"===s&&(o.link=function(t,n){if(arguments.length<2)throw new TypeError("Could not link, too few arguments.");return i.apply(null,[e.link].concat(r.call(arguments)))},o.objectify=function(t){return i.apply(null,[e.objectify].concat(r.call(arguments)))},o.createNodeMap=function(t){return i.apply(null,[e.createNodeMap].concat(r.call(arguments)))},o.merge=function(t){return i.apply(null,[e.merge].concat(r.call(arguments)))});try{e.Promise=a.Promise||n(17).Promise}catch(e){var u=function(){throw new Error("Unable to find a Promise implementation.")};for(var l in o)o[l]=u}return o},e.promisify=function(t){if(!e.Promise)try{e.Promise=a.Promise||n(17).Promise}catch(e){throw new Error("Unable to find a Promise implementation.")}var r=Array.prototype.slice.call(arguments,1);return new e.Promise(function(e,n){t.apply(null,r.concat(function(t,r){t?n(t):e(r)}))})},e.promises({api:e.promises}),t.prototype=e.promises({version:"json-ld-1.0"}),t.prototype.toString=function(){return this instanceof t?"[object JsonLdProcessor]":"[object JsonLdProcessorPrototype]"},e.JsonLdProcessor=t;var ce=!!Object.defineProperty;if(ce)try{Object.defineProperty({},"x",{})}catch(e){ce=!1}ce&&(Object.defineProperty(t,"prototype",{writable:!1,enumerable:!1}),Object.defineProperty(t.prototype,"constructor",{writable:!0,enumerable:!1,configurable:!0,value:t})),c&&"undefined"==typeof a.JsonLdProcessor&&(ce?Object.defineProperty(a,"JsonLdProcessor",{writable:!0,enumerable:!1,configurable:!0,value:t}):a.JsonLdProcessor=t);var fe="function"==typeof s&&s,he=fe?function(e){fe(e)}:function(e){setTimeout(e,0)};"object"==typeof o&&"function"==typeof o.nextTick?e.nextTick=o.nextTick:e.nextTick=he,e.setImmediate=fe?he:e.nextTick,e.parseLinkHeader=function(e){for(var t={},n=e.match(/(?:<[^>]*?>|"[^"]*?"|[^,])+/g),r=/\s*<([^>]*?)>\s*(?:;\s*(.*))?/,i=0;i<n.length;++i){var o=n[i].match(r);if(o){for(var a={target:o[1]},s=o[2],u=/(.*?)=(?:(?:"([^"]*?)")|([^"]*?))\s*(?:(?:;\s*)|$)/g;o=u.exec(s);)a[o[1]]=void 0===o[2]?o[3]:o[2];var l=a.rel||"";B(t[l])?t[l].push(a):l in t?t[l]=[t[l],a]:t[l]=a}}return t},e.RequestQueue=function(){this._requests={}},e.RequestQueue.prototype.wrapLoader=function(e){return this._loader=e,this._usePromise=1===e.length,this.add.bind(this)},e.RequestQueue.prototype.add=function(t,n){var r=this;if(!n&&!r._usePromise)throw new Error("callback must be specified.");return r._usePromise?new e.Promise(function(e,n){var i=r._requests[t];i||(i=r._requests[t]=r._loader(t).then(function(e){return delete r._requests[t],e}).catch(function(e){throw delete r._requests[t],e})),i.then(function(t){e(t)}).catch(function(e){n(e)})}):void(t in r._requests?r._requests[t].push(n):(r._requests[t]=[n],r._loader(t,function(e,n){var i=r._requests[t];delete r._requests[t];for(var o=0;o<i.length;++o)i[o](e,n)})))},e.DocumentCache=function(e){this.order=[],this.cache={},this.size=e||50,this.expires=3e4},e.DocumentCache.prototype.get=function(e){if(e in this.cache){var t=this.cache[e];if(t.expires>=+new Date)return t.ctx;delete this.cache[e],this.order.splice(this.order.indexOf(e),1)}return null},e.DocumentCache.prototype.set=function(e,t){this.order.length===this.size&&delete this.cache[this.order.shift()],this.order.push(e),this.cache[e]={ctx:t,expires:+new Date+this.expires}},e.ActiveContextCache=function(e){this.order=[],this.cache={},this.size=e||100},e.ActiveContextCache.prototype.get=function(e,t){var n=JSON.stringify(e),r=JSON.stringify(t),i=this.cache[n];return i&&r in i?i[r]:null},e.ActiveContextCache.prototype.set=function(e,t,n){if(this.order.length===this.size){var r=this.order.shift();delete this.cache[r.activeCtx][r.localCtx]}var i=JSON.stringify(e),o=JSON.stringify(t);this.order.push({activeCtx:i,localCtx:o}),i in this.cache||(this.cache[i]={}),this.cache[i][o]=te(n)},e.cache={activeCtx:new e.ActiveContextCache},e.documentLoaders={},e.documentLoaders.jquery=function(t,n){function r(r,i){return 0!==r.indexOf("http:")&&0!==r.indexOf("https:")?i(new Ce('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:r}),{contextUrl:null,documentUrl:r,document:null}):n.secure&&0!==r.indexOf("https")?i(new Ce('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:r}),{contextUrl:null,documentUrl:r,document:null}):void t.ajax({url:r,accepts:{json:"application/ld+json, application/json"},headers:{Accept:"application/ld+json, application/json"},dataType:"json",crossDomain:!0,success:function(t,n,o){var a={contextUrl:null,documentUrl:r,document:t},s=o.getResponseHeader("Content-Type"),u=o.getResponseHeader("Link");if(u&&"application/ld+json"!==s){if(u=e.parseLinkHeader(u)[Oe],B(u))return i(new Ce("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:r}),a);u&&(a.contextUrl=u.target)}i(null,a)},error:function(e,t,n){i(new Ce("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:r,cause:n}),{contextUrl:null,documentUrl:r,document:null})}})}n=n||{};var i=new e.RequestQueue,o="usePromise"in n?n.usePromise:"undefined"!=typeof Promise;return o?i.wrapLoader(function(t){return e.promisify(r,t)}):i.wrapLoader(r)},e.documentLoaders.node=function(t){function r(n,u,l){function c(t,i,a){if(f={contextUrl:null,documentUrl:n,document:a||null},t)return l(new Ce("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:n,cause:t}),f);var c=s.STATUS_CODES[i.statusCode];if(i.statusCode>=400)return l(new Ce("URL could not be dereferenced: "+c,"jsonld.InvalidUrl",{code:"loading document failed",url:n,httpStatusCode:i.statusCode}),f);if(i.headers.link&&"application/ld+json"!==i.headers["content-type"]){var h=e.parseLinkHeader(i.headers.link)[Oe];if(B(h))return l(new Ce("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:n}),f);h&&(f.contextUrl=h.target)}return i.statusCode>=300&&i.statusCode<400&&i.headers.location?u.length===o?l(new Ce("URL could not be dereferenced; there were too many redirects.","jsonld.TooManyRedirects",{code:"loading document failed",url:n,httpStatusCode:i.statusCode,redirects:u}),f):u.indexOf(n)!==-1?l(new Ce("URL could not be dereferenced; infinite redirection was detected.","jsonld.InfiniteRedirectDetected",{code:"recursive context inclusion",url:n,httpStatusCode:i.statusCode,redirects:u}),f):(u.push(n),r(i.headers.location,u,l)):(u.push(n),void l(t,f))}if(0!==n.indexOf("http:")&&0!==n.indexOf("https:"))return l(new Ce('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:n}),{contextUrl:null,documentUrl:n,document:null});if(t.secure&&0!==n.indexOf("https"))return l(new Ce('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:n}),{contextUrl:null,documentUrl:n,document:null});var f=null;return null!==f?l(null,f):void a({url:n,headers:{Accept:"application/ld+json, application/json"},strictSSL:i,followRedirect:!1},c)}t=t||{};var i=!("strictSSL"in t)||t.strictSSL,o="maxRedirects"in t?t.maxRedirects:-1,a=n(20),s=n(20),u=new e.RequestQueue;return t.usePromise?u.wrapLoader(function(t){return e.promisify(r,t,[])}):u.wrapLoader(function(e,t){r(e,[],t)})},e.documentLoaders.xhr=function(t){function n(n,i){if(0!==n.indexOf("http:")&&0!==n.indexOf("https:"))return i(new Ce('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:n}),{contextUrl:null,documentUrl:n,document:null});if(t.secure&&0!==n.indexOf("https"))return i(new Ce('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:n}),{contextUrl:null,documentUrl:n,document:null});var o=t.xhr||XMLHttpRequest,a=new o;a.onload=function(){if(a.status>=400)return i(new Ce("URL could not be dereferenced: "+a.statusText,"jsonld.LoadDocumentError",{code:"loading document failed",url:n,httpStatusCode:a.status}),{contextUrl:null,documentUrl:n,document:null});var t,o={contextUrl:null,documentUrl:n,document:a.response},s=a.getResponseHeader("Content-Type");if(r.test(a.getAllResponseHeaders())&&(t=a.getResponseHeader("Link")),t&&"application/ld+json"!==s){if(t=e.parseLinkHeader(t)[Oe],B(t))return i(new Ce("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:n}),o);t&&(o.contextUrl=t.target)}i(null,o)},a.onerror=function(){i(new Ce("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:n}),{contextUrl:null,documentUrl:n,document:null})},a.open("GET",n,!0),a.setRequestHeader("Accept","application/ld+json, application/json"),a.send()}t=t||{};var r=/(^|(\r\n))link:/i,i=new e.RequestQueue,o="usePromise"in t?t.usePromise:"undefined"!=typeof Promise;return o?i.wrapLoader(function(t){return e.promisify(n,t)}):i.wrapLoader(n)},e.useDocumentLoader=function(t){if(!(t in e.documentLoaders))throw new Ce('Unknown document loader type: "'+t+'"',"jsonld.UnknownDocumentLoader",{type:t});e.documentLoader=e.documentLoaders[t].apply(e,Array.prototype.slice.call(arguments,1))},e.processContext=function(t,n){var r={},i=2;arguments.length>3&&(r=arguments[2]||{},i+=1);var o=arguments[i];return"base"in r||(r.base=""),"documentLoader"in r||(r.documentLoader=e.loadDocument),null===n?o(null,U(r)):(n=te(n),q(n)&&"@context"in n||(n={"@context":n}),void re(n,r,function(e,n){if(e)return o(e);try{n=(new Ae).processContext(t,n,r)}catch(e){return o(e)}o(null,n)}))},e.hasProperty=function(e,t){var n=!1;if(t in e){var r=e[t];n=!B(r)||r.length>0}return n},e.hasValue=function(t,n,r){var i=!1;if(e.hasProperty(t,n)){var o=t[n],a=K(o);if(B(o)||a){a&&(o=o["@list"]);for(var s=0;s<o.length;++s)if(e.compareValues(r,o[s])){i=!0;break}}else B(r)||(i=e.compareValues(r,o))}return i},e.addValue=function(t,n,r,i){if(i=i||{},"propertyIsArray"in i||(i.propertyIsArray=!1),"allowDuplicate"in i||(i.allowDuplicate=!0),B(r)){0!==r.length||!i.propertyIsArray||n in t||(t[n]=[]);for(var o=0;o<r.length;++o)e.addValue(t,n,r[o],i)}else if(n in t){var a=!i.allowDuplicate&&e.hasValue(t,n,r);B(t[n])||a&&!i.propertyIsArray||(t[n]=[t[n]]),a||t[n].push(r)}else t[n]=i.propertyIsArray?[r]:r},e.getValues=function(e,t){var n=e[t]||[];return B(n)||(n=[n]),n},e.removeProperty=function(e,t){delete e[t]},e.removeValue=function(t,n,r,i){i=i||{},"propertyIsArray"in i||(i.propertyIsArray=!1);var o=e.getValues(t,n).filter(function(t){return!e.compareValues(t,r)});0===o.length?e.removeProperty(t,n):1!==o.length||i.propertyIsArray?t[n]=o:t[n]=o[0]},e.compareValues=function(e,t){return e===t||(!(!Q(e)||!Q(t)||e["@value"]!==t["@value"]||e["@type"]!==t["@type"]||e["@language"]!==t["@language"]||e["@index"]!==t["@index"])||!!(q(e)&&"@id"in e&&q(t)&&"@id"in t)&&e["@id"]===t["@id"])},e.getContextValue=function(e,t,n){var r=null;if(null===t)return r;if("@language"===n&&n in e&&(r=e[n]),e.mappings[t]){var i=e.mappings[t];G(n)?r=i:n in i&&(r=i[n])}return r};var de={};if(e.registerRDFParser=function(e,t){de[e]=t},e.unregisterRDFParser=function(e){delete de[e]},l){if("undefined"==typeof pe)var pe=null;if("undefined"==typeof ye)var ye={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}}var ve="http://www.w3.org/2001/XMLSchema#boolean",ge="http://www.w3.org/2001/XMLSchema#double",me="http://www.w3.org/2001/XMLSchema#integer",be="http://www.w3.org/2001/XMLSchema#string",we="http://www.w3.org/1999/02/22-rdf-syntax-ns#",xe=we+"List",_e=we+"first",ke=we+"rest",Te=we+"nil",Se=we+"type",Ee=we+"PlainLiteral",Ne=we+"XMLLiteral",Re=we+"object",je=we+"langString",Oe="http://www.w3.org/ns/json-ld#context",Ie=10,Ce=function(e,t,n){l?(Error.call(this),Error.captureStackTrace(this,this.constructor)):"undefined"!=typeof Error&&(this.stack=(new Error).stack),this.name=t||"jsonld.Error",this.message=e||"An unspecified JSON-LD error occurred.",this.details=n||{}};l?n(20).inherits(Ce,Error):"undefined"!=typeof Error&&(Ce.prototype=new Error);var Ae=function(){};Ae.prototype.compact=function(t,n,r,i){if(B(r)){for(var o=[],a=0;a<r.length;++a){var s=this.compact(t,n,r[a],i);null!==s&&o.push(s)}if(i.compactArrays&&1===o.length){var u=e.getContextValue(t,n,"@container");null===u&&(o=o[0])}return o}if(q(r)){if(i.link&&"@id"in r&&r["@id"]in i.link)for(var l=i.link[r["@id"]],a=0;a<l.length;++a)if(l[a].expanded===r)return l[a].compacted;if(Q(r)||Y(r)){var o=C(t,n,r);return i.link&&Y(r)&&(r["@id"]in i.link||(i.link[r["@id"]]=[]),i.link[r["@id"]].push({expanded:r,compacted:o})),o}var c="@reverse"===n,o={};i.link&&"@id"in r&&(r["@id"]in i.link||(i.link[r["@id"]]=[]),i.link[r["@id"]].push({expanded:r,compacted:o}));for(var f=Object.keys(r).sort(),h=0;h<f.length;++h){var d=f[h],p=r[d];if("@id"!==d&&"@type"!==d)if("@reverse"!==d)if("@index"!==d)if("@graph"!==d&&"@list"!==d&&M(d)){var y=I(t,d);e.addValue(o,y,p)}else{if(0===p.length){var v=I(t,d,p,{vocab:!0},c);e.addValue(o,v,p,{propertyIsArray:!0})}for(var g=0;g<p.length;++g){var m=p[g],v=I(t,d,m,{vocab:!0},c),u=e.getContextValue(t,v,"@container"),b=K(m),w=null;b&&(w=m["@list"]);var x=this.compact(t,v,b?w:m,i);if(b)if(B(x)||(x=[x]),"@list"!==u){var _={};_[I(t,"@list")]=x,x=_,"@index"in m&&(x[I(t,"@index")]=m["@index"])}else if(v in o)throw new Ce('JSON-LD compact error; property has a "@list" @container rule but there is more than a single @list that matches the compacted term in the document. Compaction might mix unwanted items into the list.',"jsonld.SyntaxError",{code:"compaction to list of lists"});if("@language"===u||"@index"===u){var k;v in o?k=o[v]:o[v]=k={},"@language"===u&&Q(x)&&(x=x["@value"]),e.addValue(k,m[u],x)}else{var T=!i.compactArrays||"@set"===u||"@list"===u||B(x)&&0===x.length||"@list"===d||"@graph"===d;e.addValue(o,v,x,{propertyIsArray:T})}}}else{var u=e.getContextValue(t,n,"@container");if("@index"===u)continue;var y=I(t,d);e.addValue(o,y,p)}else{var S=this.compact(t,"@reverse",p,i);for(var E in S)if(t.mappings[E]&&t.mappings[E].reverse){var N=S[E],u=e.getContextValue(t,E,"@container"),R="@set"===u||!i.compactArrays;e.addValue(o,E,N,{propertyIsArray:R}),delete S[E]}if(Object.keys(S).length>0){var y=I(t,d);e.addValue(o,y,S)}}else{var S;if(z(p))S=I(t,p,null,{vocab:"@type"===d});else{S=[];for(var g=0;g<p.length;++g)S.push(I(t,p[g],null,{vocab:!0}))}var y=I(t,d),T=B(S)&&0===p.length;e.addValue(o,y,S,{propertyIsArray:T})}}return o}return r},Ae.prototype.expand=function(t,n,i,o,a){var s=this;if(null===i||void 0===i)return null;if(!B(i)&&!q(i))return a||null!==n&&"@graph"!==L(t,n,{vocab:!0})?f(t,n,i):null;if(B(i)){var u=[],l=e.getContextValue(t,n,"@container");a=a||"@list"===l;for(var c=0;c<i.length;++c){var h=s.expand(t,n,i[c],o);if(a&&(B(h)||K(h)))throw new Ce("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"});null!==h&&(B(h)?u=u.concat(h):u.push(h))}return u}"@context"in i&&(t=s.processContext(t,i["@context"],o));for(var d=L(t,n,{vocab:!0}),u={},p=Object.keys(i).sort(),y=0;y<p.length;++y){var v,g=p[y],m=i[g];if("@context"!==g){var b=L(t,g,{vocab:!0});if(null!==b&&(ee(b)||M(b))){if(M(b)){if("@reverse"===d)throw new Ce("Invalid JSON-LD syntax; a keyword cannot be used as a @reverse property.","jsonld.SyntaxError",{code:"invalid reverse property map",value:m});if(b in u)throw new Ce("Invalid JSON-LD syntax; colliding keywords detected.","jsonld.SyntaxError",{code:"colliding keywords",keyword:b})}if("@id"===b&&!z(m)){if(!o.isFrame)throw new Ce('Invalid JSON-LD syntax; "@id" value must a string.',"jsonld.SyntaxError",{code:"invalid @id value",value:m});if(!q(m))throw new Ce('Invalid JSON-LD syntax; "@id" value must be a string or an object.',"jsonld.SyntaxError",{code:"invalid @id value",value:m})}if("@type"===b&&H(m),"@graph"===b&&!q(m)&&!B(m))throw new Ce('Invalid JSON-LD syntax; "@graph" value must not be an object or an array.',"jsonld.SyntaxError",{code:"invalid @graph value",value:m});if("@value"===b&&(q(m)||B(m)))throw new Ce('Invalid JSON-LD syntax; "@value" value must not be an object or an array.',"jsonld.SyntaxError",{code:"invalid value object value",value:m});if("@language"===b){if(null===m)continue;if(!z(m))throw new Ce('Invalid JSON-LD syntax; "@language" value must be a string.',"jsonld.SyntaxError",{code:"invalid language-tagged string",value:m});m=m.toLowerCase()}if("@index"===b&&!z(m))throw new Ce('Invalid JSON-LD syntax; "@index" value must be a string.',"jsonld.SyntaxError",{code:"invalid @index value",value:m});if("@reverse"!==b){var l=e.getContextValue(t,g,"@container");if("@language"===l&&q(m))v=r(m);else if("@index"===l&&q(m))v=function(e){for(var n=[],r=Object.keys(m).sort(),i=0;i<r.length;++i){var a=r[i],u=m[a];B(u)||(u=[u]),u=s.expand(t,e,u,o,!1);for(var l=0;l<u.length;++l){var c=u[l];"@index"in c||(c["@index"]=a),n.push(c)}}return n}(g);else{var w="@list"===b;if(w||"@set"===b){var x=n;if(w&&"@graph"===d&&(x=null),v=s.expand(t,x,m,o,w),w&&K(v))throw new Ce("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"})}else v=s.expand(t,g,m,o,!1)}if(null!==v||"@value"===b)if("@list"===b||K(v)||"@list"!==l||(v=B(v)?v:[v],v={"@list":v}),t.mappings[g]&&t.mappings[g].reverse){var _=u["@reverse"]=u["@reverse"]||{};B(v)||(v=[v]);for(var k=0;k<v.length;++k){var T=v[k];if(Q(T)||K(T))throw new Ce('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{code:"invalid reverse property value",value:v});e.addValue(_,b,T,{propertyIsArray:!0})}}else{var S=["@index","@id","@type","@value","@language"].indexOf(b)===-1;e.addValue(u,b,v,{propertyIsArray:S})}}else{if(!q(m))throw new Ce('Invalid JSON-LD syntax; "@reverse" value must be an object.',"jsonld.SyntaxError",{code:"invalid @reverse value",value:m});if(v=s.expand(t,"@reverse",m,o),"@reverse"in v)for(var E in v["@reverse"])e.addValue(u,E,v["@reverse"][E],{propertyIsArray:!0});var _=u["@reverse"]||null;for(var E in v)if("@reverse"!==E){null===_&&(_=u["@reverse"]={}),e.addValue(_,E,[],{propertyIsArray:!0});for(var N=v[E],k=0;k<N.length;++k){var T=N[k];if(Q(T)||K(T))throw new Ce('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{code:"invalid reverse property value",value:v});e.addValue(_,E,T,{propertyIsArray:!0})}}}}}}p=Object.keys(u);var R=p.length;if("@value"in u){if("@type"in u&&"@language"in u)throw new Ce('Invalid JSON-LD syntax; an element containing "@value" may not contain both "@type" and "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:u});var j=R-1;if("@type"in u&&(j-=1),"@index"in u&&(j-=1),"@language"in u&&(j-=1),0!==j)throw new Ce('Invalid JSON-LD syntax; an element containing "@value" may only have an "@index" property and at most one other property which can be "@type" or "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:u});if(null===u["@value"])u=null;else{if("@language"in u&&!z(u["@value"]))throw new Ce("Invalid JSON-LD syntax; only strings may be language-tagged.","jsonld.SyntaxError",{code:"invalid language-tagged value",element:u});if("@type"in u&&(!ee(u["@type"])||0===u["@type"].indexOf("_:")))throw new Ce('Invalid JSON-LD syntax; an element containing "@value" and "@type" must have an absolute IRI for the value of "@type".',"jsonld.SyntaxError",{code:"invalid typed value",element:u})}}else if("@type"in u&&!B(u["@type"]))u["@type"]=[u["@type"]];else if("@set"in u||"@list"in u){if(R>1&&!(2===R&&"@index"in u))throw new Ce('Invalid JSON-LD syntax; if an element has the property "@set" or "@list", then it can have at most one other property that is "@index".',"jsonld.SyntaxError",{code:"invalid set or list object",element:u});"@set"in u&&(u=u["@set"],p=Object.keys(u),R=p.length)}else 1===R&&"@language"in u&&(u=null);return!q(u)||o.keepFreeFloatingNodes||a||null!==n&&"@graph"!==d||(0===R||"@value"in u||"@list"in u||1===R&&"@id"in u)&&(u=null),u},Ae.prototype.createNodeMap=function(e,t){t=t||{};var n=t.namer||t.issuer||new ue("_:b"),r={"@default":{}};return g(e,r,"@default",n),m(r)},Ae.prototype.flatten=function(e){for(var t=this.createNodeMap(e),n=[],r=Object.keys(t).sort(),i=0;i<r.length;++i){var o=t[r[i]];Y(o)||n.push(o)}return n},Ae.prototype.frame=function(e,t,n){var r={options:n,graphs:{"@default":{},"@merged":{}},subjectStack:[],link:{}},i=new ue("_:b");g(e,r.graphs,"@merged",i),r.subjects=r.graphs["@merged"];var o=[];return b(r,Object.keys(r.subjects).sort(),t,o,null),o},Ae.prototype.normalize=function(e,t,n){return"URDNA2015"===t.algorithm?new Le(t).main(e,n):"URGNA2012"===t.algorithm?new De(t).main(e,n):void n(new Error("Invalid RDF Dataset Normalization algorithm: "+t.algorithm))},Ae.prototype.fromRDF=function(t,n,r){var i={},o={"@default":i},a={};for(var s in t){var u=t[s];s in o||(o[s]={}),"@default"===s||s in i||(i[s]={"@id":s});for(var l=o[s],c=0;c<u.length;++c){var f=u[c],h=f.subject.value,d=f.predicate.value,p=f.object;h in l||(l[h]={"@id":h});var v=l[h],g="IRI"===p.type||"blank node"===p.type;if(!g||p.value in l||(l[p.value]={"@id":p.value}),d!==Se||n.useRdfType||!g){var m=y(p,n.useNativeTypes);if(e.addValue(v,d,m,{propertyIsArray:!0}),g)if(p.value===Te){var b=l[p.value];"usages"in b||(b.usages=[]),b.usages.push({node:v,property:d,value:m})}else p.value in a?a[p.value]=!1:a[p.value]={node:v,property:d,value:m}}else e.addValue(v,"@type",p.value,{propertyIsArray:!0})}}for(var s in o){var w=o[s];if(Te in w){for(var x=w[Te],_=0;_<x.usages.length;++_){for(var k=x.usages[_],v=k.node,T=k.property,S=k.value,E=[],N=[],R=Object.keys(v).length;T===ke&&q(a[v["@id"]])&&B(v[_e])&&1===v[_e].length&&B(v[ke])&&1===v[ke].length&&(3===R||4===R&&B(v["@type"])&&1===v["@type"].length&&v["@type"][0]===xe)&&(E.push(v[_e][0]),N.push(v["@id"]),k=a[v["@id"]],v=k.node,T=k.property,S=k.value,R=Object.keys(v).length,0===v["@id"].indexOf("_:")););if(T===_e){if(v["@id"]===Te)continue;S=w[S["@id"]][ke][0],E.pop(),N.pop()}delete S["@id"],S["@list"]=E.reverse();for(var j=0;j<N.length;++j)delete w[N[j]]}delete x.usages}}for(var O=[],I=Object.keys(i).sort(),_=0;_<I.length;++_){var C=I[_],v=i[C];if(C in o)for(var u=v["@graph"]=[],w=o[C],A=Object.keys(w).sort(),L=0;L<A.length;++L){var D=w[A[L]];Y(D)||u.push(D)}Y(v)||O.push(v)}r(null,O)},Ae.prototype.toRDF=function(e,t){var n=new ue("_:b"),r={"@default":{}};g(e,r,"@default",n);for(var i={},o=Object.keys(r).sort(),a=0;a<o.length;++a){var s=o[a];("@default"===s||ee(s))&&(i[s]=h(r[s],n,t))}return i},Ae.prototype.processContext=function(t,n,r){q(n)&&"@context"in n&&B(n["@context"])&&(n=n["@context"]);var i=B(n)?n:[n];if(0===i.length)return t.clone();for(var o=t,a=0;a<i.length;++a){var s=i[a];if(null!==s){if(q(s)&&"@context"in s&&(s=s["@context"]),!q(s))throw new Ce("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{code:"invalid local context",context:s});if(e.cache.activeCtx){var u=e.cache.activeCtx.get(t,s);if(u){o=t=u;continue}}t=o,o=o.clone();var l={};if("@base"in s){var c=s["@base"];if(null===c)c=null;else{if(!z(c))throw new Ce('Invalid JSON-LD syntax; the value of "@base" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid base IRI",context:s});if(""!==c&&!ee(c))throw new Ce('Invalid JSON-LD syntax; the value of "@base" in a @context must be an absolute IRI or the empty string.',"jsonld.SyntaxError",{code:"invalid base IRI",context:s})}null!==c&&(c=e.url.parse(c||"")),o["@base"]=c,l["@base"]=!0;
}if("@vocab"in s){var f=s["@vocab"];if(null===f)delete o["@vocab"];else{if(!z(f))throw new Ce('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid vocab mapping",context:s});if(!ee(f))throw new Ce('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be an absolute IRI.',"jsonld.SyntaxError",{code:"invalid vocab mapping",context:s});o["@vocab"]=f}l["@vocab"]=!0}if("@language"in s){var f=s["@language"];if(null===f)delete o["@language"];else{if(!z(f))throw new Ce('Invalid JSON-LD syntax; the value of "@language" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid default language",context:s});o["@language"]=f.toLowerCase()}l["@language"]=!0}for(var h in s)A(o,s,h,l);e.cache.activeCtx&&e.cache.activeCtx.set(t,s,o)}else o=t=U(r)}return o};var Le=function(){var t={subject:"s",object:"o",name:"g"},n=function(e){e=e||{},this.name="URDNA2015",this.options=e,this.blankNodeInfo={},this.hashToBlankNodes={},this.canonicalIssuer=new ue("_:c14n"),this.quads=[],this.schedule={},"maxCallStackDepth"in e?this.schedule.MAX_DEPTH=e.maxCallStackDepth:this.schedule.MAX_DEPTH=500,"maxTotalCallStackDepth"in e?this.schedule.MAX_TOTAL_DEPTH=e.maxCallStackDepth:this.schedule.MAX_TOTAL_DEPTH=4294967295,this.schedule.depth=0,this.schedule.totalDepth=0,"timeSlice"in e?this.schedule.timeSlice=e.timeSlice:this.schedule.timeSlice=10};return n.prototype.doWork=function(t,n){var r=this.schedule;return r.totalDepth>=r.MAX_TOTAL_DEPTH?n(new Error("Maximum total call stack depth exceeded; normalization aborting.")):void function i(){if(r.depth===r.MAX_DEPTH)return r.depth=0,r.running=!1,e.nextTick(i);var o=(new Date).getTime();return r.running||(r.start=(new Date).getTime(),r.deadline=r.start+r.timeSlice),o<r.deadline?(r.running=!0,r.depth++,r.totalDepth++,t(function(e,t){r.depth--,r.totalDepth--,n(e,t)})):(r.depth=0,r.running=!1,void e.setImmediate(i))}()},n.prototype.forEach=function(e,t,n){var r,i,o=this,a=0;if(B(e))i=e.length,r=function(){return a!==i&&(r.value=e[a++],r.key=a,!0)};else{var s=Object.keys(e);i=s.length,r=function(){return a!==i&&(r.key=s[a++],r.value=e[r.key],!0)}}!function e(i,a){return i?n(i):r()?o.doWork(function(){t(r.value,r.key,e)}):void n()}()},n.prototype.waterfall=function(e,t){var n=this;n.forEach(e,function(e,t,r){n.doWork(e,r)},t)},n.prototype.whilst=function(e,t,n){var r=this;!function i(o){return o?n(o):e()?void r.doWork(t,i):n()}()},n.prototype.main=function(e,t){var n=this;n.schedule.start=(new Date).getTime();var r;if(n.options.format&&"application/nquads"!==n.options.format)return t(new Ce("Unknown output format.","jsonld.UnknownFormat",{format:n.options.format}));var i={};n.waterfall([function(t){n.forEach(e,function(e,t,r){"@default"===t&&(t=null),n.forEach(e,function(e,r,o){null!==t&&(0===t.indexOf("_:")?e.name={type:"blank node",value:t}:e.name={type:"IRI",value:t}),n.quads.push(e),n.forEachComponent(e,function(t){if("blank node"===t.type){var r=t.value;r in n.blankNodeInfo?n.blankNodeInfo[r].quads.push(e):(i[r]=!0,n.blankNodeInfo[r]={quads:[e]})}}),o()},r)},t)},function(e){var t=!0;n.whilst(function(){return t},function(e){t=!1,n.hashToBlankNodes={},n.waterfall([function(e){n.forEach(i,function(e,t,r){n.hashFirstDegreeQuads(t,function(e,i){return e?r(e):(i in n.hashToBlankNodes?n.hashToBlankNodes[i].push(t):n.hashToBlankNodes[i]=[t],void r())})},e)},function(e){var r=Object.keys(n.hashToBlankNodes).sort();n.forEach(r,function(e,r,o){var a=n.hashToBlankNodes[e];if(a.length>1)return o();var s=a[0];n.canonicalIssuer.getId(s),delete i[s],delete n.hashToBlankNodes[e],t=!0,o()},e)}],e)},e)},function(e){var t=Object.keys(n.hashToBlankNodes).sort();n.forEach(t,function(e,t,r){var i=[],o=n.hashToBlankNodes[e];n.waterfall([function(e){n.forEach(o,function(e,t,r){if(n.canonicalIssuer.hasId(e))return r();var o=new ue("_:b");o.getId(e),n.hashNDegreeQuads(e,o,function(e,t){return e?r(e):(i.push(t),void r())})},e)},function(e){i.sort(function(e,t){return e.hash<t.hash?-1:e.hash>t.hash?1:0}),n.forEach(i,function(e,t,r){for(var i in e.issuer.existing)n.canonicalIssuer.getId(i);r()},e)}],r)},e)},function(e){var t=[];n.waterfall([function(e){n.forEach(n.quads,function(e,r,i){n.forEachComponent(e,function(e){"blank node"===e.type&&0!==e.value.indexOf(n.canonicalIssuer.prefix)&&(e.value=n.canonicalIssuer.getId(e.value))}),t.push(ae(e)),i()},e)},function(e){return t.sort(),"application/nquads"===n.options.format?(r=t.join(""),e()):(r=ie(t.join("")),void e())}],e)}],function(e){t(e,r)})},n.prototype.hashFirstDegreeQuads=function(e,t){var n=this,r=n.blankNodeInfo[e];if("hash"in r)return t(null,r.hash);var i=[],o=r.quads;n.forEach(o,function(t,r,o){var a={predicate:t.predicate};n.forEachComponent(t,function(t,r){a[r]=n.modifyFirstDegreeComponent(e,t,r)}),i.push(ae(a)),o()},function(e){return e?t(e):(i.sort(),r.hash=Ue.hashNQuads(n.name,i),void t(null,r.hash))})},n.prototype.modifyFirstDegreeComponent=function(e,t){return"blank node"!==t.type?t:(t=te(t),t.value=t.value===e?"_:a":"_:z",t)},n.prototype.hashRelatedBlankNode=function(e,t,n,r,i){var o,a=this;a.waterfall([function(t){return a.canonicalIssuer.hasId(e)?(o=a.canonicalIssuer.getId(e),t()):n.hasId(e)?(o=n.getId(e),t()):void a.hashFirstDegreeQuads(e,function(e,n){return e?t(e):(o=n,void t())})}],function(e){if(e)return i(e);var n=new Ue(a.name);return n.update(r),"g"!==r&&n.update(a.getRelatedPredicate(t)),n.update(o),i(null,n.digest())})},n.prototype.getRelatedPredicate=function(e){return"<"+e.predicate.value+">"},n.prototype.hashNDegreeQuads=function(e,t,n){var r,i=this,o=new Ue(i.name);i.waterfall([function(n){i.createHashToRelated(e,t,function(e,t){return e?n(e):(r=t,void n())})},function(e){var n=Object.keys(r).sort();i.forEach(n,function(e,n,a){o.update(e);var s,u="",l=new Pe(r[e]);i.whilst(function(){return l.hasNext()},function(e){var n=l.next(),r=t.clone(),o="",a=[];i.waterfall([function(t){i.forEach(n,function(t,n,s){return i.canonicalIssuer.hasId(t)?o+=i.canonicalIssuer.getId(t):(r.hasId(t)||a.push(t),o+=r.getId(t)),0!==u.length&&o.length>=u.length&&o>u?e():void s()},t)},function(t){i.forEach(a,function(t,n,a){i.hashNDegreeQuads(t,r,function(n,i){return n?a(n):(o+=r.getId(t),o+="<"+i.hash+">",r=i.issuer,0!==u.length&&o.length>=u.length&&o>u?e():void a())})},t)},function(e){(0===u.length||o<u)&&(u=o,s=r),e()}],e)},function(e){return e?a(e):(o.update(u),t=s,void a())})},e)}],function(e){n(e,{hash:o.digest(),issuer:t})})},n.prototype.createHashToRelated=function(e,n,r){var i=this,o={},a=i.blankNodeInfo[e].quads;i.forEach(a,function(r,a,s){i.forEach(r,function(a,s,u){if("predicate"===s||"blank node"!==a.type||a.value===e)return u();var l=a.value,c=t[s];i.hashRelatedBlankNode(l,r,n,c,function(e,t){return e?u(e):(t in o?o[t].push(l):o[t]=[l],void u())})},s)},function(e){r(e,o)})},n.prototype.forEachComponent=function(e,t){for(var n in e)"predicate"!==n&&t(e[n],n,e)},n}(),De=function(){var e=function(e){Le.call(this,e),this.name="URGNA2012"};return e.prototype=new Le,e.prototype.modifyFirstDegreeComponent=function(e,t,n){return"blank node"!==t.type?t:(t=te(t),"name"===n?t.value="_:g":t.value=t.value===e?"_:a":"_:z",t)},e.prototype.getRelatedPredicate=function(e){return e.predicate.value},e.prototype.createHashToRelated=function(e,t,n){var r=this,i={},o=r.blankNodeInfo[e].quads;r.forEach(o,function(n,o,a){var s,u;if("blank node"===n.subject.type&&n.subject.value!==e)u=n.subject.value,s="p";else{if("blank node"!==n.object.type||n.object.value===e)return a();u=n.object.value,s="r"}r.hashRelatedBlankNode(u,n,t,s,function(e,t){t in i?i[t].push(u):i[t]=[u],a()})},function(e){n(e,i)})},e}();Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on non-object");var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),e.registerRDFParser("application/nquads",ie),e.registerRDFParser("rdfa-api",se),e.IdentifierIssuer=ue,e.UniqueNamer=ue,ue.prototype.clone=function(){var e=new ue(this.prefix);return e.counter=this.counter,e.existing=te(this.existing),e},ue.prototype.getId=function(e){if(e&&e in this.existing)return this.existing[e];var t=this.prefix+this.counter;return this.counter+=1,e&&(this.existing[e]=t),t},ue.prototype.getName=ue.prototype.getName,ue.prototype.hasId=function(e){return e in this.existing},ue.prototype.isNamed=ue.prototype.hasId;var Pe=function(e){this.list=e.sort(),this.done=!1,this.left={};for(var t=0;t<e.length;++t)this.left[e[t]]=!0};Pe.prototype.hasNext=function(){return!this.done},Pe.prototype.next=function(){for(var e=this.list.slice(),t=null,n=0,r=this.list.length,i=0;i<r;++i){var o=this.list[i],a=this.left[o];(null===t||o>t)&&(a&&i>0&&o>this.list[i-1]||!a&&i<r-1&&o>this.list[i+1])&&(t=o,n=i)}if(null===t)this.done=!0;else{var s=this.left[t]?n-1:n+1;this.list[n]=this.list[s],this.list[s]=t;for(var i=0;i<r;++i)this.list[i]>t&&(this.left[this.list[i]]=!this.left[this.list[i]])}return e};var Ue=function(e){if(!(this instanceof Ue))return new Ue(e);if(["URDNA2015","URGNA2012"].indexOf(e)===-1)throw new Error("Invalid RDF Dataset Normalization algorithm: "+e);Ue._init.call(this,e)};if(Ue.hashNQuads=function(e,t){for(var n=new Ue(e),r=0;r<t.length;++r)n.update(t[r]);return n.digest()},function(e){if(e){var t=n(20);return Ue._init=function(e){e="URDNA2015"===e?"sha256":"sha1",this.md=t.createHash(e)},Ue.prototype.update=function(e){return this.md.update(e,"utf8")},void(Ue.prototype.digest=function(){return this.md.digest("hex")})}Ue._init=function(e){e="URDNA2015"===e?new o.Algorithm:new i.Algorithm,this.md=new r(e)},Ue.prototype.update=function(e){return this.md.update(e)},Ue.prototype.digest=function(){return this.md.digest().toHex()};var r=function(e){if(!(this instanceof r))return new r(e);if(this._algorithm=e,!r._padding||r._padding.length<this._algorithm.blockSize){r._padding=String.fromCharCode(128);for(var t=String.fromCharCode(0),n=64;n>0;)1&n&&(r._padding+=t),n>>>=1,n>0&&(t+=t)}this.start()};r.prototype.start=function(){this.messageLength=0,this.fullMessageLength=[];for(var e=this._algorithm.messageLengthSize/4,t=0;t<e;++t)this.fullMessageLength.push(0);return this._input=new r.ByteBuffer,this.state=this._algorithm.start(),this},r.prototype.update=function(e){e=new r.ByteBuffer(unescape(encodeURIComponent(e))),this.messageLength+=e.length();var t=e.length();t=[t/4294967296>>>0,t>>>0];for(var n=this.fullMessageLength.length-1;n>=0;--n)this.fullMessageLength[n]+=t[1],t[1]=t[0]+(this.fullMessageLength[n]/4294967296>>>0),this.fullMessageLength[n]=this.fullMessageLength[n]>>>0,t[0]=t[1]/4294967296>>>0;for(this._input.putBytes(e.bytes());this._input.length()>=this._algorithm.blockSize;)this.state=this._algorithm.digest(this.state,this._input);return(this._input.read>2048||0===this._input.length())&&this._input.compact(),this},r.prototype.digest=function(){var e=new r.ByteBuffer;e.putBytes(this._input.bytes());var t=this.fullMessageLength[this.fullMessageLength.length-1]+this._algorithm.messageLengthSize,n=t&this._algorithm.blockSize-1;e.putBytes(r._padding.substr(0,this._algorithm.blockSize-n));for(var i=new r.ByteBuffer,o=0;o<this.fullMessageLength.length;++o)i.putInt32(this.fullMessageLength[o]<<3|this.fullMessageLength[o+1]>>>28);this._algorithm.writeMessageLength(e,i);var a=this._algorithm.digest(this.state.copy(),e),s=new r.ByteBuffer;return a.write(s),s},r.ByteBuffer=function(e){"string"==typeof e?this.data=e:this.data="",this.read=0},r.ByteBuffer.prototype.putInt32=function(e){this.data+=String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)},r.ByteBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},r.ByteBuffer.prototype.putBytes=function(e){this.data+=e},r.ByteBuffer.prototype.bytes=function(){return this.data.slice(this.read)},r.ByteBuffer.prototype.length=function(){return this.data.length-this.read},r.ByteBuffer.prototype.compact=function(){this.data=this.data.slice(this.read),this.read=0},r.ByteBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var n=this.data.charCodeAt(t);n<16&&(e+="0"),e+=n.toString(16)}return e};var i={_w:null};i.Algorithm=function(){this.name="sha1",this.blockSize=64,this.digestLength=20,this.messageLengthSize=8},i.Algorithm.prototype.start=function(){return i._w||(i._w=new Array(80)),i._createState()},i.Algorithm.prototype.writeMessageLength=function(e,t){e.putBytes(t.bytes())},i.Algorithm.prototype.digest=function(e,t){for(var n,r,o,a,s,u,l,c,f=t.length(),h=i._w;f>=64;){for(r=e.h0,o=e.h1,a=e.h2,s=e.h3,u=e.h4,c=0;c<16;++c)n=t.getInt32(),h[c]=n,l=s^o&(a^s),n=(r<<5|r>>>27)+l+u+1518500249+n,u=s,s=a,a=o<<30|o>>>2,o=r,r=n;for(;c<20;++c)n=h[c-3]^h[c-8]^h[c-14]^h[c-16],n=n<<1|n>>>31,h[c]=n,l=s^o&(a^s),n=(r<<5|r>>>27)+l+u+1518500249+n,u=s,s=a,a=o<<30|o>>>2,o=r,r=n;for(;c<32;++c)n=h[c-3]^h[c-8]^h[c-14]^h[c-16],n=n<<1|n>>>31,h[c]=n,l=o^a^s,n=(r<<5|r>>>27)+l+u+1859775393+n,u=s,s=a,a=o<<30|o>>>2,o=r,r=n;for(;c<40;++c)n=h[c-6]^h[c-16]^h[c-28]^h[c-32],n=n<<2|n>>>30,h[c]=n,l=o^a^s,n=(r<<5|r>>>27)+l+u+1859775393+n,u=s,s=a,a=o<<30|o>>>2,o=r,r=n;for(;c<60;++c)n=h[c-6]^h[c-16]^h[c-28]^h[c-32],n=n<<2|n>>>30,h[c]=n,l=o&a|s&(o^a),n=(r<<5|r>>>27)+l+u+2400959708+n,u=s,s=a,a=o<<30|o>>>2,o=r,r=n;for(;c<80;++c)n=h[c-6]^h[c-16]^h[c-28]^h[c-32],n=n<<2|n>>>30,h[c]=n,l=o^a^s,n=(r<<5|r>>>27)+l+u+3395469782+n,u=s,s=a,a=o<<30|o>>>2,o=r,r=n;e.h0=e.h0+r|0,e.h1=e.h1+o|0,e.h2=e.h2+a|0,e.h3=e.h3+s|0,e.h4=e.h4+u|0,f-=64}return e},i._createState=function(){var e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520};return e.copy=function(){var t=i._createState();return t.h0=e.h0,t.h1=e.h1,t.h2=e.h2,t.h3=e.h3,t.h4=e.h4,t},e.write=function(t){t.putInt32(e.h0),t.putInt32(e.h1),t.putInt32(e.h2),t.putInt32(e.h3),t.putInt32(e.h4)},e};var o={_k:null,_w:null};o.Algorithm=function(){this.name="sha256",this.blockSize=64,this.digestLength=32,this.messageLengthSize=8},o.Algorithm.prototype.start=function(){return o._k||o._init(),o._createState()},o.Algorithm.prototype.writeMessageLength=function(e,t){e.putBytes(t.bytes())},o.Algorithm.prototype.digest=function(e,t){for(var n,r,i,a,s,u,l,c,f,h,d,p,y,v,g,m=t.length(),b=o._k,w=o._w;m>=64;){for(l=0;l<16;++l)w[l]=t.getInt32();for(;l<64;++l)n=w[l-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,r=w[l-15],r=(r>>>7|r<<25)^(r>>>18|r<<14)^r>>>3,w[l]=n+w[l-7]+r+w[l-16]|0;for(c=e.h0,f=e.h1,h=e.h2,d=e.h3,p=e.h4,y=e.h5,v=e.h6,g=e.h7,l=0;l<64;++l)a=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),s=v^p&(y^v),i=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),u=c&f|h&(c^f),n=g+a+s+b[l]+w[l],r=i+u,g=v,v=y,y=p,p=d+n|0,d=h,h=f,f=c,c=n+r|0;e.h0=e.h0+c|0,e.h1=e.h1+f|0,e.h2=e.h2+h|0,e.h3=e.h3+d|0,e.h4=e.h4+p|0,e.h5=e.h5+y|0,e.h6=e.h6+v|0,e.h7=e.h7+g|0,m-=64}return e},o._createState=function(){var e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225};return e.copy=function(){var t=o._createState();return t.h0=e.h0,t.h1=e.h1,t.h2=e.h2,t.h3=e.h3,t.h4=e.h4,t.h5=e.h5,t.h6=e.h6,t.h7=e.h7,t},e.write=function(t){t.putInt32(e.h0),t.putInt32(e.h1),t.putInt32(e.h2),t.putInt32(e.h3),t.putInt32(e.h4),t.putInt32(e.h5),t.putInt32(e.h6),t.putInt32(e.h7)},e},o._init=function(){o._k=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o._w=new Array(64)}}(l),!pe)var Me=function(){pe=n(20).XMLSerializer};if(e.url={},e.url.parsers={simple:{keys:["href","scheme","authority","path","query","fragment"],regex:/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/},full:{keys:["href","protocol","scheme","authority","auth","user","password","hostname","port","path","directory","file","query","fragment"],regex:/^(([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(?:(((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},e.url.parse=function(t,n){for(var r={},i=e.url.parsers[n||"full"],o=i.regex.exec(t),a=i.keys.length;a--;)r[i.keys[a]]=void 0===o[a]?null:o[a];return r.normalizedPath=le(r.path,!!r.authority),r},l?e.useDocumentLoader("node"):"undefined"!=typeof XMLHttpRequest&&e.useDocumentLoader("xhr"),l){e.use=function(t){switch(t){case"request":e.request=n(20);break;default:throw new Ce("Unknown extension.","jsonld.UnknownExtension",{extension:t})}};var qe={exports:{},filename:u};n(20)(qe,"version"),e.version=qe.exports.version}return e},h=function(){return f(function(){return h()})};return!l&&n(21)?(r=[],i=function(){return f(h),h}.apply(t,r),!(void 0!==i&&(e.exports=i))):(f(h),"undefined"!=typeof e&&e.exports&&(e.exports=h),c&&("undefined"==typeof jsonld?jsonld=jsonldjs=h:jsonldjs=h)),h}()}).call(t,n(13),function(){return this}(),n(14).setImmediate,"/")},function(e,t,n){var r;(function(e,i,o){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
	 * @version   2.0.1
	 */
(function(){"use strict";function a(e){return"function"==typeof e||"object"==typeof e&&null!==e}function s(e){return"function"==typeof e}function u(e){return"object"==typeof e&&null!==e}function l(){}function c(){return function(){e.nextTick(p)}}function f(){var e=0,t=new z(p),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function h(){var e=new MessageChannel;return e.port1.onmessage=p,function(){e.port2.postMessage(0)}}function d(){return function(){setTimeout(p,1)}}function p(){for(var e=0;e<F;e+=2){var t=W[e],n=W[e+1];t(n),W[e]=void 0,W[e+1]=void 0}F=0}function y(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function g(){return new TypeError("A promises callback cannot return that same promise.")}function m(e){try{return e.then}catch(e){return $.error=e,$}}function b(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function w(e,t,n){B(function(e){var r=!1,i=b(n,t,function(n){r||(r=!0,t!==n?k(e,n):S(e,n))},function(t){r||(r=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,E(e,i))},e)}function x(e,t){t._state===J?S(e,t._result):e._state===G?E(e,t._result):N(t,void 0,function(t){k(e,t)},function(t){E(e,t)})}function _(e,t){if(t.constructor===e.constructor)x(e,t);else{var n=m(t);n===$?E(e,$.error):void 0===n?S(e,t):s(n)?w(e,t,n):S(e,t)}}function k(e,t){e===t?E(e,v()):a(t)?_(e,t):S(e,t)}function T(e){e._onerror&&e._onerror(e._result),R(e)}function S(e,t){e._state===X&&(e._result=t,e._state=J,0===e._subscribers.length||B(R,e))}function E(e,t){e._state===X&&(e._state=G,e._result=t,B(T,e))}function N(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+J]=n,i[o+G]=r,0===o&&e._state&&B(R,e)}function R(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,i,o=e._result,a=0;a<t.length;a+=3)r=t[a],i=t[a+n],r?I(n,r,i,o):i(o);e._subscribers.length=0}}function j(){this.error=null}function O(e,t){try{return e(t)}catch(e){return Y.error=e,Y}}function I(e,t,n,r){var i,o,a,u,l=s(n);if(l){if(i=O(n,r),i===Y?(u=!0,o=i.error,i=null):a=!0,t===i)return void E(t,g())}else i=r,a=!0;t._state!==X||(l&&a?k(t,i):u?E(t,o):e===J?S(t,i):e===G&&E(t,i))}function C(e,t){try{t(function(t){k(e,t)},function(t){E(e,t)})}catch(t){E(e,t)}}function A(e,t,n,r){this._instanceConstructor=e,this.promise=new e(y,r),this._abortOnReject=n,this._validateInput(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._init(),0===this.length?S(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&S(this.promise,this._result))):E(this.promise,this._validationError())}function L(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function D(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function P(e){this._id=ne++,this._state=void 0,this._result=void 0,this._subscribers=[],y!==e&&(s(e)||L(),this instanceof P||D(),C(this,e))}var U;U=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var M,q=U,F=(Date.now||function(){return(new Date).getTime()},Object.create||function(e){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof e)throw new TypeError("Argument must be an object");return l.prototype=e,new l},0),B=function(e,t){W[F]=e,W[F+1]=t,F+=2,2===F&&M()},H="undefined"!=typeof window?window:{},z=H.MutationObserver||H.WebKitMutationObserver,V="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,W=new Array(1e3);M="undefined"!=typeof e&&"[object process]"==={}.toString.call(e)?c():z?f():V?h():d();var X=void 0,J=1,G=2,$=new j,Y=new j;A.prototype._validateInput=function(e){return q(e)},A.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},A.prototype._init=function(){this._result=new Array(this.length)};var Q=A;A.prototype._enumerate=function(){for(var e=this.length,t=this.promise,n=this._input,r=0;t._state===X&&r<e;r++)this._eachEntry(n[r],r)},A.prototype._eachEntry=function(e,t){var n=this._instanceConstructor;u(e)?e.constructor===n&&e._state!==X?(e._onerror=null,this._settledAt(e._state,t,e._result)):this._willSettleAt(n.resolve(e),t):(this._remaining--,this._result[t]=this._makeResult(J,t,e))},A.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===X&&(this._remaining--,this._abortOnReject&&e===G?E(r,n):this._result[t]=this._makeResult(e,t,n)),0===this._remaining&&S(r,this._result)},A.prototype._makeResult=function(e,t,n){return n},A.prototype._willSettleAt=function(e,t){var n=this;N(e,void 0,function(e){n._settledAt(J,t,e)},function(e){n._settledAt(G,t,e)})};var K=function(e,t){return new Q(this,e,!0,t).promise},Z=function(e,t){function n(e){k(o,e)}function r(e){E(o,e)}var i=this,o=new i(y,t);if(!q(e))return E(o,new TypeError("You must pass an array to race.")),o;for(var a=e.length,s=0;o._state===X&&s<a;s++)N(i.resolve(e[s]),void 0,n,r);return o},ee=function(e,t){var n=this;if(e&&"object"==typeof e&&e.constructor===n)return e;var r=new n(y,t);return k(r,e),r},te=function(e,t){var n=this,r=new n(y,t);return E(r,e),r},ne=0,re=P;P.all=K,P.race=Z,P.resolve=ee,P.reject=te,P.prototype={constructor:P,then:function(e,t){var n=this,r=n._state;if(r===J&&!e||r===G&&!t)return this;var i=new this.constructor(y),o=n._result;if(r){var a=arguments[r-1];B(function(){I(r,i,a,o)})}else N(n,i,e,t);return i},catch:function(e){return this.then(null,e)}};var ie=function(){var e;e="undefined"!=typeof i?i:"undefined"!=typeof window&&window.document?window:self;var t="Promise"in e&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var t;return new e.Promise(function(e){t=e}),s(t)}();t||(e.Promise=re)},oe={Promise:re,polyfill:ie};n(19).amd?(r=function(){return oe}.call(t,n,t,o),!(void 0!==r&&(o.exports=r))):"undefined"!=typeof o&&o.exports?o.exports=oe:"undefined"!=typeof this&&(this.ES6Promise=oe)}).call(this)}).call(t,n(13),function(){return this}(),n(18)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t){},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,n){var r,r;r=function(){};var t=e.exports={Lexer:r("./lib/N3Lexer"),Parser:r("./lib/N3Parser"),Writer:r("./lib/N3Writer"),Store:r("./lib/N3Store"),StreamParser:r("./lib/N3StreamParser"),StreamWriter:r("./lib/N3StreamWriter"),Util:r("./lib/N3Util")};Object.keys(t).forEach(function(e){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return delete t[e],t[e]=n(23)("./N3"+e)}})})},function(e,t,n){function r(e){return n(i(e))}function i(e){return o[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var o={"./N3Lexer":24,"./N3Lexer.js":24,"./N3Parser":25,"./N3Parser.js":25,"./N3Store":26,"./N3Store.js":26,"./N3StreamParser":28,"./N3StreamParser.js":28,"./N3StreamWriter":56,"./N3StreamWriter.js":56,"./N3Util":27,"./N3Util.js":27,"./N3Writer":57,"./N3Writer.js":57};r.keys=function(){return Object.keys(o)},r.resolve=i,e.exports=r,r.id=23},function(e,t,n){(function(t){function n(e){if(!(this instanceof n))return new n(e);if(e&&e.lineMode){this._tripleQuotedString=this._number=this._boolean=/$0^/;var t=this;this._tokenize=this.tokenize,this.tokenize=function(e,n){this._tokenize(e,function(e,r){!e&&/^(?:IRI|prefixed|literal|langcode|type|\.|eof)$/.test(r.type)?n&&n(e,r):n&&n(e||t._syntaxError(r.type,n=null))})}}}var r=String.fromCharCode,i="function"==typeof t?t:function(e){setTimeout(e,0)},o=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g,a={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"\t",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},s=/[\x00-\x20<>\\"\{\}\|\^\`]/;n.prototype={_iri:/^<((?:[^>\\]|\\[uU])+)>/,_unescapedIri:/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>/,_unescapedString:/^"[^"\\]+"(?=[^"\\])/,_singleQuotedString:/^"[^"\\]*(?:\\.[^"\\]*)*"(?=[^"\\])|^'[^'\\]*(?:\\.[^'\\]*)*'(?=[^'\\])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,_prefixed:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?=\.?[,;\s#()\[\]\{\}"'<])/,_blank:/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=\.?[,;:\s#()\[\]\{\}"'<])/,_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d*\.?\d+)(?=[.,;:\s#()\[\]\{\}"'<])/,_boolean:/^(?:true|false)(?=[.,;:\s#()\[\]\{\}"'<])/,_keyword:/^@[a-z]+(?=[\s#<:])/,_sparqlKeyword:/^(?:PREFIX|BASE|GRAPH)(?=[\s#<:])/i,_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_whitespace:/^[ \t]+/,_endOfFile:/^(?:#[^\n\r]*)?$/,_tokenizeToEnd:function(e,t){function n(t){e(t._syntaxError(/^\S*/.exec(r)[0]))}for(var r=this._input;;){for(var i;i=this._newline.exec(r);)r=r.substr(i[0].length,r.length),this._line++;if((i=this._whitespace.exec(r))&&(r=r.substr(i[0].length,r.length)),this._endOfFile.test(r))return t&&e(r=null,{line:this._line,type:"eof",value:"",prefix:""}),this._input=r;var o,a=this._line,u="",l="",c="",f=r[0],h=null,d=0,p=!1;switch(f){case"^":if(1===r.length)break;if("^"!==r[1])return n(this);if(this._prevTokenType="^",r=r.substr(2),"<"!==r[0]){p=!0;break}case"<":if(h=this._unescapedIri.exec(r))u="IRI",l=h[1];else if(h=this._iri.exec(r)){if(o=this._unescape(h[1]),null===o||s.test(o))return n(this);u="IRI",l=o}break;case"_":((h=this._blank.exec(r))||t&&(h=this._blank.exec(r+" ")))&&(u="prefixed",c="_",l=h[1]);break;case'"':case"'":if(h=this._unescapedString.exec(r))u="literal",l=h[0];else if(h=this._singleQuotedString.exec(r)){if(o=this._unescape(h[0]),null===o)return n(this);u="literal",l=o.replace(/^'|'$/g,'"')}else if(h=this._tripleQuotedString.exec(r)){if(o=h[1]||h[2],this._line+=o.split(/\r\n|\r|\n/).length-1,o=this._unescape(o),null===o)return n(this);u="literal",l=o.replace(/^'|'$/g,'"')}break;case"@":"literal"===this._prevTokenType&&(h=this._langcode.exec(r))?(u="langcode",l=h[1]):(h=this._keyword.exec(r))&&(u=h[0]);break;case".":if(1===r.length?t:r[1]<"0"||r[1]>"9"){u=".",d=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(h=this._number.exec(r))&&(u="literal",l='"'+h[0]+'"^^http://www.w3.org/2001/XMLSchema#'+(h[1]?"double":/^[+\-]?\d+$/.test(h[0])?"integer":"decimal"));break;case"B":case"b":case"p":case"P":case"G":case"g":(h=this._sparqlKeyword.exec(r))?u=h[0].toUpperCase():p=!0;break;case"f":case"t":(h=this._boolean.exec(r))?(u="literal",l='"'+h[0]+'"^^http://www.w3.org/2001/XMLSchema#boolean'):p=!0;break;case"a":(h=this._shortPredicates.exec(r))?(u="abbreviation",l="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):p=!0;break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":d=1,u=f;break;default:p=!0}if(p&&("@prefix"!==this._prevTokenType&&"PREFIX"!==this._prevTokenType||!(h=this._prefix.exec(r))?((h=this._prefixed.exec(r))||t&&(h=this._prefixed.exec(r+" ")))&&(u="prefixed",c=h[1]||"",l=this._unescape(h[2])):(u="prefix",l=h[1]||"")),"^"===this._prevTokenType&&(u="IRI"===u||"prefixed"===u?"type":""),!u)return t||!/^'''|^"""/.test(r)&&/\n|\r/.test(r)?n(this):this._input=r;e(null,{line:a,type:u,value:l,prefix:c}),this._prevTokenType=u,r=r.substr(d||h[0].length,r.length)}},_unescape:function(e){try{return e.replace(o,function(e,t,n,i){var o;if(t){if(o=parseInt(t,16),isNaN(o))throw new Error;return r(o)}if(n){if(o=parseInt(n,16),isNaN(o))throw new Error;return o<=65535?r(o):r(55296+(o-=65536)/1024,56320+(1023&o))}var s=a[i];if(!s)throw new Error;return s})}catch(e){return null}},_syntaxError:function(e){return this._input=null,new Error('Syntax error: unexpected "'+e+'" on line '+this._line+".")},tokenize:function(e,t){function n(e){null!==o._input&&(o._input+=e,o._tokenizeToEnd(t,!1))}function r(){null!==o._input&&o._tokenizeToEnd(t,!0)}var o=this;this._line=1,"string"==typeof e?(this._input=e,i(function(){o._tokenizeToEnd(t,!0)})):(this._input="",e&&"function"!=typeof e?("function"==typeof e.setEncoding&&e.setEncoding("utf8"),e.on("data",n),e.on("end",r)):(this.addChunk=n,this.end=r,t||(t=e)))}},e.exports=n}).call(t,n(14).setImmediate)},function(e,t,n){function r(e){if(!(this instanceof r))return new r(e);this._tripleStack=[],this._graph=null,e=e||{},this._setBase(e.documentIRI);var t="string"==typeof e.format&&e.format.match(/\w*$/)[0].toLowerCase(),n="turtle"===t,a="trig"===t,s=/triple/.test(t),u=/quad/.test(t),l=s||u;(this._supportsNamedGraphs=!n)||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(n||a||s),l&&(this._base="",this._resolveIRI=function(e){return this._error("Disallowed relative IRI",e),this._callback=i,this._subject=null}),this._blankNodePrefix="string"!=typeof e.blankNodePrefix?"":"_:"+e.blankNodePrefix.replace(/^_:/,""),this._lexer=e.lexer||new o({lineMode:l})}function i(){}var o=n(24),a="http://www.w3.org/1999/02/22-rdf-syntax-ns#",s=a+"nil",u=a+"first",l=a+"rest",c=/^[a-z][a-z0-9+.-]*:/i,f=/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i,h=/(?:^|\/)\.\.?(?:$|[\/#?])/,d=0,p=0;r._resetBlankNodeIds=function(){d=p=0},r.prototype={_setBase:function(e){if(e){if(e.indexOf("#")>=0)throw new Error("Invalid base IRI "+e)}else e=null;(this._base=e)&&(this._basePath=e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(f),this._baseRoot=e[0],this._baseScheme=e[1])},_readInTopContext:function(e){switch(e.type){case"eof":return null!==this._graph?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"@prefix":return this._sparqlStyle=!1,this._readPrefix;case"PREFIX":return this._sparqlStyle=!0,this._readPrefix;case"@base":return this._sparqlStyle=!1,this._readBaseIRI;case"BASE":return this._sparqlStyle=!0,this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}},_readSubject:function(e){switch(this._predicate=null,e.type){case"IRI":null===this._base||c.test(e.value)?this._subject=e.value:this._subject=this._resolveIRI(e);break;case"prefixed":var t=this._prefixes[e.prefix];if(void 0===t)return this._error('Undefined prefix "'+e.prefix+':"',e);this._subject=t+e.value;break;case"[":return this._subject="_:b"+p++,this._tripleStack.push({subject:this._subject,predicate:null,object:null,type:"blank"}),this._readBlankNodeHead;case"(":return this._tripleStack.push({subject:s,predicate:null,object:null,type:"list"}),this._subject=null,this._readListItem;case"}":return this._readPunctuation(e);default:return this._error("Expected subject but got "+e.type,e)}return this._readPredicateOrNamedGraph},_readPredicate:function(e){var t=e.type;switch(t){case"IRI":case"abbreviation":null===this._base||c.test(e.value)?this._predicate=e.value:this._predicate=this._resolveIRI(e);break;case"prefixed":if("_"===e.prefix)return this._error("Disallowed blank node as predicate",e);var n=this._prefixes[e.prefix];if(void 0===n)return this._error('Undefined prefix "'+e.prefix+':"',e);this._predicate=n+e.value;break;case".":case"]":case"}":return null===this._predicate?this._error("Unexpected "+t,e):(this._subject=null,"]"===t?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._readPredicate;default:return this._error('Expected predicate to follow "'+this._subject+'"',e)}return this._readObject},_readObject:function(e){switch(e.type){case"IRI":null===this._base||c.test(e.value)?this._object=e.value:this._object=this._resolveIRI(e);break;case"prefixed":var t=this._prefixes[e.prefix];if(void 0===t)return this._error('Undefined prefix "'+e.prefix+':"',e);this._object=t+e.value;break;case"literal":return this._object=e.value,this._readDataTypeOrLang;case"[":var n="_:b"+p++;return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:n,type:"blank"}),this._subject=n,this._readBlankNodeHead;case"(":return this._tripleStack.push({subject:this._subject,predicate:this._predicate,object:s,type:"list"}),this._subject=null,this._readListItem;default:return this._error('Expected object to follow "'+this._predicate+'"',e)}return this._getTripleEndReader()},_readPredicateOrNamedGraph:function(e){return"{"===e.type?this._readGraph(e):this._readPredicate(e)},_readGraph:function(e){return"{"!==e.type?this._error("Expected graph but got "+e.type,e):(this._graph=this._subject,this._subject=null,this._readSubject)},_readBlankNodeHead:function(e){return"]"===e.type?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))},_readBlankNodeTail:function(e){if("]"!==e.type)return this._readBlankNodePunctuation(e);null!==this._subject&&this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""});var t=this._tripleStack.pop();return this._subject=t.subject,null!==t.object?(this._predicate=t.predicate,this._object=t.object,this._getTripleEndReader()):null!==this._predicate?this._readPredicate:this._readPredicateOrNamedGraph},_readDataTypeOrLang:function(e){switch(e.type){case"type":var t;if(""===e.prefix)t=null===this._base||c.test(e.value)?e.value:this._resolveIRI(e);else{var n=this._prefixes[e.prefix];if(void 0===n)return this._error('Undefined prefix "'+e.prefix+':"',e);t=n+e.value}return this._object+="^^"+t,this._getTripleEndReader();case"langcode":return this._object+="@"+e.value.toLowerCase(),this._getTripleEndReader();default:return this._getTripleEndReader().call(this,e)}},_readListItem:function(e){var t=null,n=null,r=this._subject,i=this._tripleStack,o=i[i.length-1],a=this._readListItem;switch(e.type){case"IRI":t=null===this._base||c.test(e.value)?e.value:this._resolveIRI(e);break;case"prefixed":var f=this._prefixes[e.prefix];if(void 0===f)return this._error('Undefined prefix "'+e.prefix+':"',e);t=f+e.value;break;case"literal":t=e.value,a=this._readDataTypeOrLang;break;case"[":n="_:b"+p++,t="_:b"+p++,i.push({subject:n,predicate:u,object:t,type:"blank"}),this._subject=t,a=this._readBlankNodeHead;break;case"(":n="_:b"+p++,i.push({subject:n,predicate:u,object:s,type:"list"}),this._subject=null,a=this._readListItem;break;case")":if(i.pop(),0!==i.length&&"list"===i[i.length-1].type&&this._callback(null,{subject:o.subject,predicate:o.predicate,object:o.object,graph:this._graph||""}),this._subject=o.subject,null===o.predicate){if(a=this._readPredicate,o.subject===s)return a}else if(this._predicate=o.predicate,this._object=o.object,a=this._getTripleEndReader(),o.object===s)return a;n=s;break;default:return this._error('Expected list item instead of "'+e.type+'"',e)}return null===n&&(this._subject=n="_:b"+p++),null===r?o.object===s?o.object=n:o.subject=n:this._callback(null,{subject:r,predicate:l,object:n,graph:this._graph||""}),null!==t&&this._callback(null,{subject:n,predicate:u,object:t,graph:this._graph||""}),a},_readPunctuation:function(e){var t,n=this._subject,r=this._graph;switch(e.type){case"}":if(null===this._graph)return this._error("Unexpected graph closing",e);this._graph=null;case".":this._subject=null,t=this._readInTopContext;break;case";":t=this._readPredicate;break;case",":t=this._readObject;break;case"IRI":if(this._supportsQuads&&null===this._graph){r=null===this._base||c.test(e.value)?e.value:this._resolveIRI(e),n=this._subject,t=this._readQuadPunctuation;break}case"prefixed":if(this._supportsQuads&&null===this._graph){var i=this._prefixes[e.prefix];if(void 0===i)return this._error('Undefined prefix "'+e.prefix+':"',e);r=i+e.value,t=this._readQuadPunctuation;break}default:return this._error('Expected punctuation to follow "'+this._object+'"',e)}return null!==n&&this._callback(null,{subject:n,predicate:this._predicate,object:this._object,graph:r||""}),t},_readBlankNodePunctuation:function(e){var t;switch(e.type){case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:return this._error('Expected punctuation to follow "'+this._object+'"',e)}return this._callback(null,{subject:this._subject,predicate:this._predicate,object:this._object,graph:this._graph||""}),t},_readQuadPunctuation:function(e){return"."!==e.type?this._error("Expected dot to follow quad",e):this._readInTopContext},_readPrefix:function(e){return"prefix"!==e.type?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)},_readPrefixIRI:function(e){if("IRI"!==e.type)return this._error('Expected IRI to follow prefix "'+this._prefix+':"',e);var t;return t=null===this._base||c.test(e.value)?e.value:this._resolveIRI(e),this._prefixes[this._prefix]=t,this._prefixCallback(this._prefix,t),this._readDeclarationPunctuation},_readBaseIRI:function(e){if("IRI"!==e.type)return this._error("Expected IRI to follow base declaration",e);try{this._setBase(null===this._base||c.test(e.value)?e.value:this._resolveIRI(e))}catch(t){this._error(t.message,e)}return this._readDeclarationPunctuation},_readNamedGraphLabel:function(e){switch(e.type){case"IRI":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}},_readNamedGraphBlankLabel:function(e){return"]"!==e.type?this._error("Invalid graph label",e):(this._subject="_:b"+p++,this._readGraph)},_readDeclarationPunctuation:function(e){return this._sparqlStyle?this._readInTopContext(e):"."!==e.type?this._error("Expected declaration to end with a dot",e):this._readInTopContext},_getTripleEndReader:function(){var e=this._tripleStack;if(0===e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem}},_error:function(e,t){this._callback(new Error(e+" at line "+t.line+"."))},_resolveIRI:function(e){var t=e.value;switch(t[0]){case void 0:return this._base;case"#":return this._base+t;case"?":return this._base.replace(/(?:\?.*)?$/,t);case"/":return("/"===t[1]?this._baseScheme:this._baseRoot)+this._removeDotSegments(t);default:return this._removeDotSegments(this._basePath+t)}},_removeDotSegments:function(e){if(!h.test(e))return e;for(var t="",n=e.length,r=-1,i=-1,o=0,a="/";r<n;){switch(a){case":":if(i<0&&"/"===e[++r]&&"/"===e[++r])for(;(i=r+1)<n&&"/"!==e[i];)r=i;break;case"?":case"#":r=n;break;case"/":if("."===e[r+1])switch(a=e[++r+1]){case"/":t+=e.substring(o,r-1),o=r+1;break;case void 0:case"?":case"#":return t+e.substring(o,r)+e.substr(r+1);case".":if(a=e[++r+1],void 0===a||"/"===a||"?"===a||"#"===a){if(t+=e.substring(o,r-2),(o=t.lastIndexOf("/"))>=i&&(t=t.substr(0,o)),"/"!==a)return t+"/"+e.substr(r+1);o=r+1}}}a=e[++r]}return t+e.substring(o)},parse:function(e,t,n){this._readCallback=this._readInTopContext,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix||"_:b"+d++ +"_","function"==typeof e&&(n=t,t=e,e=null),this._callback=t||i,this._prefixCallback=n||i;var r=this;this._lexer.tokenize(e,function(e,t){null!==e?(r._callback(e),r._callback=i):void 0!==r._readCallback&&(r._readCallback=r._readCallback(t))}),e||(this.addChunk=this._lexer.addChunk,this.end=this._lexer.end)}},e.exports=r},function(e,t,n){function r(e,t){return this instanceof r?(this._size=0,this._graphs=Object.create(null),this._entities=Object.create(null),this._entities["><"]=0,this._entityCount=0,this._blankNodeIndex=0,t||!e||e[0]||(t=e,e=null),this._prefixes=Object.create(null),t&&t.prefixes&&this.addPrefixes(t.prefixes),void(e&&this.addTriples(e))):new r(e,t)}var i=n(27).expandPrefixedName;r.prototype={get size(){var e=this._size;if(null!==e)return e;var t,n,r=this._graphs;for(var i in r)for(var o in t=r[i].subjects)for(var a in n=t[o])e+=Object.keys(n[a]).length;return this._size=e},_addToIndex:function(e,t,n,r){var i=e[t]||(e[t]={}),o=i[n]||(i[n]={});o[r]=null},_removeFromIndex:function(e,t,n,r){var i,o=e[t],a=o[n];delete a[r];for(i in a)return;delete o[n];for(i in o)return;delete e[t]},_findInIndex:function(e,t,n,r,i,o,a,s){var u,l,c,f=[],h=Object.keys(this._entities);t&&((u=e,e={})[t]=u[t]);for(var d in e){var p=h[d];if(l=e[d]){n&&((u=l,l={})[n]=u[n]);for(var y in l){var v=h[y];if(c=l[y])for(var g=(r?r in c?[r]:[]:Object.keys(c)),m=g.length-1;m>=0;m--){var b={subject:"",predicate:"",object:"",graph:s};b[i]=p,b[o]=v,b[a]=h[g[m]],f.push(b)}}}}return f},_countInIndex:function(e,t,n,r){var i,o,a,s=0;t&&((i=e,e={})[t]=i[t]);for(var u in e)if(o=e[u]){n&&((i=o,o={})[n]=i[n]);for(var l in o)(a=o[l])&&(r?r in a&&s++:s+=Object.keys(a).length)}return s},addTriple:function(e,t,n,r){t||(r=e.graph,n=e.object,t=e.predicate,e=e.subject),r=r||"";var i=this._graphs[r];i||(i=this._graphs[r]={subjects:{},predicates:{},objects:{}},Object.freeze(i));var o=this._entities;e=o[e]||(o[e]=++this._entityCount),t=o[t]||(o[t]=++this._entityCount),n=o[n]||(o[n]=++this._entityCount),this._addToIndex(i.subjects,e,t,n),this._addToIndex(i.predicates,t,n,e),this._addToIndex(i.objects,n,e,t),this._size=null},addTriples:function(e){for(var t=e.length-1;t>=0;t--)this.addTriple(e[t])},addPrefix:function(e,t){this._prefixes[e]=t},addPrefixes:function(e){for(var t in e)this.addPrefix(t,e[t])},removeTriple:function(e,t,n,r){t||(r=e.graph,n=e.object,t=e.predicate,e=e.subject),r=r||"";var i,o=this._entities,a=this._graphs;if((e=o[e])&&(t=o[t])&&(n=o[n])&&(i=a[r])){var s,u;if((s=i.subjects[e])&&(u=s[t])&&n in u){this._removeFromIndex(i.subjects,e,t,n),this._removeFromIndex(i.predicates,t,n,e),this._removeFromIndex(i.objects,n,e,t),null!==this._size&&this._size--;for(e in i.subjects)return;delete a[r]}}},removeTriples:function(e){for(var t=e.length-1;t>=0;t--)this.removeTriple(e[t])},find:function(e,t,n,r){var o=this._prefixes;return this.findByIRI(i(e,o),i(t,o),i(n,o),i(r,o))},findByIRI:function(e,t,n,r){r=r||"";var i=this._graphs[r],o=this._entities;return i?e&&!(e=o[e])?[]:t&&!(t=o[t])?[]:n&&!(n=o[n])?[]:e?n?this._findInIndex(i.objects,n,e,t,"object","subject","predicate",r):this._findInIndex(i.subjects,e,t,null,"subject","predicate","object",r):t?this._findInIndex(i.predicates,t,n,null,"predicate","object","subject",r):n?this._findInIndex(i.objects,n,null,null,"object","subject","predicate",r):this._findInIndex(i.subjects,null,null,null,"subject","predicate","object",r):[]},count:function(e,t,n,r){var o=this._prefixes;return this.countByIRI(i(e,o),i(t,o),i(n,o),i(r,o))},countByIRI:function(e,t,n,r){r=r||"";var i=this._graphs[r],o=this._entities;return i?e&&!(e=o[e])?0:t&&!(t=o[t])?0:n&&!(n=o[n])?0:e?n?this._countInIndex(i.objects,n,e,t):this._countInIndex(i.subjects,e,t,n):t?this._countInIndex(i.predicates,t,n,e):this._countInIndex(i.objects,n,e,t):0},createBlankNode:function(e){var t,n;if(e)for(t=e="_:"+e,n=1;this._entities[t];)t=e+n++;else do t="_:b"+this._blankNodeIndex++;while(this._entities[t]);return this._entities[t]=++this._entityCount,t}},e.exports=r},function(e,t){function n(e,t){for(var n in c)t?e.prototype[n]=r(c[n]):e[n]=c[n];return e}function r(e){return function(t){return e(this,t)}}var i="http://www.w3.org/2001/XMLSchema#",o=i+"string",a=i+"integer",s=i+"decimal",u=i+"boolean",l="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",c={isIRI:function(e){if(!e)return e;var t=e[0];return'"'!==t&&"_"!==t},isLiteral:function(e){return e&&'"'===e[0]},isBlank:function(e){return e&&"_:"===e.substr(0,2)},getLiteralValue:function(e){var t=/^"([^]*)"/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]},getLiteralType:function(e){var t=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]||(t[2]?l:o)},getLiteralLanguage:function(e){var t=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]?t[1].toLowerCase():""},isPrefixedName:function(e){return e&&/^[^:\/"']*:[^:\/"']+$/.test(e)},expandPrefixedName:function(e,t){var n,r,i,o=/(?:^|"\^\^)([^:\/#"'\^_]*):[^\/]*$/.exec(e);return o&&(n=o[1],r=t[n],i=o.index),void 0===r?e:0===i?r+e.substr(n.length+1):e.substr(0,i+3)+r+e.substr(i+n.length+4)},createIRI:function(e){return e&&'"'===e[0]?c.getLiteralValue(e):e},createLiteral:function(e,t){if(!t)switch(typeof e){case"boolean":t=u;break;case"number":if(isFinite(e)){t=e%1===0?a:s;break}default:return'"'+e+'"'}return'"'+e+(/^[a-z]+(-[a-z0-9]+)*$/i.test(t)?'"@'+t.toLowerCase():'"^^'+t)}};e.exports=n(n)},function(e,t,n){function r(e){if(!(this instanceof r))return new r(e);i.call(this,{decodeStrings:!0}),this._readableState.objectMode=!0;var t=this,n=new a(e);n.parse(function(e,n){n&&t.push(n)||e&&t.emit("error",e)},this.emit.bind(this,"prefix")),this._transform=function(e,t,r){n.addChunk(e),r()},this._flush=function(e){n.end(),e()}}var i=n(29).Transform,o=n(53),a=n(25);o.inherits(r,i),e.exports=r},function(e,t,n){function r(){i.call(this)}e.exports=r;var i=n(30).EventEmitter,o=n(31);o(r,i),r.Readable=n(32),r.Writable=n(49),r.Duplex=n(50),r.Transform=n(51),r.PassThrough=n(52),r.Stream=r,r.prototype.pipe=function(e,t){function n(t){e.writable&&!1===e.write(t)&&l.pause&&l.pause()}function r(){l.readable&&l.resume&&l.resume()}function o(){c||(c=!0,e.end())}function a(){c||(c=!0,"function"==typeof e.destroy&&e.destroy())}function s(e){if(u(),0===i.listenerCount(this,"error"))throw e}function u(){l.removeListener("data",n),e.removeListener("drain",r),l.removeListener("end",o),l.removeListener("close",a),l.removeListener("error",s),e.removeListener("error",s),l.removeListener("end",u),l.removeListener("close",u),e.removeListener("close",u)}var l=this;l.on("data",n),e.on("drain",r),e._isStdio||t&&t.end===!1||(l.on("end",o),l.on("close",a));var c=!1;return l.on("error",s),e.on("error",s),l.on("end",u),l.on("close",u),e.on("close",u),e.emit("pipe",l),e}},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,
n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,s,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],a(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(o(n))for(s=Array.prototype.slice.call(arguments,1),l=n.slice(),i=l.length,u=0;u<i;u++)l[u].apply(this,s);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,a,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){(function(r){var i=function(){try{return n(29)}catch(e){}}();t=e.exports=n(33),t.Stream=i||t,t.Readable=t,t.Writable=n(44),t.Duplex=n(43),t.Transform=n(47),t.PassThrough=n(48),!r.browser&&"disable"===r.env.READABLE_STREAM&&i&&(e.exports=i)}).call(t,n(13))},function(e,t,n){(function(t){"use strict";function r(e,t,n){return"function"==typeof e.prependListener?e.prependListener(t,n):void(e._events&&e._events[t]?I(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n))}function i(e,t){j=j||n(43),e=e||{},this.objectMode=!!e.objectMode,t instanceof j&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new F,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(q||(q=n(46).StringDecoder),this.decoder=new q(e.encoding),this.encoding=e.encoding)}function o(e){return j=j||n(43),this instanceof o?(this._readableState=new i(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),void C.call(this)):new o(e)}function a(e,t,n,r,i){var o=c(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,f(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var a=new Error("stream.push() after EOF");e.emit("error",a)}else if(t.endEmitted&&i){var u=new Error("stream.unshift() after end event");e.emit("error",u)}else{var l;!t.decoder||i||r||(n=t.decoder.write(n),l=!t.objectMode&&0===n.length),i||(t.reading=!1),l||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&h(e))),p(e,t)}else i||(t.reading=!1);return s(t)}function s(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}function u(e){return e>=B?e=B:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}function l(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=u(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function c(e,t){var n=null;return L.isBuffer(t)||"string"==typeof t||null===t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function f(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,h(e)}}function h(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(M("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?O(d,e):d(e))}function d(e){M("emit readable"),e.emit("readable"),w(e)}function p(e,t){t.readingMore||(t.readingMore=!0,O(y,e,t))}function y(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(M("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function v(e){return function(){var t=e._readableState;M("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&A(e,"data")&&(t.flowing=!0,w(e))}}function g(e){M("readable nexttick read 0"),e.read(0)}function m(e,t){t.resumeScheduled||(t.resumeScheduled=!0,O(b,e,t))}function b(e,t){t.reading||(M("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),w(e),t.flowing&&!t.reading&&e.read(0)}function w(e){var t=e._readableState;for(M("flow",t.flowing);t.flowing&&null!==e.read(););}function x(e,t){if(0===t.length)return null;var n;return t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=_(e,t.buffer,t.decoder),n}function _(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?k(e,t):T(e,t),r}function k(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,a=e>o.length?o.length:e;if(i+=a===o.length?o:o.slice(0,e),e-=a,0===e){a===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(a));break}++r}return t.length-=r,i}function T(e,t){var n=D.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,a=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,a),e-=a,0===e){a===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(a));break}++i}return t.length-=i,n}function S(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,O(E,t,e))}function E(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function N(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}function R(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}e.exports=o;var j,O=n(34),I=n(35);o.ReadableState=i;var C,A=(n(30).EventEmitter,function(e,t){return e.listeners(t).length});!function(){try{C=n(29)}catch(e){}finally{C||(C=n(30).EventEmitter)}}();var L=n(36).Buffer,D=n(39),P=n(40);P.inherits=n(31);var U=n(41),M=void 0;M=U&&U.debuglog?U.debuglog("stream"):function(){};var q,F=n(42);P.inherits(o,C),o.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding,t!==n.encoding&&(e=D.from(e,t),t="")),a(this,n,e,t,!1)},o.prototype.unshift=function(e){var t=this._readableState;return a(this,t,e,"",!0)},o.prototype.isPaused=function(){return this._readableState.flowing===!1},o.prototype.setEncoding=function(e){return q||(q=n(46).StringDecoder),this._readableState.decoder=new q(e),this._readableState.encoding=e,this};var B=8388608;o.prototype.read=function(e){M("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return M("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?S(this):h(this),null;if(e=l(e,t),0===e&&t.ended)return 0===t.length&&S(this),null;var r=t.needReadable;M("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&(r=!0,M("length less than watermark",r)),t.ended||t.reading?(r=!1,M("reading or ended",r)):r&&(M("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=l(n,t)));var i;return i=e>0?x(e,t):null,null===i?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&S(this)),null!==i&&this.emit("data",i),i},o.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},o.prototype.pipe=function(e,n){function i(e){M("onunpipe"),e===h&&a()}function o(){M("onend"),e.end()}function a(){M("cleanup"),e.removeListener("close",l),e.removeListener("finish",c),e.removeListener("drain",g),e.removeListener("error",u),e.removeListener("unpipe",i),h.removeListener("end",o),h.removeListener("end",a),h.removeListener("data",s),m=!0,!d.awaitDrain||e._writableState&&!e._writableState.needDrain||g()}function s(t){M("ondata"),b=!1;var n=e.write(t);!1!==n||b||((1===d.pipesCount&&d.pipes===e||d.pipesCount>1&&R(d.pipes,e)!==-1)&&!m&&(M("false write response, pause",h._readableState.awaitDrain),h._readableState.awaitDrain++,b=!0),h.pause())}function u(t){M("onerror",t),f(),e.removeListener("error",u),0===A(e,"error")&&e.emit("error",t)}function l(){e.removeListener("finish",c),f()}function c(){M("onfinish"),e.removeListener("close",l),f()}function f(){M("unpipe"),h.unpipe(e)}var h=this,d=this._readableState;switch(d.pipesCount){case 0:d.pipes=e;break;case 1:d.pipes=[d.pipes,e];break;default:d.pipes.push(e)}d.pipesCount+=1,M("pipe count=%d opts=%j",d.pipesCount,n);var p=(!n||n.end!==!1)&&e!==t.stdout&&e!==t.stderr,y=p?o:a;d.endEmitted?O(y):h.once("end",y),e.on("unpipe",i);var g=v(h);e.on("drain",g);var m=!1,b=!1;return h.on("data",s),r(e,"error",u),e.once("close",l),e.once("finish",c),e.emit("pipe",h),d.flowing||(M("pipe resume"),h.resume()),e},o.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var o=R(t.pipes,e);return o===-1?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},o.prototype.on=function(e,t){var n=C.prototype.on.call(this,e,t);if("data"===e)this._readableState.flowing!==!1&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&h(this,r):O(g,this))}return n},o.prototype.addListener=o.prototype.on,o.prototype.resume=function(){var e=this._readableState;return e.flowing||(M("resume"),e.flowing=!0,m(this,e)),this},o.prototype.pause=function(){return M("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(M("pause"),this._readableState.flowing=!1,this.emit("pause")),this},o.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;e.on("end",function(){if(M("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),e.on("data",function(i){if(M("wrapped data"),t.decoder&&(i=t.decoder.write(i)),(!t.objectMode||null!==i&&void 0!==i)&&(t.objectMode||i&&i.length)){var o=r.push(i);o||(n=!0,e.pause())}});for(var i in e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));var o=["error","close","destroy","pause","resume"];return N(o,function(t){e.on(t,r.emit.bind(r,t))}),r._read=function(t){M("wrapped _read",t),n&&(n=!1,e.resume())},r},o._fromList=x}).call(t,n(13))},function(e,t,n){(function(t){"use strict";function n(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,n)});case 3:return t.nextTick(function(){e.call(null,n,r)});case 4:return t.nextTick(function(){e.call(null,n,r,i)});default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return t.nextTick(function(){e.apply(null,o)})}}!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports=n:e.exports=t.nextTick}).call(t,n(13))},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(e){/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
"use strict";function r(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function i(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=a.prototype):(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return s(this,e,t,n)}function s(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?d(e,t,n,r):"string"==typeof t?f(e,t,n):p(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t,n,r){return u(t),t<=0?o(e,t):void 0!==n?"string"==typeof r?o(e,t).fill(n,r):o(e,t).fill(n):o(e,t)}function c(e,t){if(u(t),e=o(e,t<0?0:0|y(t)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|g(t,n);e=o(e,r);var i=e.write(t,n);return i!==r&&(e=e.slice(0,i)),e}function h(e,t){var n=t.length<0?0:0|y(t.length);e=o(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function d(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),a.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=a.prototype):e=h(e,t),e}function p(e,t){if(a.isBuffer(t)){var n=0|y(t.length);return e=o(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||Y(t.length)?o(e,0):h(e,t);if("Buffer"===t.type&&Z(t.data))return h(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function y(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function v(e){return+e!=e&&(e=0),a.alloc(+e)}function g(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return W(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return G(e).length;default:if(r)return W(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return j(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return R(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function b(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function w(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:x(e,t,n,r,i);if("number"==typeof t)return t&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):x(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function x(e,t,n,r,i){function o(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var a=1,s=e.length,u=t.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,n/=2}var l;if(i){var c=-1;for(l=n;l<s;l++)if(o(e,l)===o(t,c===-1?0:l-c)){if(c===-1&&(c=l),l-c+1===u)return c*a}else c!==-1&&(l-=l-c),c=-1}else for(n+u>s&&(n=s-u),l=n;l>=0;l--){for(var f=!0,h=0;h<u;h++)if(o(e,l+h)!==o(t,h)){f=!1;break}if(f)return l}return-1}function _(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var o=t.length;if(o%2!==0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function k(e,t,n,r){return $(W(t,e.length-n),e,n,r)}function T(e,t,n,r){return $(X(t),e,n,r)}function S(e,t,n,r){return T(e,t,n,r)}function E(e,t,n,r){return $(G(t),e,n,r)}function N(e,t,n,r){return $(J(t,e.length-n),e,n,r)}function R(e,t,n){return 0===t&&n===e.length?Q.fromByteArray(e):Q.fromByteArray(e.slice(t,n))}function j(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o=e[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s<=n){var u,l,c,f;switch(s){case 1:o<128&&(a=o);break;case 2:u=e[i+1],128===(192&u)&&(f=(31&o)<<6|63&u,f>127&&(a=f));break;case 3:u=e[i+1],l=e[i+2],128===(192&u)&&128===(192&l)&&(f=(15&o)<<12|(63&u)<<6|63&l,f>2047&&(f<55296||f>57343)&&(a=f));break;case 4:u=e[i+1],l=e[i+2],c=e[i+3],128===(192&u)&&128===(192&l)&&128===(192&c)&&(f=(15&o)<<18|(63&u)<<12|(63&l)<<6|63&c,f>65535&&f<1114112&&(a=f))}}null===a?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=s}return O(r)}function O(e){var t=e.length;if(t<=ee)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=ee));return n}function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function C(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function A(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=V(e[o]);return i}function L(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function D(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,n,r,i,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function U(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function M(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function q(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,r,i){return i||q(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),K.write(e,t,n,r,23,4),n+4}function B(e,t,n,r,i){return i||q(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),K.write(e,t,n,r,52,8),n+8}function H(e){if(e=z(e).replace(te,""),e.length<2)return"";for(;e.length%4!==0;)e+="=";return e}function z(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function V(e){return e<16?"0"+e.toString(16):e.toString(16)}function W(e,t){t=t||1/0;for(var n,r=e.length,i=null,o=[],a=0;a<r;++a){if(n=e.charCodeAt(a),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function X(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function J(e,t){for(var n,r,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function G(e){return Q.toByteArray(H(e))}function $(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function Y(e){return e!==e}var Q=n(37),K=n(38),Z=n(35);t.Buffer=a,t.SlowBuffer=v,t.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:r(),t.kMaxLength=i(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,n){return s(null,e,t,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,n){return l(null,e,t,n)},a.allocUnsafe=function(e){return c(null,e)},a.allocUnsafeSlow=function(e){return c(null,e)},a.isBuffer=function(e){return!(null==e||!e._isBuffer)},a.compare=function(e,t){if(!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Z(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=a.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},a.byteLength=g,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)b(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},a.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?j(this,0,e):m.apply(this,arguments)},a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,r,i){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,i>>>=0,this===e)return 0;for(var o=i-r,s=n-t,u=Math.min(o,s),l=this.slice(r,i),c=e.slice(t,n),f=0;f<u;++f)if(l[f]!==c[f]){o=l[f],s=c[f];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1},a.prototype.indexOf=function(e,t,n){return w(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return w(this,e,t,n,!1)},a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return k(this,e,t,n);case"ascii":return T(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return E(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ee=4096;a.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);var r;if(a.TYPED_ARRAY_SUPPORT)r=this.subarray(e,t),r.__proto__=a.prototype;else{var i=t-e;r=new a(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},a.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},a.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},a.prototype.readUInt8=function(e,t){return t||D(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return t||D(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return t||D(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||D(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},a.prototype.readInt8=function(e,t){return t||D(e,1,this.length),128&this[e]?(255-this[e]+1)*-1:this[e]},a.prototype.readInt16LE=function(e,t){t||D(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){t||D(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return t||D(e,4,this.length),K.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return t||D(e,4,this.length),K.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return t||D(e,8,this.length),K.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return t||D(e,8,this.length),K.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){var i=Math.pow(2,8*n)-1;P(this,e,t,n,i,0)}var o=1,a=0;for(this[t]=255&e;++a<n&&(o*=256);)this[t+a]=e/o&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t|=0,n|=0,!r){var i=Math.pow(2,8*n)-1;P(this,e,t,n,i,0)}var o=n-1,a=1;for(this[t+o]=255&e;--o>=0&&(a*=256);)this[t+o]=e/a&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,255,0),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);P(this,e,t,n,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);P(this,e,t,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,1,127,-128),a.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),a.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},a.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return B(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return B(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var o;if("number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=a.isBuffer(e)?e:W(new a(e,r).toString()),u=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%u]}return this};var te=/[^+\/0-9A-Za-z-_]/g}).call(t,function(){return this}())},function(e,t){"use strict";function n(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function r(e){return 3*e.length/4-n(e)}function i(e){var t,r,i,o,a,s,u=e.length;a=n(e),s=new c(3*u/4-a),i=a>0?u-4:u;var f=0;for(t=0,r=0;t<i;t+=4,r+=3)o=l[e.charCodeAt(t)]<<18|l[e.charCodeAt(t+1)]<<12|l[e.charCodeAt(t+2)]<<6|l[e.charCodeAt(t+3)],s[f++]=o>>16&255,s[f++]=o>>8&255,s[f++]=255&o;return 2===a?(o=l[e.charCodeAt(t)]<<2|l[e.charCodeAt(t+1)]>>4,s[f++]=255&o):1===a&&(o=l[e.charCodeAt(t)]<<10|l[e.charCodeAt(t+1)]<<4|l[e.charCodeAt(t+2)]>>2,s[f++]=o>>8&255,s[f++]=255&o),s}function o(e){return u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[63&e]}function a(e,t,n){for(var r,i=[],a=t;a<n;a+=3)r=(e[a]<<16)+(e[a+1]<<8)+e[a+2],i.push(o(r));return i.join("")}function s(e){for(var t,n=e.length,r=n%3,i="",o=[],s=16383,l=0,c=n-r;l<c;l+=s)o.push(a(e,l,l+s>c?c:l+s));return 1===r?(t=e[n-1],i+=u[t>>2],i+=u[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=u[t>>10],i+=u[t>>4&63],i+=u[t<<2&63],i+="="),o.push(i),o.join("")}t.byteLength=r,t.toByteArray=i,t.fromByteArray=s;for(var u=[],l=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,d=f.length;h<d;++h)u[h]=f[h],l[f.charCodeAt(h)]=h;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,f=n?i-1:0,h=n?-1:1,d=e[t+f];for(f+=h,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+e[t+f],f+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+e[t+f],f+=h,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:(d?-1:1)*(1/0);a+=Math.pow(2,r),o-=l}return(d?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,f=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),t+=a+f>=1?h/u:h*Math.pow(2,1-f),t*u>=2&&(a++,u/=2),a+f>=c?(s=0,a=c):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[n+d]=255&s,d+=p,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[n+d]=255&a,d+=p,a/=256,l-=8);e[n+d-p]|=128*y}},function(e,t,n){(function(e){"use strict";var r=n(36),i=r.Buffer,o=r.SlowBuffer,a=r.kMaxLength||2147483647;t.alloc=function(e,t,n){if("function"==typeof i.alloc)return i.alloc(e,t,n);if("number"==typeof n)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(e>a)throw new RangeError("size is too large");var r=n,o=t;void 0===o&&(r=void 0,o=0);var s=new i(e);if("string"==typeof o)for(var u=new i(o,r),l=u.length,c=-1;++c<e;)s[c]=u[c%l];else s.fill(o);return s},t.allocUnsafe=function(e){if("function"==typeof i.allocUnsafe)return i.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>a)throw new RangeError("size is too large");return new i(e)},t.from=function(t,n,r){if("function"==typeof i.from&&(!e.Uint8Array||Uint8Array.from!==i.from))return i.from(t,n,r);if("number"==typeof t)throw new TypeError('"value" argument must not be a number');if("string"==typeof t)return new i(t,n);if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer){var o=n;if(1===arguments.length)return new i(t);"undefined"==typeof o&&(o=0);var a=r;if("undefined"==typeof a&&(a=t.byteLength-o),o>=t.byteLength)throw new RangeError("'offset' is out of bounds");if(a>t.byteLength-o)throw new RangeError("'length' is out of bounds");return new i(t.slice(o,o+a))}if(i.isBuffer(t)){var s=new i(t.length);return t.copy(s,0,0,t.length),s}if(t){if(Array.isArray(t)||"undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return new i(t);if("Buffer"===t.type&&Array.isArray(t.data))return new i(t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},t.allocUnsafeSlow=function(e){if("function"==typeof i.allocUnsafeSlow)return i.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>=a)throw new RangeError("size is too large");return new o(e)}}).call(t,function(){return this}())},function(e,t,n){(function(e){function n(e){return Array.isArray?Array.isArray(e):"[object Array]"===v(e)}function r(e){return"boolean"==typeof e}function i(e){return null===e}function o(e){return null==e}function a(e){return"number"==typeof e}function s(e){return"string"==typeof e}function u(e){return"symbol"==typeof e}function l(e){return void 0===e}function c(e){return"[object RegExp]"===v(e)}function f(e){return"object"==typeof e&&null!==e}function h(e){return"[object Date]"===v(e)}function d(e){return"[object Error]"===v(e)||e instanceof Error}function p(e){return"function"==typeof e}function y(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function v(e){return Object.prototype.toString.call(e)}t.isArray=n,t.isBoolean=r,t.isNull=i,t.isNullOrUndefined=o,t.isNumber=a,t.isString=s,t.isSymbol=u,t.isUndefined=l,t.isRegExp=c,t.isObject=f,t.isDate=h,t.isError=d,t.isFunction=p,t.isPrimitive=y,t.isBuffer=e.isBuffer}).call(t,n(36).Buffer)},function(e,t){},function(e,t,n){"use strict";function r(){this.head=null,this.tail=null,this.length=0}var i=(n(36).Buffer,n(39));e.exports=r,r.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},r.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},r.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},r.prototype.clear=function(){this.head=this.tail=null,this.length=0},r.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},r.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),n=this.head,r=0;n;)n.data.copy(t,r),r+=n.data.length,n=n.next;return t}},function(e,t,n){"use strict";function r(e){return this instanceof r?(l.call(this,e),c.call(this,e),e&&e.readable===!1&&(this.readable=!1),e&&e.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,e&&e.allowHalfOpen===!1&&(this.allowHalfOpen=!1),void this.once("end",i)):new r(e)}function i(){this.allowHalfOpen||this._writableState.ended||s(o,this)}function o(e){e.end()}var a=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=r;var s=n(34),u=n(40);u.inherits=n(31);var l=n(33),c=n(44);u.inherits(r,l);for(var f=a(c.prototype),h=0;h<f.length;h++){var d=f[h];r.prototype[d]||(r.prototype[d]=c.prototype[d])}},function(e,t,n){(function(t,r){"use strict";function i(){}function o(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function a(e,t){T=T||n(43),e=e||{},this.objectMode=!!e.objectMode,t instanceof T&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var r=e.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=e.decodeStrings===!1;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){y(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new k(this)}function s(e){return T=T||n(43),C.call(s,this)||this instanceof T?(this._writableState=new a(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),void R.call(this)):new s(e)}function u(e,t){var n=new Error("write after end");e.emit("error",n),S(t,n)}function l(e,t,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):O.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),S(r,o),i=!1),i}function c(e,t,n){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=I.from(t,n)),t}function f(e,t,n,r,i){n=c(t,n,r),O.isBuffer(n)&&(r="buffer");var a=t.objectMode?1:n.length;t.length+=a;var s=t.length<t.highWaterMark;if(s||(t.needDrain=!0),t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest=new o(n,r,i),u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else h(e,t,!1,a,n,r,i);return s}function h(e,t,n,r,i,o,a){t.writelen=r,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function d(e,t,n,r,i){--t.pendingcb,n?S(i,r):i(r),e._writableState.errorEmitted=!0,e.emit("error",r)}function p(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}function y(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(p(n),t)d(e,n,r,t,i);else{var o=b(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||m(e,n),r?E(v,e,n,o,i):v(e,n,o,i)}}function v(e,t,n,r){n||g(e,t),t.pendingcb--,r(),x(e,t)}function g(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}function m(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0;n;)i[a]=n,n=n.next,a+=1;h(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new k(t)}else{for(;n;){var s=n.chunk,u=n.encoding,l=n.callback,c=t.objectMode?1:s.length;if(h(e,t,!1,c,s,u,l),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function b(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function w(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function x(e,t){var n=b(t);return n&&(0===t.pendingcb?(w(e,t),t.finished=!0,e.emit("finish")):w(e,t)),n}function _(e,t,n){t.ending=!0,x(e,t),n&&(t.finished?S(n):e.once("finish",n)),t.ended=!0,e.writable=!1}function k(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}e.exports=s;var T,S=n(34),E=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:S;s.WritableState=a;var N=n(40);N.inherits=n(31);var R,j={deprecate:n(45)};!function(){try{R=n(29)}catch(e){}finally{R||(R=n(30).EventEmitter)}}();var O=n(36).Buffer,I=n(39);N.inherits(s,R),a.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(a.prototype,"buffer",{get:j.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}();var C;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(C=Function.prototype[Symbol.hasInstance],Object.defineProperty(s,Symbol.hasInstance,{value:function(e){return!!C.call(this,e)||e&&e._writableState instanceof a}})):C=function(e){return e instanceof this},s.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},s.prototype.write=function(e,t,n){var r=this._writableState,o=!1;return"function"==typeof t&&(n=t,t=null),O.isBuffer(e)?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=i),r.ended?u(this,n):l(this,r,e,n)&&(r.pendingcb++,o=f(this,r,e,t,n)),o},s.prototype.cork=function(){var e=this._writableState;e.corked++},s.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||m(this,e))},s.prototype.setDefaultEncoding=function(e){
if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},s.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},s.prototype._writev=null,s.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||_(this,r,n)}}).call(t,n(13),n(14).setImmediate)},function(e,t){(function(t){function n(e,t){function n(){if(!i){if(r("throwDeprecation"))throw new Error(t);r("traceDeprecation")?console.trace(t):console.warn(t),i=!0}return e.apply(this,arguments)}if(r("noDeprecation"))return e;var i=!1;return n}function r(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=n}).call(t,function(){return this}())},function(e,t,n){function r(e){if(e&&!u(e))throw new Error("Unknown encoding: "+e)}function i(e){return e.toString(this.encoding)}function o(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function a(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}var s=n(36).Buffer,u=s.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}},l=t.StringDecoder=function(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),r(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:return void(this.write=i)}this.charBuffer=new s(6),this.charReceived=0,this.charLength=0};l.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";e=e.slice(n,e.length),t=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var r=t.charCodeAt(t.length-1);if(!(r>=55296&&r<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var i=e.length;this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),t+=e.toString(this.encoding,0,i);var i=t.length-1,r=t.charCodeAt(i);if(r>=55296&&r<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),e.copy(this.charBuffer,0,0,o),t.substring(0,i)}return t},l.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},l.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;t+=r.slice(0,n).toString(i)}return t}},function(e,t,n){"use strict";function r(e){this.afterTransform=function(t,n){return i(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!==n&&void 0!==n&&e.push(n),i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}function o(e){if(!(this instanceof o))return new o(e);s.call(this,e),this._transformState=new r(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(e,n){a(t,e,n)}):a(t)})}function a(e,t,n){if(t)return e.emit("error",t);null!==n&&void 0!==n&&e.push(n);var r=e._writableState,i=e._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}e.exports=o;var s=n(43),u=n(40);u.inherits=n(31),u.inherits(o,s),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},o.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},function(e,t,n){"use strict";function r(e){return this instanceof r?void i.call(this,e):new r(e)}e.exports=r;var i=n(47),o=n(40);o.inherits=n(31),o.inherits(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){e.exports=n(44)},function(e,t,n){e.exports=n(43)},function(e,t,n){e.exports=n(47)},function(e,t,n){e.exports=n(48)},[177,54,55],function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},31,function(e,t,n){function r(e){if(!(this instanceof r))return new r(e);i.call(this,{encoding:"utf8"}),this._writableState.objectMode=!0;var t=this,n=new a({write:function(e,n,r){t.push(e),r&&r()},end:function(e){t.push(null),e&&e()}},e);this._transform=function(e,t,r){n.addTriple(e,r)},this._flush=function(e){n.end(e)}}var i=n(29).Transform,o=n(53),a=n(57);o.inherits(r,i),e.exports=r},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);if(e&&"function"!=typeof e.write&&(t=e,e=null),t=t||{},e)this._outputStream=e,this._endStream=void 0===t.end||!!t.end;else{var r="";this._outputStream={write:function(e,t,n){r+=e,n&&n()},end:function(e){e&&e(null,r)}},this._endStream=!0}this._subject=null,/triple|quad/i.test(t.format)?this._writeTriple=this._writeTripleLine:(this._graph="",this._prefixIRIs=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes))}function r(e){var t=l[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}var i=/^"([^]*)"(?:\^\^(.+)|@([\-a-z]+))?$/i,o="http://www.w3.org/1999/02/22-rdf-syntax-ns#",a=o+"type",s=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,u=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,l={"\\":"\\\\",'"':'\\"',"\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};n.prototype={_write:function(e,t){this._outputStream.write(e,"utf8",t)},_writeTriple:function(e,t,n,r,i){try{this._graph!==r&&(this._write((null===this._subject?"":this._graph?"\n}\n":".\n")+(r?this._encodeIriOrBlankNode(r)+" {\n":"")),this._subject=null,this._graph="["!==r[0]?r:"]"),this._subject===e?this._predicate===t?this._write(", "+this._encodeObject(n),i):this._write(";\n    "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(n),i):this._write((null===this._subject?"":".\n")+this._encodeSubject(this._subject=e)+" "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(n),i)}catch(e){i&&i(e)}},_writeTripleLine:function(e,t,n,r,i){delete this._prefixMatch;try{this._write(this._encodeIriOrBlankNode(e)+" "+this._encodeIriOrBlankNode(t)+" "+this._encodeObject(n)+(r?" "+this._encodeIriOrBlankNode(r)+".\n":".\n"),i)}catch(e){i&&i(e)}},_encodeIriOrBlankNode:function(e){var t=e[0];if("["===t||"("===t||"_"===t&&":"===e[1])return e;s.test(e)&&(e=e.replace(u,r));var n=this._prefixRegex.exec(e);return n?n[1]?this._prefixIRIs[n[1]]+n[2]:e:"<"+e+">"},_encodeLiteral:function(e,t,n){return s.test(e)&&(e=e.replace(u,r)),n?'"'+e+'"@'+n:t?'"'+e+'"^^'+this._encodeIriOrBlankNode(t):'"'+e+'"'},_encodeSubject:function(e){if('"'===e[0])throw new Error("A literal as subject is not allowed: "+e);return"["===e[0]&&(this._subject="]"),this._encodeIriOrBlankNode(e)},_encodePredicate:function(e){if('"'===e[0])throw new Error("A literal as predicate is not allowed: "+e);return e===a?"a":this._encodeIriOrBlankNode(e)},_encodeObject:function(e){if('"'!==e[0])return this._encodeIriOrBlankNode(e);var t=i.exec(e);if(!t)throw new Error("Invalid literal: "+e);return this._encodeLiteral(t[1],t[2],t[3])},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},addTriple:function(e,t,n,r,i){void 0===n?this._writeTriple(e.subject,e.predicate,e.object,e.graph||"",t):"string"!=typeof r?this._writeTriple(e,t,n,"",r):this._writeTriple(e,t,n,r,i)},addTriples:function(e){for(var t=0;t<e.length;t++)this.addTriple(e[t])},addPrefix:function(e,t,n){var r={};r[e]=t,this.addPrefixes(r,n)},addPrefixes:function(e,t){var n=this._prefixIRIs,r=!1;for(var i in e){var o=e[i];/[#\/]$/.test(o)&&n[o]!==(i+=":")&&(r=!0,n[o]=i,null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null,this._graph=""),this._write("@prefix "+i+" <"+o+">.\n"))}if(r){var a="",s="";for(var u in n)a+=a?"|"+u:u,s+=(s?"|":"")+n[u];a=a.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp("^(?:"+s+")[^/]*$|^("+a+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(r?"\n":"",t)},blank:function(e,t){var n,r,i=e;switch(void 0===e?i=[]:"string"==typeof e?i=[{predicate:e,object:t}]:"length"in e||(i=[e]),r=i.length){case 0:return"[]";case 1:if(n=i[0],"["!==n.object[0])return"[ "+this._encodePredicate(n.predicate)+" "+this._encodeObject(n.object)+" ]";default:for(var o="[",a=0;a<r;a++)n=i[a],n.predicate===e?o+=", "+this._encodeObject(n.object):(o+=(a?";\n  ":"\n  ")+this._encodePredicate(n.predicate)+" "+this._encodeObject(n.object),e=n.predicate);return o+"\n]"}},list:function(e){for(var t=e&&e.length||0,n=new Array(t),r=0;r<t;r++)n[r]=this._encodeObject(e[r]);return"("+n.join(" ")+")"},_prefixRegex:/$0^/,end:function(e){null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null),this._write=this._blockedWrite;var t=e&&function(n,r){t=null,e(n,r)};if(this._endStream)try{return this._outputStream.end(t)}catch(e){}t&&t()}},e.exports=n},function(e,t,n){"use strict";function r(e){return new y(e)}function i(e){return new v(e)}function o(){return new g}function a(e,t,n){return new m(e,t,n)}function s(){return new b}function u(e,t,n){return new w(""+e,t,n)}function l(e,t){return"string"==typeof t?t.indexOf(":")===-1?new w(e,t):new w(e,null,c(t)):new w(e,null,t)}function c(e){return new x(e)}function f(e,t,n,r){return r=r||new g,new _(e,t,n,r)}function h(e,t,n,r){return new _(e,t,n,r)}function d(e,t,n){return f(e,t,n)}function p(e){return new k(e)}var y=n(4),v=n(7),g=n(59),m=n(60),b=n(74),w=n(8),x=n(9),_=n(78),k=n(79);e.exports.blankNode=r,e.exports.defaultGraph=o,e.exports.graph=s,e.exports.literal=l,e.exports.namedNode=c,e.exports.quad=f,e.exports.triple=d,e.exports.variable=p,e.exports.collection=i,e.exports.fetcher=a,e.exports.lit=u,e.exports.st=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(6),l=function(e){function t(){r(this,t);var e=i(this,Object.getPrototypeOf(t).call(this));return e.termType="DefaultGraph",e.value="",e}return o(t,e),s(t,[{key:"toCanonical",value:function(){return this.value}}]),t}(u);e.exports=l},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":r(e)},o=n(61),a=n(62),s=n(9),u=n(69),l=n(70),c=n(71).parseRDFaDOM,f=n(72),h=n(63),d=n(64),p={"text/n3":!0,"text/turtle":!0,"application/rdf+xml":!0,"application/xhtml+xml":!0,"text/html":!0,"application/ld+json":!0},y=function e(t,n,r){this.store=t,this.thisURI="http://dig.csail.mit.edu/2005/ajar/ajaw/rdf/sources.js#SourceFetcher",this.timeout=n||3e4,this.async=null==r||r,this.appNode=this.store.bnode(),this.store.fetcher=this,this.requested={},this.redirectedTo={},this.fetchCallbacks={},this.nonexistant={},this.lookedUp={},this.handlers=[],this.mediatypes={};var y=this,v=this.store,g={};g.link=u("http://www.w3.org/2007/ont/link#"),g.http=u("http://www.w3.org/2007/ont/http#"),g.httph=u("http://www.w3.org/2007/ont/httph#"),g.rdf=u("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),g.rdfs=u("http://www.w3.org/2000/01/rdf-schema#"),g.dc=u("http://purl.org/dc/elements/1.1/"),y.mediatypes["image/*"]={q:.9},y.mediatypes["*/*"]={q:.1},e.crossSiteProxy=function(t){return e.crossSiteProxyTemplate?e.crossSiteProxyTemplate.replace("{uri}",encodeURIComponent(t)):void 0},e.RDFXMLHandler=function(e){e&&(this.dom=e[0]),this.handlerFactory=function(e){e.handle=function(t){var n=y.store;this.dom||(this.dom=d.parseXML(e.responseText));var r=this.dom.documentElement;if("parsererror"===r.nodeName)throw y.failFetch(e,"Badly formed XML in "+e.resource.uri),new Error("Badly formed XML in "+e.resource.uri);var i=new f(n);try{i.parse(this.dom,e.original.uri,e.original)}catch(t){y.addStatus(e.req,"Syntax error parsing RDF/XML! "+t),console.log("Syntax error parsing RDF/XML! "+t)}e.options.noMeta||n.add(e.original,g.rdf("type"),g.link("RDFDocument"),y.appNode),t()}}},e.RDFXMLHandler.toString=function(){return"RDFXMLHandler"},e.RDFXMLHandler.register=function(e){e.mediatypes["application/rdf+xml"]={q:.9}},e.RDFXMLHandler.pattern=new RegExp("application/rdf\\+xml"),e.XHTMLHandler=function(e){e&&(this.dom=e[0]),this.handlerFactory=function(e){e.handle=function(t){var n,r;this.dom||(this.dom=d.parseXML(e.responseText));var i=y.store,o=this.dom.getElementsByTagName("title");o.length>0&&i.add(e.resource,g.dc("title"),i.literal(o[0].textContent),e.resource);for(var a=this.dom.getElementsByTagName("link"),s=a.length-1;s>=0;s--)n=a[s].getAttribute("rel"),r=!1,n||(n=a[s].getAttribute("rev"),r=!0),n&&y.linkData(e,n,a[s].getAttribute("href"),e.resource,r);for(var u=this.dom.getElementsByTagName("script"),f=0;f<u.length;f++){var h=u[f].getAttribute("type");p[h]&&l(u[f].textContent,i,e.original.uri,h)}if(e.options.noMeta||i.add(e.resource,g.rdf("type"),g.link("WebPage"),y.appNode),!e.options.noRDFa&&c)try{c(this.dom,i,e.original.uri)}catch(t){var v="Error trying to parse "+e.resource+" as RDFa:\n"+t+":\n"+t.stack;return void y.failFetch(e,v)}t()}}},e.XHTMLHandler.toString=function(){return"XHTMLHandler"},e.XHTMLHandler.register=function(e){e.mediatypes["application/xhtml+xml"]={}},e.XHTMLHandler.pattern=new RegExp("application/xhtml"),e.XMLHandler=function(){this.handlerFactory=function(e){e.handle=function(t){for(var n=d.parseXML(e.responseText),r=0;r<n.childNodes.length;r++)if(1===n.childNodes[r].nodeType){var i=n.childNodes[r].namespaceURI;if(i&&i===i.rdf)return y.addStatus(e.req,"Has XML root element in the RDF namespace, so assume RDF/XML."),void y.switchHandler("RDFXMLHandler",e,t,[n]);break}if(n.doctype&&"html"===n.doctype.name&&n.doctype.publicId.match(/^-\/\/W3C\/\/DTD XHTML/)&&n.doctype.systemId.match(/http:\/\/www.w3.org\/TR\/xhtml/))return y.addStatus(e.req,"Has XHTML DOCTYPE. Switching to XHTML Handler.\n"),void y.switchHandler("XHTMLHandler",e,t);var o=n.getElementsByTagName("html")[0];if(o){var a=o.getAttribute("xmlns");if(a&&a.match(/^http:\/\/www.w3.org\/1999\/xhtml/))return y.addStatus(e.req,"Has a default namespace for XHTML. Switching to XHTMLHandler.\n"),void y.switchHandler("XHTMLHandler",e,t)}y.failFetch(e,"Unsupported dialect of XML: not RDF or XHTML namespace, etc.\n"+e.responseText.slice(0,80))}}},e.XMLHandler.toString=function(){return"XMLHandler"},e.XMLHandler.register=function(e){e.mediatypes["text/xml"]={q:.5},e.mediatypes["application/xml"]={q:.5}},e.XMLHandler.pattern=new RegExp("(text|application)/(.*)xml"),e.HTMLHandler=function(){this.handlerFactory=function(e){e.handle=function(t){var n=e.responseText;if(n.match(/\s*<\?xml\s+version\s*=[^<>]+\?>/))return y.addStatus(e.req,"Has an XML declaration. We'll assume it's XHTML as the content-type was text/html.\n"),void y.switchHandler("XHTMLHandler",e,t);if(n.match(/.*<!DOCTYPE\s+html[^<]+-\/\/W3C\/\/DTD XHTML[^<]+http:\/\/www.w3.org\/TR\/xhtml[^<]+>/))return y.addStatus(e.req,"Has XHTML DOCTYPE. Switching to XHTMLHandler.\n"),void y.switchHandler("XHTMLHandler",e,t);if(n.match(/[^(<html)]*<html\s+[^<]*xmlns=['"]http:\/\/www.w3.org\/1999\/xhtml["'][^<]*>/))return y.addStatus(e.req,"Has default namespace for XHTML, so switching to XHTMLHandler.\n"),void y.switchHandler("XHTMLHandler",e,t);var r=new RegExp("<title>([\\s\\S]+?)</title>","im").exec(n);if(r){var i=y.store;return i.add(e.resource,g.dc("title"),i.literal(r[1]),e.resource),i.add(e.resource,g.rdf("type"),g.link("WebPage"),y.appNode),void t()}y.addStatus(e.req,"non-XML HTML document, not parsed for data."),y.doneFetch(e)}}},e.HTMLHandler.toString=function(){return"HTMLHandler"},e.HTMLHandler.register=function(e){e.mediatypes["text/html"]={q:.9}},e.HTMLHandler.pattern=new RegExp("text/html"),e.TextHandler=function(){this.handlerFactory=function(e){e.handle=function(t){var n=e.responseText;return n.match(/\s*<\?xml\s+version\s*=[^<>]+\?>/)?(y.addStatus(e.req,"Warning: "+e.resource+" has an XML declaration. We'll assume it's XML but its content-type wasn't XML.\n"),void y.switchHandler("XMLHandler",e,t)):n.slice(0,500).match(/xmlns:/)?(y.addStatus(e.req,"May have an XML namespace. We'll assume it's XML but its content-type wasn't XML.\n"),void y.switchHandler("XMLHandler",e,t)):(y.addStatus(e.req,"Plain text document, no known RDF semantics."),void y.doneFetch(e))}}},e.TextHandler.toString=function(){return"TextHandler"},e.TextHandler.register=function(e){e.mediatypes["text/plain"]={q:.5}},e.TextHandler.pattern=new RegExp("text/plain"),e.N3Handler=function(){this.handlerFactory=function(e){e.handle=function(t){var n=a(v,v,e.original.uri,e.original.uri,null,null,"",null);try{n.loadBuf(e.responseText)}catch(t){var r="Error trying to parse "+e.resource+" as Notation3:\n"+t+":\n"+t.stack;return void y.failFetch(e,r)}y.addStatus(e.req,"N3 parsed: "+n.statementCount+" triples in "+n.lines+" lines."),y.store.add(e.original,g.rdf("type"),g.link("RDFDocument"),y.appNode),y.doneFetch(e)}}},e.N3Handler.toString=function(){return"N3Handler"},e.N3Handler.register=function(e){e.mediatypes["text/n3"]={q:"1.0"},e.mediatypes["text/turtle"]={q:1}},e.N3Handler.pattern=new RegExp("(application|text)/(x-)?(rdf\\+)?(n3|turtle)"),d.callbackify(this,["request","recv","headers","load","fail","refresh","retract","done"]),this.addHandler=function(e){y.handlers.push(e),e.register(y)},this.switchHandler=function(t,n,r,o){for(var a=null,s=0;s<this.handlers.length;s++)""+this.handlers[s]===t&&(a=this.handlers[s]);if(!a)throw new Error("web.js: switchHandler: name="+t+" , this.handlers ="+this.handlers+"\nswitchHandler: switching to "+a+"; sf="+y+"; typeof Fetcher="+("undefined"==typeof e?"undefined":i(e))+";\n\t Fetcher.HTMLHandler="+e.HTMLHandler+"\n\n\tsf.handlers="+y.handlers+"\n");new a(o).handlerFactory(n),n.handle(r)},this.addStatus=function(e,t){var n=new Date;t="["+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+"."+n.getMilliseconds()+"] "+t;var r=this.store,i=r.the(e,g.link("status"));i&&i.append?i.append(r.literal(t)):o.warn("web.js: No list to add to: "+i+","+t)},this.failFetch=function(e,t){for(this.addStatus(e.req,t),e.options.noMeta||v.add(e.original,g.link("error"),t),e.resource.sameTerm(e.original)?console.log("@@ Recording failure for "+e.original+": "+e.status):console.log("@@ Recording failure original "+e.original+"( as "+e.resource+") : "+e.status),this.requested[h.docpart(e.original.uri)]=e.status;this.fetchCallbacks[e.original.uri]&&this.fetchCallbacks[e.original.uri].length;)this.fetchCallbacks[e.original.uri].shift()(!1,"Fetch of <"+e.original.uri+"> failed: "+t,e);return delete this.fetchCallbacks[e.original.uri],this.fireCallbacks("fail",[e.original.uri,t]),e.abort(),e},this.linkData=function(e,t,n,r,i){if(n){var o,a=v.sym(h.join(n,e.original.uri));if("alternate"===t||"seeAlso"===t||"meta"===t||"describedby"===t){if(a.uri===e.original.uri)return;o=g.rdfs("seeAlso")}else o="type"===t?v.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):v.sym(h.join(t,"http://www.iana.org/assignments/link-relations/"));i?v.add(a,o,e.original,r):v.add(e.original,o,a,r)}},this.parseLinkHeader=function(e,t){var n;try{n=e.getResponseHeader("link")}catch(e){}if(n)for(var r=/<[^>]*>\s*(\s*;\s*[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*")))*(,|$)/g,i=/[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*"))/g,o=n.match(r),a=0;a<o.length;a++)for(var s=o[a].split(">"),u=s[0].substring(1),l=s[1],c=l.match(i),f=0;f<c.length;f++){var h=c[f],d=h.split("="),p=d[1].replace(/["']/g,"");this.linkData(e,p,u,t)}},this.doneFetch=function(e){for(this.addStatus(e.req,"Done."),this.requested[e.original.uri]="done";this.fetchCallbacks[e.original.uri]&&this.fetchCallbacks[e.original.uri].length;)this.fetchCallbacks[e.original.uri].shift()(!0,void 0,e);delete this.fetchCallbacks[e.original.uri],this.fireCallbacks("done",[e.original.uri])};var m=[e.RDFXMLHandler,e.XHTMLHandler,e.XMLHandler,e.HTMLHandler,e.TextHandler,e.N3Handler];m.map(this.addHandler),this.nowKnownAs=function(e,t){this.lookedUp[e.uri]?this.lookedUp[t.uri]||this.lookUpThing(t,e):this.lookedUp[t.uri]&&(this.lookedUp[e.uri]||this.lookUpThing(e,t))},this.putBack=function(e,t){e=e.uri||e;var n=$rdf.sym(e).doc();return t.data=$rdf.serialize(n,this.store,n.uri,t.contentType||"text/turtle"),this.webOperation("PUT",e,t)},this.webOperation=function(e,t,n){t=t.uri||t,n=n||{},t=this.proxyIfNecessary(t);var r=this;return new Promise(function(i,o){var a=d.XMLHTTPFactory();a.options=n,a.original=r.store.sym(t),n.noMeta||"undefined"==typeof tabulator||r.saveRequestMetadata(a,r.store,t),a.onreadystatechange=function(){if(4===a.readyState){var e=!a.status||a.status>=200&&a.status<300;n.noMeta||"undefined"==typeof tabulator||r.saveResponseMetadata(a,r.store),e?i(a):o(a.status+" "+a.statusText)}},a.open(e,t,!0),n.contentType&&a.setRequestHeader("Content-type",n.contentType),a.send(n.data?n.data:void 0)})},this.webCopy=function(e,t,n){var r=this;return e=e.uri||e,new Promise(function(i,o){r.webOperation("GET",e).then(function(e){r.webOperation("PUT",t,{data:e.responseText,contentType:n}).then(function(e){i(e)}).catch(function(e){o(e)})}).catch(function(e){o(e)})})},this.lookUpThing=function(e,t,n,r,i){var o,a=v.uris(e),s=!0,u="",l={};if(n===!1||n===!0?(o=n,n={force:o}):(void 0===n&&(n={}),o=!!n.force),"undefined"!=typeof a)for(var c=0;c<a.length;c++){var f=a[c];l[f]=!0,this.lookedUp[f]=!0;var d=this,p=function(e){d.requestURI(h.docpart(e),t,n,function(t,n,o){t?r&&r(!0,e):(r&&r(!1,n),s=!1,u+=n+"\n"),delete l[f],Object.keys(l).length>0||i&&i(s,u)})};p(f)}return a.length},this.load=function(e,t){var n=this;if(e instanceof Array){var r=e.map(function(e){return n.load(e)});return Promise.all(r)}return e=e.uri||e,new Promise(function(r,i){n.nowOrWhenFetched(e,t,function(e,t,n){e?r(n):i(t)})})},this.nowOrWhenFetched=function(e,t,n,r){e=e.uri||e,"function"==typeof t?(r={},n=t):"undefined"==typeof t||(r=t instanceof s?{referingTerm:t}:t),this.requestURI(e,t,r||{},n)},this.get=this.nowOrWhenFetched,this.getHeader=function(e,t){for(var n=this.store,r=n.each(void 0,g.link("requestedURI"),e.uri),i=0;i<r.length;i++){var o=r[i];if(void 0!==o){var a=n.any(o,g.link("response"));if(void 0!==o){var s=n.each(a,g.httph(t.toLowerCase()));return s.length?s.map(function(e){return e.value}):[]}}}},this.proxyIfNecessary=function(t){if("undefined"!=typeof tabulator&&tabulator.isExtension)return t;if("undefined"!=typeof $SolidTestEnvironment&&$SolidTestEnvironment.localSiteMap){var n=t.split("/").slice(2),r=function e(t,n){var r=n[t.shift()];return r?"string"==typeof r?r+t.join("/"):t?e(t,r):null:null},i=r(n,$SolidTestEnvironment.localSiteMap);if(i)return i}return e.crossSiteProxyTemplate&&"undefined"!=typeof document&&document.location&&"https:"===(""+document.location).slice(0,6)&&"http:"===t.slice(0,5)?e.crossSiteProxyTemplate.replace("{uri}",encodeURIComponent(t)):t},this.saveRequestMetadata=function(e,t,n){var r=t.bnode();if(e.resource=t.sym(n),e.req=r,!e.options.noMeta){var i=new Date,o="["+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+"] ";t.add(r,g.rdfs("label"),t.literal(o+" Request for "+n),this.appNode),t.add(r,g.link("requestedURI"),t.literal(n),this.appNode),e.original&&e.original.uri!==n&&t.add(r,g.link("orginalURI"),t.literal(e.original.uri),this.appNode),t.add(r,g.link("status"),t.collection(),this.appNode)}return r},this.saveResponseMetadata=function(e,t){var n=t.bnode();if(e.req&&t.add(e.req,g.link("response"),n),t.add(n,g.http("status"),t.literal(e.status),n),t.add(n,g.http("statusText"),t.literal(e.statusText),n),e.headers={},"http"===h.protocol(e.resource.uri)||"https"===h.protocol(e.resource.uri)){e.headers=d.getHTTPHeaders(e);for(var r in e.headers){var i=e.headers[r].trim(),o=r.toLowerCase();t.add(n,g.httph(o),i,n),"content-type"===o&&t.add(e.resource,g.rdf("type"),$rdf.Util.mediaTypeClass(i),n)}}return n},this.requestURI=function(t,n,r,i){t=t.uri||t,t=t.split("#")[0],"boolean"==typeof r&&(r={force:r}),"undefined"==typeof r&&(r={});var a=!!r.force,s=this.store,u=arguments,l=r.baseURI||t;r.userCallback=i;var c=h.protocol(t);if("tel"===c||"mailto"===c||"urn"===c)return console.log("Unsupported protocol in: "+t),i(!1,"Unsupported protocol",{status:900})||void 0;var f=s.sym(t),p=this.getState(t);if(a)delete this.nonexistant[t];else{if("fetched"===p)return i?i(!0):void 0;if("failed"===p)return i?i(!1,"Previously failed. "+this.requested[t],{status:this.requested[t]}):void 0}if(this.fireCallbacks("request",u),i&&(this.fetchCallbacks[t]?this.fetchCallbacks[t].push(i):this.fetchCallbacks[t]=[i]),this.requested[t]!==!0){this.requested[t]=!0,!r.noMeta&&n&&n.uri&&s.add(f.uri,g.link("requestedBy"),n.uri,this.appNode);var y=d.XMLHTTPFactory(),v=y.req=s.bnode();y.original=s.sym(l),y.options=r,y.resource=f;var m=this,b=new Date,w="["+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+"] ";r.noMeta||(s.add(v,g.rdfs("label"),s.literal(w+" Request for "+t),this.appNode),s.add(v,g.link("requestedURI"),s.literal(t),this.appNode),s.add(v,g.link("status"),s.collection(),this.appNode));var x=function(){if(!y.withCredentials)return!1;if(y.retriedWithCredentials)return!0;y.retriedWithCredentials=!0,console.log("web: Retrying with no credentials for "+y.resource),y.abort(),delete m.requested[t];var e={};for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i]);return e.withCredentials=!1,m.addStatus(y.req,"Abort: Will retry with credentials SUPPRESSED to see if that helps"),m.requestURI(t,n,e,y.userCallback),!0},_=function(t){return function(n){if(t.onErrorWasCalled=!0,"undefined"!=typeof document&&e.crossSiteProxyTemplate&&document.location&&!t.proxyUsed){var r=h.hostpart,i=""+document.location,o=t.resource.uri;if(r(i)&&r(o)&&r(i)!==r(o))if(401===t.status||403===t.status||404===t.status)k(t)();else{if(x(t))return;var a=e.crossSiteProxy(o);if(console.log("web: Direct failed so trying proxy "+a),m.addStatus(t.req,"BLOCKED -> Cross-site Proxy to <"+a+">"),t.aborted)return;var s=m.store,u=t.req;t.options.noMeta||s.add(u,g.http("redirectedTo"),s.sym(a),u),t.abort(),t.aborted=!0,m.addStatus(u,"redirected to new request"),m.requested[t.resource.uri]="redirected",m.redirectedTo[t.resource.uri]=a,m.fetchCallbacks[t.resource.uri]&&(m.fetchCallbacks[a]||(m.fetchCallbacks[a]=[]),m.fetchCallbacks[a]===m.fetchCallbacks[a].concat(m.fetchCallbacks[t.resource.uri]),delete m.fetchCallbacks[t.resource.uri]);var l=m.requestURI(a,t.resource,t.options,t.userCallback);if(l&&(l.proxyUsed=!0,l.original=t.original,console.log("Proxying but original still "+l.original)),l&&l.req)return void(t.options.noMeta||s.add(t.req,s.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),l.req,m.appNode))}t.CORS_status=999}}},k=function(e){return function(){var n=function(){if(!e.handleResponseDone){e.handleResponseDone=!0;var n=null,i=e.req;m.fireCallbacks("recv",u);var o=m.store;if(m.saveResponseMetadata(e,o),m.fireCallbacks("headers",[{uri:t,headers:e.headers}]),0===e.status){if(console.log("Masked error - status 0 for "+e.resource.uri),x(e))return;return void(e.CORS_status=900)}if(e.status>=400){if(404===e.status&&(o.fetcher.nonexistant[e.resource.uri]=!0),e.responseText.length>10){var s=o.bnode();o.add(s,g.http("content"),o.literal(e.responseText),s),e.statusText&&o.add(s,g.http("statusText"),o.literal(e.statusText),s)}return void m.failFetch(e,"HTTP error for "+e.resource+": "+e.status+" "+e.statusText)}var l,c=e.headers["content-location"],f=function(e){var t=i;if(c){var n=o.any(t,g.link("requestedURI"));n!==c&&o.add(o.sym(c),g.rdf("type"),e,m.appNode)}for(;;){var r=o.any(t,g.link("requestedURI"));if(r&&r.value&&o.add(o.sym(r.value),g.rdf("type"),e,m.appNode),t=o.any(void 0,o.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),t),!t)break;var a=o.any(t,o.sym("http://www.w3.org/2007/ont/link#response"));if(!a)break;var s=o.any(a,o.sym("http://www.w3.org/2007/ont/http#status"));if(!s)break;if("301"!==s&&"302"!==s)break}},d={rdf:"application/rdf+xml",owl:"application/rdf+xml",n3:"text/n3",ttl:"text/turtle",nt:"text/n3",acl:"text/n3",html:"text/html",xml:"text/xml"};if(200===e.status){f(g.link("Document"));var p=e.headers["content-type"];r.forceContentType&&(e.headers["content-type"]=r.forceContentType),(!p||p.indexOf("application/octet-stream")>=0)&&(l=d[e.resource.uri.split(".").pop()],l&&(e.headers["content-type"]=l)),p&&(0!==p.indexOf("image/")&&0!==p.indexOf("application/pdf")||f(o.sym("http://purl.org/dc/terms/Image"))),r.clearPreviousData&&o.removeDocument(e.resource)}if("file"!==h.protocol(e.resource.uri)&&"chrome"!==h.protocol(e.resource.uri)||(r.forceContentType?e.headers["content-type"]=r.forceContentType:(l=d[e.resource.uri.split(".").pop()],l?e.headers["content-type"]=l:e.headers["content-type"]="text/xml")),c){var y=h.join(e.resource.uri,c);if(!a&&y!==e.resource.uri&&m.requested[y]&&"done"===m.requested[y])return m.doneFetch(e),void e.abort();m.requested[y]=!0}for(var v=0;v<m.handlers.length;v++)if(e.headers["content-type"]&&e.headers["content-type"].match(m.handlers[v].pattern)){
n=new m.handlers[v];break}if(m.parseLinkHeader(e,i),!n)return void m.doneFetch(e);try{n.handlerFactory(e)}catch(t){m.failFetch(e,"Exception handling content-type "+e.headers["content-type"]+" was: "+t)}}};switch(e.readyState){case 0:var i,o=e.resource.uri;if(this.crossSiteProxyTemplate&&"undefined"!=typeof document&&document.location){var s=h.hostpart,l=""+document.location;if(s(l)&&s(o)&&s(l)!==s(o)){if(i=this.crossSiteProxyTemplate.replace("{uri}",encodeURIComponent(o)),m.addStatus(e.req,"BLOCKED -> Cross-site Proxy to <"+i+">"),e.aborted)return;var c=m.store,f=e.req;c.add(f,g.http("redirectedTo"),c.sym(i),f);var d=e.req=c.bnode();c.add(f,g.http("redirectedRequest"),d,e.req);var p=new Date,y="["+p.getHours()+":"+p.getMinutes()+":"+p.getSeconds()+"] ";c.add(d,g.rdfs("label"),c.literal(y+" Request for "+i),this.appNode),c.add(d,g.link("status"),c.collection(),this.appNode),c.add(d,g.link("requestedURI"),c.literal(i),this.appNode);var v=c.bnode();c.add(f,g.link("response"),v),e.abort(),e.aborted=!0,e.redirected=!0,m.addStatus(f,"redirected XHR"),m.fetchCallbacks[e.resource.uri]&&(m.fetchCallbacks[i]||(m.fetchCallbacks[i]=[]),m.fetchCallbacks[i]===m.fetchCallbacks[i].concat(m.fetchCallbacks[e.resource.uri]),delete m.fetchCallbacks[e.resource.uri]),m.fireCallbacks("redirected",u),m.requested[e.resource.uri]="redirected";var b=m.requestURI(i,e.resource,e.options||{},e.userCallback);if(b&&b.req)return void c.add(e.req,c.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),b.req,m.appNode)}}m.failFetch(e,"HTTP Blocked. (ReadyState 0) Cross-site violation for <"+t+">");break;case 3:break;case 4:if(n(),e.handle&&void 0!==e.responseText){if("redirected"===m.requested[e.resource.uri])break;m.fireCallbacks("load",u),e.handle(function(){m.doneFetch(e)})}else e.redirected?m.addStatus(e.req,"Aborted and redirected to new request."):m.addStatus(e.req,"Fetch over. No data handled. Aborted = "+e.aborted)}}},T=t;"undefined"!=typeof tabulator&&tabulator.preferences.get("offlineModeUsingLocalhost")&&"http://"===T.slice(0,7)&&"localhost/"!==T.slice(7,17)&&(T="http://localhost/"+T.slice(7),o.warn("Localhost kludge for offline use: actually getting <"+T+">"));var S="https:"===T.slice(0,6);void 0!==r.withCredentials&&(S=r.withCredentials);var E=this.proxyIfNecessary(T);y.onerror=_(y),y.onreadystatechange=k(y),y.timeout=m.timeout,y.withCredentials=S,y.actualProxyURI=E,y.req=v,y.options=r,y.options=r,y.resource=f,y.requestedURI=T,y.ontimeout=function(){m.failFetch(y,"requestTimeout")};try{y.open("GET",E,this.async)}catch(e){return this.failFetch(y,"XHR open for GET failed for <"+T+">:\n\t"+e)}if(a&&y.setRequestHeader("Cache-control","no-cache"),"undefined"!=typeof tabulator&&tabulator.isExtension&&y.channel&&("http"===h.protocol(y.resource.uri)||"https"===h.protocol(y.resource.uri)))try{y.channel.notificationCallbacks={getInterface:function(e){return e.equals(Components.interfaces.nsIChannelEventSink)?{onChannelRedirect:function(e,t,i){if(!y.aborted){var o=m.store,a=t.URI.spec,s=y.req;if(!y.options.noMeta){m.addStatus(y.req,"Redirected: "+y.status+" to <"+a+">"),o.add(s,g.http("redirectedTo"),o.sym(a),y.req);var l=y.req=o.bnode();o.add(s,g.http("redirectedRequest"),l,this.appNode);var c=new Date,f="["+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+"] ";o.add(l,g.rdfs("label"),o.literal(f+" Request for "+a),this.appNode),o.add(l,g.link("status"),o.collection(),this.appNode),o.add(l,g.link("requestedURI"),o.literal(a),this.appNode);var d=o.bnode();o.add(s,g.link("response"),d),o.add(d,g.http("status"),o.literal(y.status),d),y.statusText&&o.add(d,g.http("statusText"),o.literal(y.statusText),d)}if(y.status-0!==303&&(o.HTTPRedirects[y.resource.uri]=a),y.status-0===301&&n){var p=h.docpart(n.uri),v="Warning: "+y.resource+" has moved to <"+a+">.";n&&(v+=" Link in <"+p+" >should be changed",o.add(p,o.sym("http://www.w3.org/2007/ont/link#warning"),v,m.appNode))}y.abort(),y.aborted=!0,m.fetchCallbacks[y.resource.uri]&&(m.fetchCallbacks[a]||(m.fetchCallbacks[a]=[]),m.fetchCallbacks[a]===m.fetchCallbacks[a].concat(m.fetchCallbacks[y.resource.uri]),delete m.fetchCallbacks[y.resource.uri]),m.addStatus(s,"redirected"),m.fireCallbacks("redirected",u),m.requested[y.resource.uri]="redirected",m.redirectedTo[y.resource.uri]=a;var b=a.indexOf("#");b>=0&&(y.options.noMeta||o.add(y.resource,o.sym("http://www.w3.org/2007/ont/link#warning"),"Warning: "+y.resource+" HTTP redirects to"+a+' which should not contain a "#" sign'),a=a.slice(0,b));var w=m.requestURI(a,y.resource,y.options,y.userCallback);w&&w.req&&!r.noMeta&&o.add(y.req,o.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),w.req,m.appNode)}},asyncOnChannelRedirect:function(e,t,r,i){if(!y.aborted){var o=m.store,a=t.URI.spec,s=y.req;m.addStatus(y.req,"Redirected: "+y.status+" to <"+a+">"),o.add(s,g.http("redirectedTo"),o.sym(a),y.req);var u=y.req=o.bnode();o.add(s,g.http("redirectedRequest"),u,y.req);var l=new Date,c="["+l.getHours()+":"+l.getMinutes()+":"+l.getSeconds()+"] ";o.add(u,g.rdfs("label"),o.literal(c+" Request for "+a),this.appNode),o.add(u,g.link("status"),o.collection(),this.appNode),o.add(u,g.link("requestedURI"),o.literal(a),this.appNode);var f=o.bnode();if(o.add(s,g.link("response"),f),o.add(f,g.http("status"),o.literal(y.status),f),y.statusText&&o.add(f,g.http("statusText"),o.literal(y.statusText),f),y.status-0!==303&&(o.HTTPRedirects[y.resource.uri]=a),y.status-0===301&&n){var d=h.docpart(n.uri),p="Warning: "+y.resource+" has moved to <"+a+">.";n&&(p+=" Link in <"+d+" >should be changed",o.add(d,o.sym("http://www.w3.org/2007/ont/link#warning"),p,m.appNode))}y.abort(),y.aborted=!0;var v=a.indexOf("#");if(v>=0){var b="Warning: "+y.resource+" HTTP redirects to"+a+' which do not normally contain a "#" sign';o.add(y.resource,o.sym("http://www.w3.org/2007/ont/link#warning"),b),a=a.slice(0,v)}m.requested[y.resource.uri]="redirected",m.redirectedTo[y.resource.uri]=a;var w=m.requestURI(a,y.resource,y.options,y.userCallback);w&&(w.original=y.original,w.req&&o.add(y.req,o.sym("http://www.w3.org/2007/ont/link#redirectedRequest"),w.req,m.appNode))}}}:Components.results.NS_NOINTERFACE}}}catch(e){return m.failFetch(y,"@@ Couldn't set callback for redirects: "+e)}try{var N="";for(var R in this.mediatypes){""!==N&&(N+=", "),N+=R;for(var j in this.mediatypes[R])N+=";"+j+"="+this.mediatypes[R][j]}y.setRequestHeader("Accept",N),this.addStatus(y.req,"Accept: "+N)}catch(e){throw new Error("Can't set Accept header: "+e)}try{y.send(null)}catch(e){return this.failFetch(y,"XHR send failed:"+e)}return setTimeout(function(){4!==y.readyState&&m.isPending(y.resource.uri)&&m.failFetch(y,"requestTimeout")},this.timeout),this.addStatus(y.req,"HTTP Request sent."),y}},this.objectRefresh=function(e){var t=v.uris(e);if("undefined"!=typeof t)for(var n=0;n<t.length;n++)this.refresh(this.store.sym(h.docpart(t[n])))},this.unload=function(e){this.store.removeMany(void 0,void 0,void 0,e),delete this.requested[e.uri]},this.refresh=function(e,t){this.fireCallbacks("refresh",arguments),this.requestURI(e.uri,void 0,{force:!0,clearPreviousData:!0},t)},this.retract=function(e){this.store.removeMany(void 0,void 0,void 0,e),e.uri&&delete this.requested[h.docpart(e.uri)],this.fireCallbacks("retract",arguments)},this.getState=function(e){return"undefined"==typeof this.requested[e]?"unrequested":this.requested[e]===!0?"requested":"done"===this.requested[e]?"fetched":"redirected"===this.requested[e]?this.getState(this.redirectedTo[e]):"failed"},this.isPending=function(e){return this.requested[e]===!0}};e.exports=y},function(e,t){"use strict";e.exports={debug:function(e){},warn:function(e){},info:function(e){},error:function(e){},success:function(e){},msg:function(e){}}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":r(e)},o=n(63),a=n(64).ArrayIndexOf,s=function(){function e(e){return encodeURI(e)}function t(e,t,r,i,o,a,s,u){return new n(e,t,r,i,o,a,s,u)}function n(e,t,n,r,i,o,a,s){"undefined"==typeof t&&(t=null),"undefined"==typeof n&&(n=""),"undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=""),"undefined"==typeof o&&(o=null),"undefined"==typeof a&&(a=""),"undefined"==typeof s&&(s=null),this._bindings=new h([]),this._flags=a,""!=n&&(m(n.indexOf(":")>=0,"Document URI not absolute: "+n),this._bindings[""]=n+"#"),this._store=e,i&&e.setGenPrefix(i),this._thisDoc=n,this.source=e.sym(n),this.lines=0,this.statementCount=0,this.startOfLine=0,this.previousLine=0,this._genPrefix=i,this.keywords=new f(["a","this","bind","has","is","of","true","false"]),this.keywordsSet=0,this._anonymousNodes=new h([]),this._variables=new h([]),this._parentVariables=new h([]),this._reason=s,this._reason2=null,_&&(this._reason2=why_BecauseOfData(e.sym(n),this._reason)),r?this._baseURI=r:n?this._baseURI=n:this._baseURI=null,m(!this._baseURI||this._baseURI.indexOf(":")>=0),this._genPrefix||(this._thisDoc?this._genPrefix=this._thisDoc+"#_g":this._genPrefix=RDFSink_uniqueURI()),null==t?this._thisDoc?this._formula=e.formula(n+"#_formula"):this._formula=e.formula():this._formula=t,this._context=this._formula,this._parentContext=null}function r(e,t,n,r,i){this._str=n.encode("utf-8"),this._str=n,this._i=r,this._why=i,this.lines=t,this._uri=e}function s(e,t,n,r,i){return"Line "+(t+1)+" of <"+e+">: Bad syntax: "+i+'\nat: "'+p(n,r,r+30)+'"'}var u={encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},decode:function(e){for(var t="",n=0;n<e.length;){var r=e.charCodeAt(n);r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(t+=String.fromCharCode((31&r)<<6|63&e.charCodeAt(n+1)),n+=2):(t+=String.fromCharCode((15&r)<<12|(63&e.charCodeAt(n+1))<<6|63&e.charCodeAt(n+2)),n+=3)}return t}},l="http://www.w3.org/2000/10/swap/log#",c=function(e){return e},f=function(e){return e},h=function(e){if(e.length>0)throw"missing.js: oops nnonempty dict not imp";return[]},d=function(e){return e.length},p=function(e,t,n){if("undefined"==typeof e.slice)throw"@@ mising.js: No .slice function for "+e+" of type "+("undefined"==typeof e?"undefined":i(e));return"undefined"==typeof n||null==n?e.slice(t):e.slice(t,n)},y=Error("dummy error stop iteration"),v=function(e){return this.last=0,this.li=e,this.next=function(){if(this.last==this.li.length)throw y;return this.li[this.last++]},this},g=function(e,t){return e.indexOf(t)},m=function(e,t){if(!e){if(t)throw"python Assertion failed: "+t;throw"(python) Assertion failed."}},b=function(e){return String.fromCharCode(e)};String.prototype.encode=function(e){if("utf-8"!=e)throw"UTF8_converter: can only do utf-8";return u.encode(this)},String.prototype.decode=function(e){if("utf-8"!=e)throw"UTF8_converter: can only do utf-8";return this};var w=function(e,t){return o.join(t,e)},x=null,_=0,k=0,T=function(e){},S="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",E="http://www.w3.org/2002/07/owl#sameAs",N="#",R="http://www.w3.org/2001/XMLSchema#integer",j="http://www.w3.org/2001/XMLSchema#double",O="http://www.w3.org/2001/XMLSchema#decimal",I="http://www.w3.org/2001/XMLSchema#date",C="http://www.w3.org/2001/XMLSchema#dateTime",A="\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~",L=A+":",D=(new RegExp("^[ \\t]*(#[^\\n]*)?\\r?\\n","g"),new RegExp("^[ \\t]*(#[^\\n]*)?$","g"),new RegExp("^[ \\t]*","g"),new RegExp("^[-+]?[0-9]+","g"),new RegExp("^([-+]?[0-9]+)(\\.[0-9]+)?(e[-+]?[0-9]+)?","g")),P=new RegExp("^[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9](T[0-9][0-9]:[0-9][0-9](:[0-9][0-9](\\.[0-9]*)?)?)?Z?"),U=(new RegExp("^[0-9]+","g"),new RegExp('[\\\\\\r\\n\\"]',"g")),M=new RegExp("^[a-zA-Z0-9]+(-[a-zA-Z0-9]+)?","g");return n.prototype.here=function(e){return this._genPrefix+"_L"+this.lines+"C"+(e-this.startOfLine+1)},n.prototype.formula=function(){return this._formula},n.prototype.loadStream=function(e){return this.loadBuf(e.read())},n.prototype.loadBuf=function(e){return this.startDoc(),this.feed(e),this.endDoc()},n.prototype.feed=function(e){for(var t=e.decode("utf-8"),n=0;n>=0;){var r=this.skipSpace(t,n);if(r<0)return;var n=this.directiveOrStatement(t,r);if(n<0)throw s(this._thisDoc,this.lines,t,r,"expected directive or statement")}},n.prototype.directiveOrStatement=function(e,t){var n=this.skipSpace(e,t);if(n<0)return n;var r=this.directive(e,n);if(r>=0)return this.checkDot(e,r);var r=this.statement(e,n);return r>=0?this.checkDot(e,r):r},n.prototype.tok=function(e,t,n){if("@"==p(t,n,n+1))var n=n+1;else if(a(this.keywords,e)<0)return-1;var r=n+d(e);return p(t,n,r)==e&&A.indexOf(t.charAt(r))>=0?r:-1},n.prototype.directive=function(t,n){var r=this.skipSpace(t,n);if(r<0)return r;var i=new f([]),r=this.tok("bind",t,n);if(r>0)throw s(this._thisDoc,this.lines,t,n,"keyword bind is obsolete: use @prefix");var r=this.tok("keywords",t,n);if(r>0){var n=this.commaSeparatedList(t,r,i,!1);if(n<0)throw s(this._thisDoc,this.lines,t,n,"'@keywords' needs comma separated list of words");return this.setKeywords(p(i,null,null)),k>80&&T("Keywords ",this.keywords),n}var r=this.tok("forAll",t,n);if(r>0){var n=this.commaSeparatedList(t,r,i,!0);if(n<0)throw s(this._thisDoc,this.lines,t,n,"Bad variable list after @forAll");var o=new v(i);try{for(;;){var u=o.next();(a(this._variables,u)<0||a(this._parentVariables,u)>=0)&&(this._variables[u]=this._context.newUniversal(u))}}catch(e){if(e!=y)throw e}return n}var r=this.tok("forSome",t,n);if(r>0){var n=this.commaSeparatedList(t,r,i,this.uri_ref2);if(n<0)throw s(this._thisDoc,this.lines,t,n,"Bad variable list after @forSome");var o=new v(i);try{for(;;){var u=o.next();this._context.declareExistential(u)}}catch(e){if(e!=y)throw e}return n}var r=this.tok("prefix",t,n);if(r>=0){var l=new f([]),n=this.qname(t,r,l);if(n<0)throw s(this._thisDoc,this.lines,t,r,"expected qname after @prefix");var r=this.uri_ref2(t,n,l);if(r<0)throw s(this._thisDoc,this.lines,t,n,"expected <uriref> after @prefix _qname_");var c=l[1].uri;if(this._baseURI)var c=w(this._baseURI,c);else m(c.indexOf(":")>=0,"With no base URI, cannot handle relative URI for NS");return m(c.indexOf(":")>=0),this._bindings[l[0][0]]=c,this.bind(l[0][0],e(c)),r}var r=this.tok("base",t,n);if(r>=0){var l=new f([]),n=this.uri_ref2(t,r,l);if(n<0)throw s(this._thisDoc,this.lines,t,r,"expected <uri> after @base ");var c=l[0].uri;if(!this._baseURI)throw s(this._thisDoc,this.lines,t,r,"With no previous base URI, cannot use relative URI in @base  <"+c+">");var c=w(this._baseURI,c);return m(c.indexOf(":")>=0),this._baseURI=c,n}return-1},n.prototype.bind=function(e,t){""==e||this._store.setPrefixForURI(e,t)},n.prototype.setKeywords=function(e){null==e?this.keywordsSet=0:(this.keywords=e,this.keywordsSet=1)},n.prototype.startDoc=function(){},n.prototype.endDoc=function(){return this._formula},n.prototype.makeStatement=function(e){e[0].add(e[2],e[1],e[3],this.source),this.statementCount+=1},n.prototype.statement=function(e,t){var n=new f([]),t=this.object(e,t,n);if(t<0)return t;var r=this.property_list(e,t,n[0]);if(r<0)throw s(this._thisDoc,this.lines,e,t,"expected propertylist");return r},n.prototype.subject=function(e,t,n){return this.item(e,t,n)},n.prototype.verb=function(e,t,n){var r=this.skipSpace(e,t);if(r<0)return r;var i=new f([]),r=this.tok("has",e,t);if(r>=0){var t=this.prop(e,r,i);if(t<0)throw s(this._thisDoc,this.lines,e,r,"expected property after 'has'");return n.push(new c(["->",i[0]])),t}var r=this.tok("is",e,t);if(r>=0){var t=this.prop(e,r,i);if(t<0)throw s(this._thisDoc,this.lines,e,r,"expected <property> after 'is'");var r=this.skipSpace(e,t);if(r<0)throw s(this._thisDoc,this.lines,e,t,"End of file found, expected property after 'is'");var t=r,r=this.tok("of",e,t);if(r<0)throw s(this._thisDoc,this.lines,e,t,"expected 'of' after 'is' <prop>");return n.push(new c(["<-",i[0]])),r}var r=this.tok("a",e,t);if(r>=0)return n.push(new c(["->",this._store.sym(S)])),r;if("<="==p(e,t,t+2))return n.push(new c(["<-",this._store.sym(l+"implies")])),t+2;if("="==p(e,t,t+1))return">"==p(e,t+1,t+2)?(n.push(new c(["->",this._store.sym(l+"implies")])),t+2):(n.push(new c(["->",this._store.sym(E)])),t+1);if(":="==p(e,t,t+2))return n.push(new c(["->",l+"becomes"])),t+2;var r=this.prop(e,t,i);if(r>=0)return n.push(new c(["->",i[0]])),r;if(">-"==p(e,t,t+2)||"<-"==p(e,t,t+2))throw s(this._thisDoc,this.lines,e,r,">- ... -> syntax is obsolete.");return-1},n.prototype.prop=function(e,t,n){return this.item(e,t,n)},n.prototype.item=function(e,t,n){return this.path(e,t,n)},n.prototype.blankNode=function(e){return this._context.bnode(e,this._reason2)},n.prototype.path=function(e,t,n){var r=this.nodeOrLiteral(e,t,n);if(r<0)return r;for(;"!^.".indexOf(p(e,r,r+1))>=0;){var i=p(e,r,r+1);if("."==i){var o=p(e,r+1,r+2);if(!o||L.indexOf(o)>=0&&":?<[{(".indexOf(o)<0)break}var a=n.pop(),u=this.blankNode(this.here(r)),r=this.node(e,r+1,n);if(r<0)throw s(this._thisDoc,this.lines,e,r,"EOF found in middle of path syntax");var l=n.pop();"^"==i?this.makeStatement(new c([this._context,l,u,a])):this.makeStatement(new c([this._context,l,a,u])),n.push(u)}return r},n.prototype.anonymousNode=function(e){var t=this._anonymousNodes[e];if(t)return t;var t=this._store.bnode(this._context,this._reason2);return this._anonymousNodes[e]=t,t},n.prototype.node=function(e,t,n,r){"undefined"==typeof r&&(r=null);var i=r,o=this.skipSpace(e,t);if(o<0)return o;var t=o,a=p(e,t,t+1);if("["==a){var u=this.here(t),o=this.skipSpace(e,t+1);if(o<0)throw s(this._thisDoc,this.lines,e,t,"EOF after '['");if("="==p(e,o,o+1)){var t=o+1,l=new f([]),o=this.objectList(e,t,l);if(!(o>=0))throw s(this._thisDoc,this.lines,e,t,"objectList expected after [= ");var i=l[0];if(d(l)>1){var g=new v(l);try{for(;;){var m=g.next();this.makeStatement(new c([this._context,this._store.sym(E),i,m]))}}catch(e){if(e!=y)throw e}}var o=this.skipSpace(e,o);if(o<0)throw s(this._thisDoc,this.lines,e,t,"EOF when objectList expected after [ = ");if(";"==p(e,o,o+1))var o=o+1}if(null==i)var i=this.blankNode(u);var t=this.property_list(e,o,i);if(t<0)throw s(this._thisDoc,this.lines,e,o,"property_list expected");var o=this.skipSpace(e,t);if(o<0)throw s(this._thisDoc,this.lines,e,t,"EOF when ']' expected after [ <propertyList>");if("]"!=p(e,o,o+1))throw s(this._thisDoc,this.lines,e,o,"']' expected");return n.push(i),o+1}if("{"==a){var b=p(e,t+1,t+2);if("$"==b){t+=1;for(var o=t+1,w=new f([]),_=!0;;){var t=this.skipSpace(e,o);if(t<0)throw s(this._thisDoc,this.lines,e,t,"needed '$}', found end.");if("$}"==p(e,t,t+2)){var o=t+2;break}if(_)var _=!1;else{if(","!=p(e,t,t+1))throw s(this._thisDoc,this.lines,e,t,"expected: ','");t+=1}var k=new f([]),o=this.item(e,t,k);if(o<0)throw s(this._thisDoc,this.lines,e,t,"expected item in set or '$}'");w.push(k[0])}return n.push(this._store.newSet(w,this._context)),o}var o=t+1,T=this._parentContext;this._parentContext=this._context;var S=this._anonymousNodes,N=this._parentVariables;this._parentVariables=this._variables,this._anonymousNodes=new h([]),this._variables=this._variables.slice();var R=this._reason2;if(this._reason2=x,null==i)var i=this._store.formula();for(this._context=i;;){var t=this.skipSpace(e,o);if(t<0)throw s(this._thisDoc,this.lines,e,t,"needed '}', found end.");if("}"==p(e,t,t+1)){var o=t+1;break}var o=this.directiveOrStatement(e,t);if(o<0)throw s(this._thisDoc,this.lines,e,t,"expected statement or '}'")}return this._anonymousNodes=S,this._variables=this._parentVariables,this._parentVariables=N,this._context=this._parentContext,this._reason2=R,this._parentContext=T,n.push(i.close()),o}if("("==a){var j=this._store.list,b=p(e,t+1,t+2);if("$"==b){var j=this._store.newSet;t+=1}for(var o=t+1,w=new f([]);;){var t=this.skipSpace(e,o);if(t<0)throw s(this._thisDoc,this.lines,e,t,"needed ')', found end.");if(")"==p(e,t,t+1)){var o=t+1;break}var k=new f([]),o=this.item(e,t,k);if(o<0)throw s(this._thisDoc,this.lines,e,t,"expected item in list or ')'");w.push(k[0])}return n.push(j(w,this._context)),o}var o=this.tok("this",e,t);if(o>=0)throw s(this._thisDoc,this.lines,e,t,"Keyword 'this' was ancient N3. Now use @forSome and @forAll keywords.");var o=this.tok("true",e,t);if(o>=0)return n.push(!0),o;var o=this.tok("false",e,t);if(o>=0)return n.push(!1),o;if(null==i){var o=this.uri_ref2(e,t,n);if(o>=0)return o}return-1},n.prototype.property_list=function(e,t,n){for(;;){var r=this.skipSpace(e,t);if(r<0)throw s(this._thisDoc,this.lines,e,t,"EOF found when expected verb in property list");if(":-"!=p(e,r,r+2)){var t=r,i=new f([]),r=this.verb(e,t,i);if(r<=0)return t;var o=new f([]),t=this.objectList(e,r,o);if(t<0)throw s(this._thisDoc,this.lines,e,r,"objectList expected");var a=new v(o);try{for(;;){var u=a.next(),l=i[0],h=l[0],d=l[1];"->"==h?this.makeStatement(new c([this._context,d,n,u])):this.makeStatement(new c([this._context,d,u,n]))}}catch(e){if(e!=y)throw e}var r=this.skipSpace(e,t);if(r<0)throw s(this._thisDoc,this.lines,e,r,"EOF found in list of objects");if(";"!=p(e,t,t+1))return t;var t=t+1}else{var t=r+2,g=new f([]),r=this.node(e,t,g,n);if(r<0)throw s(this._thisDoc,this.lines,e,t,"bad {} or () or [] node after :- ");var t=r}}},n.prototype.commaSeparatedList=function(e,t,n,r){var i=this.skipSpace(e,t);if(i<0)throw s(this._thisDoc,this.lines,e,i,"EOF found expecting comma sep list");if("."==e.charAt(i))return t;if(r)var i=this.uri_ref2(e,i,n);else var i=this.bareWord(e,i,n);if(i<0)return-1;for(;;){var t=this.skipSpace(e,i);if(t<0)return t;var o=p(e,t,t+1);if(","!=o)return"."!=o?-1:t;if(r)var i=this.uri_ref2(e,t+1,n);else var i=this.bareWord(e,t+1,n);if(i<0)throw s(this._thisDoc,this.lines,e,i,"bad list content")}},n.prototype.objectList=function(e,t,n){var t=this.object(e,t,n);if(t<0)return-1;for(;;){var r=this.skipSpace(e,t);if(r<0)throw s(this._thisDoc,this.lines,e,r,"EOF found after object");if(","!=p(e,r,r+1))return r;var t=this.object(e,r+1,n);if(t<0)return t}},n.prototype.checkDot=function(e,t){var n=this.skipSpace(e,t);if(n<0)return n;if("."==p(e,n,n+1))return n+1;if("}"==p(e,n,n+1))return n;if("]"==p(e,n,n+1))return n;throw s(this._thisDoc,this.lines,e,n,"expected '.' or '}' or ']' at end of statement")},n.prototype.uri_ref2=function(e,t,n){var r=new f([]),i=this.qname(e,t,r);if(i>=0){var o=r[0],u=o[0],l=o[1];if(null==u){m(0,"not used?");var c=this._baseURI+N}else{var c=this._bindings[u];if(!c){if("_"==u)return n.push(this.anonymousNode(l)),i;throw s(this._thisDoc,this.lines,e,t,"Prefix "+u+" not bound.")}}var h=this._store.sym(c+l);return a(this._variables,h)>=0?n.push(this._variables[h]):n.push(h),i}var t=this.skipSpace(e,t);if(t<0)return-1;if("?"==e.charAt(t)){var y=new f([]),i=this.variable(e,t,y);return i>0?(n.push(y[0]),i):-1}if("<"==e.charAt(t)){for(var t=t+1,v=t;t<d(e);){if(">"==e.charAt(t)){var g=p(e,v,t);if(this._baseURI)var g=w(this._baseURI,g);else m(g.indexOf(":")>=0,"With no base URI, cannot deal with relative URIs");if("#"==p(e,t-1,t)&&"#"!=p(g,-1,null))var g=g+"#";var h=this._store.sym(g);return a(this._variables,h)>=0?n.push(this._variables[h]):n.push(h),t+1}var t=t+1}throw s(this._thisDoc,this.lines,e,i,"unterminated URI reference")}if(this.keywordsSet){var y=new f([]),i=this.bareWord(e,t,y);if(i<0)return-1;if(a(this.keywords,y[0])>=0)throw s(this._thisDoc,this.lines,e,t,'Keyword "'+y[0]+'" not allowed here.');return n.push(this._store.sym(this._bindings[""]+y[0])),i}return-1},n.prototype.skipSpace=function(e,t){for(var n=" \n\r\t\f\v\u2028\u2029",r=t?t:0;r<e.length;r++){var i=e.charAt(r);if(n.indexOf(i)<0){if("#"!==e.charAt(r))return r;for(;;r++){if(r===e.length)return-1;if("\n"===e.charAt(r)){this.lines=this.lines+1;break}}}else"\n"===e.charAt(r)&&(this.lines=this.lines+1)}return-1},n.prototype.variable=function(e,t,n){var r=this.skipSpace(e,t);if(r<0)return-1;if("?"!=p(e,r,r+1))return-1;var r=r+1,t=r;if("0123456789-".indexOf(e.charAt(r))>=0)throw s(this._thisDoc,this.lines,e,r,"Varible name can't start with '"+e.charAt(r)+"s'");for(;t<d(e)&&L.indexOf(e.charAt(t))<0;)var t=t+1;if(null==this._parentContext)throw s(this._thisDoc,this.lines,e,r,"Can't use ?xxx syntax for variable in outermost level: "+p(e,r-1,t));return n.push(this._store.variable(p(e,r,t))),t},n.prototype.bareWord=function(e,t,n){var r=this.skipSpace(e,t);if(r<0)return-1;var i=e.charAt(r);if("0123456789-".indexOf(i)>=0)return-1;if(L.indexOf(i)>=0)return-1;for(var t=r;t<d(e)&&L.indexOf(e.charAt(t))<0;)var t=t+1;return n.push(p(e,r,t)),t},n.prototype.qname=function(e,t,n){var t=this.skipSpace(e,t);if(t<0)return-1;var r=e.charAt(t);if("0123456789-+".indexOf(r)>=0)return-1;if(L.indexOf(r)<0)for(var i=r,t=t+1;t<d(e);){var r=e.charAt(t);if(!(L.indexOf(r)<0))break;var i=i+r,t=t+1}else var i="";if(t<d(e)&&":"==e.charAt(t)){for(var o=i,t=t+1,i="";t<d(e);){var r=e.charAt(t);if(!(L.indexOf(r)<0))break;var i=i+r,t=t+1}return n.push(new c([o,i])),t}return i&&this.keywordsSet&&a(this.keywords,i)<0?(n.push(new c(["",i])),t):-1},n.prototype.object=function(e,t,n){var r=this.subject(e,t,n);if(r>=0)return r;var r=this.skipSpace(e,t);if(r<0)return-1;var t=r;if('"'==e.charAt(t)){if('"""'==p(e,t,t+3))var i='"""';else var i='"';var t=t+d(i),o=this.strconst(e,t,i),r=o[0],a=o[1];return n.push(this._store.literal(a)),T("New string const ",a,r),r}return-1},n.prototype.nodeOrLiteral=function(e,t,n){var r=this.node(e,t,n);if(r>=0)return r;var r=this.skipSpace(e,t);if(r<0)return-1;var t=r,i=e.charAt(t);if("-+0987654321".indexOf(i)>=0){P.lastIndex=0;var o=P.exec(e.slice(t));if(null!=o){var a=o[0];r=t+a.length,a.indexOf("T")>=0?n.push(this._store.literal(a,void 0,this._store.sym(C))):n.push(this._store.literal(a,void 0,this._store.sym(I)))}else{D.lastIndex=0;var o=D.exec(e.slice(t));if(null==o)throw s(this._thisDoc,this.lines,e,t,"Bad number or date syntax");r=t+D.lastIndex;var a=p(e,t,r);a.indexOf("e")>=0?n.push(this._store.literal(parseFloat(a),void 0,this._store.sym(j))):p(e,t,r).indexOf(".")>=0?n.push(this._store.literal(parseFloat(a),void 0,this._store.sym(O))):n.push(this._store.literal(parseInt(a),void 0,this._store.sym(R)))}return r}if('"'==e.charAt(t)){if('"""'==p(e,t,t+3))var u='"""';else var u='"';var t=t+d(u),l=null,c=this.strconst(e,t,u),r=c[0],h=c[1],y=null;if("@"==p(e,r,r+1)){M.lastIndex=0;var o=M.exec(e.slice(r+1));if(null==o)throw s(this._thisDoc,startline,e,t,"Bad language code syntax on string literal, after @");var t=M.lastIndex+r+1,y=p(e,r+1,t),r=t}if("^^"==p(e,r,r+2))var v=new f([]),r=this.uri_ref2(e,r+2,v),l=v[0];return n.push(this._store.literal(h,y,l)),r}return-1},n.prototype.strconst=function(e,t,n){for(var r=t,i="",o=this.lines;r<d(e);){var t=r+d(n);if(p(e,r,t)==n)return new c([t,i]);if('"'!=e.charAt(r)){U.lastIndex=0;var a=U.exec(e.slice(r));if(!a)throw s(this._thisDoc,o,e,r,"Closing quote missing in string at ^ in "+p(e,r-20,r)+"^"+p(e,r,r+20));var t=r+U.lastIndex-1,i=i+p(e,r,t),u=e.charAt(t);if('"'!=u)if("\r"!=u){if("\n"==u){if('"'==n)throw s(this._thisDoc,o,e,t,"newline found in string literal");this.lines=this.lines+1;var i=i+u,r=t+1;this.previousLine=this.startOfLine,this.startOfLine=r}else if("\\"==u){var r=t+1,u=p(e,r,r+1);if(!u)throw s(this._thisDoc,o,e,t,"unterminated string literal (2)");var l=g('abfrtvn\\"',u);if(l>=0)var f='a\b\f\r\t\v\n\\"'.charAt(l),i=i+f,r=r+1;else if("u"==u)var h=this.uEscape(e,r+1,o),r=h[0],u=h[1],i=i+u;else{if("U"!=u)throw s(this._thisDoc,this.lines,e,t,"bad escape");var h=this.UEscape(e,r+1,o),r=h[0],u=h[1],i=i+u}}}else var r=t+1;else var r=t}else var i=i+'"',r=r+1}throw s(this._thisDoc,this.lines,e,t,"unterminated string literal")},n.prototype.uEscape=function(e,t,n){for(var r=t,i=0,o=0;i<4;){var a=p(e,r,r+1),u=a.toLowerCase(),r=r+1;if(""==u)throw s(this._thisDoc,n,e,t,"unterminated string literal(3)");var l=g("0123456789abcdef",u);if(l<0)throw s(this._thisDoc,n,e,t,"bad string literal hex escape");var o=16*o+l,i=i+1}var f=String.fromCharCode(o);return new c([r,f])},n.prototype.UEscape=function(e,t,n){for(var r=t,i=0,o="\\U";i<8;){var a=p(e,r,r+1),u=a.toLowerCase(),r=r+1;if(""==u)throw s(this._thisDoc,n,e,t,"unterminated string literal(3)");var l=g("0123456789abcdef",u);if(l<0)throw s(this._thisDoc,n,e,t,"bad string literal hex escape");var o=o+u,i=i+1}var f=b("0x"+p(o,2,10)-0);return new c([r,f])},r.prototype.toString=function(){var e=this._str,t=this._i,n=0;if(t>60)var r="...",n=t-60;else var r="";if(d(e)-t>60)var i="...";else var i="";return'Line %i of <%s>: Bad syntax (%s) at ^ in:\n"%s%s^%s%s"'%new c([this.lines+1,this._uri,this._why,r,p(e,n,t),p(e,t,t+60),i])},t}();e.exports=s},function(e,t,n){"use strict";function r(e){var t;return t=e.indexOf("#"),t<0?e:e.slice(0,t)}function i(e){return c(r(e.uri))}function o(e){var t=/[^\/]*\/\/([^\/]*)\//.exec(e);return t?t[1]:""}function a(e,t){var n,r,i,o,a,s,u=t.indexOf("#");if(u>0&&(t=t.slice(0,u)),0===e.length)return t;if(0===e.indexOf("#"))return t+e;if(o=e.indexOf(":"),o>=0)return e;if(n=t.indexOf(":"),0===t.length)return e;if(n<0)return l("Invalid base: "+t+" in join with given: "+e),e;if(r=t.slice(0,+n+1||9e9),0===e.indexOf("//"))return r+e;if(t.indexOf("//",n)===n+1){if(i=t.indexOf("/",n+3),i<0)return t.length-n-3>0?t+"/"+e:r+e}else if(i=t.indexOf("/",n+1),i<0)return t.length-n-1>0?t+"/"+e:r+e;if(0===e.indexOf("/"))return t.slice(0,i)+e;if(s=t.slice(i),a=s.lastIndexOf("/"),a<0)return r+e;for(a>=0&&a<s.length-1&&(s=s.slice(0,+a+1||9e9)),s+=e;s.match(/[^\/]*\/\.\.\//);)s=s.replace(/[^\/]*\/\.\.\//,"");return s=s.replace(/\.\//g,""),s=s.replace(/\/\.$/,"/"),t.slice(0,i)+s}function s(e){var t;return t=e.indexOf(":"),t<0?null:e.slice(0,t)}function u(e,t){var n,r,i,o,a,s,u,l,c,f,h,d,p,y=new RegExp("^[-_a-zA-Z0-9.]+:(//[^/]*)?/[^/]*$");if(!e)return t;if(e===t)return"";for(r=l=0,a=t.length;l<a&&(n=t[r],n===e[r]);r=++l);if(e.slice(0,r).match(y)&&(i=t.indexOf("//"),i<0&&(i=-2),o=t.indexOf("/",i+2),"/"!==t[o+1]&&"/"!==e[o+1]&&t.slice(0,o)===e.slice(0,o)))return t.slice(o);if("#"===t[r]&&e.length===r)return t.slice(r);for(;r>0&&"/"!==t[r-1];)r--;if(r<3)return t;if(e.indexOf("//",r-2)>0||t.indexOf("//",r-2)>0)return t;if(e.indexOf(":",r)>0)return t;for(u=0,h=e.slice(r),c=0,s=h.length;c<s;c++)n=h[c],"/"===n&&u++;if(0===u&&r<t.length&&"#"===t[r])return"./"+t.slice(r);if(0===u&&r===t.length)return"./";if(p="",u>0)for(f=1,d=u;d>=1?f<=d:f>=d;d>=1?++f:--f)p+="../";return p+t.slice(r)}var l=l||console.log;e.exports.docpart=r,e.exports.document=i,e.exports.hostpart=o,e.exports.join=a,e.exports.protocol=s,e.exports.refTo=u;var c=n(58).namedNode},function(e,t,n){(function(e){"use strict";function t(e,t,n){var r=null;if("undefined"!=typeof e.fetcher&&(r=e.fetcher,"NamedNode"===t.termType)){var i,o=m(t.uri);if(t.uri.indexOf("#")<0){if(y(t.uri,"http://dbpedia.org/resource/Category:"))return;y(t.uri,"http://purl.org/dc/elements/1.1/")||y(t.uri,"http://purl.org/dc/terms/")?i="http://dublincore.org/2005/06/13/dcq":y(t.uri,"http://xmlns.com/wot/0.1/")?i="http://xmlns.com/wot/0.1/index.rdf":y(t.uri,"http://web.resource.org/cc/")&&(i="http://web.resource.org/cc/schema.rdf")}i&&(o=i),r&&"unrequested"!==r.getState(o)||(i&&b.warn("Assuming server still broken, faking redirect of <"+t.uri+"> to <"+o+">"),r.requestURI(o,n))}}function r(e,t,n){n||(n=0);var r=e.length;for(n<0&&(n=r+n);n<r;n++)if(e[n]===t)return n;return-1}function i(e,t){e.callbacks={};for(var n=t.length-1;n>=0;n--)e.callbacks[t[n]]=[];e.addHook=function(t){e.callbacks[t]||(e.callbacks[t]=[])},e.addCallback=function(t,n){e.callbacks[t].push(n)},e.removeCallback=function(t,n){for(var r=0;r<e.callbacks[t].length;r++)if(e.callbacks[t][r].name===n)return e.callbacks[t].splice(r,1),!0;return!1},e.insertCallback=function(t,n){e.callbacks[t].unshift(n);
},e.fireCallbacks=function(t,n){var r,i=[],o=[],a=e.callbacks[t].length;for(r=a-1;r>=0;r--)e.callbacks[t][r].apply(e,n)&&i.push(e.callbacks[t][r]);for(r=i.length-1;r>=0;r--)o.push(i[r]);for(r=a;r<e.callbacks[t].length;r++)o.push(e.callbacks[t][r]);e.callbacks[t]=o}}function o(){return tabulator&&tabulator.isExtension?Components.classes["@mozilla.org/xmlextras/domparser;1"].getService(Components.interfaces.nsIDOMParser):window.DOMParser?new DOMParser:!!window.ActiveXObject&&new ActiveXObject("Microsoft.XMLDOM")}function a(e,t){t=t||{};var n=[];"selfClosing"in t&&t.selfClosing.split(" ").forEach(function(e){n[e]=!0});var r=[];return"skipAttributes"in t&&t.skipAttributes.split(" ").forEach(function(e){r[e]=!0}),s(e,t,n,r)}function s(e,t,n,r){var i,o="",a=[!1];if("undefined"==typeof e.nodeType)return o;if(1===e.nodeType){if(e.hasAttribute("class")&&"classWithChildText"in t&&e.matches(t.classWithChildText.class))o+=e.querySelector(t.classWithChildText.element).textContent;else if(!("skipNodeWithClass"in t&&e.matches("."+t.skipNodeWithClass))){var u=e.nodeName.toLowerCase();o+="<"+u;var l=[];for(i=e.attributes.length-1;i>=0;i--){var c=e.attributes[i];if(!(r.length>0&&r[c.name]||/^\d+$/.test(c.name))){if("class"===c.name&&"replaceClassItemWith"in t&&c.value.split(" ").indexOf(t.replaceClassItemWith.source)>-1){var f=new RegExp(t.replaceClassItemWith.source,"g");c.value=c.value.replace(f,t.replaceClassItemWith.target).trim()}"class"===c.name&&"skipClassWithValue"in t&&t.skipClassWithValue===c.value||l.push(c.name+"='"+c.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&quot;")+"'")}}if(l.length>0&&("sortAttributes"in t&&t.sortAttributes&&l.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}),o+=" "+l.join(" ")),n[u])o+=" />";else{for(o+=">",o+="html"===u?"\n  ":"",a.push("style"===u||"script"===u),i=0;i<e.childNodes.length;i++)o+=s(e.childNodes[i]);a.pop(),o+="body"===u?"</"+u+">\n":"</"+u+">"}}}else if(8===e.nodeType)o+="<!--"+e.nodeValue+"-->";else if(3===e.nodeType||4===e.nodeType){var h=e.nodeValue.replace(/\n+$/,"");o+=a[a.length-1]?h:h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}else console.log("Warning; Cannot handle serialising nodes of type: "+e.nodeType),console.log(e);return o}function u(){var e=new Date,t=e.getYear()+1900,n=e.getMonth()+1,r=e.getDate(),i=e.getUTCHours(),o=e.getUTCMinutes(),a=e.getSeconds();return n<10&&(n="0"+n),r<10&&(r="0"+r),i<10&&(i="0"+i),o<10&&(o="0"+o),a<10&&(a="0"+a),t+"-"+n+"-"+r+"T"+i+":"+o+":"+a+"Z"}function l(e){for(var t,n=e.getAllResponseHeaders().split("\n"),r={},i=0;i<n.length;i++)if(n[i].length>0){var o=n[i].split(": ");"undefined"==typeof o[1]?r[t]+="\n"+o[0]:(t=o[0].toLowerCase(),r[t]=o[1])}return r}function c(e,t,n){var r=function(e){return"BlankNode"===e.termType?null:e},i=function(t){var i=n.statementsMatching(e).map(function(e){return""+r(e.subject)+" "+r(e.predicate)+" "+r(e.object)}).concat(n.statementsMatching(void 0,void 0,e).map(function(e){return""+r(e.subject)+" "+r(e.predicate)+" "+r(e.object)}));return i.sort(),i.join("\n")};return"BlankNode"===e.termType||"BlankNode"===t.termType?0===e.compareTerm(t)?0:i(e)>i(t)?1:i(e)<i(t)?-1:e.compareTerm(t):e.compareTerm(t)}function f(e,t,n){var r=c(e.subject,t.subject,n);return r?r:(r=c(e.predicate,t.predicate,n),r?r:c(e.object,t.object,n))}function h(e){var t=document.createElement("div");t.textContent=e,document.body.appendChild(t)}function d(t,r){var i;if(r=r||{},"undefined"!=typeof tabulator&&tabulator.isExtension)i=Components.classes["@mozilla.org/xmlextras/domparser;1"].getService(Components.interfaces.nsIDOMParser);else{if("undefined"!=typeof e&&e&&e.exports){var o=n(65).DOMParser,a=(new o).parseFromString(t,r.contentType||"application/xhtml+xml");return a}i="undefined"!=typeof window&&window.DOMParser?new window.DOMParser:new o}return i.parseFromString(t,"application/xml")}function p(e,t){for(var n=0;n<e.length;n++)if(e[n].subject.sameTerm(t.subject)&&e[n].predicate.sameTerm(t.predicate)&&e[n].object.sameTerm(t.object)&&e[n].why.sameTerm(t.why))return void e.splice(n,1);throw new Error("RDFArrayRemove: Array did not contain "+t+" "+t.why)}function y(e,t){return e.slice(0,t.length)===t}function v(e,t){for(var n=e.split("%s"),r="",i=0;i<t.length;i++)t[i]+="",r+=n[i]+t[i];return r+n.slice(t.length).join()}function g(){var t;if("undefined"!=typeof tabulator&&tabulator.isExtension)return Components.classes["@mozilla.org/xmlextras/xmlhttprequest;1"].createInstance().QueryInterface(Components.interfaces.nsIXMLHttpRequest);if("undefined"!=typeof window&&"XMLHttpRequest"in window)return new(t=window.XMLHttpRequest);if("undefined"!=typeof e&&e&&e.exports)return new(t=n(68).XMLHttpRequest);if(!window.ActiveXObject)return!1;try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}var m=n(63).docpart,b=n(61);e.exports.AJAR_handleNewTerm=t,e.exports.ArrayIndexOf=r,e.exports.callbackify=i,e.exports.dtstamp=u,e.exports.DOMParserFactory=o,e.exports.domToString=a,e.exports.dumpNode=s,e.exports.getHTTPHeaders=l,e.exports.heavyCompare=c,e.exports.heavyCompareSPO=f,e.exports.output=h,e.exports.parseXML=d,e.exports.RDFArrayRemove=p,e.exports.string_startswith=y,e.exports.string={},e.exports.string.template=v,e.exports.uri=n(63),e.exports.XMLHTTPFactory=g,e.exports.log=b,e.exports.mediaTypeClass=function(e){return $rdf.sym("http://www.w3.org/ns/iana/media-types/"+e+"#Resource")}}).call(t,n(18)(e))},function(e,t,n){function r(e){this.options=e||{locator:{}}}function i(e,t,n){function r(t){var r=e[t];!r&&a&&(r=2==e.length?function(n){e(t,n)}:e),i[t]=r&&function(e){r("[xmldom "+t+"]\t"+e+s(n))}||function(){}}if(!e){if(t instanceof o)return t;e=t}var i={},a=e instanceof Function;return n=n||{},r("warning"),r("error"),r("fatalError"),i}function o(){this.cdata=!1}function a(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function s(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function u(e,t,n){return"string"==typeof e?e.substr(t,n):e.length>=t+n||t?new java.lang.String(e,t,n)+"":e}function l(e,t){e.currentElement?e.currentElement.appendChild(t):e.document.appendChild(t)}r.prototype.parseFromString=function(e,t){var n=this.options,r=new c,a=n.domBuilder||new o,s=n.errorHandler,u=n.locator,l=n.xmlns||{},f={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return u&&a.setDocumentLocator(u),r.errorHandler=i(s,a,u),r.domBuilder=n.domBuilder||a,/\/x?html?$/.test(t)&&(f.nbsp="",f.copy="",l[""]="http://www.w3.org/1999/xhtml"),l.xml=l.xml||"http://www.w3.org/XML/1998/namespace",e?r.parse(e,l,f):r.errorHandler.error("invalid document source"),a.document},o.prototype={startDocument:function(){this.document=(new f).createDocument(null,null,null),this.locator&&(this.document.documentURI=this.locator.systemId)},startElement:function(e,t,n,r){var i=this.document,o=i.createElementNS(e,n||t),s=r.length;l(this,o),this.currentElement=o,this.locator&&a(this.locator,o);for(var u=0;u<s;u++){var e=r.getURI(u),c=r.getValue(u),n=r.getQName(u),f=i.createAttributeNS(e,n);f.getOffset&&a(f.getOffset(1),f),f.value=f.nodeValue=c,o.setAttributeNode(f)}},endElement:function(e,t,n){var r=this.currentElement;r.tagName;this.currentElement=r.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var n=this.document.createProcessingInstruction(e,t);this.locator&&a(this.locator,n),l(this,n)},ignorableWhitespace:function(e,t,n){},characters:function(e,t,n){if(e=u.apply(this,arguments),this.currentElement&&e){if(this.cdata){var r=this.document.createCDATASection(e);this.currentElement.appendChild(r)}else{var r=this.document.createTextNode(e);this.currentElement.appendChild(r)}this.locator&&a(this.locator,r)}},skippedEntity:function(e){},endDocument:function(){this.document.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,n){e=u.apply(this,arguments);var r=this.document.createComment(e);this.locator&&a(this.locator,r),l(this,r)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,n){var r=this.document.implementation;if(r&&r.createDocumentType){var i=r.createDocumentType(e,t,n);this.locator&&a(this.locator,i),l(this,i)}},warning:function(e){console.warn("[xmldom warning]\t"+e,s(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,s(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,s(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(e){o.prototype[e]=function(){return null}});var c=n(66).XMLReader,f=t.DOMImplementation=n(67).DOMImplementation;t.XMLSerializer=n(67).XMLSerializer,t.DOMParser=r},function(e,t,n){function r(){}function i(e,t,n,r,i){function c(e){if(e>65535){e-=65536;var t=55296+(e>>10),n=56320+(1023&e);return String.fromCharCode(t,n)}return String.fromCharCode(e)}function p(e){var t=e.slice(1,-1);return t in n?n[t]:"#"===t.charAt(0)?c(parseInt(t.substr(1).replace("x","0x"))):(i.error("entity not found:"+e),e)}function y(t){if(t>k){var n=e.substring(k,t).replace(/&#?\w+;/g,p);w&&v(k),r.characters(n,0,t-k),k=t}}function v(t,n){for(;t>=m&&(n=b.exec(e));)g=n.index,m=g+n[0].length,w.lineNumber++;w.columnNumber=t-g+1}for(var g=0,m=0,b=/.+(?:\r\n?|\n)|.*$/g,w=r.locator,x=[{currentNSMap:t}],_={},k=0;;){try{var T=e.indexOf("<",k);if(T<0){if(!e.substr(k).match(/^\s*$/)){var S=r.document,E=S.createTextNode(e.substr(k));S.appendChild(E),r.currentElement=E}return}switch(T>k&&y(T),e.charAt(T+1)){case"/":var N=e.indexOf(">",T+3),R=e.substring(T+2,N),j=x.pop(),O=j.localNSMap;if(j.tagName!=R&&i.fatalError("end tag name: "+R+" is not match the current start tagName:"+j.tagName),r.endElement(j.uri,j.localName,R),O)for(var I in O)r.endPrefixMapping(I);N++;break;case"?":w&&v(T),N=h(e,T,r);break;case"!":w&&v(T),N=f(e,T,r,i);break;default:w&&v(T);var C=new d,N=a(e,T,C,p,i),A=C.length;if(w){if(A)for(var L=0;L<A;L++){var D=C[L];v(D.offset),D.offset=o(w,{})}v(N)}!C.closed&&l(e,N,C.tagName,_)&&(C.closed=!0,n.nbsp||i.warning("unclosed xml attribute")),s(C,r,x),"http://www.w3.org/1999/xhtml"!==C.uri||C.closed?N++:N=u(e,N,C.tagName,p,r)}}catch(e){i.error("element parse error: "+e),N=-1}N>k?k=N:y(Math.max(T,k)+1)}}function o(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function a(e,t,n,r,i){for(var o,a,s=++t,u=b;;){var l=e.charAt(s);switch(l){case"=":if(u===w)o=e.slice(t,s),u=_;else{if(u!==x)throw new Error("attribute equal must after attrName");u=_}break;case"'":case'"':if(u===_){if(t=s+1,s=e.indexOf(l,t),!(s>0))throw new Error("attribute value no end '"+l+"' match");a=e.slice(t,s).replace(/&#?\w+;/g,r),n.add(o,a,t-1),u=T}else{if(u!=k)throw new Error('attribute value must after "="');a=e.slice(t,s).replace(/&#?\w+;/g,r),n.add(o,a,t),i.warning('attribute "'+o+'" missed start quot('+l+")!!"),t=s+1,u=T}break;case"/":switch(u){case b:n.setTagName(e.slice(t,s));case T:case S:case E:u=E,n.closed=!0;case k:case w:case x:break;default:throw new Error("attribute invalid close char('/')")}break;case"":i.error("unexpected end of input");case">":switch(u){case b:n.setTagName(e.slice(t,s));case T:case S:case E:break;case k:case w:a=e.slice(t,s),"/"===a.slice(-1)&&(n.closed=!0,a=a.slice(0,-1));case x:u===x&&(a=o),u==k?(i.warning('attribute "'+a+'" missed quot(")!!'),n.add(o,a.replace(/&#?\w+;/g,r),t)):(i.warning('attribute "'+a+'" missed value!! "'+a+'" instead!!'),n.add(a,a,t));break;case _:throw new Error("attribute value missed!!")}return s;case"":l=" ";default:if(l<=" ")switch(u){case b:n.setTagName(e.slice(t,s)),u=S;break;case w:o=e.slice(t,s),u=x;break;case k:var a=e.slice(t,s).replace(/&#?\w+;/g,r);i.warning('attribute "'+a+'" missed quot(")!!'),n.add(o,a,t);case T:u=S}else switch(u){case x:i.warning('attribute "'+o+'" missed value!! "'+o+'" instead!!'),n.add(o,o,t),t=s,u=w;break;case T:i.warning('attribute space is required"'+o+'"!!');case S:u=w,t=s;break;case _:u=k,t=s;break;case E:throw new Error("elements closed character '/' and '>' must be connected to")}}s++}}function s(e,t,n){for(var r=e.tagName,i=null,o=n[n.length-1].currentNSMap,a=e.length;a--;){var s=e[a],u=s.qName,l=s.value,f=u.indexOf(":");if(f>0)var h=s.prefix=u.slice(0,f),d=u.slice(f+1),p="xmlns"===h&&d;else d=u,h=null,p="xmlns"===u&&"";s.localName=d,p!==!1&&(null==i&&(i={},c(o,o={})),o[p]=i[p]=l,s.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(p,l))}for(var a=e.length;a--;){s=e[a];var h=s.prefix;h&&("xml"===h&&(s.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==h&&(s.uri=o[h]))}var f=r.indexOf(":");f>0?(h=e.prefix=r.slice(0,f),d=e.localName=r.slice(f+1)):(h=null,d=e.localName=r);var y=e.uri=o[h||""];if(t.startElement(y,d,r,e),e.closed){if(t.endElement(y,d,r),i)for(h in i)t.endPrefixMapping(h)}else e.currentNSMap=o,e.localNSMap=i,n.push(e)}function u(e,t,n,r,i){if(/^(?:script|textarea)$/i.test(n)){var o=e.indexOf("</"+n+">",t),a=e.substring(t+1,o);if(/[&<]/.test(a))return/^script$/i.test(n)?(i.characters(a,0,a.length),o):(a=a.replace(/&#?\w+;/g,r),i.characters(a,0,a.length),o)}return t+1}function l(e,t,n,r){var i=r[n];return null==i&&(i=r[n]=e.lastIndexOf("</"+n+">")),i<t}function c(e,t){for(var n in e)t[n]=e[n]}function f(e,t,n,r){var i=e.charAt(t+2);switch(i){case"-":if("-"===e.charAt(t+3)){var o=e.indexOf("-->",t+4);return o>t?(n.comment(e,t+4,o-t-4),o+3):(r.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==e.substr(t+3,6)){var o=e.indexOf("]]>",t+9);return n.startCDATA(),n.characters(e,t+9,o-t-9),n.endCDATA(),o+3}var a=y(e,t),s=a.length;if(s>1&&/!doctype/i.test(a[0][0])){var u=a[1][0],l=s>3&&/^public$/i.test(a[2][0])&&a[3][0],c=s>4&&a[4][0],f=a[s-1];return n.startDTD(u,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),c&&c.replace(/^(['"])(.*?)\1$/,"$2")),n.endDTD(),f.index+f[0].length}}return-1}function h(e,t,n){var r=e.indexOf("?>",t);if(r){var i=e.substring(t,r).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(i){i[0].length;return n.processingInstruction(i[1],i[2]),r+2}return-1}return-1}function d(e){}function p(e,t){return e.__proto__=t,e}function y(e,t){var n,r=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=t,i.exec(e);n=i.exec(e);)if(r.push(n),n[1])return r}var v=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,g=new RegExp("[\\-\\.0-9"+v.source.slice(1,-1)+"-\\u203F-]"),m=new RegExp("^"+v.source+g.source+"*(?::"+v.source+g.source+"*)?$"),b=0,w=1,x=2,_=3,k=4,T=5,S=6,E=7;r.prototype={parse:function(e,t,n){var r=this.domBuilder;r.startDocument(),c(t,t={}),i(e,t,n,r,this.errorHandler),r.endDocument()}},d.prototype={setTagName:function(e){if(!m.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,n){if(!m.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:n}},length:0,getLocalName:function(e){return this[e].localName},getOffset:function(e){return this[e].offset},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},p({},p.prototype)instanceof p||(p=function(e,t){function n(){}n.prototype=t,n=new n;for(t in e)n[t]=e[t];return n}),t.XMLReader=r},function(e,t,n){function r(e,t){for(var n in e)t[n]=e[n]}function i(e,t){function n(){}var i=e.prototype;if(Object.create){var o=Object.create(t.prototype);i.__proto__=o}i instanceof t||(n.prototype=t.prototype,n=new n,r(i,n),e.prototype=i=n),i.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),i.constructor=e)}function o(e,t){if(t instanceof Error)var n=t;else n=this,Error.call(this,re[e]),this.message=re[e],Error.captureStackTrace&&Error.captureStackTrace(this,o);return n.code=e,t&&(this.message=this.message+": "+t),n}function a(){}function s(e,t){this._node=e,this._refresh=t,u(this)}function u(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var n=e._refresh(e._node);F(e,"length",n.length),r(n,e),e._inc=t}}function l(){}function c(e,t){for(var n=e.length;n--;)if(e[n]===t)return n}function f(e,t,n,r){if(r?t[c(t,r)]=n:t[t.length++]=n,e){n.ownerElement=e;var i=e.ownerDocument;i&&(r&&b(i,e,r),m(i,e,n))}}function h(e,t,n){var r=c(t,n);if(!(r>=0))throw o(ie,new Error);for(var i=t.length-1;r<i;)t[r]=t[++r];if(t.length=i,e){var a=e.ownerDocument;a&&(b(a,e,n),n.ownerElement=null)}}function d(e){if(this._features={},e)for(var t in e)this._features=e[t]}function p(){}function y(e){return"<"==e&&"&lt;"||">"==e&&"&gt;"||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function v(e,t){if(t(e))return!0;if(e=e.firstChild)do if(v(e,t))return!0;while(e=e.nextSibling)}function g(){}function m(e,t,n){e&&e._inc++;var r=n.namespaceURI;"http://www.w3.org/2000/xmlns/"==r&&(t._nsMap[n.prefix?n.localName:""]=n.value)}function b(e,t,n,r){e&&e._inc++;var i=n.namespaceURI;"http://www.w3.org/2000/xmlns/"==i&&delete t._nsMap[n.prefix?n.localName:""]}function w(e,t,n){if(e&&e._inc){e._inc++;var r=t.childNodes;if(n)r[r.length++]=n;else{for(var i=t.firstChild,o=0;i;)r[o++]=i,i=i.nextSibling;r.length=o}}}function x(e,t){var n=t.previousSibling,r=t.nextSibling;return n?n.nextSibling=r:e.firstChild=r,r?r.previousSibling=n:e.lastChild=n,w(e.ownerDocument,e),t}function _(e,t,n){var r=t.parentNode;if(r&&r.removeChild(t),t.nodeType===ee){var i=t.firstChild;if(null==i)return t;var o=t.lastChild}else i=o=t;var a=n?n.previousSibling:e.lastChild;i.previousSibling=a,o.nextSibling=n,a?a.nextSibling=i:e.firstChild=i,null==n?e.lastChild=o:n.previousSibling=o;do i.parentNode=e;while(i!==o&&(i=i.nextSibling));return w(e.ownerDocument||e,e),t.nodeType==ee&&(t.firstChild=t.lastChild=null),t}function k(e,t){var n=t.parentNode;if(n){var r=e.lastChild;n.removeChild(t);var r=e.lastChild}var r=e.lastChild;return t.parentNode=e,t.previousSibling=r,t.nextSibling=null,r?r.nextSibling=t:e.firstChild=t,e.lastChild=t,w(e.ownerDocument,e,t),t}function T(){this._nsMap={}}function S(){}function E(){}function N(){}function R(){}function j(){}function O(){}function I(){}function C(){}function A(){}function L(){}function D(){}function P(){}function U(e,t,n,r){switch(e.nodeType){case V:var i=e.attributes,o=i.length,a=e.firstChild,s=e.tagName;r=H===e.namespaceURI||r,t.push("<",s),n&&t.sort.apply(i,n);for(var u=0;u<o;u++)U(i.item(u),t,n,r);if(a||r&&!/^(?:meta|link|img|br|hr|input|button)$/i.test(s)){if(t.push(">"),r&&/^script$/i.test(s))a&&t.push(a.data);else for(;a;)U(a,t,n,r),a=a.nextSibling;t.push("</",s,">")}else t.push("/>");return;case K:case ee:for(var a=e.firstChild;a;)U(a,t,n,r),a=a.nextSibling;return;case W:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,y),'"');case X:return t.push(e.data.replace(/[<&]/g,y));case J:return t.push("<![CDATA[",e.data,"]]>");case Q:return t.push("<!--",e.data,"-->");case Z:var l=e.publicId,c=e.systemId;if(t.push("<!DOCTYPE ",e.name),l)t.push(' PUBLIC "',l),c&&"."!=c&&t.push('" "',c),t.push('">');else if(c&&"."!=c)t.push(' SYSTEM "',c,'">');else{var f=e.internalSubset;f&&t.push(" [",f,"]"),t.push(">")}return;case Y:return t.push("<?",e.target," ",e.data,"?>");case G:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function M(e,t,n){var r;switch(t.nodeType){case V:r=t.cloneNode(!1),r.ownerDocument=e;case ee:break;case W:n=!0}if(r||(r=t.cloneNode(!1)),r.ownerDocument=e,r.parentNode=null,n)for(var i=t.firstChild;i;)r.appendChild(M(e,i,n)),i=i.nextSibling;return r}function q(e,t,n){var r=new t.constructor;for(var i in t){var o=t[i];"object"!=typeof o&&o!=r[i]&&(r[i]=o)}switch(t.childNodes&&(r.childNodes=new a),r.ownerDocument=e,r.nodeType){case V:var s=t.attributes,u=r.attributes=new l,c=s.length;u._ownerElement=r;for(var f=0;f<c;f++)r.setAttributeNode(q(e,s.item(f),!0));break;case W:n=!0}if(n)for(var h=t.firstChild;h;)r.appendChild(q(e,h,n)),h=h.nextSibling;return r}function F(e,t,n){e[t]=n}function B(e){switch(e.nodeType){case 1:case 11:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(B(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}var H="http://www.w3.org/1999/xhtml",z={},V=z.ELEMENT_NODE=1,W=z.ATTRIBUTE_NODE=2,X=z.TEXT_NODE=3,J=z.CDATA_SECTION_NODE=4,G=z.ENTITY_REFERENCE_NODE=5,$=z.ENTITY_NODE=6,Y=z.PROCESSING_INSTRUCTION_NODE=7,Q=z.COMMENT_NODE=8,K=z.DOCUMENT_NODE=9,Z=z.DOCUMENT_TYPE_NODE=10,ee=z.DOCUMENT_FRAGMENT_NODE=11,te=z.NOTATION_NODE=12,ne={},re={},ie=(ne.INDEX_SIZE_ERR=(re[1]="Index size error",1),ne.DOMSTRING_SIZE_ERR=(re[2]="DOMString size error",2),ne.HIERARCHY_REQUEST_ERR=(re[3]="Hierarchy request error",3),ne.WRONG_DOCUMENT_ERR=(re[4]="Wrong document",4),ne.INVALID_CHARACTER_ERR=(re[5]="Invalid character",5),ne.NO_DATA_ALLOWED_ERR=(re[6]="No data allowed",6),ne.NO_MODIFICATION_ALLOWED_ERR=(re[7]="No modification allowed",7),ne.NOT_FOUND_ERR=(re[8]="Not found",8)),oe=(ne.NOT_SUPPORTED_ERR=(re[9]="Not supported",9),ne.INUSE_ATTRIBUTE_ERR=(re[10]="Attribute in use",10));ne.INVALID_STATE_ERR=(re[11]="Invalid state",11),ne.SYNTAX_ERR=(re[12]="Syntax error",12),ne.INVALID_MODIFICATION_ERR=(re[13]="Invalid modification",13),ne.NAMESPACE_ERR=(re[14]="Invalid namespace",14),ne.INVALID_ACCESS_ERR=(re[15]="Invalid access",15);o.prototype=Error.prototype,r(ne,o),a.prototype={length:0,item:function(e){return this[e]||null},toString:function(){for(var e=[],t=0;t<this.length;t++)U(this[t],e);return e.join("")}},s.prototype.item=function(e){return u(this),this[e]},i(s,a),l.prototype={length:0,item:a.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var n=this[t];if(n.nodeName==e)return n}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new o(oe);var n=this.getNamedItem(e.nodeName);return f(this._ownerElement,this,e,n),n},setNamedItemNS:function(e){var t,n=e.ownerElement;if(n&&n!=this._ownerElement)throw new o(oe);return t=this.getNamedItemNS(e.namespaceURI,e.localName),f(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return h(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var n=this.getNamedItemNS(e,t);return h(this._ownerElement,this,n),n},getNamedItemNS:function(e,t){for(var n=this.length;n--;){var r=this[n];if(r.localName==t&&r.namespaceURI==e)return r}return null}},d.prototype={hasFeature:function(e,t){var n=this._features[e.toLowerCase()];return!(!n||t&&!(t in n))},createDocument:function(e,t,n){var r=new g;if(r.implementation=this,r.childNodes=new a,r.doctype=n,n&&r.appendChild(n),t){var i=r.createElementNS(e,t);r.appendChild(i)}return r},createDocumentType:function(e,t,n){var r=new O;return r.name=e,r.nodeName=e,r.publicId=t,r.systemId=n,r}},p.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return _(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return x(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return q(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==X&&e.nodeType==X?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var n=t._nsMap;if(n)for(var r in n)if(n[r]==e)return r;t=2==t.nodeType?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var n=t._nsMap;if(n&&e in n)return n[e];t=2==t.nodeType?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){var t=this.lookupPrefix(e);return null==t}},r(z,p),r(z,p.prototype),g.prototype={nodeName:"#document",nodeType:K,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==ee){for(var n=e.firstChild;n;){var r=n.nextSibling;this.insertBefore(n,t),n=r}return e}return null==this.documentElement&&1==e.nodeType&&(this.documentElement=e),_(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),x(this,e)},importNode:function(e,t){return M(this,e,t)},getElementById:function(e){var t=null;return v(this.documentElement,function(n){if(1==n.nodeType&&n.getAttribute("id")==e)return t=n,!0}),t},createElement:function(e){var t=new T;t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new a;var n=t.attributes=new l;return n._ownerElement=t,t},createDocumentFragment:function(){var e=new L;return e.ownerDocument=this,e.childNodes=new a,e},createTextNode:function(e){var t=new N;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new R;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new j;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var n=new D;return n.ownerDocument=this,n.tagName=n.target=e,n.nodeValue=n.data=t,n},createAttribute:function(e){var t=new S;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new A;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var n=new T,r=t.split(":"),i=n.attributes=new l;return n.childNodes=new a,n.ownerDocument=this,n.nodeName=t,n.tagName=t,n.namespaceURI=e,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,i._ownerElement=n,n},createAttributeNS:function(e,t){var n=new S,r=t.split(":");return n.ownerDocument=this,n.nodeName=t,n.name=t,n.namespaceURI=e,n.specified=!0,2==r.length?(n.prefix=r[0],n.localName=r[1]):n.localName=t,n}},i(g,p),T.prototype={nodeType:V,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var n=this.ownerDocument.createAttribute(e);n.value=n.nodeValue=""+t,this.setAttributeNode(n)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===ee?this.insertBefore(e,null):k(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);n&&this.removeAttributeNode(n)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var n=this.getAttributeNodeNS(e,t);return n&&n.value||""},setAttributeNS:function(e,t,n){var r=this.ownerDocument.createAttributeNS(e,t);r.value=r.nodeValue=""+n,this.setAttributeNode(r)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new s(this,function(t){var n=[];return v(t,function(r){r===t||r.nodeType!=V||"*"!==e&&r.tagName!=e||n.push(r)}),n})},getElementsByTagNameNS:function(e,t){return new s(this,function(n){var r=[];return v(n,function(i){i===n||i.nodeType!==V||"*"!==e&&i.namespaceURI!==e||"*"!==t&&i.localName!=t||r.push(i)}),r})}},g.prototype.getElementsByTagName=T.prototype.getElementsByTagName,g.prototype.getElementsByTagNameNS=T.prototype.getElementsByTagNameNS,i(T,p),S.prototype.nodeType=W,i(S,p),E.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(re[3])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,n){var r=this.data.substring(0,e),i=this.data.substring(e+t);n=r+n+i,this.nodeValue=this.data=n,this.length=n.length}},i(E,p),N.prototype={nodeName:"#text",nodeType:X,splitText:function(e){var t=this.data,n=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var r=this.ownerDocument.createTextNode(n);return this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling),r}},i(N,E),R.prototype={nodeName:"#comment",nodeType:Q},i(R,E),j.prototype={nodeName:"#cdata-section",nodeType:J},i(j,E),O.prototype.nodeType=Z,i(O,p),I.prototype.nodeType=te,i(I,p),C.prototype.nodeType=$,i(C,p),A.prototype.nodeType=G,i(A,p),L.prototype.nodeName="#document-fragment",L.prototype.nodeType=ee,i(L,p),D.prototype.nodeType=Y,i(D,p),P.prototype.serializeToString=function(e,t){return e.toString(t)},p.prototype.toString=function(e){var t=[];return U(this,t,e),t.join("")};try{Object.defineProperty&&(Object.defineProperty(s.prototype,"length",{get:function(){return u(this),this.$$length}}),Object.defineProperty(p.prototype,"textContent",{get:function(){return B(this)},set:function(e){switch(this.nodeType){case 1:case 11:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=value,this.nodeValue=e}}}),F=function(e,t,n){e["$$"+t]=n})}catch(e){}t.DOMImplementation=d,t.XMLSerializer=P},function(e,t){e.exports=XMLHttpRequest},function(e,t,n){"use strict";function r(e){return function(t){return new i(e+(t||""))}}var i=n(9);e.exports=r},function(e,t,n){"use strict";function r(e,t,n,r,p){function y(){p&&p(null,t)}function v(e){if("application/ld+json"!==r||"application/nquads"!==r||"application/n-quads"!==r){if(!p)throw new Error("Error trying to parse <"+n+"> as "+r+":\n"+e+":\n"+e.stack);p(e,t)}}function g(e,n){e&&p(e,t);try{k.parse(n,m)}catch(e){p(e,t)}}function m(e,n,r){if(e&&p(e,t),n)T.push(n);else{for(var i=0;i<T.length;i++)b(t,T[i]);p(null,t)}}function b(e,t){var n=w(t.subject),r=w(t.predicate),i=w(t.object),o=null;t.graph&&(o=w(t.graph)),e.add(n,r,i,o)}function w(e){var t;if(s.Util.isLiteral(e)){t=s.Util.getLiteralValue(e);var n=s.Util.getLiteralLanguage(e),r=new l(s.Util.getLiteralType(e));return new a(t,n,r)}return s.Util.isIRI(e)?new l(e):s.Util.isBlank(e)?(t=e.substring(2,e.length),new i(t)):null}try{if("text/n3"===r||"text/turtle"===r){var x=u(t,t,n,n,null,null,"",null);x.loadBuf(e),y()}else if("application/rdf+xml"===r){var _=new f(t);_.parse(d.parseXML(e),n,t.sym(n)),y()}else if("application/xhtml+xml"===r)c(d.parseXML(e,{contentType:"application/xhtml+xml"}),t,n),y();else if("text/html"===r)c(d.parseXML(e,{contentType:"text/html"}),t,n),y();else if("application/sparql-update"===r)h(e,t,n),y();else{if("application/ld+json"!==r&&"application/nquads"!==r&&"application/n-quads"!==r)throw new Error("Don't know how to parse "+r+" yet");var k=s.Parser(),T=[];if("application/ld+json"===r){var S;try{S=JSON.parse(e)}catch(e){p(e,null)}o.toRDF(S,{format:"application/nquads"},g)}else g(null,e)}}catch(e){v(e)}}e.exports=r;var i=n(4),o=n(16),a=n(8),s=n(22),u=n(62),l=n(9),c=n(71).parseRDFaDOM,f=n(72),h=n(73),d=n(64)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4),a=n(8),s=n(58),u=n(9),l=n(63),c=n(64);if("undefined"==typeof f)var f={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};var h=function(){function e(t,n){r(this,e),this.options=n||{},this.kb=t,this.target=n.target||{
graph:{subjects:{},prefixes:{},terms:{}}},this.blankNodes=[],this.htmlOptions={selfClosing:"br img input area base basefont col colgroup source wbr isindex link meta param hr"},this.theOne="_:"+(new Date).getTime(),this.language=null,this.vocabulary=null,this.blankCounter=0,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}],this.inXHTMLMode=!1,this.absURIRE=/[\w\_\-]+:\S+/,this.finishedHandlers=[],this.init()}return i(e,[{key:"addTriple",value:function(e,t,n,r){var i,o,a,u;i="undefined"==typeof t?s.namedNode(this.options.base):this.toRDFNodeObject(t),a=this.toRDFNodeObject(n),o=this.toRDFNodeObject(r),u=s.namedNode(this.options.base),this.kb.add(i,a,o,u)}},{key:"ancestorPath",value:function(e){for(var t="";e&&e.nodeType!==f.DOCUMENT_NODE;)t="/"+e.localName+t,e=e.parentNode;return t}},{key:"copyMappings",value:function(e){var t={};for(var n in e)t[n]=e[n];return t}},{key:"copyProperties",value:function(){}},{key:"deriveDateTimeType",value:function(t){for(var n=0;n<e.dateTimeTypes.length;n++){var r=e.dateTimeTypes[n].pattern.exec(t);if(r&&r[0].length===t.length)return e.dateTimeTypes[n].type}return null}},{key:"init",value:function(){}},{key:"newBlankNode",value:function(){return this.blankCounter++,"_:"+this.blankCounter}},{key:"newSubjectOrigin",value:function(e,t){}},{key:"parseCURIE",value:function(t,n,r){var i,o=t.indexOf(":");if(o>=0){var a=t.substring(0,o);if(""===a)return i=n[""],i?i+t.substring(o+1):null;if("_"===a)return"_:"+t.substring(o+1);if(e.NCNAME.test(a)&&(i=n[a]))return i+t.substring(o+1)}return null}},{key:"parseCURIEOrURI",value:function(e,t,n){var r=this.parseCURIE(e,t,n);return r?r:this.resolveAndNormalize(n,e)}},{key:"parsePredicate",value:function(e,t,n,r,i,o){if(""===e)return null;var a=this.parseTermOrCURIEOrAbsURI(e,t,o?null:n,r,i);return a&&0===a.indexOf("_:")?null:a}},{key:"parsePrefixMappings",value:function(e,t){for(var n=this.tokenize(e),r=null,i=0;i<n.length;i++)":"===n[i][n[i].length-1]?r=n[i].substring(0,n[i].length-1):r&&(t[r]=this.options.base?l.join(n[i],this.options.base):n[i],r=null)}},{key:"parseSafeCURIEOrCURIEOrURI",value:function(e,t,n){return e=this.trim(e),"["===e.charAt(0)&&"]"===e.charAt(e.length-1)?(e=e.substring(1,e.length-1),e=e.trim(e),0===e.length?null:"_:"===e?this.theOne:this.parseCURIE(e,t,n)):this.parseCURIEOrURI(e,t,n)}},{key:"parseTermOrCURIEOrAbsURI",value:function(e,t,n,r,i){e=this.trim(e);var o=this.parseCURIE(e,r,i);if(o)return o;if(n){if(t&&!this.absURIRE.exec(e))return t+e;var a=n[e];if(a)return a;var s=e.toLowerCase();if(a=n[s])return a}return this.absURIRE.exec(e)?this.resolveAndNormalize(i,e):null}},{key:"parseTermOrCURIEOrURI",value:function(e,t,n,r,i){e=this.trim(e);var o=this.parseCURIE(e,r,i);if(o)return o;var a=n[e];if(a)return a;var s=e.toLowerCase();return(a=n[s])?a:t&&!this.absURIRE.exec(e)?t+e:this.resolveAndNormalize(i,e)}},{key:"parseURI",value:function(e){return e}},{key:"process",value:function(t,n){var r;t.nodeType===f.DOCUMENT_NODE?(r=t.baseURI,t=t.documentElement,t.baseURI=r,this.setContext(t)):t.parentNode.nodeType===f.DOCUMENT_NODE&&this.setContext(t);var i=[],o=function(e){if(!e&&n&&n.baseURI)return n.baseURI;var t=e.indexOf("#");return t>=0&&(e=e.substring(0,t)),n&&n.baseURIMap&&(e=n.baseURIMap(e)),e};for(i.push({current:t,context:this.push(null,o(t.baseURI))});i.length>0;){var a=i.shift();if(a.parent){if(a.context.parent&&a.context.parent.listMapping===a.listMapping)continue;for(var s in a.listMapping){var u=a.listMapping[s];if(0!==u.length){for(var c=[],h=0;h<u.length;h++)c.push(this.newBlankNode());for(var d=0;d<c.length;d++)this.addTriple(a.parent,c[d],"http://www.w3.org/1999/02/22-rdf-syntax-ns#first",u[d]),this.addTriple(a.parent,c[d],"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest",{type:e.objectURI,value:d+1<c.length?c[d+1]:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"});this.addTriple(a.parent,a.subject,s,{type:e.objectURI,value:c[0]})}else this.addTriple(a.parent,a.subject,s,{type:e.objectURI,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"})}}else{var p=a.current,y=a.context,v=!1,g=null,m=null,b=null,w=y.prefixes,x=!1,_=[],k=y.listMapping,T=!y.parent,S=y.language,E=y.vocabulary;r=this.parseURI(o(p.baseURI)),p.item=null;var N=p.getAttributeNode("vocab");if(N){var R=this.trim(N.value);if(R.length>0){E=R;var j=r.spec;this.addTriple(p,j,"http://www.w3.org/ns/rdfa#usesVocabulary",{type:e.objectURI,value:E})}else E=this.vocabulary}for(var O=0;O<p.attributes.length;O++){var I=p.attributes[O];if("x"===I.nodeName.charAt(0)&&0===I.nodeName.indexOf("xmlns:")){x||(w=this.copyMappings(w),x=!0);var C=I.nodeName.substring(6),A=e.trim(I.value);w[C]=this.options.base?l.join(A,this.options.base):A}}var L=p.getAttributeNode("prefix");L&&(x||(w=this.copyMappings(w),x=!0),this.parsePrefixMappings(L.value,w));for(var D=null,P=0;!D&&P<this.langAttributes.length;P++)D=p.getAttributeNodeNS(this.langAttributes[P].namespaceURI,this.langAttributes[P].localName);if(D){var U=e.trim(D.value);S=U.length>0?U:null}var M,q,F=p.getAttributeNode("rel"),B=p.getAttributeNode("rev"),H=p.getAttributeNode("typeof"),z=p.getAttributeNode("property"),V=p.getAttributeNode("datatype"),W=this.inHTMLMode?p.getAttributeNode("datetime"):null,X=p.getAttributeNode("content"),J=p.getAttributeNode("about"),G=p.getAttributeNode("src"),$=p.getAttributeNode("resource"),Y=p.getAttributeNode("href"),Q=p.getAttributeNode("inlist"),K=[];if(F){q=this.tokenize(F.value);for(var Z=0;Z<q.length;Z++)M=this.parsePredicate(q[Z],E,y.terms,w,r,this.inHTMLMode&&null!==z),M&&K.push(M)}var ee=[];if(B){q=this.tokenize(B.value);for(var te=0;te<q.length;te++)M=this.parsePredicate(q[te],E,y.terms,w,r,this.inHTMLMode&&z),M&&ee.push(M)}if(this.inHTMLMode&&(F||B)&&z&&(0===K.length&&(F=null),0===ee.length&&(B=null)),F||B?(J&&(g=this.parseSafeCURIEOrCURIEOrURI(J.value,w,r)),H&&(b=g),g||(p.parentNode.nodeType===f.DOCUMENT_NODE?g=o(p.baseURI):y.parentObject&&(g=o(p.parentNode.baseURI)===y.parentObject?o(p.baseURI):y.parentObject)),$&&(m=this.parseSafeCURIEOrCURIEOrURI($.value,w,r)),m||(Y?m=this.resolveAndNormalize(r,encodeURI(Y.value)):G?m=this.resolveAndNormalize(r,encodeURI(G.value)):!H||J||this.inXHTMLMode&&("head"===p.localName||"body"===p.localName)||(m=this.newBlankNode())),!H||J||!this.inXHTMLMode||"head"!==p.localName&&"body"!==p.localName?H&&!J&&(b=m):b=g):!z||X||V?(J&&(g=this.parseSafeCURIEOrCURIEOrURI(J.value,w,r)),!g&&$&&(g=this.parseSafeCURIEOrCURIEOrURI($.value,w,r)),!g&&Y&&(g=this.resolveAndNormalize(r,encodeURI(Y.value))),!g&&G&&(g=this.resolveAndNormalize(r,encodeURI(G.value))),g||(p.parentNode.nodeType===f.DOCUMENT_NODE?g=o(p.baseURI):!this.inXHTMLMode&&!this.inHTMLMode||"head"!==p.localName&&"body"!==p.localName?H?g=this.newBlankNode():y.parentObject&&(g=o(p.parentNode.baseURI)===y.parentObject?o(p.baseURI):y.parentObject,z||(v=!0)):g=o(p.parentNode.baseURI)===y.parentObject?o(p.baseURI):y.parentObject),H&&(b=g)):(J&&(g=this.parseSafeCURIEOrCURIEOrURI(J.value,w,r),H&&(b=g)),g||p.parentNode.nodeType!==f.DOCUMENT_NODE?!g&&y.parentObject&&(g=o(p.parentNode.baseURI)===y.parentObject?o(p.baseURI):y.parentObject):(g=o(p.baseURI),H&&(b=g)),H&&!b&&($&&(b=this.parseSafeCURIEOrCURIEOrURI($.value,w,r)),!b&&Y&&(b=this.resolveAndNormalize(r,encodeURI(Y.value))),!b&&G&&(b=this.resolveAndNormalize(r,encodeURI(G.value))),b||!this.inXHTMLMode&&!this.inHTMLMode||"head"!==p.localName&&"body"!==p.localName||(b=g),b||(b=this.newBlankNode()),m=b)),g&&(J||$||b)){var ne=g;H&&!J&&!$&&m&&(ne=m),this.newSubjectOrigin(p,ne)}if(b){q=this.tokenize(H.value);for(var re=0;re<q.length;re++){var ie=this.parseTermOrCURIEOrAbsURI(q[re],E,y.terms,w,r);ie&&this.addTriple(p,b,e.typeURI,{type:e.objectURI,value:ie})}}if(g&&g!==y.parentObject&&(k={},T=!0),m){if(F&&Q)for(var oe=0;oe<K.length;oe++){var ae=k[K[oe]];ae||(ae=[],k[K[oe]]=ae),ae.push({type:e.objectURI,value:m})}else if(F)for(var se=0;se<K.length;se++)this.addTriple(p,g,K[se],{type:e.objectURI,value:m});if(B)for(var ue=0;ue<ee.length;ue++)this.addTriple(p,m,ee[ue],{type:e.objectURI,value:g})}else{if(g&&!m&&(F||B)&&(m=this.newBlankNode()),F&&Q)for(var le=0;le<K.length;le++){var ce=k[K[le]];ce||(ce=[],k[M]=ce),_.push({predicate:K[le],list:ce})}else if(F)for(var fe=0;fe<K.length;fe++)_.push({predicate:K[fe],forward:!0});if(B)for(var he=0;he<ee.length;he++)_.push({predicate:ee[he],forward:!1})}if(z){var de=null,pe=null;V?(de=""===V.value?e.PlainLiteralURI:this.parseTermOrCURIEOrAbsURI(V.value,E,y.terms,w,r),pe=W&&!X?W.value:de===e.XMLLiteralURI||de===e.HTMLLiteralURI?null:X?X.value:p.textContent):X?(de=e.PlainLiteralURI,pe=X.value):W?(pe=W.value,de=e.deriveDateTimeType(pe),de||(de=e.PlainLiteralURI)):F||B||($&&(pe=this.parseSafeCURIEOrCURIEOrURI($.value,w,r)),!pe&&Y?pe=this.resolveAndNormalize(r,encodeURI(Y.value)):!pe&&G&&(pe=this.resolveAndNormalize(r,encodeURI(G.value))),pe&&(de=e.objectURI)),de||(H&&!J?(de=e.objectURI,pe=b):(pe=p.textContent,this.inHTMLMode&&"time"===p.localName&&(de=e.deriveDateTimeType(pe)),de||(de=e.PlainLiteralURI))),q=this.tokenize(z.value);for(var ye=0;ye<q.length;ye++){var ve=this.parsePredicate(q[ye],E,y.terms,w,r);if(ve)if(Q){var ge=k[ve];ge||(ge=[],k[ve]=ge),ge.push(de===e.XMLLiteralURI||de===e.HTMLLiteralURI?{type:de,value:p.childNodes}:{type:de?de:e.PlainLiteralURI,value:pe,language:S})}else de===e.XMLLiteralURI||de===e.HTMLLiteralURI?this.addTriple(p,g,ve,{type:de,value:p.childNodes}):this.addTriple(p,g,ve,{type:de?de:e.PlainLiteralURI,value:pe,language:S})}}if(g&&!v)for(var me=0;me<y.incomplete.length;me++)y.incomplete[me].list?y.incomplete[me].list.push({type:e.objectURI,value:g}):y.incomplete[me].forward?this.addTriple(p,y.subject,y.incomplete[me].predicate,{type:e.objectURI,value:g}):this.addTriple(p,g,y.incomplete[me].predicate,{type:e.objectURI,value:y.subject});var be=null,we=g;v?(be=this.push(y,y.subject),be.parentObject=o(p.parentNode.baseURI)===y.parentObject?o(p.baseURI):y.parentObject,be.incomplete=y.incomplete,be.language=S,be.prefixes=w,be.vocabulary=E):(be=this.push(y,g),be.parentObject=m?m:g?g:y.subject,be.prefixes=w,be.incomplete=_,m&&(we=m,k={},T=!0),be.listMapping=k,be.language=S,be.vocabulary=E),T&&i.unshift({parent:p,context:y,subject:we,listMapping:k});for(var xe=p.lastChild;xe;xe=xe.previousSibling)xe.nodeType===f.ELEMENT_NODE&&(xe.baseURI=p.baseURI,i.unshift({current:xe,context:be}))}}this.inHTMLMode&&this.copyProperties();for(var _e=0;_e<this.finishedHandlers.length;_e++)this.finishedHandlers[_e](t)}},{key:"push",value:function(e,t){return{parent:e,subject:t?t:e?e.subject:null,parentObject:null,incomplete:[],listMapping:e?e.listMapping:{},language:e?e.language:this.language,prefixes:e?e.prefixes:this.target.graph.prefixes,terms:e?e.terms:this.target.graph.terms,vocabulary:e?e.vocabulary:this.vocabulary}}},{key:"resolveAndNormalize",value:function(e,t){return l.join(t,e)}},{key:"setContext",value:function(e){"html"===e.localName&&"XHTML+RDFa 1.1"===e.getAttribute("version")?this.setXHTMLContext():"html"===e.localName||"http://www.w3.org/1999/xhtml"===e.namespaceURI?"undefined"!=typeof document&&document.doctype?"-//W3C//DTD XHTML+RDFa 1.0//EN"===document.doctype.publicId&&"http://www.w3.org/MarkUp/DTD/xhtml-rdfa-1.dtd"===document.doctype.systemId?(console.log("WARNING: RDF 1.0 is not supported.  Defaulting to HTML5 mode."),this.setHTMLContext()):"-//W3C//DTD XHTML+RDFa 1.1//EN"===document.doctype.publicId&&"http://www.w3.org/MarkUp/DTD/xhtml-rdfa-2.dtd"===document.doctype.systemId?this.setXHTMLContext():this.setHTMLContext():this.setHTMLContext():this.setXMLContext()}},{key:"setHTMLContext",value:function(){this.setInitialContext(),this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"},{namespaceURI:null,localName:"lang"}],this.inXHTMLMode=!1,this.inHTMLMode=!0}},{key:"setInitialContext",value:function(){this.vocabulary=null,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"}]}},{key:"setXHTMLContext",value:function(){this.setInitialContext(),this.inXHTMLMode=!0,this.inHTMLMode=!1,this.langAttributes=[{namespaceURI:"http://www.w3.org/XML/1998/namespace",localName:"lang"},{namespaceURI:null,localName:"lang"}],this.target.graph.terms.alternate="http://www.w3.org/1999/xhtml/vocab#alternate",this.target.graph.terms.appendix="http://www.w3.org/1999/xhtml/vocab#appendix",this.target.graph.terms.bookmark="http://www.w3.org/1999/xhtml/vocab#bookmark",this.target.graph.terms.cite="http://www.w3.org/1999/xhtml/vocab#cite",this.target.graph.terms.chapter="http://www.w3.org/1999/xhtml/vocab#chapter",this.target.graph.terms.contents="http://www.w3.org/1999/xhtml/vocab#contents",this.target.graph.terms.copyright="http://www.w3.org/1999/xhtml/vocab#copyright",this.target.graph.terms.first="http://www.w3.org/1999/xhtml/vocab#first",this.target.graph.terms.glossary="http://www.w3.org/1999/xhtml/vocab#glossary",this.target.graph.terms.help="http://www.w3.org/1999/xhtml/vocab#help",this.target.graph.terms.icon="http://www.w3.org/1999/xhtml/vocab#icon",this.target.graph.terms.index="http://www.w3.org/1999/xhtml/vocab#index",this.target.graph.terms.last="http://www.w3.org/1999/xhtml/vocab#last",this.target.graph.terms.license="http://www.w3.org/1999/xhtml/vocab#license",this.target.graph.terms.meta="http://www.w3.org/1999/xhtml/vocab#meta",this.target.graph.terms.next="http://www.w3.org/1999/xhtml/vocab#next",this.target.graph.terms.prev="http://www.w3.org/1999/xhtml/vocab#prev",this.target.graph.terms.previous="http://www.w3.org/1999/xhtml/vocab#previous",this.target.graph.terms.section="http://www.w3.org/1999/xhtml/vocab#section",this.target.graph.terms.stylesheet="http://www.w3.org/1999/xhtml/vocab#stylesheet",this.target.graph.terms.subsection="http://www.w3.org/1999/xhtml/vocab#subsection",this.target.graph.terms.start="http://www.w3.org/1999/xhtml/vocab#start",this.target.graph.terms.top="http://www.w3.org/1999/xhtml/vocab#top",this.target.graph.terms.up="http://www.w3.org/1999/xhtml/vocab#up",this.target.graph.terms.p3pv1="http://www.w3.org/1999/xhtml/vocab#p3pv1",this.target.graph.terms.related="http://www.w3.org/1999/xhtml/vocab#related",this.target.graph.terms.role="http://www.w3.org/1999/xhtml/vocab#role",this.target.graph.terms.transformation="http://www.w3.org/1999/xhtml/vocab#transformation"}},{key:"setXMLContext",value:function(){this.setInitialContext(),this.inXHTMLMode=!1,this.inHTMLMode=!1}},{key:"tokenize",value:function(e){return this.trim(e).split(/\s+/)}},{key:"toRDFNodeObject",value:function(t){if("undefined"!=typeof t){if("string"==typeof t)return"_:"===t.substring(0,2)?("undefined"==typeof this.blankNodes[t.substring(2)]&&(this.blankNodes[t.substring(2)]=new o(t.substring(2))),this.blankNodes[t.substring(2)]):s.namedNode(t);switch(t.type){case e.objectURI:return"_:"===t.value.substring(0,2)?("undefined"==typeof this.blankNodes[t.value.substring(2)]&&(this.blankNodes[t.value.substring(2)]=new o(t.value.substring(2))),this.blankNodes[t.value.substring(2)]):s.namedNode(t.value);case e.PlainLiteralURI:return new a(t.value,t.language||"");case e.XMLLiteralURI:case e.HTMLLiteralURI:var n="";return Object.keys(t.value).forEach(function(e){n+=c.domToString(t.value[e],this.htmlOptions)}),new a(n,"",new u(t.type));default:return new a(t.value,"",new u(t.type))}}}},{key:"trim",value:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}],[{key:"parseRDFaDOM",value:function(t,n,r){var i=new e(n,{base:r});t.baseURI=r,i.process(t)}}]),e}();h.XMLLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral",h.HTMLLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#HTML",h.PlainLiteralURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral",h.objectURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#object",h.typeURI="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",h.nameChar="[-A-Z_a-z-----------0-F.0-9--]",h.nameStartChar="[A-Za-z------------------------------------------------------------------------------------------------------------------------------------------------------_]",h.NCNAME=new RegExp("^"+h.nameStartChar+h.nameChar+"*$"),h.dateTimeTypes=[{pattern:/-?P(?:[0-9]+Y)?(?:[0-9]+M)?(?:[0-9]+D)?(?:T(?:[0-9]+H)?(?:[0-9]+M)?(?:[0-9]+(?:\.[0-9]+)?S)?)?/,type:"http://www.w3.org/2001/XMLSchema#duration"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]-[0-9][0-9]T(?:[0-1][0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9](?:\.[0-9]+)?(?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#dateTime"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]-[0-9][0-9](?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#date"},{pattern:/(?:[0-1][0-9]|2[0-4]):[0-5][0-9]:[0-5][0-9](?:\.[0-9]+)?(?:Z|[+\-][0-9][0-9]:[0-9][0-9])?/,type:"http://www.w3.org/2001/XMLSchema#time"},{pattern:/-?(?:[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9])-[0-9][0-9]/,type:"http://www.w3.org/2001/XMLSchema#gYearMonth"},{pattern:/-?[1-9][0-9][0-9][0-9]|0[1-9][0-9][0-9]|00[1-9][0-9]|000[1-9]/,type:"http://www.w3.org/2001/XMLSchema#gYear"}],e.exports=h},function(e,t,n){"use strict";var r=n(63),i=function e(t){var e={};e.ns={RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFS:"http://www.w3.org/2000/01/rdf-schema#"},e.nodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},this.frameFactory=function(t,n,i){return{NODE:1,ARC:2,parent:n,parser:t,store:t.store,element:i,lastChild:0,base:null,lang:null,node:null,nodeType:null,listIndex:1,rdfid:null,datatype:null,collection:!1,terminateFrame:function(){this.collection&&this.node.close()},addSymbol:function(e,t){t=r.join(t,this.base),this.node=this.store.sym(t),this.nodeType=e},loadTriple:function(){if(this.parent.parent.collection?this.parent.parent.node.append(this.node):this.store.add(this.parent.parent.node,this.parent.node,this.node,this.parser.why),null!=this.parent.rdfid){var t=this.store.sym(r.join("#"+this.parent.rdfid,this.base));this.store.add(t,this.store.sym(e.ns.RDF+"type"),this.store.sym(e.ns.RDF+"Statement"),this.parser.why),this.store.add(t,this.store.sym(e.ns.RDF+"subject"),this.parent.parent.node,this.parser.why),this.store.add(t,this.store.sym(e.ns.RDF+"predicate"),this.parent.node,this.parser.why),this.store.add(t,this.store.sym(e.ns.RDF+"object"),this.node,this.parser.why)}},isTripleToLoad:function(){return null!=this.parent&&null!=this.parent.parent&&this.nodeType===this.NODE&&this.parent.nodeType===this.ARC&&this.parent.parent.nodeType===this.NODE},addNode:function(e){this.addSymbol(this.NODE,e),this.isTripleToLoad()&&this.loadTriple()},addCollection:function(){this.nodeType=this.NODE,this.node=this.store.collection(),this.collection=!0,this.isTripleToLoad()&&this.loadTriple()},addCollectionArc:function(){this.nodeType=this.ARC},addBNode:function(e){null!=e?null!=this.parser.bnodes[e]?this.node=this.parser.bnodes[e]:this.node=this.parser.bnodes[e]=this.store.bnode():this.node=this.store.bnode(),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()},addArc:function(t){t===e.ns.RDF+"li"&&(t=e.ns.RDF+"_"+this.parent.listIndex,this.parent.listIndex++),this.addSymbol(this.ARC,t)},addLiteral:function(e){this.parent.datatype?this.node=this.store.literal(e,"",this.store.sym(this.parent.datatype)):this.node=this.store.literal(e,this.lang),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()}}},this.getAttributeNodeNS=function(e,t,n){var r=null;if(e.getAttributeNodeNS)r=e.getAttributeNodeNS(t,n);else for(var i,o,a=e.attributes,s=0;s<a.length;++s)if(i=a[s],i.namespaceURI===t&&(o=i.prefix?i.prefix+":"+n:n,o===i.nodeName)){r=i;break}return r},this.store=t,this.bnodes={},this.why=null,this.reify=!1,this.parse=function(t,n,r){var i=t.childNodes;this.cleanParser();var o;if(t.nodeType===e.nodeType.DOCUMENT){for(var a=0;a<i.length;a++)if(i[a].nodeType===e.nodeType.ELEMENT){o=i[a];break}}else{if(t.nodeType!==e.nodeType.ELEMENT)throw new Error("RDFParser: can't find root in "+n+". Halting. ");o=t}this.why=r;var s=this.frameFactory(this);return this.base=n,s.base=n,s.lang=null,this.parseDOM(this.buildFrame(s,o)),!0},this.parseDOM=function(t){for(var n,i=function(e){var t="";if(null==e.namespaceURI)throw new Error("RDF/XML syntax error: No namespace for "+e.localName+" in "+this.base);return e.namespaceURI&&(t+=e.namespaceURI),e.localName?t+=e.localName:e.nodeName&&(t+=e.nodeName.indexOf(":")>=0?e.nodeName.split(":")[1]:e.nodeName),t}.bind(this),o=!0;t.parent;){var a=t.element,s=a.attributes;if(a.nodeType===e.nodeType.TEXT||a.nodeType===e.nodeType.CDATA_SECTION)t.parent.nodeType===t.NODE&&(t.addArc(e.ns.RDF+"value"),t=this.buildFrame(t)),t.addLiteral(a.nodeValue);else if(i(a)!==e.ns.RDF+"RDF")if(t.parent&&t.parent.collection&&(t.addCollectionArc(),t=this.buildFrame(t,t.element),t.parent.element=null),t.parent&&t.parent.nodeType&&t.parent.nodeType!==t.ARC){t.addArc(i(a)),this.reify&&(n=this.getAttributeNodeNS(a,e.ns.RDF,"ID"),n&&(t.rdfid=n.nodeValue,a.removeAttributeNode(n)));var u=this.getAttributeNodeNS(a,e.ns.RDF,"parseType"),l=this.getAttributeNodeNS(a,e.ns.RDF,"datatype");if(l&&(t.datatype=l.nodeValue,a.removeAttributeNode(l)),u){var c=u.nodeValue;"Literal"===c?(t.datatype=e.ns.RDF+"XMLLiteral",t=this.buildFrame(t),t.addLiteral(a),o=!1):"Resource"===c?(t=this.buildFrame(t,t.element),t.parent.element=null,t.addBNode()):"Collection"===c&&(t=this.buildFrame(t,t.element),t.parent.element=null,t.addCollection()),a.removeAttributeNode(u)}if(0!==s.length){var f=this.getAttributeNodeNS(a,e.ns.RDF,"resource"),h=this.getAttributeNodeNS(a,e.ns.RDF,"nodeID");t=this.buildFrame(t),f?(t.addNode(f.nodeValue),a.removeAttributeNode(f)):h?(t.addBNode(h.nodeValue),a.removeAttributeNode(h)):t.addBNode();for(var d=s.length-1;d>=0;d--){var p=this.buildFrame(t);p.addArc(i(s[d])),i(s[d])===e.ns.RDF+"type"?this.buildFrame(p).addNode(s[d].nodeValue):this.buildFrame(p).addLiteral(s[d].nodeValue)}}else 0===a.childNodes.length&&this.buildFrame(t).addLiteral("")}else{var y=this.getAttributeNodeNS(a,e.ns.RDF,"about");if(n=this.getAttributeNodeNS(a,e.ns.RDF,"ID"),y&&n)throw new Error("RDFParser: "+a.nodeName+" has both rdf:id and rdf:about. Halting. Only one of these properties may be specified on a node.");if(!y&&n)t.addNode("#"+n.nodeValue),a.removeAttributeNode(n);else if(null==y&&null==n){var v=this.getAttributeNodeNS(a,e.ns.RDF,"nodeID");v?(t.addBNode(v.nodeValue),a.removeAttributeNode(v)):t.addBNode()}else t.addNode(y.nodeValue),a.removeAttributeNode(y);var g=this.getAttributeNodeNS(a,e.ns.RDF,"type");e.ns.RDF+"Description"!==i(a)&&(g={nodeValue:i(a)}),null!=g&&(this.store.add(t.node,this.store.sym(e.ns.RDF+"type"),this.store.sym(r.join(g.nodeValue,t.base)),this.why),g.nodeName&&a.removeAttributeNode(g));for(var m=s.length-1;m>=0;m--)this.store.add(t.node,this.store.sym(i(s[m])),this.store.literal(s[m].nodeValue,t.lang),this.why)}for(a=t.element;t.parent;){for(var b=t;null==a;)t=t.parent,a=t.element;var w=a.childNodes&&a.childNodes[t.lastChild];if(w&&o){if((w.nodeType===e.nodeType.ELEMENT||w.nodeType===e.nodeType.TEXT||w.nodeType===e.nodeType.CDATA_SECTION)&&(w.nodeType!==e.nodeType.TEXT&&w.nodeType!==e.nodeType.CDATA_SECTION||1===a.childNodes.length)){t.lastChild++,t=this.buildFrame(b,a.childNodes[t.lastChild-1]);break}t.lastChild++}else{if(t.terminateFrame(),!(t=t.parent))break;a=t.element,o=!0}}}},this.cleanParser=function(){this.bnodes={},this.why=null},this.buildFrame=function(t,n){var i=this.frameFactory(this,t,n);if(t&&(i.base=t.base,i.lang=t.lang),!n||n.nodeType===e.nodeType.TEXT||n.nodeType===e.nodeType.CDATA_SECTION)return i;var o=n.attributes,a=n.getAttributeNode("xml:base");null!=a&&(i.base=a.nodeValue,n.removeAttribute("xml:base"));var s=n.getAttributeNode("xml:lang");null!=s&&(i.lang=s.nodeValue,n.removeAttribute("xml:lang"));for(var u=o.length-1;u>=0;u--)if("xml"===o[u].nodeName.substr(0,3)){if("xmlns:"===o[u].name.slice(0,6)){var l=o[u].nodeValue;this.base&&(l=r.join(l,this.base)),this.store.setPrefixForURI(o[u].name.slice(6),l)}n.removeAttributeNode(o[u])}return i}};e.exports=i},function(e,t,n){"use strict";function r(e,t,n){var r,a,s,u=["INSERT","DELETE","WHERE"],l=o("http://www.w3.org/ns/pim/patch#"),c=i(t,t,n,n,null,null,"",null),f={},h=function(e,t,n,r,i){return"Line "+(t+1)+" of <"+e+">: Bad syntax:\n   "+i+'\n   at: "'+n.slice(r,r+30)+'"'};r=0;var d=t.sym(n+"#query");for(f.query=d;;){if(a=c.skipSpace(e,r),a<0)return f;if(";"===e[a]){if(r=c.skipSpace(e,a+1),r<0)return f;a=r}var p=!1;for(s=0;s<u.length;s++){var y=u[s];if(e.slice(a,a+y.length)===y){if(r=c.skipSpace(e,a+y.length),r<0)throw h(c._thisDoc,c.lines,e,a+y.length,"found EOF, needed {...} after "+y);if(("INSERT"===y||"DELETE"===y)&&"DATA"===e.slice(r,r+4)){if(a=c.skipSpace(e,r+4),a<0)throw h(c._thisDoc,c.lines,e,r+4,"needed {...} after INSERT DATA "+y);r=a}var v=[];if(a=c.node(e,r,v),a<0)throw h(c._thisDoc,c.lines,e,r,"bad syntax or EOF in {...} after "+y);f[y.toLowerCase()]=v[0],t.add(d,l(y.toLowerCase()),v[0]),p=!0,r=a}}if(!p&&"@prefix"===e.slice(a,a+7)){if(r=c.directive(e,a),r<0)throw h(c._thisDoc,c.lines,e,r,"bad syntax or EOF after @prefix ");r=c.checkDot(e,r),p=!0}if(!p)throw h(c._thisDoc,c.lines,e,a,"Unknown syntax at start of statememt: '"+e.slice(a).slice(0,20)+"'")}}e.exports=r;var i=n(62),o=n(69)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":l(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":l(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,n,r){var i=e.any(t,n,void 0);return!!i&&(e.equate(i,r),!0)}function s(e,t,n,r){var i=e.any(void 0,n,r);return!!i&&(e.equate(i,t),!0)}function u(e,t,n,r,i){e.typeCallback&&e.typeCallback(e,r,i);var o=e.classActions[r.hashString()],a=!1;if(o)for(var s=0;s<o.length;s++)a=a||o[s](e,t,n,r,i);return a}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(64).ArrayIndexOf,h=n(75),d=n(64).RDFArrayRemove,p=n(78),y=n(6),v=n(79),g="http://www.w3.org/2002/07/owl#",m=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.statements=[],n.optional=[],n.propertyActions=[],n.classActions=[],n.redirections=[],n.aliases=[],n.HTTPRedirects=[],n.subjectIndex=[],n.predicateIndex=[],n.objectIndex=[],n.whyIndex=[],n.index=[n.subjectIndex,n.predicateIndex,n.objectIndex,n.whyIndex],n.namespaces={},n.features=e||["sameAs","InverseFunctionalProperty","FunctionalProperty"],n.initPropertyActions(n.features),n}return o(t,e),c(t,[{key:"applyPatch",value:function(e,t,r){var i,o=n(80),a=this,s=function(n){if(e.delete){i=e.delete,u&&(i=i.substitute(u)),i=i.statements;var o=[],s=i.map(function(e){var n=a.statementsMatching(e.subject,e.predicate,e.object,t);return 0===n.length?(o.push(e),null):n[0]});if(o.length)return r("Couldn't find to delete: "+o[0]);s.map(function(e){a.remove(e)})}e.insert&&(i=e.insert,u&&(i=i.substitute(u)),i=i.statements,i.map(function(e){e.why=t,a.add(e.subject,e.predicate,e.object,e.why)})),n()},u=null;if(e.where){var l=new o("patch");l.pat=e.where,l.pat.statements.map(function(e){e.why=t});var c=[];a.query(l,function(e){c.push(e)},a.fetcher,function(){return 0===c.length?r("No match found to be patched:"+e.where):c.length>1?r("Patch ambiguous. No patch done."):(u=c[0],void s(r))})}else s(r)}},{key:"declareExistential",value:function(e){return this._existentialVariables||(this._existentialVariables=[]),this._existentialVariables.push(e),e}},{key:"initPropertyActions",value:function(e){this.propertyActions["<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>"]=[u],f(e,"sameAs")>=0&&(this.propertyActions["<http://www.w3.org/2002/07/owl#sameAs>"]=[function(e,t,n,r,i){return e.equate(t,r),!0}]),f(e,"InverseFunctionalProperty")>=0&&(this.classActions["<"+g+"InverseFunctionalProperty>"]=[function(e,t,n,r,i){return e.newPropertyAction(t,s)}]),f(e,"FunctionalProperty")>=0&&(this.classActions["<"+g+"FunctionalProperty>"]=[function(e,t,n,r,i){return e.newPropertyAction(t,a)}])}},{key:"add",value:function(e,n,r,i){var o;if(1===arguments.length){if(e instanceof Array)for(o=0;o<e.length;o++)this.add(e[o]);else e instanceof p?this.add(e.subject,e.predicate,e.object,e.why):e instanceof t&&this.add(e.statements);return this}var a,s;i||(i=this.fetcher?this.fetcher.appNode:this.sym("chrome:theSession")),e=y.fromValue(e),n=y.fromValue(n),r=y.fromValue(r),i=y.fromValue(i),this.predicateCallback&&this.predicateCallback(this,n,i);var u=this.canon(n).hashString();a=this.propertyActions[u];var l=!1;if(a)for(o=0;o<a.length;o++)l=l||a[o](this,e,n,r,i);if(this.holds(e,n,r,i))return console.log("rdflib: Ignoring dup! {"+e+" "+n+" "+r+" "+i+"}"),null;var c=[this.canon(e).hashString(),u,this.canon(r).hashString(),this.canon(i).hashString()];for(s=new p(e,n,r,i),o=0;o<4;o++){var f=this.index[o],h=c[o];f[h]||(f[h]=[]),f[h].push(s)}return this.statements.push(s),s}},{key:"addAll",value:function(e){var t=this;e.forEach(function(e){t.add(e.subject,e.predicate,e.object,e.graph)})}},{key:"any",value:function(e,t,n,r){var i=this.anyStatementMatching(e,t,n,r);if(null!=i)return null==e?i.subject:null==t?i.predicate:null==n?i.object:void 0}},{key:"anyValue",value:function(e,t,n,r){var i=this.any(e,t,n,r);return i?i.value:void 0}},{key:"anyStatementMatching",value:function(e,t,n,r){var i=this.statementsMatching(e,t,n,r,!0);if(i&&0!==i.length)return i[0]}},{key:"canon",value:function(e){if(!e)return e;var t=this.redirections[e.hashString()];return t?t:e}},{key:"check",value:function(){this.checkStatementList(this.statements);for(var e=0;e<4;e++){var t=this.index[e];for(var n in t)t.hasOwnProperty(n)&&this.checkStatementList(t[n],e)}}},{key:"checkStatementList",value:function(e,t){for(var n,r=["subject","predicate","object","why"],i=" found in "+r[t]+" index.",o=0;o<e.length;o++){n=e[o];for(var a=[n.subject,n.predicate,n.object,n.why],s=function(e,t){for(var n=0;n<e.length;n++)if(e[n].subject.sameTerm(t.subject)&&e[n].predicate.sameTerm(t.predicate)&&e[n].object.sameTerm(t.object)&&e[n].why.sameTerm(t.why))return!0},u=0;u<4;u++){var l=this.canon(a[u]),c=l.hashString();this.index[u][c]&&!s(this.index[u][c],n)}if(!s(this.statements,n))throw new Error("Statement list does not statement "+n+"@"+n.why+i)}}},{key:"close",value:function(){return this}},{key:"copyTo",value:function(e,t,n){n||(n=[]);var r=this.statementsMatching(e);f(n,"two-direction")!==-1&&r.concat(this.statementsMatching(void 0,void 0,e));for(var i=0;i<r.length;i++){var o=r[i];switch(o.object.termType){case"NamedNode":this.add(t,o.predicate,o.object);break;case"Literal":case"BlankNode":case"collection":this.add(t,o.predicate,o.object.copy(this))}f(n,"delete")!==-1&&this.remove(o)}}},{key:"equate",value:function(e,t){e=this.canon(e),t=this.canon(t);
var n=e.compareTerm(t);return!n||(n<0?this.replaceWith(t,e):this.replaceWith(e,t))}},{key:"formula",value:function(e){return new t(e)}},{key:"match",value:function(e,t,n,r){return this.statementsMatching(y.fromValue(e),y.fromValue(t),y.fromValue(n),y.fromValue(r))}},{key:"mentionsURI",value:function(e){var t="<"+e+">";return!!this.subjectIndex[t]||!!this.objectIndex[t]||!!this.predicateIndex[t]}},{key:"newExistential",value:function(e){if(!e)return this.bnode();var t=this.sym(e);return this.declareExistential(t)}},{key:"newPropertyAction",value:function(e,t){var n=e.hashString();this.propertyActions[n]||(this.propertyActions[n]=[]),this.propertyActions[n].push(t);for(var r=this.statementsMatching(void 0,e,void 0),i=!1,o=0;o<r.length;o++)i=i||t(this,r[o].subject,e,r[o].object);return i}},{key:"newUniversal",value:function(e){var t=this.sym(e);return this._universalVariables||(this._universalVariables=[]),this._universalVariables.push(t),t}},{key:"variable",value:function(e){return new v(e)}},{key:"nextSymbol",value:function(e){for(var t=0;;t++){var n=e.uri+"#n"+t;if(!this.mentionsURI(n))return this.sym(n)}}},{key:"query",value:function(e,t,r,i){var o=n(80).indexedFormulaQuery;return o.call(this,e,t,r,i)}},{key:"remove",value:function(e){if(e instanceof Array){for(var n=0;n<e.length;n++)this.remove(e[n]);return this}if(e instanceof t)return this.remove(e.statements);var r=this.statementsMatching(e.subject,e.predicate,e.object,e.why);if(!r.length)throw new Error("Statement to be removed is not on store: "+e);return this.removeStatement(r[0]),this}},{key:"removeDocument",value:function(e){for(var t=this.statementsMatching(void 0,void 0,void 0,e).slice(),n=0;n<t.length;n++)this.removeStatement(t[n]);return this}},{key:"removeMany",value:function(e,t,n,r,i){for(var o=this.statementsMatching(e,t,n,r,!1),a=[],s=0;s<o.length;s++)a.push(o[s]);for(i&&(a=a.slice(0,i)),s=0;s<a.length;s++)this.remove(a[s])}},{key:"removeMatches",value:function(e,t,n,r){return this.removeStatements(this.statementsMatching(e,t,n,r)),this}},{key:"removeStatement",value:function(e){for(var t=[e.subject,e.predicate,e.object,e.why],n=0;n<4;n++){var r=this.canon(t[n]),i=r.hashString();this.index[n][i]&&d(this.index[n][i],e)}return d(this.statements,e),this}},{key:"removeStatements",value:function(e){for(var t=0;t<e.length;t++)this.remove(e[t]);return this}},{key:"replaceWith",value:function(e,t){for(var n=e.hashString(),r=t.hashString(),i=function(e){var t=e[n];if(t){var i=e[r];i?e[r]=t.concat(i):e[r]=t,delete e[n]}},o=0;o<4;o++)i(this.index[o]);if(this.redirections[n]=t,e.uri){if(this.aliases[r]||(this.aliases[r]=[]),this.aliases[r].push(e),this.aliases[n])for(o=0;o<this.aliases[n].length;o++)this.redirections[this.aliases[n][o].hashString()]=t,this.aliases[r].push(this.aliases[n][o]);this.add(t,this.sym("http://www.w3.org/2007/ont/link#uri"),e.uri),this.fetcher&&this.fetcher.nowKnownAs(e,t)}return i(this.classActions),i(this.propertyActions),!0}},{key:"allAliases",value:function(e){var t=this.aliases[this.canon(e).hashString()]||[];return t.push(this.canon(e)),t}},{key:"sameThings",value:function(e,t){if(e.sameTerm(t))return!0;var n=this.canon(e);if(!n)return!1;var r=this.canon(t);return!!r&&n.uri===r.uri}},{key:"setPrefixForURI",value:function(e,t){"tab"===e&&this.namespaces.tab||"ns"!==e.slice(0,2)&&"default"!==e.slice(0,7)&&(this.namespaces[e]=t)}},{key:"statementsMatching",value:function(e,t,n,r,i){var o,a,s=[e,t,n,r],u=[],l=[],c=[],f=[];for(o=0;o<4;o++)u[o]=this.canon(y.fromValue(s[o])),u[o]?(f.push(o),l[o]=u[o].hashString()):c.push(o);if(0===f.length)return this.statements;if(1===f.length)return o=f[0],a=this.index[o][l[o]],a&&i&&a.length>1&&(a=a.slice(0,1)),a=a||[];var h,d,p=1e10;for(d=0;d<f.length;d++){if(o=f[d],a=this.index[o][l[o]],!a)return[];a.length<p&&(p=a.length,h=d)}for(var v=f[h],g=this.index[v][l[v]],m=f.slice(0,h).concat(f.slice(h+1)),b=[],w=["subject","predicate","object","why"],x=0;x<g.length;x++){var _=g[x];for(d=0;d<m.length;d++)if(o=m[d],!this.canon(_[w[o]]).sameTerm(u[o])){_=null;break}if(null!=_&&(b.push(_),i))break}return b}},{key:"uris",value:function(e){var t=this.canon(e),n=this.aliases[t.hashString()];if(!t.uri)return[];var r=[t.uri];if(n)for(var i=0;i<n.length;i++)r.push(n[i].uri);return r}},{key:"length",get:function(){return this.statements.length}}]),t}(h);e.exports=m,e.exports.handleRDFType=u},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(4),l=n(5),c=n(7),f=n(8),h=n(61),d=n(9),p=n(6),y=n(76),v=n(78),g=n(79),m=function(e){function t(e,n,o,a){r(this,t);var s=i(this,Object.getPrototypeOf(t).call(this));return s.termType=t.termType,s.statements=e||[],s.constraints=n||[],s.initBindings=o||[],s.optional=a||[],s}return o(t,e),s(t,[{key:"add",value:function(e,t,n,r){return this.statements.push(new v(e,t,n,r))}},{key:"addStatement",value:function(e){return this.statements.push(e)}},{key:"bnode",value:function(e){return new u(e)}},{key:"bottomTypeURIs",value:function(e){var t,n,r,i,o,a,s,u,l;t=[];for(o in e)if(e.hasOwnProperty(o)){for(l=e[o],u=this.each(void 0,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),this.sym(o)),n=!0,i=0,a=u.length;i<a;i++)if(r=u[i],s=r.uri,s in e){n=!1;break}n&&(t[o]=l)}return t}},{key:"collection",value:function(){return new c}},{key:"each",value:function(e,t,n,r){var i,o,a,s,u,l,c,f,h,d=[],p=this.statementsMatching(e,t,n,r,!1);if(null==e)for(o=0,l=p.length;o<l;o++)i=p[o],d.push(i.subject);else if(null==t)for(a=0,c=p.length;a<c;a++)i=p[a],d.push(i.predicate);else if(null==n)for(s=0,f=p.length;s<f;s++)i=p[s],d.push(i.object);else if(null==r)for(u=0,h=p.length;u<h;u++)i=p[u],d.push(i.why);return d}},{key:"equals",value:function(e){return!!e&&this.hashString()===e.hashString()}},{key:"findMembersNT",value:function(e){var t,n,r,i,o,a,s,u,l,c,f,h,d,p,y,v,g,m,b,w,x;m={},m[e.toNT()]=!0,l={},h=this.transitiveClosure(m,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0);for(w in h)if(h.hasOwnProperty(w)){for(d=this.statementsMatching(void 0,this.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),this.fromNT(w)),t=0,r=d.length;t<r;t++)b=d[t],l[b.subject.toNT()]=b;for(p=this.each(void 0,this.sym("http://www.w3.org/2000/01/rdf-schema#domain"),this.fromNT(w)),n=0,i=p.length;n<i;n++)for(c=p[n],y=this.statementsMatching(void 0,c),u=0,o=y.length;u<o;u++)b=y[u],l[b.subject.toNT()]=b;for(v=this.each(void 0,this.sym("http://www.w3.org/2000/01/rdf-schema#range"),this.fromNT(w)),f=0,a=v.length;f<a;f++)for(c=v[f],g=this.statementsMatching(void 0,c),x=0,s=g.length;x<s;x++)b=g[x],l[b.object.toNT()]=b}return l}},{key:"findMemberURIs",value:function(e){return this.NTtoURI(this.findMembersNT(e))}},{key:"findSubClassesNT",value:function(e){var t={};return t[e.toNT()]=!0,this.transitiveClosure(t,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!0)}},{key:"findSuperClassesNT",value:function(e){var t={};return t[e.toNT()]=!0,this.transitiveClosure(t,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!1)}},{key:"findTypesNT",value:function(e){var t,n,r,i,o,a,s,u,l,c,f,h,d,p,y,v,g;for(f="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",g=[],h=this.statementsMatching(e,void 0,void 0),n=0,i=h.length;n<i;n++)if(v=h[n],v.predicate.uri===f)g[v.object.toNT()]=v;else for(d=this.each(v.predicate,this.sym("http://www.w3.org/2000/01/rdf-schema#domain")),r=0,o=d.length;r<o;r++)c=d[r],g[c.toNT()]=v;for(p=this.statementsMatching(void 0,void 0,e),u=0,a=p.length;u<a;u++)for(v=p[u],y=this.each(v.predicate,this.sym("http://www.w3.org/2000/01/rdf-schema#range")),l=0,s=y.length;l<s;l++)t=y[l],g[t.toNT()]=v;return this.transitiveClosure(g,this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf"),!1)}},{key:"findTypeURIs",value:function(e){return this.NTtoURI(this.findTypesNT(e))}},{key:"formula",value:function(){return new t}},{key:"fromNT",value:function(e){var t,n,r,i;switch(e[0]){case"<":return this.sym(e.slice(1,-1));case'"':if(r=void 0,t=void 0,n=e.lastIndexOf('"'),n<e.length-1)if("@"===e[n+1])r=e.slice(n+2);else{if("^^"!==e.slice(n+1,n+3))throw new Error("Can't convert string from NT: "+e);t=this.fromNT(e.slice(n+3))}return e=e.slice(1,n),e=e.replace(/\\"/g,'"'),e=e.replace(/\\n/g,"\n"),e=e.replace(/\\\\/g,"\\"),this.literal(e,r,t);case"_":return i=new u,i.id=parseInt(e.slice(3),10),u.nextId--,i;case"?":return new g(e.slice(1))}throw new Error("Can't convert from NT: "+e)}},{key:"holds",value:function(e,t,n,r){var i=this.anyStatementMatching(e,t,n,r);return null!=i}},{key:"holdsStatement",value:function(e){return this.holds(e.subject,e.predicate,e.object,e.why)}},{key:"list",value:function(e){var t=new c;return e.forEach(function(e){t.append(e)}),t}},{key:"literal",value:function(e,t,n){return new f(""+e,t,n)}},{key:"NTtoURI",value:function(e){var t,n,r={};for(t in e)e.hasOwnProperty(t)&&(n=e[t],"<"===t[0]&&(r[t.slice(1,-1)]=n));return r}},{key:"serialize",value:function(e,t,n){var r,i,o;switch(o=y(this),o.suggestNamespaces(this.namespaces),o.setBase(e),i=n?this.statementsMatching(void 0,void 0,void 0,n):this.statements,null!=t?t:"text/n3"){case"application/rdf+xml":r=o.statementsToXML(i);break;case"text/n3":case"text/turtle":r=o.statementsToN3(i);break;default:throw new Error("serialize: Content-type "+t+" not supported.")}return r}},{key:"substitute",value:function(e){var n=this.statements.map(function(t){t.substitute(e)});return new t(n)}},{key:"sym",value:function(e,t){if(t)throw new Error("This feature (kb.sym with 2 args) is removed. Do not assume prefix mappings.");return new d(e)}},{key:"the",value:function(e,t,n,r){var i=this.any(e,t,n,r);return null==i&&h.error("No value found for the() {"+e+" "+t+" "+n+"}."),i}},{key:"transitiveClosure",value:function(e,t,n){var r,i,o,a,s,u,l={};Object.assign(l,e);for(var c={};;){if(u=function(){for(var e in l)if(l.hasOwnProperty(e))return e}(),null==u)return c;for(s=n?this.each(void 0,t,this.fromNT(u)):this.each(this.fromNT(u),t),i=0,o=s.length;i<o;i++)r=s[i],a=r.toNT(),a in c||a in l||(l[a]=l[u]);c[u]=l[u],delete l[u]}}},{key:"topTypeURIs",value:function(e){var t,n,r,i,o,a,s,u;s=[];for(r in e)if(e.hasOwnProperty(r)){for(u=e[r],o=0,a=this.each(this.sym(r),this.sym("http://www.w3.org/2000/01/rdf-schema#subClassOf")),t=0,i=a.length;t<i;t++)if(n=a[t],"http://www.w3.org/2000/01/rdf-schema#Resource"!==n.uri){o++;break}o||(s[r]=u)}return s["http://www.w3.org/2000/01/rdf-schema#Resource"]&&delete s["http://www.w3.org/2000/01/rdf-schema#Resource"],s["http://www.w3.org/2002/07/owl#Thing"]&&delete s["http://www.w3.org/2002/07/owl#Thing"],s}},{key:"toString",value:function(){return"{"+this.statements.join("\n")+"}"}},{key:"whether",value:function(e,t,n,r){return this.statementsMatching(e,t,n,r,!1).length}}]),t}(p);m.termType="formula",m.prototype.classOrder=l.Formula,m.prototype.isVar=0,m.prototype.ns=n(69),m.prototype.variable=n(58).variable,e.exports=m},function(e,t,n){"use strict";function r(e,t,n,r,a){function s(e,t){return a?void a(e,t):t}var u=null;try{var l,c=o(t),f=t.statementsMatching(void 0,void 0,void 0,e);switch(c.suggestNamespaces(t.namespaces),c.setBase(n),r){case"application/rdf+xml":return u=c.statementsToXML(f),s(null,u);case"text/n3":case"application/n3":return u=c.statementsToN3(f),s(null,u);case"text/turtle":case"application/x-turtle":return c.setFlags("si"),u=c.statementsToN3(f),s(null,u);case"application/n-triples":return c.setFlags("deinprstux"),u=c.statementsToNTriples(f),s(null,u);case"application/ld+json":c.setFlags("deinprstux"),l=c.statementsToNTriples(f),i.convertToJson(l,a);break;case"application/n-quads":case"application/nquads":return c.setFlags("deinprstux q"),u=c.statementsToNTriples(f),s(null,u);default:throw new Error("Serialize: Content-type "+r+" not supported for data write.")}}catch(e){if(a)return a(e);throw e}}e.exports=r;var i=n(11),o=n(77)},function(e,t,n){"use strict";var r=n(9),i=n(63),o=n(64),a=n(10),s=function(){function e(e){return encodeURI(e)}function t(e){for(var t,n="",r=0;r<e.length;r++)t=e.charCodeAt(r),n+=t>65535?"\\U"+("00000000"+t.toString(16)).slice(-8):t>126?"\\u"+("0000"+t.toString(16)).slice(-4):e[r];return n}var n=function(e){this.flags="",this.base=null,this.prefixes=[],this.namespaces=[],this.suggestPrefix("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.suggestPrefix("xml","reserved:reservedForFutureUse"),this.namespacesUsed=[],this.keywords=["a"],this.prefixchars="abcdefghijklmnopqustuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",this.incoming=null,this.formulas=[],this.store=e};n.prototype.setBase=function(e){this.base=e},n.prototype.setFlags=function(e){this.flags=e?e:""},n.prototype.toStr=function(e){var t=e.toNT();return"formula"==e.termType&&(this.formulas[t]=e),t},n.prototype.fromStr=function(e){if("{"==e[0]){var t=this.formulas[e];return t||console.log("No formula object for "+e),t}return this.store.fromNT(e)},n.prototype.suggestPrefix=function(e,t){"default"!==e.slice(0,7)&&"ns"!==e.slice(0,2)&&e&&t&&(e in this.namespaces||t in this.prefixes||(this.prefixes[t]=e,this.namespaces[e]=t))},n.prototype.suggestNamespaces=function(e){for(var t in e)this.suggestPrefix(t,e[t])},n.prototype.checkIntegrity=function(){var e,t;for(e in this.namespaces)if(this.prefixes[this.namespaces[e]]!==e)throw"Serializer integity error 1: "+e+", "+this.namespaces[e]+", "+this.prefixes[this.namespaces[e]]+"!";for(t in this.prefixes)if(this.namespaces[this.prefixes[t]]!==t)throw"Serializer integity error 2: "+t+", "+this.prefixs[t]+", "+this.namespaces[this.prefixes[t]]+"!"},n.prototype.makeUpPrefix=function(e){function t(t){return!!n.prototype.validPrefix.test(t)&&("ns"!==t&&(!(t in this.namespaces)&&(this.prefixes[e]=t,this.namespaces[t]=e,r=t,!0)))}var r,i=e;t=t.bind(this),"#/".indexOf(i[i.length-1])>=0&&(i=i.slice(0,-1));var o=i.lastIndexOf("/");o>=0&&(i=i.slice(o+1));for(var a=0;a<i.length&&this.prefixchars.indexOf(i[a]);)a++;if(i=i.slice(0,a),i.length<6&&t(i))return r;if(t(i.slice(0,3)))return r;if(t(i.slice(0,2)))return r;if(t(i.slice(0,4)))return r;if(t(i.slice(0,1)))return r;if(t(i.slice(0,5)))return r;n.prototype.validPrefix.test(i)||(i="n");for(var a=0;;a++)if(t(i.slice(0,3)+a))return r},n.prototype.rootSubjects=function(e){for(var t={},n={},r={},i=0;i<e.length;i++){var o=e[i],a=[o.subject,o.predicate,o.object];a.map(function(e){"BlankNode"==e.termType&&(r[e.toNT()]=!0)});var s=e[i].object;t.hasOwnProperty(s)||(t[s]=[]),t[s].push(o.subject);var u=n[this.toStr(o.subject)];u||(u=[]),u.push(o),n[this.toStr(o.subject)]=u}var l=[];for(var c in n)if(n.hasOwnProperty(c)){var s=this.fromStr(c);"BlankNode"==s.termType&&t[s]&&1==t[s].length||l.push(s)}this.incoming=t;for(var f={},i=0;i<l.length;i++)f[l[i].toNT()]=!0;return{roots:l,subjects:n,rootsHash:f,incoming:t}},n.prototype.toN3=function(e){return this.statementsToN3(e.statements)},n.prototype._notQNameChars="\t\r\n !\"#$%&'()*.,+/;<=>?@[\\]^`{|}~",n.prototype._notNameChars=n.prototype._notQNameChars+":",n.prototype.explicitURI=function(n){return n=this.flags.indexOf("r")<0&&this.base?i.refTo(this.base,n):this.flags.indexOf("u")>=0?t(n):e(n),"<"+n+">"},n.prototype.statementsToNTriples=function(e){var t=e.slice();t.sort();for(var n="",r="http://www.w3.org/1999/02/22-rdf-syntax-ns#",i=this,o=this.store,a=function e(t){if("collection"!==t.termType)return i.atomicTermToN3(t);for(var a=t.elements,s=o.sym(r+"nill"),u=a.length-1;u>=0;u--){var l=new $rdf.BlankNode;n+=e(l)+" "+e(o.sym(r+"first"))+" "+e(a[u])+".\n",n+=e(l)+" "+e(o.sym(r+"rest"))+" "+e(s)+".\n",s=l}return i.atomicTermToN3(s)},s=0;s<t.length;s++){var u=t[s],l="";l+=a(u.subject)+" ",l+=a(u.predicate)+" ",l+=a(u.object)+" ",this.flags.indexOf("q")>=0&&(l+=a(u.why)+" "),l+=".\n",n+=l}return n},n.prototype.statementsToN3=function(e){function t(e){for(var t=this.rootSubjects(e),n=t.roots,i=[],o=0;o<n.length;o++){var a=n[o];i.push(r(a,t))}return i}function r(e,t){return"BlankNode"!=e.termType||t.incoming[e]?[a(e,t)].concat([i(e,t)]).concat(["."]):o(e,t,!0).concat(["."])}function i(e,t){var n=[],r=null,i=t.subjects[this.toStr(e)];if("undefined"==typeof i)throw"Cant find statements for "+e;i.sort();for(var s=[],u=0;u<i.length;u++){var l=i[u];l.predicate.uri==r?s.push(","):(r&&(n=n.concat([s]).concat([";"]),s=[]),n.push(c[l.predicate.uri]?c[l.predicate.uri]:a(l.predicate,t))),r=l.predicate.uri,s.push(o(l.object,t))}return n=n.concat([s])}function o(e,t,n){return"BlankNode"==e.termType&&t.subjects[this.toStr(e)]&&(n||void 0==t.rootsHash[e.toNT()])?["["].concat(i(e,t)).concat(["]"]):a(e,t)}function a(e,n){var r;switch(e.termType){case"formula":var i=["{"];return i=i.concat(t(e.statements)),i.concat(["}"]);case"collection":var i=["("];for(r=0;r<e.elements.length;r++)i.push([o(e.elements[r],n)]);return i.push(")"),i;default:return this.atomicTermToN3(e)}}function s(){var e="";this.defaultNamespace&&(e+="@prefix : <"+this.defaultNamespace+">.\n");for(var t in this.prefixes)this.prefixes.hasOwnProperty(t)&&this.namespacesUsed[t]&&(e+="@prefix "+this.prefixes[t]+": "+this.explicitURI(t)+".\n");return e+"\n"}var u=4,l=80,c={};this.flags.indexOf("s")<0&&(c["http://www.w3.org/2002/07/owl#sameAs"]="="),this.flags.indexOf("t")<0&&(c["http://www.w3.org/1999/02/22-rdf-syntax-ns#type"]="a"),this.flags.indexOf("i")<0&&(c["http://www.w3.org/2000/10/swap/log#implies"]="=>");var f=function(e){for(var t="",n=0;n<e;n++)t+=" ";return t},h=function e(t){for(var n="",r=0;r<t.length;r++){var i=t[r],o="string"==typeof i?i:e(i);0!=r&&","!=o&&";"!=o&&(n+=" "),n+=o}return n},d=function e(t,n){var r="",i=1e5;n||(n=0);for(var o=0;o<t.length;o++){var a=t[o];if("string"!=typeof a){var s=e(a,n+1);if(s.length<10*(l-u*n)&&s.indexOf('"""')<0){var c=h(a);c.length<l-u*n&&(a="   "+c,s="")}s&&(i=1e4),r+=s}if("string"==typeof a){if("1"==a.length&&"\n"==r.slice(-1)){if(",.;".indexOf(a)>=0){r=r.slice(0,-1)+a+"\n",i+=1;continue}if("])}".indexOf(a)>=0){r=r.slice(0,-1)+" "+a+"\n",i+=2;continue}}if(i<u*n+4)r=r.slice(0,-1)+" "+a+"\n",i+=a.length+1;else{var c=f(u*n)+a;r+=c+"\n",i=c.length}}}return r};t=t.bind(this),i=i.bind(this),o=o.bind(this),n.prototype.termToN3=a,a=a.bind(this);var s=s.bind(this),p=t(e);return s()+d(p,-1)},n.prototype.atomicTermToN3=function(e,t){switch(e.termType){case"BlankNode":case"Variable":return e.toNT();case"Literal":if(e.datatype&&this.flags.indexOf("x")<0)switch(e.datatype.uri){case"http://www.w3.org/2001/XMLSchema#integer":return e.value.toString();case"http://www.w3.org/2001/XMLSchema#boolean":return e.value?"true":"false"}var n=this.stringToN3(e.value);return e.language?n+="@"+e.language:e.datatype.equals(a.string)||(n+="^^"+this.atomicTermToN3(e.datatype,t)),n;case"NamedNode":return this.symbolToN3(e);default:throw"Internal: atomicTermToN3 cannot handle "+e+" of termType: "+e.termType+"\n"}},n.prototype.validPrefix=new RegExp(/^[a-zA-Z][a-zA-Z0-9]*$/),n.prototype.forbidden1=new RegExp(/[\\"\b\f\r\v\t\n\u0080-\uffff]/gm),n.prototype.forbidden3=new RegExp(/[\\"\b\f\r\v\u0080-\uffff]/gm),n.prototype.stringToN3=function(e,t){t||(t="e");var r,i,o="",a=0,s=0;e.length>20&&'"'!=e.slice(-1)&&t.indexOf("n")<0&&(e.indexOf("\n")>0||e.indexOf('"')>0)?(r='"""',i=n.prototype.forbidden3):(r='"',i=n.prototype.forbidden1);for(var a=0;a<e.length;){i.lastIndex=0;var u=i.exec(e.slice(a));if(null==u)break;s=a+i.lastIndex-1,o+=e.slice(a,s);var l=e[s];if('"'==l&&'"""'==r&&'"""'!=e.slice(s,s+3))o+=l;else{var c='\b\f\r\t\v\n\\"'.indexOf(l);o+=c>=0?"\\"+'bfrtvn\\"'[c]:t.indexOf("e")>=0?"\\u"+("000"+l.charCodeAt(0).toString(16).toLowerCase()).slice(-4):l}a=s+1}return r+o+e.slice(a)+r},n.prototype.symbolToN3=function(e){var t=e.uri,r=t.indexOf("#");if(r<0&&this.flags.indexOf("/")<0&&(r=t.lastIndexOf("/")),r>=0&&this.flags.indexOf("p")<0&&(0===t.indexOf("http")||0===t.indexOf("ws")||0===t.indexOf("file"))){for(var i=!0,o=r+1;o<t.length;o++)if(n.prototype._notNameChars.indexOf(t[o])>=0){i=!1;break}if(t.slice(0,r+1)==this.base+"#")return"<#"+t.slice(r+1)+">";if(i){var a=t.slice(r+1),s=t.slice(0,r+1);if(this.defaultNamespace&&this.defaultNamespace==s&&this.flags.indexOf("d")<0)return this.flags.indexOf("k")>=0&&this.keyords.indexOf(a)<0?a:":"+a;this.checkIntegrity();var u=this.prefixes[s];if(u||(u=this.makeUpPrefix(s)),u)return this.namespacesUsed[s]=!0,u+":"+a}}return this.explicitURI(t)},n.prototype.writeStore=function(e){var t=this.store,n=t.fetcher,r=n&&n.appNode,i=this.store.index[3];for(var o in i){var a=t.fromNT(o);r&&a.sameTerm(r)||e("\n"+this.atomicTermToN3(a)+" "+this.atomicTermToN3(t.sym("http://www.w3.org/2000/10/swap/log#semantics"))+" { "+this.statementsToN3(t.statementsMatching(void 0,void 0,void 0,a))+" }.\n")}t.statementsMatching(void 0,t.sym("http://www.w3.org/2007/ont/link#requestedURI")).map(function(n){e("\n<"+n.object.value+"> log:metadata {\n");var r=t.statementsMatching(void 0,void 0,void 0,n.subject);e(this.statementsToN3(this.statementsToN3(r))),e("}.\n")});var s=[];r&&s.push(r);var u=[];s.map(function(e){u=u.concat(t.statementsMatching(void 0,void 0,void 0,e))}),e(this.statementsToN3(u))},n.prototype.statementsToXML=function(e){function t(e){this.suggestPrefix("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#");for(var t=this.rootSubjects(e),n=t.roots,r=[],i=0;i<n.length;i++)root=n[i],r.push(u(root,t));return r}function i(e){return"undefined"==typeof e?"@@@undefined@@@@":e.replace(/[&<"]/g,function(e){switch(e[0]){case"&":return"&amp;";case"<":return"&lt;";case'"':return"&quot;"}})}function s(e){return i(this.base?o.uri.refTo(this.base,e.uri):e.uri)}function u(e,t){var n,o,c,h,d=[],p=t.subjects[this.toStr(e)];if("undefined"==typeof p)throw"Serializing XML - Cant find statements for "+e;p.sort(function(e,t){var n=e.predicate.uri,r=t.predicate.uri;if(n.substring(0,y.length)==y||r.substring(0,y.length)==y)return n.localeCompare(r);var i=n.substring(y.length),o=r.substring(y.length),a=parseInt(i),s=parseInt(o);return isNaN(a)||isNaN(s)||a!=i||s!=o?n.localeCompare(r):a-s});for(var v=0;v<p.length;v++)if(c=p[v],"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"!=c.predicate.uri||n||"symbol"!=c.object.termType){if(h=c.predicate,h.uri.substr(0,y.length)==y){var g=h.uri.substr(y.length),m=parseInt(g);g==m.toString()&&(h=new r("http://www.w3.org/1999/02/22-rdf-syntax-ns#li"))}switch(o=f(h),c.object.termType){case"BlankNode":d=1==t.incoming[c.object].length?d.concat(["<"+o+">",u(c.object,t),"</"+o+">"]):d.concat(["<"+o+' rdf:nodeID="'+c.object.toNT().slice(2)+'"/>']);break;case"NamedNode":d=d.concat(["<"+o+' rdf:resource="'+s(c.object)+'"/>']);break;case"Literal":d=d.concat(["<"+o+(c.object.datatype.equals(a.string)?"":' rdf:datatype="'+i(c.object.datatype.uri)+'"')+(c.object.language?' xml:lang="'+c.object.language+'"':"")+">"+i(c.object.value)+"</"+o+">"]);break;case"collection":d=d.concat(["<"+o+' rdf:parseType="Collection">',l(c.object,t),"</"+o+">"]);break;default:throw"Can't serialize object of type "+c.object.termType+" into XML"}}else n=c.object;var b=n?f(n):"rdf:Description",w="";return"BlankNode"==e.termType?t.incoming[e]&&1==t.incoming[e].length||(w=' rdf:nodeID="'+e.toNT().slice(2)+'"'):w=' rdf:about="'+s(e)+'"',["<"+b+w+">"].concat([d]).concat(["</"+b+">"])}function l(e,t){for(var n=[],r=0;r<e.elements.length;r++)n.push(u(e.elements[r],t));return n}function c(e,t){var n=[],r=t.subjects[this.toStr(e)];if(void 0==r)return n;r.sort();for(var o=0;o<r.length;o++){var u=r[o];switch(u.object.termType){case"BlankNode":n=t.rootsHash[u.object.toNT()]?n.concat(["<"+f(u.predicate)+' rdf:nodeID="'+u.object.toNT().slice(2)+'">',"</"+f(u.predicate)+">"]):n.concat(["<"+f(u.predicate)+' rdf:parseType="Resource">',c(u.object,t),"</"+f(u.predicate)+">"]);break;case"NamedNode":n=n.concat(["<"+f(u.predicate)+' rdf:resource="'+s(u.object)+'"/>']);break;case"Literal":n=n.concat(["<"+f(u.predicate)+(u.object.datatype.equals(a.string)?"":' rdf:datatype="'+i(u.object.datatype.value)+'"')+(u.object.language?' xml:lang="'+u.object.language+'"':"")+">"+i(u.object.value)+"</"+f(u.predicate)+">"]);break;case"collection":n=n.concat(["<"+f(u.predicate)+' rdf:parseType="Collection">',l(u.object,t),"</"+f(u.predicate)+">"]);break;default:throw"Can't serialize object of type "+u.object.termType+" into XML"}}return n}function f(e){var t=e.uri,r=t.indexOf("#");if(r<0&&this.flags.indexOf("/")<0&&(r=t.lastIndexOf("/")),r<0)throw"Cannot make qname out of <"+t+">";for(var i=r+1;i<t.length;i++)if(n.prototype._notNameChars.indexOf(t[i])>=0)throw'Invalid character "'+t[i]+'" cannot be in XML qname for URI: '+t;var o=t.slice(r+1),a=t.slice(0,r+1);if(this.defaultNamespace&&this.defaultNamespace==a&&this.flags.indexOf("d")<0)return o;var s=this.prefixes[a];return s||(s=this.makeUpPrefix(a)),p[a]=!0,s+":"+o}var h=4,d=80,p=[];p["http://www.w3.org/1999/02/22-rdf-syntax-ns#"]=!0;var y="http://www.w3.org/1999/02/22-rdf-syntax-ns#_",v=function(e){for(var t="",n=0;n<e;n++)t+=" ";return t},g=function e(t){for(var n="",r=0;r<t.length;r++){var i=t[r],o="string"==typeof i?i:e(i);n+=o}return n},m=function e(t,n){var r="",i=1e5;n||(n=0);for(var o=0;o<t.length;o++){var a=t[o];if("string"!=typeof a){var s=e(a,n+1);if(s.length<10*(d-h*n)&&s.indexOf('"""')<0){var u=g(a);u.length<d-h*n&&(a="   "+u,s="")}s&&(i=1e4),r+=s}if("string"==typeof a)if(i<h*n+4)r=r.slice(0,-1)+" "+a+"\n",i+=a.length+1;else{var u=v(h*n)+a;r+=u+"\n",i=u.length}}return r};t=t.bind(this),s=s.bind(this),u=u.bind(this),c=c.bind(this),f=f.bind(this);var b=t(e),w="<rdf:RDF";this.defaultNamespace&&(w+=' xmlns="'+i(this.defaultNamespace)+'"');for(var x in p)p.hasOwnProperty(x)&&(w+="\n xmlns:"+this.prefixes[x]+'="'+i(x)+'"');w+=">";var _=[w,b,"</rdf:RDF>"];return m(_,-1)};var s=function(e){return new n(e)};return s}();e.exports=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6),a=function(){function e(t,n,i,a){r(this,e),this.subject=o.fromValue(t),this.predicate=o.fromValue(n),this.object=o.fromValue(i),this.why=a}return i(e,[{key:"equals",value:function(e){return e.subject.equals(this.subject)&&e.predicate.equals(this.predicate)&&e.object.equals(this.object)&&e.graph.equals(this.graph)}},{key:"substitute",value:function(t){return new e(this.subject.substitute(t),this.predicate.substitute(t),this.object.substitute(t),this.why)}},{key:"toCanonical",value:function(){var e=[this.subject.toCanonical(),this.predicate.toCanonical(),this.object.toCanonical()];return this.graph&&"DefaultGraph"!==this.graph.termType&&e.push(this.graph.toCanonical()),e.join(" ")+" ."}},{key:"toNT",value:function(){return[this.subject.toNT(),this.predicate.toNT(),this.object.toNT()].join(" ")+" ."}},{key:"toString",value:function(){return this.toNT()}},{key:"graph",get:function(){return this.why},set:function(e){this.why=e}}]),e}();e.exports=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(5),l=n(6),c=n(63),f=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.termType=t.termType,n.value=e,n.base="varid:",n.uri=c.join(e,n.base),n}return o(t,e),s(t,[{key:"equals",value:function(e){return!!e&&(this.termType===e.termType&&this.value===e.value)}},{key:"hashString",value:function(){return this.toString()}},{key:"substitute",value:function(e){var t;return null!=(t=e[this.toNT()])?t:this}},{key:"toString",value:function(){return this.uri.slice(0,this.base.length)===this.base?"?"+this.uri.slice(this.base.length):"?"+this.uri}}]),t}(l);f.termType="Variable",f.prototype.classOrder=u.Variable,f.prototype.isVar=1,e.exports=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n,r){function i(e,t){return e.nvars!==t.nvars?e.nvars-t.nvars:e.index.length-t.index.length}var o=function(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&(n+="    "+t+" -> "+e[t]);return n},u=function(e){var t,n="Bindings: ",r=e.length;for(t=0;t<r;t++)n+=o(e[t][0])+";\n\t";return n},l=function(e,t,n,r){var i=n[e];if(void 0===i){if(e.isVar){var o=[];return o[e]=t,[[o,null]]}i=e}if(!i.complexType)return r.redirections[i]&&(i=r.redirections[i]),r.redirections[t]&&(t=r.redirections[t]),i.sameTerm(t)?[[[],null]]:[];if(e instanceof Array)return t instanceof Array?c(e,t,n):[];throw new Error("query.js: oops - code not written yet")},c=function e(t,n,r,i){var o;if(t.length!==n.length)return[];if(!t.length)return[[[],null]];var a=l(t[0],n[0],r,i);if(0===a.length)return a;var s,u,c,f,h,d,p,y=[],v=a.length;for(s=0;s<v;s++){u=a[s][0],p=[];for(h in u)u.hasOwnProperty(h)&&(p[h]=u[h]);for(h in r)r.hasOwnProperty(h)&&(p[h]=r[h]);for(o=e(t.slice(1),n.slice(1),p,i),f=o.length,c=0;c<f;c++){d=o[c][0];for(h in u)u.hasOwnProperty(h)&&(d[h]=u[h]);y.push([d,null])}}return y},f=function(e,t){var n=t[e];return void 0===n?e:n},h=function(e,t){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},d=function(e,t){return this.trunkBindings=t,this.originalCallback=e,this.branches=[],this};d.prototype.checkAllDone=function(){var e;for(e=0;e<this.branches.length;e++)if(!this.branches[e].done)return;a.debug("OPTIONAL BIDNINGS ALL DONE:"),this.doCallBacks(this.branches.length-1,this.trunkBindings)},d.prototype.doCallBacks=function(e,t){var n;if(e<0)return this.originalCallback(t);for(n=0;n<this.branches[e].results.length;n++)this.doCallBacks(e-1,h(t,this.branches[e].results[n]))};var p=function(e,t){return this.count=0,this.success=!1,this.done=!1,this.callback=e,this.onDone=t,this};p.prototype.reportMatch=function(e){this.callback(e),this.success=!0},p.prototype.reportDone=function(){this.done=!0,a.info("Mandatory query branch finished.***"),void 0!==this.onDone&&this.onDone()};var y=function(e){return this.count=0,this.done=!1,
this.results=[],this.junction=e,e.branches.push(this),this};y.prototype.reportMatch=function(e){this.results.push(e)},y.prototype.reportDone=function(){a.debug("Optional branch finished - results.length = "+this.results.length),0===this.results.length&&(this.results.push({}),a.debug("Optional branch FAILED - that's OK.")),this.done=!0,this.junction.checkAllDone()};var v=function(e,t,n){var r,i,o,a,s;for(t.nvars=0,t.index=null,i=[t.subject,t.predicate,t.object],s=[e.subjectIndex,e.predicateIndex,e.objectIndex],a=0;a<3;a++)if(i[a].isVar&&void 0===n[i[a]])t.nvars++;else{if(r=f(i[a],n),e.redirections[r.hashString()]&&(r=e.redirections[r.hashString()]),o=s[a][r.hashString()],!o)return t.index=[],!1;(null===t.index||t.index.length>o.length)&&(t.index=o)}return null===t.index&&(t.index=e.statements),!0},g=0,m=function e(n,r,i,u,l,c,f){a.debug("Match begins, Branch count now: "+f.count+" for "+f.pattern_debug);var h=n.fetcher?n.fetcher:null,p=r.statements;if(0===p.length){if(a.debug("FOUND MATCH WITH BINDINGS:"+o(i)),0===r.optional.length)f.reportMatch(i);else{a.debug("OPTIONAL: "+r.optional);var v,m=new d(t,i),b=[];for(v=0;v<r.optional.length;v++)b[v]=new y(m),b[v].pattern_debug=r.optional[v];for(v=0;v<r.optional.length;v++)b[v].count=b[v].count+1,e(n,r.optional[v],i,"",l,t,b[v])}return f.count--,void a.debug("Match ends -- success , Branch count now: "+f.count+" for "+f.pattern_debug)}var x,_,k=p.length;if(h){var T="match"+g++,S=function(t,o){var a=t.uri.split("#")[0];h.nowOrWhenFetched(a,void 0,function(o,a,s){o&&console.log("Error following link to <"+t.uri+"> in query: "+a),e(n,r,i,u,l,c,f)})};for(_=0;_<k;_++){if(x=p[_],void 0!==i[x.subject]&&i[x.subject].uri&&h&&"unrequested"===h.getState(s(i[x.subject].uri)))return void S(i[x.subject],T);if(void 0!==i[x.object]&&i[x.object].uri&&h&&"unrequested"===h.getState(s(i[x.object].uri)))return void S(i[x.object],T)}}w(n,r,i,u,l,c,f)},b=function(e,t){var n,r,i=!0;for(n in e)e.hasOwnProperty(n)&&t[n]&&(r=t[n].test,r&&!r(e[n])&&(i=!1));return i},w=function(e,t,n,r,s,l,f){var h,d,p,y,g,w,x,_=t.statements,k=_.length;for(h=0;h<k;h++)x=_[h],a.info("match2: item="+x+", bindingsSoFar="+o(n)),v(e,x,n);_.sort(i),x=_[0];var T=e.formula();T.optional=t.optional,T.constraints=t.constraints,T.statements=_.slice(1),a.debug(r+"match2 searching "+x.index.length+" for "+x+"; bindings so far="+o(n));var S,E,N,R=x.index.length,j=0;for(S=0;S<R;S++)for(N=x.index[S],E=c([x.subject,x.predicate,x.object],[N.subject,N.predicate,N.object],n,e),a.info(r+" From first: "+E.length+": "+u(E)),p=E.length,d=0;d<p;d++)if(g=[],w=E[d][0],b(w,t.constraints)){for(y in w)w.hasOwnProperty(y)&&(g[y]=w[y]);for(y in n)n.hasOwnProperty(y)&&(g[y]=n[y]);f.count++,j++,m(e,T,g,r+"  ",s,l,f)}else a.debug("Branch count CS: "+f.count);f.count--,0===j&&a.debug("Match2 fails completely on "+x),a.debug("Match2 ends, Branch count: "+f.count+" for "+f.pattern_debug),0===f.count&&(a.debug("Branch finished."),f.reportDone())},x=this;a.debug("Query on "+this.statements.length);var _=new p(t,r);_.count++,setTimeout(function(){m(x,e.pat,e.pat.initBindings,"",n,t,_)},0)}var o=n(74),a=n(61),s=n(63).docpart,u=function e(t,n){r(this,e),this.pat=new o,this.vars=[],this.name=t,this.id=n};e.exports.Query=u,e.exports.indexedFormulaQuery=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(6),l=function(e){function t(){r(this,t);var e=i(this,Object.getPrototypeOf(t).call(this));return e.termType=t.termType,e}return o(t,e),s(t,[{key:"toString",value:function(){return"()"}}]),t}(u);l.termType="empty",e.exports=l},function(e,t){"use strict";var n=function(){return{parseJSON:function(e,t,n){var r,i,o,a={},s=n.sym(t);for(var u in e){0===u.indexOf("_:")?a[u]?r=a[u]:(r=n.bnode(u),a[u]=r):r=n.sym(u);var l=e[u];for(var c in l){var f=l[c];i=n.sym(c);for(var h in f){var d=f[h];if("uri"===d.type)o=n.sym(d.value),n.add(r,i,o,s);else if("BlankNode"===d.type)a[d.value]?o=a[d.value]:(o=n.bnode(d.value),a[d.value]=o),n.add(r,i,o,s);else{if("Literal"!==d.type)throw new Error("error: unexpected termtype: "+h.type);o=d.datatype?n.literal(d.value,void 0,n.sym(d.datatype)):d.lang?n.literal(d.value,d.lang):n.literal(d.value),n.add(r,i,o,s)}}}}}}}();e.exports=n},function(e,t,n){"use strict";function r(e){function t(e){for(var t=s()+"SELECT ",n=0;n<e.vars.length;n++)t+=e.vars[n]+" ";return t+="\n"}function n(e){var t="",n=e.statements;for(var r in n)i.debug("Found statement: "+n),t+=s()+n[r]+"\n";return t}function r(e){var t="";for(var n in e.constraints){var r=e.constraints[n];t+=s()+"FILTER ( "+r.describe(n)+" ) \n"}return t}function o(e){for(var t="",a=0;a<e.optional.length;a++)i.debug("Found optional query"),t+=s()+"OPTIONAL { \n",l++,t+=n(e.optional[a]),t+=r(e.optional[a]),t+=o(e.optional[a]),l--,t+=s()+"}\n";return t}function a(e){var t=s()+"WHERE \n{ \n";return l++,t+=n(e),t+=r(e),t+=o(e),l--,t+="}"}function s(){for(var e="",t=0;t<l;t++)e+="    ";return e}function u(e){return t(e)+a(e.pat)}var l=0;return u(e)}var i=n(61);e.exports=r},function(e,t,n){"use strict";function r(e,t,n){function r(e){if(C[e])return C[e];var t=n.variable(e);return C[e]=t,t}function a(e){return"string"==typeof e&&e.match(/[^ \n\t]/)}function s(e){return"string"==typeof e&&e.match(/^[\?\$]/)}function u(e){return"string"==typeof e?e.replace(/^&lt;/,"<").replace(/&gt;$/,">"):e}function l(e){return"string"==typeof e&&e.match(/^<[^>]*>$/)}function c(e){return"string"==typeof e&&(e.match(/^_:/)||e.match(/^$/))}function f(e){return"string"==typeof e&&e.match(/:$/)}function h(e){return"string"==typeof e&&e.match(/^:|^[^_][^:]*:/)}function d(e){var t=e.split(":");return t[0]}function p(e){var t=e.split(":");return t[1]}function y(e){return l(e)?e.slice(1,e.length-1):e}function v(e){var t=e.indexOf("'")===-1?null:e.indexOf("'"),r=e.indexOf('"')===-1?null:e.indexOf('"');if(!t&&!r){var o=new Array(1);return o[0]=e,o}var a,s,u=new Array(2);if(!t||r&&r<t)a='"',s=r;else{if(r&&!(t&&t<r))return i.error("SQARQL QUERY OOPS!"),u;a="'",s=t}u[0]=e.slice(0,s);var l=e.slice(s+1).indexOf(a);if(l===-1)return i.error("SPARQL parsing error: no matching parentheses in literal "+e),e;var c;return e.slice(l+s+2).match(/^\^\^/)?(c=e.slice(l+s+2).indexOf(" "),u[1]=n.literal(e.slice(s+1,s+1+l),"",n.sym(y(e.slice(s+4+l,s+2+l+c)))),u=u.concat(v(e.slice(l+s+3+c)))):e.slice(l+s+2).match(/^@/)?(c=e.slice(l+s+2).indexOf(" "),u[1]=n.literal(e.slice(s+1,s+1+l),e.slice(s+3+l,s+2+l+c),null),u=u.concat(v(e.slice(l+s+2+c)))):(u[1]=n.literal(e.slice(s+1,s+1+l),"",null),i.info("Literal found: "+u[1]),u=u.concat(v(e.slice(l+s+2)))),u}function g(e){e=e.replace(/\(/g," ( ").replace(/\)/g," ) ").replace(/</g," <").replace(/>/g,"> ").replace(/{/g," { ").replace(/}/g," } ").replace(/[\t\n\r]/g," ").replace(/; /g," ; ").replace(/\. /g," . ").replace(/, /g," , "),i.info("New str into spaceDelimit: \n"+e);var t=[],n=e.split(" ");for(var r in n)a(n[r])&&(t=t.concat(n[r]));return t}function m(e){for(var t=e,n=0;n<t.length;n++)if("a"===t[n]&&(t[n]="<http://www.w3.org/1999/02/22-rdf-syntax-ns#type>"),"is"===t[n]&&"of"===t[n+2]){t.splice(n,1),t.splice(n+1,1);var r=t[n-1];t[n-1]=t[n+1],t[n+1]=r}return t}function b(e){for(var t=[],o=0;o<e.length;o++)"string"==typeof e[o]?(e[o]=u(e[o]),s(e[o])?t[o]=r(e[o].slice(1)):c(e[o])?(i.info(e[o]+" was identified as a bnode."),t[o]=n.bnode()):l(e[o])?(i.info(e[o]+" was identified as a symbol."),t[o]=n.sym(y(e[o]))):h(e[o])?(i.info(e[o]+" was identified as a prefixed symbol"),D[d(e[o])]?t[o]=n.sym(e[o]=D[d(e[o])]+p(e[o])):(i.error("SPARQL error: "+e[o]+" with prefix "+d(e[o])+" does not have a correct prefix entry."),t[o]=e[o])):t[o]=e[o]):t[o]=e[o];return t}function w(e){var t=v(e),n=[];for(var r in t)n="string"==typeof t[r]?n.concat(g(t[r])):n.concat(t[r]);return n=m(n),i.info("SPARQL Tokens: "+n),n}function x(e,t){for(var n=0;n<t.length;n++)if("string"==typeof t[n]&&t[n].toLowerCase()===e.toLowerCase())return n;return null}function _(e,t){for(var n=[],r=0;r<t.length;r++)"string"==typeof t[r]&&t[r].toLowerCase()===e.toLowerCase()&&n.push(r);return n}function k(e,t){i.info("SPARQL vars: "+e);for(var n in e)if(s(e[n])){i.info("Added "+e[n]+" to query variables from SPARQL");var o=r(e[n].slice(1));t.vars.push(o),o.label=e[n].slice(1)}else i.warn("Incorrect SPARQL variable in SELECT: "+e[n])}function T(e){var t=_("PREFIX",e),n=[];for(var r in t){var o=e[t[r]+1],a=e[t[r]+2];if(f(o))if(l(a)){i.info("Prefix found: "+o+" -> "+a);var s=d(o),u=y(a);n[s]=u}else i.error("Invalid SPARQL symbol: "+a);else i.error("Invalid SPARQL prefix: "+o)}return n}function S(e,t,n){i.info("Looking for a close bracket of type "+n+" in "+e);for(var r=0,o=0;o<e.length;o++)if(e[o]===t&&r++,e[o]===n&&r--,r<0)return o;return i.error("Statement had no close parenthesis in SPARQL query"),0}function E(e){return this.describe=function(t){return t+" = "+e.toNT()},this.test=function(t){return e.sameTerm(t)},this}function N(e){this.describe=function(t){return"REGEXP( '"+e+"' , "+t+" )"},this.test=function(t){var n=e,r=new RegExp(n);return!!t.value&&r.test(t.value)}}function R(e,t){3!==e.length||"Variable"!==e[0].termType||"NamedNode"!==e[2].termType&&"Literal"!==e[2].termType?6===e.length&&"string"==typeof e[0]&&"regexp"===e[0].toLowerCase()&&"("===e[1]&&")"===e[5]&&","===e[3]&&"Variable"===e[4].termType&&"Literal"===e[2].termType&&(i.debug("Constraint added: "+e),t.constraints[e[4]]=new N(e[2].value)):"="===e[1]?(i.debug("Constraint added: "+e),t.constraints[e[0]]=new E(e[2])):">"===e[1]?(i.debug("Constraint added: "+e),t.constraints[e[0]]=new E(e[2])):"<"===e[1]?(i.debug("Constraint added: "+e),t.constraints[e[0]]=new E(e[2])):i.warn("I don't know how to handle the constraint: "+e)}function j(e,t){i.debug("Optional query: "+e+" not yet implemented.");var r=n.formula();O(e,r),t.optional.push(r)}function O(e,t){var n,r=b(e);i.debug("WHERE: "+r);for(var o;x("OPTIONAL",r);)o=x("OPTIONAL",r),i.debug("OPT: "+o+" "+r[o]+" in "+r),"{"!==r[o+1]&&i.warn("Bad optional opening bracket in word "+o),n=S(r.slice(o+2),"{","}"),n===-1?i.error("No matching bracket in word "+o):(j(r.slice(o+2,o+2+n),t),o=x("OPTIONAL",r),n=S(r.slice(o+2),"{","}"),r.splice(o,n+3));for(i.debug("WHERE after optionals: "+r);x("FILTER",r);){var a=x("FILTER",r);"("!==r[a+1]&&i.warn("Bad filter opening bracket in word "+a),n=S(r.slice(a+2),"(",")"),n===-1?i.error("No matching bracket in word "+a):(R(r.slice(a+2,a+2+n),t),a=x("FILTER",r),n=S(r.slice(a+2),"(",")"),r.splice(a,n+3))}i.debug("WHERE after filters and optionals: "+r),I(r,t)}function I(e,t){var n=new Array(1);n[0]=-1;for(var r=n.concat(_(".",e)),o=[],a=0;a<r.length-1;a++)o[a]=e.slice(r[a]+1,r[a+1]);for(a in o){i.info("s+p+o "+a+" = "+o[a]);var s=o[a][0];o[a].splice(0,1);var u=n.concat(_(";",o[a]));u.push(o[a].length);for(var l=[],c=0;c<u.length-1;c++)l[c]=o[a].slice(u[c]+1,u[c+1]);for(a in l){i.info("p+o "+a+" = "+o[a]);var f=l[a][0];l[a].splice(0,1);var h=n.concat(_(",",l[a]));h.push(l[a].length);var d=[];for(c=0;c<h.length-1;c++)d[c]=l[a].slice(h[c]+1,h[c+1]);for(a in d){var p=d[a][0];i.info("Subj="+s+" Pred="+f+" Obj="+p),t.add(s,f,p)}}}}var C=[];i.info("SPARQL input: \n"+e);var A=new o,L=w(e),D=T(L);D.rdf||(D.rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"),D.rdfs||(D.rdfs="http://www.w3.org/2000/01/rdf-schema#");var P=x("SELECT",L),U=x("WHERE",L);if(P<0||U<0||P>U)return i.error("Invalid or nonexistent SELECT and WHERE tags in SPARQL query"),!1;if(k(L.slice(P+1,U),A),O(L.slice(U+2,L.length-1),A.pat),t)return A;for(var M in A.pat.statements){var q=A.pat.statements[M];"NamedNode"===q.subject.termType&&n.fetcher&&n.fetcher.lookUpThing(q.subject,"sparql:"+q.subject),"NamedNode"===q.object.termType&&n.fetcher&&n.fetcher.lookUpThing(q.object,"sparql:"+q.object)}return A}var i=n(61),o=n(80).Query;e.exports=r},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":r(e)},o=n(63).docpart,a=n(60),s=n(58).graph,u=n(74),l=n(58).namedNode,c=n(69),f=n(77),h=n(63).join,d=n(64),p=function(){var e=function(e){if(this.store=e,e.updater)throw new Error("You can't have two UpdateManagers for the same store");e.fetcher||new a(e),e.updater=this,this.ifps={},this.fps={},this.ns={},this.ns.link=c("http://www.w3.org/2007/ont/link#"),this.ns.http=c("http://www.w3.org/2007/ont/http#"),this.ns.httph=c("http://www.w3.org/2007/ont/httph#"),this.ns.ldp=c("http://www.w3.org/ns/ldp#"),this.ns.rdf=c("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.ns.rdfs=c("http://www.w3.org/2000/01/rdf-schema#"),this.ns.rdf=c("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),this.ns.owl=c("http://www.w3.org/2002/07/owl#"),this.patchControl=[]};return e.prototype.patchControlFor=function(e){return this.patchControl[e.uri]||(this.patchControl[e.uri]=[]),this.patchControl[e.uri]},e.prototype.editable=function(e,t){if(!e)return!1;if(t||(t=this.store),"file:///"===e.slice(0,8)){if(t.holds(t.sym(e),l("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),l("http://www.w3.org/2007/ont/link#MachineEditableDocument")))return"LOCALFILE";var n=t.statementsMatching(t.sym(e),void 0,void 0);return console.log("sparql.editable: Not MachineEditableDocument file "+e+"\n"),console.log(n.map(function(e){return e.toNT()}).join("\n")),!1}var r,i=!1,a=t.each(void 0,this.ns.link("requestedURI"),o(e));if(t.holds(l(e),this.ns.rdf("type"),this.ns.ldp("Resource")))return"SPARQL";for(var s,u,c=0;c<a.length;c++)if(r=a[c],void 0!==r){var f=t.any(r,this.ns.link("response"));if(void 0!==r){var h=t.each(f,this.ns.httph("accept-patch"));if(h.length)for(s=0;s<h.length;s++)if(u=h[s].value.trim(),u.indexOf("application/sparql-update")>=0)return"SPARQL";var d=t.each(f,this.ns.httph("ms-author-via"));if(d.length)for(s=0;s<d.length;s++){if(u=d[s].value.trim(),u.indexOf("SPARQL")>=0)return"SPARQL";if(u.indexOf("DAV")>=0)return"DAV"}var p=t.each(f,this.ns.http("status"));if(p.length)for(s=0;s<p.length;s++)200!==p[s]&&404!==p[s]||(i=!0)}else console.log("sparql.editable: No response for "+e+"\n")}if(0===a.length)console.log("sparql.editable: No request for "+e+"\n");else if(i)return!1;console.log("sparql.editable: inconclusive for "+e+"\n")},e.prototype.anonymize=function(e){return"_:"===e.toNT().substr(0,2)&&this._mentioned(e)?"?"+e.toNT().substr(2):e.toNT()},e.prototype.anonymizeNT=function(e){return this.anonymize(e.subject)+" "+this.anonymize(e.predicate)+" "+this.anonymize(e.object)+" ."},e.prototype._statement_bnodes=function(e){return[e.subject,e.predicate,e.object].filter(function(e){return e.isBlank})},e.prototype._statement_array_bnodes=function(e){for(var t=[],n=0;n<e.length;n++)t=t.concat(this._statement_bnodes(e[n]));t.sort();for(var r=[],i=0;i<t.length;i++)0!==i&&t[i].sameTerm(t[i-1])||r.push(t[i]);return r},e.prototype._cache_ifps=function(){this.ifps={};for(var e=this.store.each(void 0,this.ns.rdf("type"),this.ns.owl("InverseFunctionalProperty")),t=0;t<e.length;t++)this.ifps[e[t].uri]=!0;for(this.fps={},e=this.store.each(void 0,this.ns.rdf("type"),this.ns.owl("FunctionalProperty")),t=0;t<e.length;t++)this.fps[e[t].uri]=!0},e.prototype._bnode_context2=function(e,t,n){for(var r,i,o=this.store.statementsMatching(void 0,void 0,e,t),a=0;a<o.length;a++)if(this.fps[o[a].predicate.uri]){if(r=o[a].subject,!r.isBlank)return[o[a]];if(n&&(i=this._bnode_context2(r,t,n-1)))return i.concat([o[a]])}for(o=this.store.statementsMatching(e,void 0,void 0,t),a=0;a<o.length;a++)if(this.ifps[o[a].predicate.uri]){if(r=o[a].object,!r.isBlank)return[o[a]];if(n&&(i=this._bnode_context2(r,t,n-1)))return i.concat([o[a]])}return null},e.prototype._bnode_context_1=function(e,t){for(var n=0;n<3;n++){var r=this._bnode_context2(e,t,n);if(null!==r)return r}throw new Error("Unable to uniquely identify bnode: "+e.toNT())},e.prototype._mentioned=function(e){return 0!==this.store.statementsMatching(e).length||0!==this.store.statementsMatching(void 0,e).length||0!==this.store.statementsMatching(void 0,void 0,e).length},e.prototype._bnode_context=function(e,t){var n=[];if(e.length){this._cache_ifps();for(var r=0;r<e.length;r++){var i=e[r];this._mentioned(i)&&(n=n.concat(this._bnode_context_1(i,t)))}}return n},e.prototype._statement_context=function(e){var t=this._statement_bnodes(e);return this._bnode_context(t,e.why)},e.prototype._context_where=function(e){var t=this;return e&&0!==e.length?"WHERE { "+e.map(function(e){return t.anonymizeNT(e)}).join("\n")+" }\n":""},e.prototype._fire=function(e,t,n){if(!e)throw new Error("No URI given for remote editing operation: "+t);console.log("sparql: sending update to <"+e+">");var r=d.XMLHTTPFactory();r.options={},r.onreadystatechange=function(){if(4===r.readyState){var i=!r.status||r.status>=200&&r.status<300;i?console.log("sparql: update Ok for <"+e+">"):console.log("sparql: update failed for <"+e+"> status="+r.status+", "+r.statusText+", body length="+r.responseText.length+"\n   for query: "+t),n(e,i,r.responseText,r)}},r.open("PATCH",e,!0),r.setRequestHeader("Content-type","application/sparql-update"),r.send(t)},e.prototype.update_statement=function(e){if(!e||e.why){var t=this,n=this._statement_context(e);return{statement:e?[e.subject,e.predicate,e.object,e.why]:void 0,statementNT:e?this.anonymizeNT(e):void 0,where:t._context_where(n),set_object:function(e,n){var r=this.where;r+="DELETE DATA { "+this.statementNT+" } ;\n",r+="INSERT DATA { "+this.anonymize(this.statement[0])+" "+this.anonymize(this.statement[1])+" "+this.anonymize(e)+"  . }\n",t._fire(this.statement[3].uri,r,n)}}}},e.prototype.insert_statement=function(e,t){var n=e instanceof Array?e[0]:e,r=this._context_where(this._statement_context(n));if(e instanceof Array){for(var i="",o=0;o<e.length;o++)i+=e[o]+"\n";r+="INSERT DATA { "+i+" }\n"}else r+="INSERT DATA { "+this.anonymize(e.subject)+" "+this.anonymize(e.predicate)+" "+this.anonymize(e.object)+"  . }\n";this._fire(n.why.uri,r,t)},e.prototype.delete_statement=function(e,t){var n=e instanceof Array?e[0]:e,r=this._context_where(this._statement_context(n));if(e instanceof Array){for(var i="",o=0;o<e.length;o++)i+=e[o]+"\n";r+="DELETE DATA { "+i+" }\n"}else r+="DELETE DATA { "+this.anonymize(e.subject)+" "+this.anonymize(e.predicate)+" "+this.anonymize(e.object)+"  . }\n";this._fire(n.why.uri,r,t)},e.prototype.requestDownstreamAction=function(e,t){var n=this.patchControlFor(e);if(n.pendingUpstream){if(n.downstreamAction){if(n.downstreamAction===t)return;throw new Error("Can't wait for > 1 differnt downstream actions")}n.downstreamAction=t}else t(e)},e.prototype.clearUpstreamCount=function(e){var t=this.patchControlFor(e);t.upstreamCount=0},e.prototype.getUpdatesVia=function(e){var t=this.store.fetcher.getHeader(e,"updates-via");return t&&t.length?t[0].trim():null},e.prototype.addDownstreamChangeListener=function(e,t){var n=this.patchControlFor(e);n.downstreamChangeListeners||(n.downstreamChangeListeners=[]),n.downstreamChangeListeners.push(t);var r=this;this.setRefreshHandler(e,function(e){r.reloadAndSync(e)})},e.prototype.reloadAndSync=function(e){var t=this.patchControlFor(e),n=this;if(t.reloading)return void console.log("   Already reloading - stop");t.reloading=!0;var r=1e3,i=function i(){console.log("try reload - timeout = "+r),n.reload(n.store,e,function(n,o,a){if(t.reloading=!1,n){if(t.downstreamChangeListeners)for(var s=0;s<t.downstreamChangeListeners.length;s++)console.log("        Calling downstream listener "+s),t.downstreamChangeListeners[s]()}else 0===a.status?(console.log("Network error refreshing the data. Retrying in "+r/1e3),t.reloading=!0,r*=2,setTimeout(i,r)):console.log("Error "+a.status+"refreshing the data:"+o+". Stopped"+e)})};i()},e.prototype.setRefreshHandler=function(e,t){var n=this.getUpdatesVia(e),r=t,i=this,o=this,a=1500,s=0;if(!n)return console.log("Server doies not support live updates thoughUpdates-Via :-("),!1;n=h(n,e.uri),n=n.replace(/^http:/,"ws:").replace(/^https:/,"wss:"),console.log("Web socket URI "+n);var u=function t(){var u;if("undefined"!=typeof WebSocket)u=new WebSocket(n);else if("undefined"!=typeof Services)u=Services.wm.getMostRecentWindow("navigator:browser").WebSocket(n);else{if("undefined"==typeof window||!window.WebSocket)return void console.log("Live update disabled, as WebSocket not supported by platform :-(");u=window.WebSocket(n)}u.onopen=function(){console.log("    websocket open"),a=1500,this.send("sub "+e.uri),s&&(console.log("Web socket has been down, better check for any news."),o.requestDownstreamAction(e,r))};var l=i.patchControlFor(e);l.upstreamCount=0,u.onclose=function(e){console.log("*** Websocket closed with code "+e.code+", reason '"+e.reason+"' clean = "+e.clean),a*=2,s+=1,console.log("Retrying in "+a+"ms"),setTimeout(function(){console.log("Trying websocket again"),t()},a)},u.onmessage=function(t){if(t.data&&"pub"===t.data.slice(0,3)){if("upstreamCount"in l&&(l.upstreamCount-=1,l.upstreamCount>=0))return void console.log("just an echo: "+l.upstreamCount);console.log("Assume a real downstream change: "+l.upstreamCount+" -> 0"),l.upstreamCount=0,i.requestDownstreamAction(e,r)}}};return u(),!0},e.prototype.update=function(e,t,n){try{var r=this.store,o=e?e instanceof u?e.statements:e instanceof Array?e:[e]:[],a=t?t instanceof u?t.statements:t instanceof Array?t:[t]:[];if(!(o instanceof Array))throw new Error("Type Error "+("undefined"==typeof o?"undefined":i(o))+": "+o);if(!(a instanceof Array))throw new Error("Type Error "+("undefined"==typeof a?"undefined":i(a))+": "+a);if(0===o.length&&0===a.length)return n(null,!0);var s=o.length?o[0].why:a[0].why,l=this.patchControlFor(s),c=Date.now(),p=["subject","predicate","object","why"],y=["insert","delete"],v={delete:o,insert:a};y.map(function(e){v[e].map(function(e){if(!s.sameTerm(e.why))throw new Error("update: destination "+s+" inconsistent with delete quad "+e.why);p.map(function(t){if("undefined"==typeof e[t])throw new Error("update: undefined "+t+" of statement.")})})});var g=this.editable(s.uri,r);if(!g)throw new Error("Can't make changes in uneditable "+s);var m,b,w,x;if(g.indexOf("SPARQL")>=0){var _=[];o.length&&(_=this._statement_array_bnodes(o)),a.length&&(_=_.concat(this._statement_array_bnodes(a)));var k=this._bnode_context(_,s),T=this._context_where(k),S="";if(T.length){if(o.length){for(S+="DELETE { ",m=0;m<o.length;m++)S+=this.anonymizeNT(o[m])+"\n";S+=" }\n"}if(a.length){for(S+="INSERT { ",m=0;m<a.length;m++)S+=this.anonymizeNT(a[m])+"\n";S+=" }\n"}S+=T}else{if(o.length){for(S+="DELETE DATA { ",m=0;m<o.length;m++)S+=this.anonymizeNT(o[m])+"\n";S+=" } \n"}if(a.length){for(o.length&&(S+=" ; "),S+="INSERT DATA { ",m=0;m<a.length;m++)S+=this.anonymizeNT(a[m])+"\n";S+=" }\n"}}l.pendingUpstream=l.pendingUpstream?l.pendingUpstream+1:1,"upstreamCount"in l&&(l.upstreamCount+=1,console.log("upstream count up to : "+l.upstreamCount)),this._fire(s.uri,S,function(e,t,i,u){if(u.elapsedTime_ms=Date.now()-c,console.log("    sparql: Return "+(t?"success":"FAILURE "+u.status)+" elapsed "+u.elapsedTime_ms+"ms"),t){try{r.remove(o)}catch(e){t=!1,i="Remote Ok BUT error deleting "+o.length+" from store!!! "+e}for(var f=0;f<a.length;f++)r.add(a[f].subject,a[f].predicate,a[f].object,s)}if(n(e,t,i,u),l.pendingUpstream-=1,0===l.pendingUpstream&&l.downstreamAction){var h=l.downstreamAction;delete l.downstreamAction,console.log("delayed downstream action:"),h(s)}})}else if(g.indexOf("DAV")>=0){var E=r.any(s,this.ns.link("request"));if(!E)throw new Error("No record of our HTTP GET request for document: "+s);var N=r.any(E,this.ns.link("response"));if(!N)return null;var R=r.the(N,this.ns.httph("content-type")).value;for(b=r.statementsMatching(void 0,void 0,void 0,s).slice(),m=0;m<o.length;m++)d.RDFArrayRemove(b,o[m]);for(m=0;m<a.length;m++)b.push(a[m]);switch(x=f(r),x.suggestNamespaces(r.namespaces),x.setBase(s.uri),R){case"application/rdf+xml":w=x.statementsToXML(b);break;case"text/n3":case"text/turtle":case"application/x-turtle":case"application/n3":w=x.statementsToN3(b);break;default:throw new Error("Content-type "+R+" not supported for data write")}var j,O=r.the(N,this.ns.httph("content-location"));O&&(j=h(O.value,j));var I=d.XMLHTTPFactory();I.options={},I.onreadystatechange=function(){if(4===I.readyState){var e=!I.status||I.status>=200&&I.status<300;if(e){for(var t=0;t<o.length;t++)r.remove(o[t]);for(t=0;t<a.length;t++)r.add(a[t].subject,a[t].predicate,a[t].object,s)}n(s.uri,e,I.responseText)}},I.open("PUT",j,!0),I.setRequestHeader("Content-type",R),I.send(w)}else{if(!(g.indexOf("LOCALFILE")>=0))throw new Error("Unhandled edit method: '"+g+"' for "+s);try{for(console.log("Writing back to local file\n"),b=r.statementsMatching(void 0,void 0,void 0,s).slice(),m=0;m<o.length;m++)d.RDFArrayRemove(b,o[m]);for(m=0;m<a.length;m++)b.push(a[m]);x=f(r),x.suggestNamespaces(r.namespaces),x.setBase(s.uri);var C=s.uri.lastIndexOf(".");if(C<1)throw new Error("Rewriting file: No filename extension: "+s.uri);var A=s.uri.slice(C+1);switch(A){case"rdf":case"owl":case"xml":w=x.statementsToXML(b);break;case"n3":case"nt":case"ttl":w=x.statementsToN3(b);break;default:throw new Error("File extension ."+A+" not supported for data write")}console.log("Writing back: <<<"+w+">>>");var L=s.uri.slice(7),D=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);if(D.initWithPath(L),!D.exists())throw new Error("Rewriting file <"+s.uri+"> but it does not exist!");var P=Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);for(P.init(D,42,parseInt("0666",8),0),P.write(w,w.length),P.close(),m=0;m<o.length;m++)r.remove(o[m]);for(m=0;m<a.length;m++)r.add(a[m].subject,a[m].predicate,a[m].object,s);n(s.uri,!0,"")}catch(e){n(s.uri,!1,"Exception trying to write back file <"+s.uri+">\n")}}}catch(e){n(void 0,!1,"Exception in update: "+e)}},e.prototype.put=function(e,t,n,r){var o,a=this.store;if(("undefined"==typeof t?"undefined":i(t))===i(""))o=t;else{var s=f(a);switch(s.suggestNamespaces(a.namespaces),s.setBase(e.uri),n){case"application/rdf+xml":o=s.statementsToXML(t);break;case"text/n3":case"text/turtle":case"application/x-turtle":case"application/n3":o=s.statementsToN3(t);break;default:throw new Error("Content-type "+n+" not supported for data PUT")}}var u=d.XMLHTTPFactory();u.options={},u.onreadystatechange=function(){if(4===u.readyState){var n=!u.status||u.status>=200&&u.status<300;n&&"string"!=typeof t&&t.map(function(e){a.addStatement(e)}),n&&(delete a.fetcher.nonexistant[e.uri],delete a.fetcher.requested[e.uri]),r(e.uri,n,u.responseText,u)}},u.open("PUT",e.uri,!0),u.setRequestHeader("Content-type",n),u.send(o)},e.prototype.reload=function(e,t,n){var r=Date.now();e.fetcher.nowOrWhenFetched(t.uri,{force:!0,noMeta:!0,clearPreviousData:!0},function(e,i,o){if(e)if(o.onErrorWasCalled||200!==o.status)console.log("    Non-HTTP error reloading data! onErrorWasCalled="+o.onErrorWasCalled+" status: "+o.status),n(!1,"Non-HTTP error reloading data: "+i,o);else{var a=Date.now()-r;t.reloadTime_total||(t.reloadTime_total=0),t.reloadTime_count||(t.reloadTime_count=0),t.reloadTime_total+=a,t.reloadTime_count+=1,console.log("    Fetch took "+a+"ms, av. of "+t.reloadTime_count+" = "+t.reloadTime_total/t.reloadTime_count+"ms."),n(!0)}else console.log("    ERROR reloading data: "+i),n(!1,"Error reloading data: "+i,o)})},e.prototype.oldReload=function(e,t,n){var r=s(),i=fetcher(r),o=Date.now();i.nowOrWhenFetched(t.uri,{force:!0,noMeta:!0,clearPreviousData:!0},function(i,a,s){if(i)if(s.onErrorWasCalled||200!==s.status)console.log("    Non-HTTP error reloading data! onErrorWasCalled="+s.onErrorWasCalled+" status: "+s.status),n(!1,"Non-HTTP error reloading data: "+a,s);else{var u=e.statementsMatching(void 0,void 0,void 0,t).slice(),l=r.statementsMatching(void 0,void 0,void 0,t).slice();console.log("    replacing "+u.length+" with "+l.length+" out of total statements "+e.statements.length),e.remove(u),e.add(l);var c=Date.now()-o;0===l.length&&console.log("????????????????? 0000000"),t.reloadTime_total||(t.reloadTime_total=0),t.reloadTime_count||(t.reloadTime_count=0),t.reloadTime_total+=c,t.reloadTime_count+=1,console.log("    fetch took "+c+"ms, av. of "+t.reloadTime_count+" = "+t.reloadTime_total/t.reloadTime_count+"ms."),n(!0)}else console.log("    ERROR reloading data: "+a),n(!1,"Error reloading data: "+a,s)})},e}();e.exports=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(58).namedNode,a=function(){function e(t,n){r(this,e),this.parent=t,this.via=n,this.connected=!1,this.pending={},this.subscribed={},this.socket={};try{this.socket=new WebSocket(n),this.socket.onopen=this.onOpen,this.socket.onclose=this.onClose,this.socket.onmessage=this.onMessage,this.socket.onerror=this.onError}catch(e){this.onError(e)}}return i(e,[{key:"_decode",value:function(e){var t,n,r,i,o,a,s;i={},o=function(){var n,r,i,o;for(i=e.split("&"),o=[],n=0,r=i.length;n<r;n++)t=i[n],o.push(t.split("="));return o}();for(n in o)t=o[n],a=[decodeURIComponent(t[0]),decodeURIComponent(t[1])],r=a[0],s=a[1],null==i[r]&&(i[r]=[]),i[r].push(s);return i}},{key:"_send",value:function(e,t,n){var r,i;return i=[e,t,n].join(" "),"function"==typeof(r=this.socket).send?r.send(i):void 0}},{key:"_subscribe",value:function(e){return this._send("sub",e,""),this.subscribed[e]=!0,this.subscribed[e]}},{key:"onClose",value:function(e){var t;this.connected=!1;for(t in this.subscribed)this.pending[t]=!0;return this.subscribed={},this.subscribed}},{key:"onError",value:function(e){throw new Error("onError"+e)}},{key:"onMessage",value:function(e){var t,n;return n=e.data.split(" "),"ping"===n[0]?"function"==typeof(t=this.socket).send?t.send("pong "+n.slice(1).join(" ")):void 0:"pub"===n[0]?this.parent.onUpdate(n[1],this._decode(n[2])):void 0}},{key:"onOpen",value:function(e){var t,n;this.connected=!0,t=[];for(n in this.pending)delete this.pending[n],t.push(this._subscribe(n));return t}},{key:"subscribe",value:function(e){return this.connected?this._subscribe(e):(this.pending[e]=!0,this.pending[e])}}]),e}(),s=function(){function e(t){r(this,e),this.fetcher=t,this.graph={},this.via={},this.fetcher.addCallback("headers",this.onHeaders)}return i(e,[{key:"onHeaders",value:function(e){var t,n,r;return null==e.headers||("undefined"==typeof WebSocket||null===WebSocket||(t=e.headers.etag,r=e.headers["updates-via"],n=e.uri,t&&r&&(this.graph[n]={etag:t,via:r},this.register(r,n)),!0))}},{key:"onUpdate",
value:function(e,t){return this.fetcher.refresh(o(e))}},{key:"register",value:function(e,t){return null==this.via[e]&&(this.via[e]=new a(this,e)),this.via[e].subscribe(t)}}]),e}();e.exports.UpdatesSocket=a,e.exports.UpdatesVia=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(88),a=function(){function e(){r(this,e),this.accessToken=null,this.currentClient=null,this.providerUri=null,this.webId=null,this.defaultCallbacks={onLoginSuccess:function(e,t){console.log("onLoginSuccess() callback! webId: ",e,"access_token: ",t)},onProviderSelected:function(e){console.log("onProviderSelected() callback! providerUri: ",e)}},this.callbacks={}}return i(e,[{key:"detectAuthCallback",value:function(){var e=this,t=window.location.href,n=this.extractState(t,"hash");if(n){console.log("Auth callback detected. Loading provider by state: ",n);var r=this.loadProvider(n);return r?(console.log("Provider loaded from state: ",r,". Loading client."),this.dispatchProviderSelected(r),this.loadOrRegisterClient(r).then(function(e){if(e)return console.log("Loaded client: ",e.registration.client_id),console.log("Validating auth response..."),e.validateResponse(t,localStorage)}).then(function(t){console.log("Validated auth response: ",t);var n=t.decoded.payload.sub,r=t.params.access_token;return e.dispatchLoginSuccess(n,r)}).catch(function(e){if("Cannot resolve signing key for ID Token."!==e.message)throw e;console.error("ID Token found, but could not validate. Provider likely has changed their public keys. Not signed in.")})):void console.error("Auth callback detected, but no provider stored for state!")}}},{key:"dispatchLoginSuccess",value:function(e,t){this.webId=e,this.accessToken=t;var n=this.callbacks.onLoginSuccess||this.defaultCallbacks.onLoginSuccess;if(!n)throw new Error("onLoginSuccess() callback not found");n.bind(this),n(e,t)}},{key:"dispatchProviderSelected",value:function(e){this.providerUri=e;var t=this.callbacks.onProviderSelected||this.defaultCallbacks.onProviderSelected;if(!t)throw new Error("onProviderSelected() callback not found");t.bind(this),t(e)}},{key:"extractState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hash";if(e){var n=new URL(e),r=void 0;if("hash"===t){var i=n.hash||"#",o=new URLSearchParams(i.substr(1));r=o.get("state")}return"query"===t&&(r=n.searchParams.get("state")),r}}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.callbacks=e,window.addEventListener("message",this.onMessage.bind(this)),this.detectAuthCallback()}},{key:"keyByProvider",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.providerUri;return"oidc.rp.by-provider."+e}},{key:"keyByState",value:function(e){return"oidc.rp.by-state."+e}},{key:"loadOrRegisterClient",value:function(e){var t=this;if(this.currentClient)return console.log("currentClient cached, returning"),Promise.resolve(this.currentClient);var n=this.keyByProvider(e),r=localStorage.getItem(n);return r?(console.log("client config stored locally for ",e),r=JSON.parse(r),o.from(r)):(console.log("client config not stored, proceeding to register client"),this.registerClient(e).then(function(n){return t.storeClient(n,e),n}))}},{key:"loadProvider",value:function(e){var t=this.keyByState(e),n=localStorage.getItem(t);return n}},{key:"login",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"redirect";if(!t)throw new TypeError("Cannot login(), missing client");return t.createRequest({},localStorage).then(function(t){console.log("login()>createRequest()>url: ",t);var i=n.extractState(t,"query");if(!i)throw new Error("login() - could not extract state param");n.saveProviderByState(e,i),"redirect"===r&&(window.location=t)})}},{key:"registerClient",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.registerPublicClient(e,t).catch(function(e){console.error("Error while registering:",e)})}},{key:"registerPublicClient",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(console.log("Registering public client..."),!e)throw new TypeError("Cannot registerClient auth client, missing providerUri");var n=t.redirectUri||window.location.href;this.redirectUri=n;var r={issuer:e,grant_types:["implicit"],redirect_uris:[n],response_types:["id_token token"],scope:t.scope||"openid profile"},i={defaults:{authenticate:{redirect_uri:n,response_type:"id_token token"}},store:t.store||localStorage};return o.register(e,r,i)}},{key:"onMessage",value:function(e){if(console.log("Auth client received event: ",e),e&&e.data)switch(e.data.event_type){case"providerSelected":this.selectProvider(e.data.value);break;default:console.error("onMessage - unknown event type: ",e)}}},{key:"saveProviderByState",value:function(e,t){var n=this.keyByState(t);localStorage.setItem(n,e)}},{key:"selectProvider",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"redirect";this.dispatchProviderSelected(e),this.loadOrRegisterClient(e).then(function(r){return console.log("Obtained registered client. Proceeding to login()."),t.login(e,r,n)})}},{key:"storeClient",value:function(e,t){this.currentClient=e,localStorage.setItem(this.keyByProvider(t),e.serialize())}}]),e}();e.exports=a},function(e,t,n){"use strict";e.exports=n(89)},function(e,t,n){(function(t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(90),l=n(94),c=l.Headers?l.Headers:t.Headers,f=n(95),h=(f.JSONSchema,f.JSONDocument),d=n(104),p=d.JWKSet,y=n(129),v=n(135),g=n(138),m=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"discover",value:function(){var e=this;try{var t=this.provider.url,n=".well-known/openid-configuration";return u(t,'RelyingParty provider must define "url"'),l(t+"/"+n).then(function(t){return t.json().then(function(t){return e.provider.configuration=t})})}catch(e){return Promise.reject(e)}}},{key:"register",value:function(e){var t=this;try{var n=this.provider.configuration;u(n,"OpenID Configuration is not initialized."),u(n.registration_endpoint,"OpenID Configuration is missing registration_endpoint.");var r=n.registration_endpoint,i="post",o=new c({"Content-Type":"application/json"}),a=this.defaults.register,s=JSON.stringify(Object.assign({},a,e));return l(r,{method:i,headers:o,body:s}).then(function(e){return e.json().then(function(e){return t.registration=e})})}catch(e){return Promise.reject(e)}}},{key:"serialize",value:function(){return JSON.stringify(this)}},{key:"jwks",value:function(){var e=this;try{var t=this.provider.configuration;u(t,"OpenID Configuration is not initialized."),u(t.jwks_uri,"OpenID Configuration is missing jwks_uri.");var n=t.jwks_uri;return l(n).then(function(t){return t.json().then(function(e){return p.importKeys(e)}).then(function(t){return e.provider.jwks=t})})}catch(e){return Promise.reject(e)}}},{key:"createRequest",value:function(e,t){return y.create(this,e,t||this.store)}},{key:"validateResponse",value:function(e,t){return t=t||this.store,e=e.match(/^http(s?):\/\//)?{rp:this,redirect:e,session:t}:{rp:this,body:e,session:t},v.validateResponse(e)}},{key:"userinfo",value:function(){try{var e=this.provider.configuration;u(e,"OpenID Configuration is not initialized."),u(e.registration_endpoint,"OpenID Configuration is missing registration_endpoint.");var t=e.userinfo_endpoint,n=this.session.access_token;u(n,"Missing access token.");var r=new c({"Content-Type":"application/json",Authorization:"Bearer "+n});return l(t,{headers:r}).then(status(200)).then(function(e){return e.json()})}catch(e){return Promise.reject(e)}}},{key:"logout",value:function(){}}],[{key:"from",value:function(e){var n=new t(e),r=n.validate();if(!r.valid)return Promise.reject(r);var i=n.provider.jwks;return i?p.importKeys(i).then(function(e){return n.provider.jwks=e,n}):n.jwks().then(function(){return n})}},{key:"register",value:function(e,n,r){var i=new t({provider:{url:e},defaults:Object.assign({},r.defaults),store:r.store});return Promise.resolve().then(function(){return i.discover()}).catch(function(e){throw console.error("Error in RP register() > discover() step:",e),e}).then(function(){return i.jwks()}).catch(function(e){throw console.error("Error in RP register() > jwks() step:",e),e}).then(function(){return i.register(n)}).catch(function(e){throw console.error("Error in RP register() > register() step:",e),e}).then(function(){return i})}},{key:"schema",get:function(){return g}}]),t}(h);e.exports=m}).call(t,function(){return this}())},function(e,t,n){(function(t){"use strict";/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
function r(e,t){if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0}function i(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function o(e){return Object.prototype.toString.call(e)}function a(e){return!i(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}function s(e){if(w.isFunction(e)){if(k)return e.name;var t=e.toString(),n=t.match(S);return n&&n[1]}}function u(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function l(e){if(k||!w.isFunction(e))return w.inspect(e);var t=s(e),n=t?": "+t:"";return"[Function"+n+"]"}function c(e){return u(l(e.actual),128)+" "+e.operator+" "+u(l(e.expected),128)}function f(e,t,n,r,i){throw new T.AssertionError({message:n,actual:e,expected:t,operator:r,stackStartFunction:i})}function h(e,t){e||f(e,!0,t,"==",T.ok)}function d(e,t,n,s){if(e===t)return!0;if(i(e)&&i(t))return 0===r(e,t);if(w.isDate(e)&&w.isDate(t))return e.getTime()===t.getTime();if(w.isRegExp(e)&&w.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(a(e)&&a(t)&&o(e)===o(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(i(e)!==i(t))return!1;s=s||{actual:[],expected:[]};var u=s.actual.indexOf(e);return u!==-1&&u===s.expected.indexOf(t)||(s.actual.push(e),s.expected.push(t),y(e,t,n,s))}return n?e===t:e==t}function p(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function y(e,t,n,r){if(null===e||void 0===e||null===t||void 0===t)return!1;if(w.isPrimitive(e)||w.isPrimitive(t))return e===t;if(n&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var i=p(e),o=p(t);if(i&&!o||!i&&o)return!1;if(i)return e=_.call(e),t=_.call(t),d(e,t,n);var a,s,u=E(e),l=E(t);if(u.length!==l.length)return!1;for(u.sort(),l.sort(),s=u.length-1;s>=0;s--)if(u[s]!==l[s])return!1;for(s=u.length-1;s>=0;s--)if(a=u[s],!d(e[a],t[a],n,r))return!1;return!0}function v(e,t,n){d(e,t,!0)&&f(e,t,n,"notDeepStrictEqual",v)}function g(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&t.call({},e)===!0}function m(e){var t;try{e()}catch(e){t=e}return t}function b(e,t,n,r){var i;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=m(t),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),e&&!i&&f(i,n,"Missing expected exception"+r);var o="string"==typeof r,a=!e&&w.isError(i),s=!e&&i&&!n;if((a&&o&&g(i,n)||s)&&f(i,n,"Got unwanted exception"+r),e&&i&&n&&!g(i,n)||!e&&i)throw i}var w=n(91),x=Object.prototype.hasOwnProperty,_=Array.prototype.slice,k=function(){return"foo"===function(){}.name}(),T=e.exports=h,S=/\s*function\s+([^\(\s]*)\s*/;T.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=c(this),this.generatedMessage=!0);var t=e.stackStartFunction||f;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var n=new Error;if(n.stack){var r=n.stack,i=s(t),o=r.indexOf("\n"+i);if(o>=0){var a=r.indexOf("\n",o+1);r=r.substring(a+1)}this.stack=r}}},w.inherits(T.AssertionError,Error),T.fail=f,T.ok=h,T.equal=function(e,t,n){e!=t&&f(e,t,n,"==",T.equal)},T.notEqual=function(e,t,n){e==t&&f(e,t,n,"!=",T.notEqual)},T.deepEqual=function(e,t,n){d(e,t,!1)||f(e,t,n,"deepEqual",T.deepEqual)},T.deepStrictEqual=function(e,t,n){d(e,t,!0)||f(e,t,n,"deepStrictEqual",T.deepStrictEqual)},T.notDeepEqual=function(e,t,n){d(e,t,!1)&&f(e,t,n,"notDeepEqual",T.notDeepEqual)},T.notDeepStrictEqual=v,T.strictEqual=function(e,t,n){e!==t&&f(e,t,n,"===",T.strictEqual)},T.notStrictEqual=function(e,t,n){e===t&&f(e,t,n,"!==",T.notStrictEqual)},T.throws=function(e,t,n){b(!0,e,t,n)},T.doesNotThrow=function(e,t,n){b(!1,e,t,n)},T.ifError=function(e){if(e)throw e};var E=Object.keys||function(e){var t=[];for(var n in e)x.call(e,n)&&t.push(n);return t}}).call(t,function(){return this}())},[177,92,93],54,31,function(e,t){e.exports=fetch},function(e,t,n){"use strict";e.exports={Formats:n(96),Initializer:n(97),JSONDocument:n(98),JSONMapping:n(101),JSONPatch:n(99),JSONPointer:n(100),JSONSchema:n(102),Validator:n(103)}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s][0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i,o=/^(?:[a-z][a-z0-9+-.]*)?(?:\:|\/)\/?[^\s]*$/i,a=/^[a-z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,s=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,u=/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,l=/^[a-z](?:(?:[-0-9a-z]{0,61})?[0-9a-z])?(\.[a-z](?:(?:[-0-9a-z]{0,61})?[0-9a-z])?)*$/i,c=function(){function e(){n(this,e)}return r(e,[{key:"register",value:function(e,t){if("string"!=typeof e)throw new Error("Format name must be a string");return"string"==typeof t&&(t=new RegExp(t)),this[e]=t}},{key:"resolve",value:function(e){var t=this[e];if(!t)throw new Error("Unknown JSON Schema format.");return t}},{key:"test",value:function(e,t){var n=this.resolve(e);return n.test(t)}}],[{key:"initialize",value:function(){var t=new e;return t.register("date-time",i),t.register("uri",o),t.register("email",a),t.register("ipv4",s),t.register("ipv6",u),t.register("hostname",l),t}}]),e}();e.exports=c.initialize()},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){n(this,e),this.schema=t}return r(e,null,[{key:"compile",value:function(t){var n=new e(t);return n.parse(),n.compile()}}]),r(e,[{key:"parse",value:function(){function e(t,r){var i=t.properties||{};Object.keys(i).forEach(function(t){var o=r.concat([t]),a=i[t],s={key:t,fn:"property",ref:o.join("."),chain:o};a.private&&(s.private=!0),a.default&&(s.default=a.default),a.immutable&&(s.immutable=!0),a.set&&(s.setter=a.set),a.after&&(s.after=a.after),a.properties?(n.get(o)||(s.fn="ensureContainer",n.set(o,s)),e(a,o)):n.set(o,s)})}var t=this.schema,n=this.operations=new Map;e(t,[])}},{key:"compile",value:function(){var e=this,t="options = options || {}\n";return this.operations.forEach(function(n){t+=e[n.fn](n)}),new Function("target","source","options",t)}},{key:"property",value:function(e){return e.private?this.private(e):this.assign(e)}},{key:"private",value:function(e){return"\n    if (options.private) {\n      "+this.assign(e)+"\n    }\n    "}},{key:"assign",value:function(e){var t=void 0;return t=e.setter?this.setterAssign(e):e.immutable?this.immutableAssign(e):this.simpleAssign(e),t="\n    if ("+this.condition(e)+") {\n      "+t+"\n    } "+(e.default?this.defaults(e):"")+"\n    ",e.after&&(t+=this.afterAssign(e)),t}},{key:"immutableAssign",value:function(e){var t="target",n=e.chain.slice(0,e.chain.length-1).join(".");return n&&(t=t+"."+n),"Object.defineProperty("+t+", '"+e.key+"', {\n        value: source."+e.ref+",\n        writable: "+!e.immutable+",\n        enumerable: true\n      })"}},{key:"simpleAssign",value:function(e){return"target."+e.ref+" = source."+e.ref}},{key:"setterAssign",value:function(e){return"target."+e.ref+" = ("+e.setter.toString()+")(source)"}},{key:"afterAssign",value:function(e){return"\n    ("+e.after.toString()+").call(target, source)\n    "}},{key:"defaults",value:function(e){return"function"==typeof e.default?e.defaultString="("+e.default.toString()+")()":e.defaultString=JSON.stringify(e.default),"else if (options.defaults !== false) {\n      "+(e.immutable?this.immutableDefault(e):this.simpleDefault(e))+"\n    }"}},{key:"simpleDefault",value:function(e){return"target."+e.ref+" = "+e.defaultString}},{key:"immutableDefault",value:function(e){var t="target",n=e.chain.slice(0,e.chain.length-1).join(".");return n&&(t=t+"."+n),"Object.defineProperty("+t+", '"+e.key+"', {\n        value: "+e.defaultString+",\n        writable: "+!e.immutable+",\n        enumerable: true\n      })"}},{key:"condition",value:function e(t){var n=t.chain,r=t.ref,i=n.reduce(function(e,t,r){return r>0&&e.push("source."+n.slice(0,r).join(".")),e},[]).join(" && "),e=i?i+" && source."+r+" !== undefined":"source."+r+" !== undefined";return e}},{key:"ensureContainer",value:function(e){return"\n    if (!target."+e.ref+") {\n      target."+e.ref+" = {}\n    }\n    "}}]),e}();e.exports=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(99),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e),this.initialize(t,n)}return i(e,null,[{key:"schema",get:function(){throw new Error("Schema must be defined by classes extending JSONDocument")}}]),i(e,[{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.constructor.schema;n.initialize(this,e,t)}},{key:"validate",value:function(e){var t=this.constructor.schema;return(e||t).validate(this)}},{key:"patch",value:function e(t){var e=new o(t);e.apply(this)}},{key:"select",value:function(){}},{key:"project",value:function(e){return e.project(this)}}],[{key:"serialize",value:function(e){return JSON.stringify(e)}},{key:"deserialize",value:function(e){try{return JSON.parse(e)}catch(e){throw new Error("Failed to parse JSON")}}}]),e}();e.exports=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"==typeof e?"undefined":i(e)},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(100),u=2,l=["add","remove","replace","move","copy","test"],c=function(){function e(t){r(this,e),this.ops=t||[]}return a(e,[{key:"apply",value:function(e){var t=this;this.ops.forEach(function(n){var r=n.op;if(!r)throw new Error('Missing "op" in JSON Patch operation');if(l.indexOf(r)===-1)throw new Error('Invalid "op" in JSON Patch operation');if(!n.path)throw new Error('Missing "path" in JSON Patch operation');t[r](n,e)})}},{key:"add",value:function(e,t){if(void 0===e.value)throw new Error('Missing "value" in JSON Patch add operation');var n=new s(e.path,u);n.add(t,e.value)}},{key:"remove",value:function(e,t){var n=new s(e.path);n.remove(t)}},{key:"replace",value:function(e,t){if(void 0===e.value)throw new Error('Missing "value" in JSON Patch replace operation');var n=new s(e.path);n.replace(t,e.value)}},{key:"move",value:function(e,t){if(void 0===e.from)throw new Error('Missing "from" in JSON Patch move operation');if(e.path.match(new RegExp("^"+e.from)))throw new Error('Invalid "from" in JSON Patch move operation');var n=new s(e.path),r=new s(e.from),i=r.get(t);r.remove(t),n.add(t,i)}},{key:"copy",value:function(e,t){if(void 0===e.from)throw new Error('Missing "from" in JSON Patch copy operation');var n=new s(e.path),r=new s(e.from),i=r.get(t);n.add(t,i)}},{key:"test",value:function(e,t){if(void 0===e.value)throw new Error('Missing "value" in JSON Patch test operation');var n=new s(e.path),r=n.get(t);switch(o(e.value)){default:if(r!==e.value)throw new Error("Mismatching JSON Patch test value")}}}]),e}();e.exports=c},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=0,o=1,a=2,s=function(){function e(t,r){n(this,e),this.expr=t,this.mode=r||i,this.tokens=t&&"#"===t.charAt(0)?this.parseURIFragmentIdentifier(t):this.parseJSONString(t)}return r(e,[{key:"escape",value:function(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}},{key:"unescape",value:function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}},{key:"parseJSONString",value:function(e){if("string"!=typeof e)throw new Error("JSON Pointer must be a string");if(""===e)return[];if("/"!==e.charAt(0))throw new Error("Invalid JSON Pointer");return"/"===e?[""]:e.substr(1).split("/").map(this.unescape)}},{key:"toJSONString",value:function(){return"/"+this.tokens.map(this.escape).join("/")}},{key:"parseURIFragmentIdentifier",value:function(e){if("string"!=typeof e)throw new Error("JSON Pointer must be a string");if("#"!==e.charAt(0))throw new Error("Invalid JSON Pointer URI Fragment Identifier");return this.parseJSONString(decodeURIComponent(e.substr(1)))}},{key:"toURIFragmentIdentifier",value:function(){var e=this,t=this.tokens.map(function(t){return encodeURIComponent(e.escape(t))}).join("/");return"#/"+t}},{key:"get",value:function(e){for(var t=e,n=this.tokens,r=0;r<n.length;r++){if(!t||void 0===t[n[r]]){if(this.mode!==i)return;throw new Error("Invalid JSON Pointer reference")}t=t[n[r]]}return t}},{key:"add",value:function(e,t){for(var n=this.tokens,r=e,s=0;s<n.length;s++){var u=n[s];if(s===n.length-1)"-"===u?r.push(t):Array.isArray(r)?r.splice(u,0,t):r[u]=t;else if(r[u])r=r[u];else switch(this.mode){case i:throw new Error("Invalid JSON Pointer reference");case o:r=r[u]=parseInt(u)?[]:{};break;case a:return;default:throw new Error("Invalid pointer mode")}}}},{key:"replace",value:function(e,t){for(var n=this.tokens,r=e,i=0;i<n.length;i++){var o=n[i];i===n.length-1?r[o]=t:r=r[o]?r[o]:r[o]=parseInt(o)?[]:{}}}},{key:"remove",value:function(e){for(var t=this.tokens,n=e,r=0;r<t.length;r++){var i=t[r];if(void 0===n||void 0===n[i])return;if(Array.isArray(n))return void n.splice(i,1);r===t.length-1&&delete n[i],n=n[i]}}}],[{key:"parse",value:function(t){return new e(t)}}]),e}();e.exports=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(100),l=1,c=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Object.keys(e).forEach(function(t){var r=e[t];n.set(new u(t,l),new u(r,l))}),n}return o(t,e),s(t,[{key:"map",value:function(e,t){this.forEach(function(n,r){r.add(e,n.get(t))})}},{key:"project",value:function(e,t){this.forEach(function(n,r){n.add(t,r.get(e))})}}]),t}(Map);e.exports=c},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a="function"==typeof Symbol&&"symbol"===o(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":o(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"==typeof e?"undefined":o(e)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(97),l=n(103),c=function(){function e(t){i(this,e),Object.assign(this,t),Object.defineProperties(this,{initialize:{enumerable:!1,writeable:!1,value:u.compile(t)},validate:{enumerable:!1,writeable:!1,value:l.compile(t)}})}return s(e,[{key:"extend",value:function(t){function n(e){return e&&"object"===("undefined"==typeof e?"undefined":a(e))&&null!==e&&!Array.isArray(e)}function i(e,t){var o=Object.assign({},e);return n(e)&&n(t)&&Object.keys(t).forEach(function(a){n(t[a])&&a in e?o[a]=i(e[a],t[a]):Object.assign(o,r({},a,t[a]))}),o}var o=i(this,t);return new e(o)}}]),e}();e.exports=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"==typeof e?"undefined":i(e)},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(96),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e),this.schema=t,Object.assign(this,n),this.address||(this.address=""),this.require!==!0&&(this.require=!1)}return a(e,null,[{key:"compile",value:function(t){var n=new e(t),r='\n      // "cursor"\n      let value = data\n      let container\n      let stack = []\n      let top = -1\n\n      // error state\n      let valid = true\n      let errors = []\n\n      // complex schema state\n      let initialValidity\n      let anyValid\n      let notValid\n      let countOfValid\n      let initialErrorCount\n      let accumulatedErrorCount\n\n      // validation code\n      '+n.compile()+"\n\n      // validation result\n      return {\n        valid,\n        errors\n      }\n    ";return new Function("data",r)}}]),a(e,[{key:"compile",value:function(){var e="";return this.require&&(e+=this.required()),e+=this.type(),e+=this.array(),e+=this.number(),e+=this.object(),e+=this.string(),e+=this.enum(),e+=this.anyOf(),e+=this.allOf(),e+=this.not(),e+=this.oneOf()}},{key:"push",value:function(){return"\n      stack.push(value)\n      container = value\n      top++\n    "}},{key:"pop",value:function(){return"\n      if (stack.length > 1) {\n        top--\n        stack.pop()\n      }\n\n      value = container = stack[top]\n    "}},{key:"type",value:function e(){var e=this.schema.type,t=this.address,n="";if(e){var r=Array.isArray(e)?e:[e],i=r.map(function(e){return"array"===e?"!Array.isArray(value)":"boolean"===e?"typeof value !== 'boolean'":"integer"===e?"!Number.isInteger(value)":"null"===e?"value !== null":"number"===e?"typeof value !== 'number'":"object"===e?"(typeof value !== 'object' || Array.isArray(value) || value === null)":"string"===e?"typeof value !== 'string'":void 0}).join(" && ");n+="\n      // "+t+" type checking\n      if (value !== undefined && "+i+") {\n        valid = false\n        errors.push({\n          keyword: 'type',\n          message: 'invalid type'\n        })\n      }\n      "}return n}},{key:"array",value:function(){var e=["additionalItems","items","minItems","maxItems","uniqueItems"],t=this.validations(e),n="";return t.length>0&&(n+="\n      /**\n       * Array validations\n       */\n      if (Array.isArray(value)) {\n      "+t+"\n      }\n      "),n}},{key:"number",value:function(){var e=["minimum","maximum","multipleOf"],t=this.validations(e),n="";return t.length>0&&(n+="\n      /**\n       * Number validations\n       */\n      if (typeof value === 'number') {\n      "+t+"\n      }\n      "),n}},{key:"object",value:function(){var e=["maxProperties","minProperties","additionalProperties","properties","patternProperties","dependencies","schemaDependencies","propertyDependencies"],t=this.validations(e),n="";return t.length>0&&(n+="\n      /**\n       * Object validations\n       */\n      if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      "+t+"\n      }\n      "),n}},{key:"string",value:function(){var e=["maxLength","minLength","pattern","format"],t=this.validations(e),n="";return t.length>0&&(n+="\n      /**\n       * String validations\n       */\n      if (typeof value === 'string') {\n      "+t+"\n      }\n      "),n}},{key:"validations",value:function(e){var t=this,n=this.schema,r="",i=Object.keys(n).filter(function(t){return e.indexOf(t)!==-1});return i.forEach(function(e){r+=t[e]()}),r}},{key:"enum",value:function(){var e=this.schema.enum,t=this.address,n=["value !== undefined"],r="";return e&&(e.forEach(function(e){switch("undefined"==typeof e?"undefined":o(e)){case"boolean":n.push("value !== "+e);break;case"number":n.push("value !== "+e);break;case"string":n.push('value !== "'+e+'"');break;case"object":null===e?n.push("value !== null"):n.push("'"+JSON.stringify(e)+"' !== JSON.stringify(value)");break;default:throw new Error("Things are not well in the land of enum")}}),r+='\n      /**\n       * Validate "'+t+'" enum\n       */\n      if ('+n.join(" && ")+") {\n        valid = false\n        errors.push({\n          keyword: 'enum',\n          message: JSON.stringify(value) + ' is not an enumerated value'\n        })\n      }\n      "),r}},{key:"anyOf",value:function t(){var t=this.schema.anyOf,n=this.address,r="";return Array.isArray(t)&&(r+="\n        initialValidity = valid\n        initialErrorCount = errors.length\n        anyValid = false\n      ",t.forEach(function(t){var i=new e(t,{address:n});r+="\n        accumulatedErrorCount = errors.length\n        "+i.compile()+"\n        if (accumulatedErrorCount === errors.length) {\n          anyValid = true\n        }\n        "}),r+="\n          if (anyValid === true) {\n            valid = initialValidity\n            errors = errors.slice(0, initialErrorCount)\n          }\n      "),r}},{key:"allOf",value:function t(){var t=this.schema.allOf,n=this.address,r="";return Array.isArray(t)&&t.forEach(function(t){var i=new e(t,{address:n});r+="\n        "+i.compile()+"\n        "}),r}},{key:"oneOf",value:function t(){var t=this.schema.oneOf,n=this.address,r="";return Array.isArray(t)&&(r+="\n        /**\n         * Validate "+n+" oneOf\n         */\n        initialValidity = valid\n        initialErrorCount = errors.length\n        countOfValid = 0\n      ",t.forEach(function(t){var i=new e(t,{address:n});r+="\n        accumulatedErrorCount = errors.length\n        "+i.compile()+"\n        if (accumulatedErrorCount === errors.length) {\n          countOfValid += 1\n        }\n        "}),r+="\n          if (countOfValid === 1) {\n            valid = initialValidity\n            errors = errors.slice(0, initialErrorCount)\n          } else {\n            valid = false\n            errors.push({\n              keyword: 'oneOf',\n              message: 'what is a reasonable error message for this case?'\n            })\n          }\n      "),r}},{key:"not",value:function t(){var t=this.schema.not,n=this.address,r="";if("object"===("undefined"==typeof t?"undefined":o(t))&&null!==t&&!Array.isArray(t)){var i=t,a=new e(i,{address:n});r+="\n        /**\n         * NOT\n         */\n        if (value !== undefined) {\n          initialValidity = valid\n          initialErrorCount = errors.length\n          notValid = true\n\n          accumulatedErrorCount = errors.length\n\n          "+a.compile()+"\n\n          if (accumulatedErrorCount === errors.length) {\n            notValid = false\n          }\n\n          if (notValid === true) {\n            valid = initialValidity\n            errors = errors.slice(0, initialErrorCount)\n          } else {\n            valid = false\n            errors = errors.slice(0, initialErrorCount)\n            errors.push({\n              keyword: 'not',\n              message: 'hmm...'\n            })\n          }\n        }\n      "}return r}},{key:"properties",value:function t(){var n=this.schema,r=this.address,t=n.properties,i=n.required,a=this.push();return i=Array.isArray(i)?i:[],"object"===("undefined"==typeof t?"undefined":o(t))&&Object.keys(t).forEach(function(n){var o=t[n],s=i.indexOf(n)!==-1,u=[r,n].filter(function(e){return!!e}).join("."),l=new e(o,{address:u,require:s});a+="\n        value = container['"+n+"']\n        ",a+=l.compile()}),a+=this.pop()}},{key:"otherProperties",value:function(){return"\n      /**\n       * Validate Other Properties\n       */\n      "+this.push()+"\n\n      for (let key in container) {\n        value = container[key]\n        matched = false\n\n        "+this.patternValidations()+"\n        "+this.additionalValidations()+"\n      }\n\n      "+this.pop()+"\n    "}},{key:"patternValidations",value:function(){var t=this.schema.patternProperties,n="";return"object"===("undefined"==typeof t?"undefined":o(t))&&Object.keys(t).forEach(function(r){var i=t[r],o=new e(i);n+="\n          if (key.match('"+r+"')) {\n            matched = true\n            "+o.compile()+"\n          }\n        "}),n}},{key:"additionalValidations",value:function(){var t=this.schema,n=t.properties,r=t.additionalProperties,i=this.address,a="",s=["matched !== true"];if(Object.keys(n||{}).forEach(function(e){s.push("key !== '"+e+"'")}),"object"===("undefined"==typeof r?"undefined":o(r))){var u=r,l=new e(u,{address:i+"[APKey]"});a+="\n        // validate additional properties\n        if ("+s.join(" && ")+") {\n          "+l.compile()+"\n        }\n      "}return r===!1&&(a+="\n        // validate non-presence of additional properties\n        if ("+s.join(" && ")+") {\n          valid = false\n          errors.push({\n            keyword: 'additionalProperties',\n            message: key + ' is not a defined property'\n          })\n        }\n      "),a}},{key:"patternProperties",value:function(){var e="";return this.otherPropertiesCalled||(this.otherPropertiesCalled=!0,e+=this.otherProperties()),e}},{key:"additionalProperties",value:function(){var e="";return this.otherPropertiesCalled||(this.otherPropertiesCalled=!0,e+=this.otherProperties()),e}},{key:"minProperties",value:function e(){var e=this.schema.minProperties,t=this.address;return"\n        // "+t+" min properties\n        if (Object.keys(value).length < "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'minProperties',\n            message: 'too few properties'\n          })\n        }\n    "}},{key:"maxProperties",value:function e(){var e=this.schema.maxProperties,t=this.address;return"\n        // "+t+" max properties\n        if (Object.keys(value).length > "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'maxProperties',\n            message: 'too many properties'\n          })\n        }\n    "}},{key:"dependencies",value:function t(){var t=this.schema.dependencies,n=this.address,r=this.push();return"object"===("undefined"==typeof t?"undefined":o(t))&&Object.keys(t).forEach(function(i){var a=t[i],s=[];if(Array.isArray(a))a.forEach(function(e){s.push("container['"+e+"'] === undefined")}),r+="\n            if (container['"+i+"'] !== undefined && ("+s.join(" || ")+")) {\n              valid = false\n              errors.push({\n                keyword: 'dependencies',\n                message: 'unmet dependencies'\n              })\n            }\n          ";else if("object"===("undefined"==typeof a?"undefined":o(a))){var u=a,l=new e(u,{address:n});r+="\n            if (container['"+i+"'] !== undefined) {\n              "+l.compile()+"\n            }\n          "}}),r+=this.pop()}},{key:"required",value:function(){var e=(this.schema.properties,this.address),t="";return t+="\n      // validate "+e+" presence\n      if (value === undefined) {\n        valid = false\n        errors.push({\n          keyword: 'required',\n          message: 'is required'\n        })\n      }\n    "}},{key:"additionalItems",value:function t(){var n=this.schema,r=n.items,t=n.additionalItems,i=(this.address,"");if(t===!1&&Array.isArray(r)&&(i+="\n        // don't allow additional items\n        if (value.length > "+r.length+") {\n          valid = false\n          errors.push({\n            keyword: 'additionalItems',\n            message: 'additional items not allowed'\n          })\n        }\n      "),"object"===("undefined"==typeof t?"undefined":o(t))&&null!==t&&Array.isArray(r)){var a=t,s=new e(a);i+="\n        // additional items\n        "+this.push()+"\n\n        for (var i = "+r.length+"; i <= container.length; i++) {\n          value = container[i]\n          "+s.compile()+"\n        }\n\n        "+this.pop()+"\n      ";
}return i}},{key:"items",value:function t(){var t=this.schema.items,n=this.address,r="";if(Array.isArray(t))r+=this.push(),t.forEach(function(t,i){var o=t,a=new e(o,{address:n+"["+i+"]"});r+="\n          // item #"+i+"\n          value = container["+i+"]\n          "+a.compile()+"\n        "}),r+=this.pop();else if("object"===("undefined"==typeof t?"undefined":o(t))&&null!==t){var i=t,a=new e(i);r+="\n        // items\n        "+this.push()+"\n\n        for (var i = 0; i < container.length; i++) {\n          // read array element\n          value = container[i]\n          "+a.compile()+"\n        }\n\n        "+this.pop()+"\n      "}return r}},{key:"minItems",value:function e(){var e=this.schema.minItems,t=this.address;return"\n        // "+t+" min items\n        if (value.length < "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'minItems',\n            message: 'too few properties'\n          })\n        }\n    "}},{key:"maxItems",value:function e(){var e=this.schema.maxItems,t=this.address;return"\n        // "+t+" max items\n        if (value.length > "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'maxItems',\n            message: 'too many properties'\n          })\n        }\n    "}},{key:"uniqueItems",value:function e(){var e=this.schema.uniqueItems,t=this.address,n="";return e===!0&&(n+="\n        // validate "+t+" unique items\n        let values = value.map(v => JSON.stringify(v)) // TODO: optimize\n        let set = new Set(values)\n        if (values.length !== set.size) {\n          valid = false\n          errors.push({\n            keyword: 'uniqueItems',\n            message: 'items must be unique'\n          })\n        }\n      "),n}},{key:"minLength",value:function e(){var e=this.schema.minLength,t=this.address;return"\n        // "+t+" validate minLength\n        if (Array.from(value).length < "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'minLength',\n            message: 'too short'\n          })\n        }\n    "}},{key:"maxLength",value:function e(){var e=this.schema.maxLength,t=this.address;return"\n        // "+t+" validate maxLength\n        if (Array.from(value).length > "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'maxLength',\n            message: 'too long'\n          })\n        }\n    "}},{key:"pattern",value:function e(){var e=this.schema.pattern,t=this.address;if(e)return"\n          // "+t+" validate pattern\n          if (!value.match(new RegExp('"+e+"'))) {\n            valid = false\n            errors.push({\n              keyword: 'pattern',\n              message: 'does not match the required pattern'\n            })\n          }\n      "}},{key:"format",value:function e(){var e=this.schema.format,t=this.address,n=s.resolve(e);if(n)return"\n      // "+t+" validate format\n      if (!value.match("+n+")) {\n        valid = false\n        errors.push({\n          keyword: 'format',\n          message: 'is not \""+e+"\" format'\n        })\n      }\n      "}},{key:"minimum",value:function e(){var t=this.schema,e=t.minimum,n=t.exclusiveMinimum,r=this.address,i=n===!0?"<=":"<";return"\n        // "+r+" validate minimum\n        if (value "+i+" "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'minimum',\n            message: 'too small'\n          })\n        }\n    "}},{key:"maximum",value:function e(){var t=this.schema,e=t.maximum,n=t.exclusiveMaximum,r=this.address,i=n===!0?">=":">";return"\n        // "+r+" validate maximum\n        if (value "+i+" "+e+") {\n          valid = false\n          errors.push({\n            keyword: 'maximum',\n            message: 'too large'\n          })\n        }\n    "}},{key:"multipleOf",value:function e(){var e=this.schema.multipleOf,t="";if("number"==typeof e){var n=e.toString().length,r=n-e.toFixed(0).length-1,i=r>0?Math.pow(10,r):1,o=void 0;o=r>0?"(value * "+i+") % "+e*i+" !== 0":"value % "+e+" !== 0",t+="\n        if ("+o+") {\n          valid = false\n          errors.push({\n            keyword: 'multipleOf',\n            message: 'must be a multiple of "+e+"'\n          })\n        }\n      "}return t}}]),e}();e.exports=u},function(e,t,n){"use strict";var r=n(105),i=n(117),o=n(121),a=n(123),s=n(128),u=n(125),l=n(127),c=n(119),f=n(122),h=n(126),d=n(124);e.exports={JWA:r,JWK:i,JWKSet:o,JWT:a,JWS:s,Base64URLSchema:u,JOSEHeaderSchema:l,JWKSchema:c,JWKSetSchema:f,JWTClaimsSetSchema:h,JWTSchema:d}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=(n(106),n(107)),a=n(115),s=a.NotSupportedError,u=function(){function e(){r(this,e)}return i(e,null,[{key:"sign",value:function(e,t,n){var r=o.normalize("sign",e);return r instanceof Error?Promise.reject(new s(e)):r.sign(t,n)}},{key:"verify",value:function(e,t,n,r){var i=o.normalize("verify",e);return i instanceof Error?Promise.reject(new s(e)):i.verify(t,n,r)}},{key:"importKey",value:function(e){var t=o.normalize("importKey",e.alg);return t.importKey(e)}}]),e}();e.exports=u},function(e,t,n){(function(t){function n(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function r(e){t.isBuffer(e)&&(e=e.toString());var n=i(e).replace(/\-/g,"+").replace(/_/g,"/");return n}function i(e){var n=4,r=e.length,i=e.length%n;if(!i)return e;var o=r,a=n-i,s=r+a,u=t(s);for(u.write(e);a--;)u.write("=",o++);return u.toString()}function o(e,n){return t(r(e),"base64").toString(n)}function a(e,r){return n(t(e,r).toString("base64"))}function s(e){return t(r(e),"base64")}a.toBase64=r,a.fromBase64=n,a.decode=o,a.encode=a,a.toBuffer=s,e.exports=a}).call(t,n(36).Buffer)},function(e,t,n){"use strict";var r=n(108),i=n(112),o=n(113),a=new o;a.define("HS256","sign",new r({name:"HMAC",hash:{name:"SHA-256"}})),a.define("HS384","sign",new r({name:"HMAC",hash:{name:"SHA-384"}})),a.define("HS512","sign",new r({name:"HMAC",hash:{name:"SHA-512"}})),a.define("RS256","sign",new i({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}})),a.define("RS384","sign",new i({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}})),a.define("RS512","sign",new i({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}})),a.define("none","sign",{}),a.define("HS256","verify",new r({name:"HMAC",hash:{name:"SHA-256"}})),a.define("HS384","verify",new r({name:"HMAC",hash:{name:"SHA-384"}})),a.define("HS512","verify",new r({name:"HMAC",hash:{name:"SHA-512"}})),a.define("RS256","verify",new i({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}})),a.define("RS384","verify",new i({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}})),a.define("RS512","verify",new i({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}})),a.define("none","verify",{}),a.define("RS256","importKey",new i({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}})),a.define("RS384","importKey",new i({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}})),a.define("RS512","importKey",new i({name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}})),e.exports=a},function(e,t,n){(function(t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(106),a=n(109),s=n(110),u=function(){function e(t){r(this,e),this.params=t}return i(e,[{key:"sign",value:function(e,n){var r=this.params;return n=(new s).encode(n),a.subtle.sign(r,e,n).then(function(e){return o(t.from(e))})}},{key:"verify",value:function(e,t,n){var r=this.params;return"string"==typeof t&&(t=Uint8Array.from(o.toBuffer(t))),"string"==typeof n&&(n=(new s).encode(n)),a.subtle.verify(r,e,t,n)}},{key:"assertSufficientKeyLength",value:function(e){if(e.length<this.bitlength)throw new Error("The key is too short.")}}]),e}();e.exports=u}).call(t,n(36).Buffer)},function(e,t){e.exports=crypto},function(e,t,n){(function(t){"use strict";var r=t.TextEncoder?t.TextEncoder:n(111).TextEncoder;e.exports=r}).call(t,function(){return this}())},function(e,t){e.exports=TextEncoder},function(e,t,n){(function(t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(106),a=n(109),s=n(110),u=function(){function e(t){r(this,e),this.params=t}return i(e,[{key:"sign",value:function(e,n){var r=this.params;return n=(new s).encode(n),a.subtle.sign(r,e,n).then(function(e){return o(t.from(e))})}},{key:"verify",value:function(e,t,n){var r=this.params;return"string"==typeof t&&(t=Uint8Array.from(o.toBuffer(t))),"string"==typeof n&&(n=(new s).encode(n)),a.subtle.verify(r,e,t,n)}},{key:"importKey",value:function(e){var t=Object.assign({},e),n=this.params,r=e.key_ops||[];return"sig"===e.use&&r.push("verify"),"enc"===e.use?Promise.resolve(e):(e.key_ops&&(r=e.key_ops),a.subtle.importKey("jwk",t,n,!0,r).then(function(e){return Object.defineProperty(t,"cryptoKey",{enumerable:!1,value:e}),t}))}}]),e}();e.exports=u}).call(t,n(36).Buffer)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(114),a=["sign","verify","encrypt","decrypt","importKey"],s=function(){function e(){var t=this;r(this,e),a.forEach(function(e){t[e]={}})}return i(e,[{key:"define",value:function(e,t,n){var r=this[t];r[e]=n}},{key:"normalize",value:function(e,t){var n=this[e];if(!n)return new SyntaxError;var r=n[t];return r?r:new o(t)}}],[{key:"operations",get:function(){return a}}]),e}();e.exports=s},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":o(t))&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":o(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e){function t(e){n(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.message=e+" is not a supported algorithm",i}return i(t,e),t}(Error);e.exports=a},function(e,t,n){"use strict";e.exports={DataError:n(116),NotSupportedError:n(114)}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":o(t))&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":o(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e){function t(e){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),t}(Error);e.exports=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(118),l=u.JSONDocument,c=n(119),f=n(105),h=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,null,[{key:"importKey",value:function(e){return f.importKey(e)}},{key:"schema",get:function(){return c}}]),t}(l);e.exports=h},95,function(e,t,n){"use strict";var r=n(118),i=r.JSONSchema,o=n(120),a=(o.BASE64_REGEXP,new i({type:"object",properties:{kty:{type:"string",enum:["RSA","EC","oct"]},use:{type:"string",enum:["sig","enc"]},key_ops:{type:"array",enum:["sign","verify","encrypt","decrypt","wrapKey","unwrapKey","deriveKey","deriveBits"]},alg:{type:"string",enum:["HS256","HS384","HS512","RS256","RS384","RS512","ES256","ES384","ES512","PS256","PS384","PS512","none"]},kid:{type:"string"},x5u:{type:"string"},x5c:{type:"array"},x5t:{type:"string"}}}));e.exports=a},function(e,t,n){"use strict";var r=n(118),i=r.Formats;i.register("StringOrURI",new RegExp),i.register("NumericDate",new RegExp),i.register("URI",new RegExp),i.register("url",new RegExp),i.register("base64",new RegExp),i.register("base64url",new RegExp),i.register("MediaType",new RegExp)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(118),l=u.JSONDocument,c=n(122),f=n(117),h=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,null,[{key:"importKeys",value:function(e){var n=this.schema.validate(e);n.valid||Promise.reject(n);var r=new t(e),i=e.keys.map(function(e){return f.importKey(e)});return Promise.all(i).then(function(e){return r.keys=e,r})}},{key:"schema",get:function(){return c}}]),t}(l);e.exports=h},function(e,t,n){"use strict";var r=n(118),i=r.JSONSchema,o=n(119),a=new i({type:"object",properties:{keys:{type:"array",items:o}}});e.exports=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"==typeof e?"undefined":a(e)},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(106),c=n(118),f=c.JSONDocument,h=n(124),d=n(128),p=n(116),y=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"isJWE",value:function(){return!!this.header.enc}},{key:"resolveKeys",value:function(e){var t=this.header.kid,n=void 0,r=void 0;if(Array.isArray(e)&&(n=e),e.keys&&(n=e.keys),e.keys||"object"!==("undefined"==typeof e?"undefined":s(e))||(n=[e]),!n)throw new p("Invalid JWK argument");return r=t?n.find(function(e){return e.kid===t}):n.find(function(e){return"sig"===e.use}),!!r&&(console.log(r),this.key=r.cryptoKey,!0)}},{key:"encode",value:function(){var e=this.validate();if(!e.valid)return Promise.reject(e);var t=this;return this.isJWE()?JWE.encrypt(t):d.sign(t)}},{key:"verify",value:function(){var e=this.validate();return e.valid?d.verify(this):Promise.reject(e)}}],[{key:"decode",value:function(e){var t=this,n=void 0;if("string"!=typeof e)throw new p("JWT must be a string");if(e.startsWith("{")){try{e=JSON.parse(e,function(){})}catch(e){throw new p("Invalid JWT serialization")}e.signatures||e.recipients?e.serialization="json":e.serialization="flattened",n=new t(e)}else try{var r="compact",i=e.split("."),o=i.length;if(3!==o&&5!==o)throw new Error("Malformed JWT");var a=JSON.parse(l.decode(i[0]));if(3===o){var s="JWS",u=JSON.parse(l.decode(i[1])),c=i[2];n=new t({type:s,segments:i,header:a,payload:u,signature:c,serialization:r})}}catch(e){throw new p("Invalid JWT compact serialization")}return n}},{key:"encode",value:function(e,n,r){var i=new t(e,n);return i.encode(r)}},{key:"verify",value:function(e,n){var r=t.decode(n);return r.key=e,r.verify().then(function(e){return r})}},{key:"schema",get:function(){return h}}]),t}(f);e.exports=y},function(e,t,n){"use strict";var r=n(125),i=n(126),o=n(127),a=n(118),s=a.JSONSchema,u=new s({type:"object",properties:{type:{type:"string",enum:["JWS","JWE"]},segments:{type:"array"},header:o,protected:o,unprotected:o,iv:r,aad:r,ciphertext:r,tag:r,recipients:{type:"array",items:{type:"object",properties:{header:o,encrypted_key:r}}},payload:i,signatures:{type:"array",items:{type:"object",properties:{protected:o,header:o,signature:r,key:{type:"object"}}}},signature:r,verified:{type:"boolean",default:!1},key:{type:"object"},serialization:{type:"string",enum:["compact","json","flattened"],default:"compact"}}});e.exports=u},function(e,t,n){"use strict";var r=n(118),i=r.JSONSchema,o=new i({type:"string",format:"base64url"});e.exports=o},function(e,t,n){"use strict";var r=n(118),i=r.JSONSchema,o=new i({properties:{iss:{type:"string",format:"StringOrURI"},sub:{type:"string",format:"StringOrURI"},aud:{type:["array","string"],format:"StringOrURI",items:{format:"StringOrURI"}},exp:{type:"number",format:"NumericDate"},nbf:{type:"number",format:"NumericDate"},iat:{type:"number",format:"NumericDate"},jti:{type:"string"}}});e.exports=o},function(e,t,n){"use strict";var r=(n(119),n(118)),i=r.JSONSchema,o=new i({type:"object",properties:{typ:{type:"string"},cty:{type:"string",enum:["JWT"]},alg:{type:"string",format:"StringOrURI"},jku:{type:"string",format:"URI"},kid:{type:"string"},x5u:{type:"string",format:"URI"},x5c:{type:"array",items:{type:"string",format:"base64"}},x5t:{type:"string",format:"base64url"},crit:{type:"array",items:{type:"string"},minItems:1},enc:{type:"string",format:"StringOrURI"},zip:{type:"string"}}});e.exports=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"==typeof e?"undefined":i(e)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(106),l=n(105),c=n(115),f=c.DataError,h=function(){function e(){r(this,e)}return s(e,null,[{key:"sign",value:function(e){var t=u(JSON.stringify(e.payload));if("compact"===e.serialization){var n=function(){var n=e.key,r=e.header.alg,i=u(JSON.stringify(e.header)),o=i+"."+t;return{v:l.sign(r,n,o).then(function(e){return o+"."+e})}}();if("object"===("undefined"==typeof n?"undefined":a(n)))return n.v}return"json"===e.serialization,"flattened"===e.serialization,Promise.reject(new f("Unsupported serialization"))}},{key:"verify",value:function(e){if(e.signatures,e.signature){var t=o(e.segments,2),n=t[0],r=t[1],i=n+"."+r,a=e.key,s=e.signature,u=e.header.alg;return l.verify(u,a,s,i).then(function(t){return e.verified=t,t})}return Promise.reject(new f("Missing signature(s)"))}}]),e}();e.exports=h},function(e,t,n){(function(t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(90),a=n(130),s=n(109),u=n(133),l=n(134),c=function(){function e(){r(this,e)}return i(e,null,[{key:"create",value:function(e,n,r){return new Promise(function(i,c){var f=e.provider,h=e.defaults,d=e.registration;o(f.configuration,"RelyingParty provider OpenID Configuration is missing"),o(h.authenticate,"RelyingParty default authentication parameters are missing"),o(d,"RelyingParty client registration is missing");var p=f.configuration.issuer,y=f.configuration.authorization_endpoint,v={client_id:d.client_id},g=Object.assign(h.authenticate,v,n);return o(p,"Missing issuer in provider OpenID Configuration"),o(y,"Missing authorization_endpoint in provider OpenID Configuration"),o(g.scope,"Missing scope parameter in authentication request"),o(g.response_type,"Missing response_type parameter in authentication request"),o(g.client_id,"Missing client_id parameter in authentication request"),o(g.redirect_uri,"Missing redirect_uri parameter in authentication request"),g.state=Array.from(s.getRandomValues(new Uint8Array(16))),g.nonce=Array.from(s.getRandomValues(new Uint8Array(16))),Promise.all([s.subtle.digest({name:"SHA-256"},new Uint8Array(g.state)),s.subtle.digest({name:"SHA-256"},new Uint8Array(g.nonce))]).then(function(e){var n=a(t.from(e[0])),i=a(t.from(e[1])),o=p+"/requestHistory/"+n;r[o]=JSON.stringify(g),g.state=n,g.nonce=i}).then(function(){}).then(function(){var e=new l(y);e.search=u.encode(g),i(e.href)})})}}]),e}();e.exports=c}).call(t,n(36).Buffer)},function(e,t,n){e.exports=n(131).default,e.exports.default=e.exports},function(e,t,n){(function(e){"use strict";function r(t,n){return void 0===n&&(n="utf8"),a(e.isBuffer(t)?t.toString("base64"):new e(t,n).toString("base64"))}function i(t,n){return void 0===n&&(n="utf8"),new e(o(t),"base64").toString(n)}function o(e){return e=e.toString(),u.default(e).replace(/\-/g,"+").replace(/_/g,"/")}function a(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function s(t){return new e(o(t),"base64")}var u=n(132),l=r;l.encode=r,l.decode=i,l.toBase64=o,l.fromBase64=a,l.toBuffer=s,Object.defineProperty(t,"__esModule",{value:!0}),t.default=l}).call(t,n(36).Buffer)},function(e,t,n){(function(e){"use strict";function n(t){var n=4,r=t.length,i=r%n;if(!i)return t;var o=r,a=n-i,s=r+a,u=new e(s);for(u.write(t);a--;)u.write("=",o++);return u.toString()}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n}).call(t,n(36).Buffer)},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,null,[{key:"encode",value:function(e){var t=[];return Object.keys(e).forEach(function(n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}),t.join("&")}},{key:"decode",value:function(e){var t={};return e.split("&").forEach(function(e){var n=e.split("="),r=decodeURIComponent(n[0]),i=decodeURIComponent(n[1]);t[r]=i}),t}}]),e}();e.exports=i},function(e,t){e.exports=URL},function(e,t,n){(function(t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(134),s=n(90),u=n(109),l=n(130),c=n(94),f=c.Headers?c.Headers:t.Headers,h=n(133),d=n(136),p=function(){function e(){i(this,e)}return o(e,null,[{key:"validateResponse",value:function(e){return Promise.resolve(e).then(this.parseResponse).then(this.matchRequest).then(this.validateStateParam).then(this.errorResponse).then(this.validateResponseMode).then(this.validateResponseParams).then(this.exchangeAuthorizationCode).then(this.validateIDToken).then(function(){return e})}},{key:"parseResponse",value:function(e){var t=e.redirect,n=e.body;if(t&&n||!t&&!n)throw new Error("Invalid response mode");if(t){var r=new a(t),i=r.search,o=r.hash;if(i&&o)throw new Error("Invalid response mode");i&&(e.params=h.decode(i.substring(1)),e.mode="query"),o&&(e.params=h.decode(o.substring(1)),e.mode="fragment")}return n&&(e.params=h.decode(n),e.mode="form_post"),e}},{key:"matchRequest",value:function(e){var t=e.rp,n=e.params,r=e.session,i=n.state,o=t.provider.configuration.issuer;if(!i)throw new Error("Missing state parameter in authentication response");var a=o+"/requestHistory/"+i,s=r[a];if(!s)throw new Error("Mismatching state parameter in authentication response");return e.request=JSON.parse(s),e}},{key:"validateStateParam",value:function(e){var t=new Uint8Array(e.request.state),n=e.params.state;return u.subtle.digest({name:"SHA-256"},t).then(function(t){if(n!==l(r.from(t)))throw new Error("Mismatching state parameter in authentication response");return e})}},{key:"errorResponse",value:function(e){var t=e.params.error;return t?Promise.reject(t):Promise.resolve(e)}},{key:"validateResponseMode",value:function(e){if("code"!==e.request.response_type&&"query"===e.mode)throw new Error("Invalid response mode");return e}},{key:"validateResponseParams",value:function(e){var t=e.request,n=e.params,r=t.response_type.split(" ");return r.includes("code")&&s(n.code,"Missing authorization code in authentication response"),r.includes("id_token")&&s(n.id_token,"Missing id_token in authentication response"),r.includes("token")&&(s(n.access_token,"Missing access_token in authentication response"),s(n.token_type,"Missing token_type in authentication response")),e}},{key:"exchangeAuthorizationCode",value:function(e){var t=e.rp,n=e.params,i=e.request,o=n.code;if(!o||"code"!==i.response_type)return Promise.resolve(e);var a=t.provider,u=t.registration,l=u.client_id,d=u.client_secret;if(!d)throw new AuthenticationError("Client cannot exchange authorization code because it is not a confidential client");var p=a.configuration.token_endpoint,y="POST",v=new f({"Content-Type":"application/x-www-form-urlencoded"}),g=h.encode({grant_type:"authorization_code",code:o,redirect_uri:i.redirect_uri}),m=u.token_endpoint_auth_method||"client_secret_basic";if("client_secret_basic"===m){var b=new r(l+":"+d).toString("base64");v.set("Authorization","Basic "+b)}return"client_secret_post"===m&&(g.client_id=l,g.client_secret=d),c(p,{method:y,headers:v,body:g}).then(function(e){return e.json()}).then(function(t){return s(t.access_token,"Missing access_token in token response"),s(t.token_type,"Missing token_type in token response"),s(t.id_token,"Missing id_token in token response"),e.params=Object.assign(e.params,t),e})}},{key:"validateIDToken",value:function(t){var n=t.params.id_token;if(!n)return Promise.resolve(t);var r=t.rp,i=r.provider;r.registration,i.configuration,i.jwks;return Promise.resolve(t).then(e.decryptIDToken).then(e.decodeIDToken).then(e.validateIssuer).then(e.validateAudience).then(e.resolveKeys).then(e.verifySignature).then(e.validateExpires).then(e.verifyNonce).then(e.validateACR).then(e.validateAuthTime).then(e.validateAccessTokenHash).then(e.validateCodeHash)}},{key:"decryptIDToken",value:function(e){return Promise.resolve(e)}},{key:"decodeIDToken",value:function(e){var t=e.params.id_token;return t&&(e.decoded=d.decode(t)),e}},{key:"validateIssuer",value:function(e){var t=e.rp.provider.configuration,n=e.decoded.payload;if(n.iss!==t.issuer)throw new Error("Mismatching issuer in ID Token");return e}},{key:"validateAudience",value:function(e){var t=e.rp.registration,n=e.decoded.payload,r=n.aud,i=n.azp;if("string"==typeof r&&r!==t.client_id)throw new Error("Mismatching audience in id_token");if(Array.isArray(r)&&!r.includes(t.client_id))throw new Error("Mismatching audience in id_token");if(Array.isArray(r)&&!i)throw new Error("Missing azp claim in id_token");if(i&&i!==t.client_id)throw new Error("Mismatching azp claim in id_token");return e}},{key:"resolveKeys",value:function(e){var t=e.rp,n=t.provider,r=(n.jwks,e.decoded);return t.jwks().then(function(t){if(r.resolveKeys(t))return Promise.resolve(e);throw new Error("Cannot resolve signing key for ID Token.");
})}},{key:"verifySignature",value:function(e){var t=e.decoded.header.alg,n=e.rp.registration,r=n.id_token_signed_response_alg||"RS256";if(t!==r)throw new Error("Expected ID Token to be signed with "+r);return e.decoded.verify().then(function(t){if(!t)throw new Error("Invalid ID Token signature");return e})}},{key:"validateExpires",value:function(e){var t=e.decoded.payload.exp;if(t<=Math.floor(Date.now()/1e3))throw new Error("Expired ID Token");return e}},{key:"verifyNonce",value:function(e){var t=new Uint8Array(e.request.nonce),n=e.decoded.payload.nonce;if(!n)throw new Error("Missing nonce in ID Token");return u.subtle.digest({name:"SHA-256"},t).then(function(t){if(n!==l(r.from(t)))throw new Error("Mismatching nonce in ID Token");return e})}},{key:"validateAcr",value:function(e){return e}},{key:"validateAccessTokenHash",value:function(e){return e}},{key:"validateAuthorizationCodeHash",value:function(e){return e}}]),e}();e.exports=p}).call(t,function(){return this}(),n(36).Buffer)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(104),l=u.JWT,c=n(137),f=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,null,[{key:"schema",get:function(){return c}}]),t}(l);e.exports=f},function(e,t,n){"use strict";var r=n(104),i=r.JWTSchema,o=i.extend({properties:{header:{},payload:{properties:{iss:{type:"string",format:"url"},sub:{type:"string",maxLength:255},auth_time:{type:"integer",format:"NumericDate"},nonce:{type:"string"},acr:{type:"string"},amr:{type:"array",items:{type:"string"}},azp:{type:"string",format:"StringOrURI"}},required:["iss","sub","aud","exp","iat"]}}});e.exports=o},function(e,t,n){"use strict";var r=n(95),i=r.JSONSchema,o=new i({type:"object",properties:{provider:{type:"object",properties:{name:{type:"string"},url:{type:"string",format:"uri"},configuration:{},jwks:{}},required:["url"]},defaults:{type:"object",properties:{authenticate:{type:"object",properties:{redirect_uri:{type:"string",format:"uri"},response_type:{type:"string",default:"id_token token",enum:["code","token","id_token token","id_token token code"]},display:{type:"string",default:"page",enum:["page","popup"]},scope:{type:["string","array"],default:["openid"]}}},register:{}}},registration:{},store:{type:"object",default:{}}}});e.exports=o},function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.rdf=e,this.vocab=d(e),this.config=Object.assign(s,t),this.auth=t.auth}function i(e,t){return new r(e,t)}var o="text/turtle;q=0.8,*/*;q=0.5",a="text/turtle",s=n(140),u=n(141).composePatchQuery,l=n(142),c=n(144),f=n(148),h=n(149),d=n(145);r.prototype.createContainer=function(e,t,n,r){return this.post(e,r,t,!0)},r.prototype.createResponse=function(e,t){var n=new l(this.rdf,e,t);return"get"===n.method&&n.isContainer()?new c(this.rdf,n.location,n):n},r.prototype.currentUrl=function(){return"undefined"!=typeof window?window.location.href:null},r.prototype.del=function(e){return this.solidRequest(e,"DELETE")},r.prototype.get=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.headers=t.headers||{},t.headers.Accept||(t.headers.Accept=o),this.solidRequest(e,"GET",t)},r.prototype.head=function(e,t){return this.solidRequest(e,"HEAD",t)},r.prototype.loadParsedGraphs=function(e,t){var n=this,r=e.map(function(e){return n.get(e,t).then(function(e){return e.parsedGraph()}).catch(function(){return null}).then(function(t){return{uri:e,value:t}})});return Promise.all(r)},r.prototype.needsProxy=function(e){var t=this.currentUrl(),n=t&&"https:"===t.slice(0,6),r=e&&"http:"===e.slice(0,5);return n&&r},r.prototype.options=function(e){return this.solidRequest(e,"OPTIONS")},r.prototype.patch=function(e,t,n,r){var i=u(t,n),o="application/sparql-update";return r=r||{},r.headers=r.headers||{},r.headers["Content-Type"]=o,this.solidRequest(e,"PATCH",r,i)},r.prototype.post=function(e,t,n,r,i){var o;r?(o=this.vocab.ldp("BasicContainer"),i="text/turtle"):(o=this.vocab.ldp("Resource"),i=i||a);var s={};return s.headers={},s.headers.Link=o+'; rel="type"',s.headers["Content-Type"]=i,n&&n.length>0&&(s.headers.Slug=n),this.solidRequest(e,"POST",s,t)},r.prototype.proxyUrl=function(e,t){return t=t||this.config.proxyUrl,t.replace("{uri}",encodeURIComponent(e))},r.prototype.put=function(e,t,n,r){return r=r||{},r.headers=r.headers||{},n=n||a,r.headers["Content-Type"]=n,this.solidRequest(e,"PUT",r,t)},r.prototype.solidRequest=function(e,t,n,r){n=n||{},n.headers=n.headers||{},this.auth&&this.auth.accessToken&&(n.headers.Authorization="Bearer "+this.auth.accessToken),n.proxyUrl=n.proxyUrl||this.config.proxyUrl,n.timeout=n.timeout||this.config.timeout,(this.needsProxy(e)||n.forceProxy)&&(e=this.proxyUrl(e));var i=this;return new Promise(function(o,a){var s=new f;s.open(t,e),n.noCredentials||(s.withCredentials=!0);for(var u in n.headers)s.setRequestHeader(u,n.headers[u]);n.timeout&&(s.timeout=n.timeout),s.onload=function(){this.status>=200&&this.status<300?o(i.createResponse(this,t)):a(new h(this.status,this.statusText,{xhr:this}))},s.onerror=function(){a(new h(this.status,this.statusText,{xhr:this}))},"undefined"!=typeof r&&r?s.send(r):s.send()})},e.exports=i,e.exports.SolidWebClient=r},function(e,t){"use strict";e.exports={proxyUrl:"https://databox.me/,proxy?uri={uri}",timeout:5e4}},function(e,t){"use strict";function n(e,t){return t&&"http"!==t.slice(0,4)?[e,t].map(function(e){return"/"===e[0]&&(e=e.slice(1)),"/"===e[e.length-1]&&(e=e.slice(0,e.length-1)),e}).join("/"):t}function r(e,t){var n="",r=!0;return e&&e.length>0&&(e=e.map(function(e){return s(e,r)}),n+="DELETE DATA { "+e.join(" . ")+" };\n"),t&&t.length>0&&(t=t.map(function(e){return s(e,r)}),n+="INSERT DATA { "+t.join(" . ")+" };\n"),n}function i(e){var t,n,r,i,o=e.split("//");return 2===o.length?(t=o[0],n=o[1]):n=e,i=n.split("/"),r=t?t+"//"+i[0]:i[0],e.startsWith("//")&&(r="//"+r),r}function o(e,t){var n={};if(e){var r=e.split(",");r.forEach(function(t){t&&e.indexOf(t)>=0&&(n[t.trim().toLowerCase()]=!0)})}return t&&t.indexOf("application/sparql-update")>=0&&(n.patch=!0),n}function a(e){if(!e)return{};for(var t=/<[^>]*>\s*(\s*;\s*[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*")))*(,|$)/g,n=/[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*"))/g,r=e.match(t),i={},o=0;o<r.length;o++)for(var a=r[o].split(">"),s=a[0].substring(1),u=a[1],l=u.match(n),c=0;c<l.length;c++){var f=l[c],h=f.split("="),d=h[1].replace(/["']/g,"");i[d]||(i[d]=[]),i[d].push(s),i[d].length>1&&i[d].sort()}return i}function s(e,t){return"string"!=typeof e&&(e=e.toCanonical()),t&&e.endsWith(".")&&(e=e.slice(0,-1)),e}e.exports.absoluteUrl=n,e.exports.composePatchQuery=r,e.exports.hostname=i,e.exports.parseAllowedMethods=o,e.exports.parseLinkHeader=a,e.exports.statementToNT=s},function(e,t,n){"use strict";function r(e,t,n){if(!t)return this.xhr=null,this.user="",this.method=null,this.types=[],void(this.graph=null);this.rdf=e;var r=t.getResponseHeader("Link");this.linkHeaders=i.parseLinkHeader(r)||{},n=n?n.toLowerCase():"",this.method=n,this.acl=this.linkHeaders.acl,this.acl&&(this.acl=this.acl[0]),this.allowedMethods=this.parseAllowedMethods(t,n),this.graph=null,this.meta=this.linkHeaders.meta||this.linkHeaders.describedBy,this.meta&&(this.meta=this.meta[0]),this.types=this.typeLinkHeaders(),this.url=t.getResponseHeader("Location")||t.responseURL,this.user=t.getResponseHeader("User")||"",this.websocket=t.getResponseHeader("Updates-Via")||"",this.xhr=t}e.exports=r;var i=n(141),o=n(143);r.prototype.aclAbsoluteUrl=function(){return this.acl?this.resolveMetaOrAclUrl("acl"):null},r.prototype.contentType=function(){return this.xhr?this.xhr.getResponseHeader("Content-Type"):null},r.prototype.exists=function(){return this.xhr&&this.xhr.status>=200&&this.xhr.status<400},r.prototype.isContainer=function(){return this.isType("http://www.w3.org/ns/ldp#Container")||this.isType("http://www.w3.org/ns/ldp#BasicContainer")},r.prototype.isLoggedIn=function(){return this.user},r.prototype.isType=function(e){return this.types.indexOf(e)!==-1},r.prototype.metaAbsoluteUrl=function(){return this.meta?this.resolveMetaOrAclUrl("meta"):null},r.prototype.parseAllowedMethods=function(e,t){return"get"===t?{}:i.parseAllowedMethods(e.getResponseHeader("Allow"),e.getResponseHeader("Accept-Patch"))},r.prototype.parsedGraph=function(){return this.graph||(this.graph=o.parseGraph(this.rdf,this.url,this.raw(),this.contentType())),this.graph},r.prototype.raw=function(){return this.xhr?this.xhr.response:null},r.prototype.resolveMetaOrAclUrl=function(e){if(!this.url)return null;var t=this[e],n=this.url.slice(0,this.url.lastIndexOf("/")+1);return i.absoluteUrl(n,t)},r.prototype.typeLinkHeaders=function(){if(!Array.isArray(this.linkHeaders.type))return[];var e=new Set(this.linkHeaders.type||[]);return Array.from(e)}},function(e,t){"use strict";function n(e,t,n){t.statementsMatching(s).forEach(function(t){e.add(t.subject,t.predicate,t.object,t.why)})}function r(e,t){var n=e.graph();return t.forEach(function(e){n.addStatement(e)}),n}function i(e,t,n,r){var i=e.graph();return e.parse(n,i,t,r),i}function o(e,t,n,r,i){var o={},a=e.statementsMatching(t,n,r,i);return a.forEach(function(e){o[e.object.uri]=!0}),Object.keys(o)}function a(e){var t=e.map(function(e){return e.toNT()});return t=t.join("\n")}e.exports.appendGraph=n,e.exports.parseGraph=i,e.exports.parseLinks=o,e.exports.serializeStatements=a,e.exports.graphFromStatements=r;var s=null},function(e,t,n){"use strict";function r(e,t,n){s.call(this,t,n),this.containers={},this.contentsUris=[],this.rdf=e,this.resources={},this.vocab=a(e),n&&this.initFromResponse(this.uri,n)}e.exports=r;var i=n(143),o=i.parseLinks,a=n(145),s=n(147);r.prototype=Object.create(s.prototype),r.prototype.constructor=r,r.prototype.appendFromGraph=function(e,t){var n=this.rdf.namedNode(this.uri);this.types=Object.keys(e.findTypeURIs(n));var i=o(e,null,this.vocab.ldp("contains"));this.contentsUris=this.contentsUris.concat(i.sort());var a,u=e.each(null,null,this.vocab.ldp("Container")),l=this;u.forEach(function(t){t.uri!==l.uri&&(a=new r(l.rdf,t.uri),a.types=Object.keys(e.findTypeURIs(t)),l.containers[a.uri]=a)});var c,f,h,d;i.forEach(function(t){f=t in l.containers,c=t!==l.uri&&!f,c&&(h=new s(t),d=l.rdf.namedNode(t),h.types=Object.keys(e.findTypeURIs(d)),l.resources[t]=h)})},r.prototype.findByType=function(e){var t,n,r=[];for(t in this.containers)n=this.containers[t],n.isType(e)&&r.push(n);var i;for(t in this.resources)i=this.resources[t],i.isType(e)&&r.push(i);return r},r.prototype.initFromResponse=function(e,t){var n=t.contentType();if(!n)throw new Error("Cannot parse container without a Content-Type: header");var r=i.parseGraph(this.rdf,e,t.raw(),n);this.parsedGraph=r,this.appendFromGraph(r,e)},s.prototype.isContainer=function(){return!0},r.prototype.isEmpty=function(){return 0===this.contentsUris.length}},function(e,t,n){"use strict";function r(e){var t=n(146)(e),r={acl:t.base("http://www.w3.org/ns/auth/acl#"),app:t.base("http://www.w3.org/ns/solid/app#"),dct:t.base("http://purl.org/dc/terms/"),foaf:t.base("http://xmlns.com/foaf/0.1/"),ldp:t.base("http://www.w3.org/ns/ldp#"),owl:t.base("http://www.w3.org/2002/07/owl#"),pim:t.base("http://www.w3.org/ns/pim/space#"),rdf:t.base("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),rdfs:t.base("http://www.w3.org/2000/01/rdf-schema#"),schema:t.base("http://schema.org/"),sioc:t.base("http://rdfs.org/sioc/ns#"),solid:t.base("http://www.w3.org/ns/solid/terms#"),vcard:t.base("http://www.w3.org/2006/vcard/ns#"),xsd:t.base("http://www.w3.org/2001/XMLSchema#")};return r}e.exports=r},function(e,t){"use strict";function n(e){this.rdf=e}function r(e){return new n(e)}e.exports=r,n.prototype.base=function(e){var t=this;return function(n){return t.rdf?t.rdf.namedNode(e+n):e+n}}},function(e,t){"use strict";function n(e,t){this.name=null,this.parsedGraph=null,this.response=t,this.types=[],this.uri=e,t&&t.url!==e&&(this.uri=t.url),this.initName()}e.exports=n,n.prototype.initName=function(){if(this.uri){var e=this.uri.split("/");this.name=e.pop(),!this.name&&e.length>0&&(this.name=e.pop())}},n.prototype.isContainer=function(){return!1},n.prototype.isType=function(e){return this.types.indexOf(e)!==-1}},function(e,t,n){"use strict";var r;r="undefined"!=typeof tabulator&&tabulator.isExtension?Components.classes["@mozilla.org/xmlextras/xmlhttprequest;1"].createInstance().QueryInterface(Components.interfaces.nsIXMLHttpRequest):"undefined"!=typeof window&&"XMLHttpRequest"in window?window.XMLHttpRequest:n(68),e.exports=r},function(e,t,n){function r(e,t,n){if("string"==typeof e&&(e=s[e]),"number"!=typeof e)throw new TypeError("Non-numeric HTTP code");"object"==typeof t&&null!=t&&(n=t,t=null),o.call(this,t||a[e],n),this.code=e}function i(e){return{configurable:!0,get:function(){return this[e]},set:function(t){return this[e]=t}}}t=e.exports=r;var o=n(150),a=n(151),s=t;r.prototype=Object.create(o.prototype,{constructor:{value:r,configurable:!0,writable:!0}}),r.prototype.name="HttpError",Object.defineProperties(r.prototype,{statusCode:i("code"),statusMessage:i("message"),status:{configurable:!0,get:function(){return this.code},set:function(e){Object.defineProperty(this,"status",{value:e,configurable:!0,enumerable:!0,writable:!0})}}}),r.prototype.toString=function(){return this.name+": "+this.code+" "+this.message};for(var u in a){var l=a[u];t[l.replace("'","").replace(/[- ]/g,"_").toUpperCase()]=+u}},function(e,t){function n(e,t){if(e&&"object"==typeof e?(t=e,e=void 0):this.message=e,t)for(var n in t)this[n]=t[n];r.call(this,"name")||(this.name=r.call(i(this),"name")?this.name:this.constructor.name),!o||"stack"in this||o(this,this.constructor)}var r=Object.hasOwnProperty,i=Object.getPrototypeOf,o=Error.captureStackTrace;e.exports=n,n.prototype=Object.create(Error.prototype,{constructor:{value:n,configurable:!0,writable:!0}}),n.prototype.name="StandardError"},function(e,t){e.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},function(e,t,n){"use strict";function r(e,t){this.webClient=e,this.config=t||i}e.exports=r;var i=n(153);r.prototype.currentUser=function(){if("undefined"==typeof window)return null;var e=window.location.href;return this.login(e).catch(function(e){return console.log("Detecting current user failed: %o",e),null})},r.prototype.listen=function(){var e=new Promise(function(e,t){var n=window.addEventListener?"addEventListener":"attachEvent",r=window[n],i="attachEvent"===n?"onmessage":"message";r(i,function(n){var r=n.data;if("User:"===r.slice(0,5)){var i=r.slice(5,r.length);return i&&i.length>0&&"http"===i.slice(0,4)?e(i):t(i)}},!0)});return e},r.prototype.login=function(e,t){var n=this.config.authEndpoint;e=e||window.location.origin+window.location.pathname,t=t||n;var r=this.webClient;return r.head(e).then(function(e){return e.isLoggedIn()?e.user:r.head(t).then(function(e){return e.user})})},r.prototype.signup=function(e){e=e||this.config.signupEndpoint;var t=this.config.signupWindowWidth,n=this.config.signupWindowHeight,r=window.screen.width/2-(t/2+10),i=window.screen.height/2-(n/2+50),o="Solid signup",a=e+"?origin="+encodeURIComponent(window.location.origin),s="resizable,scrollbars,status,width="+t+",height="+n+",left="+r+",top="+i;window.open(a,o,s);var u=this;return new Promise(function(e){u.listen().then(function(t){return e(t)})})}},function(e,t){"use strict";e.exports={authEndpoint:"https://databox.me/",signupEndpoint:"https://solid.github.io/solid-idps/",signupWindowHeight:600,signupWindowWidth:1024}},function(e,t,n){"use strict";function r(e,t,n){return t.options(e).then(function(e){var n=e.metaAbsoluteUrl();if(!n)throw new Error("Could not find a meta URL in the Link header");return t.get(n)}).then(function(t){var r=t.parsedGraph(),i=r.any(void 0,n.solid("account"));if(!i||!i.uri)throw new Error("Could not find a WebID matching the domain "+e);return i})}function i(e,t,n,r){return t=t||{},t.headers=t.headers||{Accept:"text/turtle"},t.noCredentials=!0,n.get(e,t).then(function(i){var s=i.parsedGraph(),u=new a(e,s,r,n,i);return u.isLoaded=!0,t.ignoreExtended?u:o(u,t,n)})}function o(e,t,n){var r=e.relatedProfilesLinks();return n.loadParsedGraphs(r,t).then(function(t){return t.forEach(function(t){t&&t.value&&e.appendFromGraph(t.value,t.uri)}),e})}e.exports.discoverWebID=r,e.exports.getProfile=i,e.exports.loadExtendedProfile=o;var a=n(155)},function(e,t,n){"use strict";function r(e,t,n,r,i){this.appRegistryListed={uri:null,graph:null},this.appRegistryUnlisted={uri:null,graph:null},this.inbox={uri:null,graph:null},this.isLoaded=!1,this.picture=null,this.name=null,this.rdf=n,this.storage=[],this.typeIndexListed={uri:null,graph:null},this.typeIndexUnlisted={uri:null,graph:null},this.parsedGraph=null,this.preferences={uri:null,graph:null},this.response=i,this.relatedProfiles={sameAs:[],seeAlso:[]},this.webId=null,this.webClient=r,e&&(this.baseProfileUrl=e.indexOf("#")>=0?e.slice(0,e.indexOf("#")):e,t&&(this.initWebId(t),this.appendFromGraph(t,this.baseProfileUrl)))}function i(e,t,n){var r=s(n),i=n.namedNode(e),o=r.foaf("primaryTopic"),a=t.any(i,o);return a}function o(e,t,n,r,i){var o=e.any(t,n,r,i);return o?o.uri:null}e.exports=r;var a=n(156),s=n(160),u=n(162),l=n(165),c=n(163),f=c.parseLinks,h="/settings/prefs.ttl",d="/profile/";r.prototype.appendFromGraph=function(e,t){if(e){var n=this.rdf,r=s(n);this.parsedGraph=this.parsedGraph||n.graph(),c.appendGraph(this.parsedGraph,e,t);var i,a=n.namedNode(this.webId);this.name||(this.name=this.find(r.foaf("name"))),this.picture||(this.picture=this.find(r.foaf("img"))),i=f(e,null,r.owl("sameAs")),this.relatedProfiles.sameAs=this.relatedProfiles.sameAs.concat(i),i=f(e,null,r.rdfs("seeAlso")),this.relatedProfiles.seeAlso=this.relatedProfiles.seeAlso.concat(i),this.preferences.uri||(this.preferences.uri=o(e,a,r.pim("preferencesFile"))),this.inbox.uri||(this.inbox.uri=o(e,a,r.solid("inbox"))),i=f(e,a,r.pim("storage")),this.storage=this.storage.concat(i),this.typeIndexListed.uri||(this.typeIndexListed.uri=o(e,a,r.solid("publicTypeIndex"))),this.typeIndexUnlisted.uri||(this.typeIndexUnlisted.uri=o(e,a,r.solid("privateTypeIndex"))),this.appRegistryListed.uri||(this.appRegistryListed.uri=o(e,a,r.solid("publicAppRegistry"))),this.appRegistryUnlisted.uri||(this.appRegistryUnlisted.uri=o(e,a,r.solid("privateAppRegistry")))}},r.prototype.appRegistryDefaultContainer=function(){var e,t=this.webId||this.baseProfileUrl;return e=t?t.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,"")+"/":d},r.prototype.appsForType=function(e){return a.appsForType(this,e,this.rdf)},r.prototype.find=function(e){if(!this.parsedGraph)throw new Error("Profile graph not yet loaded.");var t=this.rdf.namedNode(this.webId),n=this.parsedGraph.any(t,e);return n?n.value||n.uri:n},r.prototype.findAll=function(e){if(!this.parsedGraph)throw new Error("Profile graph not yet loaded.");var t=this.rdf.namedNode(this.webId),n=this.parsedGraph.statementsMatching(t,e);return n=n.map(function(e){return e.object.value||e.object.uri}),n.sort()},r.prototype.initWebId=function(e){if(e)try{this.webId=i(this.baseProfileUrl,e,this.rdf).uri}catch(e){throw new Error("Unable to parse WebID from profile: "+e)}},r.prototype.relatedProfilesLinks=function(){var e=[];return e=e.concat(this.relatedProfiles.sameAs).concat(this.relatedProfiles.seeAlso),this.preferences.uri&&(e=e.concat(this.preferences.uri)),e},r.prototype.hasAppRegistryPrivate=function(){if(!this.isLoaded)throw new Error("Must load profile before checking if registry exists.");return this.appRegistryUnlisted.uri},r.prototype.hasAppRegistryPublic=function(){if(!this.isLoaded)throw new Error("Must load profile before checking if registry exists.");return this.appRegistryListed.uri},r.prototype.hasStorage=function(){return this.storage&&this.storage.length>0},r.prototype.hasTypeRegistryPrivate=function(){if(!this.isLoaded)throw new Error("Must load profile before checking if registry exists.");return this.typeIndexUnlisted.uri},r.prototype.hasTypeRegistryPublic=function(){if(!this.isLoaded)throw new Error("Must load profile before checking if registry exists.");return this.typeIndexListed.uri},r.prototype.loadAppRegistry=function(e,t){return e=e||this.webClient,a.loadAppRegistry(this,e,t)},r.prototype.loadTypeRegistry=function(e,t){return e=e||this.webClient,l.loadTypeRegistry(this,e,t)},r.prototype.addAppRegistry=function(e,t){if(u.isListed(e,this.rdf))this.appRegistryListed.graph||(this.appRegistryListed.uri=t,this.appRegistryListed.graph=e);else{if(!u.isUnlisted(e,this.rdf))throw console.log(e),new Error("Attempting to add an invalid app registry resource");this.appRegistryUnlisted.graph||(this.appRegistryUnlisted.uri=t,this.appRegistryUnlisted.graph=e)}},r.prototype.addTypeRegistry=function(e,t){if(u.isListed(e,this.rdf))this.typeIndexListed.graph||(this.typeIndexListed.uri=t,this.typeIndexListed.graph=e);else{if(!u.isUnlisted(e,this.rdf))throw new Error("Attempting to add an invalid type registry index");this.typeIndexUnlisted.graph||(this.typeIndexUnlisted.uri=t,this.typeIndexUnlisted.graph=e)}},r.prototype.reloadAppRegistry=function(e){return this.resetAppRegistry(),this.loadAppRegistry(e)},r.prototype.reloadTypeRegistry=function(e){return this.resetTypeRegistry(),this.loadTypeRegistry(e)},r.prototype.resetAppRegistry=function(){this.appRegistryListed.graph=null,this.appRegistryUnlisted.graph=null},r.prototype.resetTypeRegistry=function(){this.typeIndexListed.graph=null,this.typeIndexUnlisted.graph=null},r.prototype.typeRegistryForClass=function(e){return l.typeRegistryForClass(this,e,this.rdf)},r.prototype.typeRegistryDefaultContainer=function(){var e,t=this.webId||this.baseProfileUrl;return e=t?t.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,"")+"/":d},r.prototype.privateProfileUri=function(){return this.preferences&&this.preferences.uri?this.preferences.uri:h},r.prototype.registerApp=function(e,t){return t=t||this.webClient,a.registerApp(this,e,t)},r.prototype.registerType=function(e,t,n,r){return l.registerType(this,e,t,n,r,this.webClient)},r.prototype.unregisterType=function(e,t,n){return l.unregisterType(this,e,t,n,this.webClient)}},function(e,t,n){"use strict";function r(e,t,n){var r,i;if(t.isListed?(r=e.appRegistryListed.uri,i=e.appRegistryListed.graph):(r=e.appRegistryUnlisted.uri,i=e.appRegistryUnlisted.graph),!r)throw new Error("Cannot register app, registry URL missing");var o=e.rdf,a=[],s=t.rdfStatements(o);return n.patch(r,a,s).then(function(t){var n=d.graphFromStatements(s,o);return i?d.appendGraph(i,n):i=n,e})}function i(e,t,n){var r=[];return r.concat(f(e.appRegistryListed.graph,t,n)).concat(f(e.appRegistryUnlisted.graph,t,n))}function o(e){var t=y(e),n=e.namedNode(""),r=[e.triple(n,t.rdf("type"),t.solid("AppRegistry")),e.triple(n,t.rdf("type"),t.solid("UnlistedDocument"))],i={data:d.serializeStatements(r),graph:d.graphFromStatements(r,e),slug:"privateAppRegistry.ttl",uri:null};return i}function a(e){var t=y(e),n=e.namedNode(""),r=[e.triple(n,t.rdf("type"),t.solid("AppRegistry")),e.triple(n,t.rdf("type"),t.solid("ListedDocument"))],i={data:d.serializeStatements(r),graph:d.graphFromStatements(r,e),slug:"publicAppRegistry.ttl",uri:null};return i}function s(e,t,n){n=n||{};var r=e.rdf,i=y(r),a=e.appRegistryDefaultContainer(),s=r.namedNode(e.webId),u=o(r);return t.post(a,u.data,u.slug).catch(function(e){throw new Error("Could not create private registry document:",e)}).then(function(o){u.uri=p.absoluteUrl(v.hostname(a),o.url);var l=[r.triple(s,i.solid("privateAppRegistry"),r.namedNode(u.uri))],c=[];return t.patch(e.privateProfileUri(),c,l,n)}).catch(function(e){throw new Error("Could not update profile with private registry:"+e)}).then(function(t){return e.appRegistryUnlisted=u,e})}function u(e,t,n){n=n||{};var r=e.rdf,i=y(r),o=e.appRegistryDefaultContainer(),s=r.namedNode(e.webId),u=a(r);return t.post(o,u.data,u.slug).catch(function(e){throw new Error("Could not create public registry document:",e)}).then(function(a){u.uri=p.absoluteUrl(v.hostname(o),a.url);var l=[r.triple(s,i.solid("publicAppRegistry"),r.namedNode(u.uri))],c=[];return t.patch(e.webId,c,l,n)}).catch(function(e){throw new Error("Could not update profile with public registry:",e)}).then(function(t){return e.appRegistryListed=u,e})}function l(e,t,n){n=n||{},n.headers=n.headers||{},n.headers.Accept||(n.headers.Accept="text/turtle");var r=[];return e.appRegistryListed.uri&&r.push(e.appRegistryListed.uri),e.appRegistryUnlisted.uri&&r.push(e.appRegistryUnlisted.uri),t.loadParsedGraphs(r,n).then(function(t){return t.forEach(function(t){t&&t.value&&e.addAppRegistry(t.value,t.uri)}),e})}function c(e,t,n){if(!e)throw new Error("No profile provided");if(!e.isLoaded)throw new Error("Profile is not loaded");if(!t||!t.isValid())throw new Error("Invalid app registration");return l(e,n).then(function(e){return t.isListed&&!e.hasAppRegistryPublic()?u(e,n):t.isListed||e.hasAppRegistryPrivate()?e:s(e,n)}).then(function(e){return r(e,t,n)})}function f(e,t,n){var r,i=y(n),o=[];return e?(e.statementsMatching(null,i.app("commonType"),t).forEach(function(t){r=t.subject;var i=new h;i.initFromGraph(r,e,n),o.push(i)}),o):o}e.exports.addToAppRegistry=r,e.exports.blankPrivateAppRegistry=o,e.exports.blankPublicAppRegistry=a,e.exports.initAppRegistryPrivate=s,e.exports.initAppRegistryPublic=u,e.exports.loadAppRegistry=l,e.exports.appsForType=i,e.exports.registerApp=c,e.exports.registrationsFromGraph=f;var h=n(157),d=n(163),p=n(164),y=n(160),v=n(164)},function(e,t,n){"use strict";function r(e,t,n){e=e||{},this.isListed=n,this.name=e.name,this.redirectTemplateUri=e.redirectTemplateUri,this.registrationUri=null,this.shortdesc=e.shortdesc,this.types=t||[]}e.exports=r;var i=n(158),o=n(160),a=n(162);r.prototype.hashFragment=function(){var e=i.unique(this.redirectTemplateUri);return e},r.prototype.initFromGraph=function(e,t,n){this.registrationUri=e.uri,this.isListed=!!a.isListed(t,n),this.types=[];var r=this,i=o(n);t.statementsMatching(e,i.app("commonType")).forEach(function(e){r.types.push(e.object.uri)});var s;s=t.any(e,i.app("name")),s&&(this.name=s.value),s=t.any(e,i.app("shortdesc")),s&&(this.shortdesc=s.value),s=t.any(e,i.app("redirectTemplateUri")),s&&(this.redirectTemplateUri=s.value)},r.prototype.isValid=function(){return this.name&&this.redirectTemplateUri&&this.types.length>0},r.prototype.rdfStatements=function(e){var t=e.namedNode("#"+this.hashFragment()),n=[],r=o(e);return n.push(e.triple(t,r.rdf("type"),r.solid("AppRegistration")),e.triple(t,r.app("name"),this.name),e.triple(t,r.app("shortdesc"),this.shortdesc),e.triple(t,r.app("redirectTemplateUri"),this.redirectTemplateUri)),this.types.forEach(function(i){n.push(e.triple(t,r.app("commonType"),i))}),n}},function(e,t,n){e.exports=n(159)},function(e,t){function n(e){var t=0;if(0==e.length)return t;for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);t=(t<<5)-t+r,t&=t}return t}function r(e,t){function n(e){var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";return t[e]}t=t||62;var r,i=[],o="",a=e<0?"-":"";for(e=Math.abs(e);e>=t;)r=e%t,e=Math.floor(e/t),i.push(n(r));e>0&&i.push(n(e));for(var s=i.length-1;s>=0;s--)o+=i[s];return a+o}function i(e){var t=r(n(e),61);return t.replace("-","Z")}function o(e){for(var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="",r=e||8,i=0;i<r;i++){var o=Math.floor(Math.random()*t.length);n+=t.substring(o,o+1)}return n}t.bitwise=n,t.binaryTransfer=r,t.unique=i,t.random=o},[178,161],146,function(e,t,n){"use strict";function r(e,t){var n=o(t);return e.any(null,null,n.solid("UnlistedDocument"),e.uri)}function i(e,t){var n=o(t);return e.any(null,null,n.solid("ListedDocument"),e.uri)}e.exports.isListed=i,e.exports.isUnlisted=r;var o=n(160)},function(e,t){"use strict";function n(e,t){t.statementsMatching(u).forEach(function(t){e.add(t.subject,t.predicate,t.object,t.why)})}function r(e,t){return"string"!=typeof e&&(e=e.toNT()),t&&e.endsWith(".")&&(e=e.slice(0,-1)),e}function i(e,t){var n=t.graph();return e.forEach(function(e){n.addStatement(e)}),n}function o(e,t,n,r){var i=r.graph();return r.parse(t,i,e,n),i}function a(e,t,n,r,i){var o={},a=e.statementsMatching(t,n,r,i);return a.forEach(function(e){o[e.object.uri]=!0}),Object.keys(o)}function s(e){var t=e.map(function(e){return e.toNT()});return t=t.join("\n")}e.exports.appendGraph=n,e.exports.parseGraph=o,e.exports.parseLinks=a,e.exports.serializeStatements=s,e.exports.graphFromStatements=i,e.exports.statementToNT=r;var u=null},function(e,t,n){"use strict";function r(e,t){var n={};if(e){var r=e.split(",");r.forEach(function(t){t&&e.indexOf(t)>=0&&(n[t.trim().toLowerCase()]=!0)})}return t&&t.indexOf("application/sparql-update")>=0&&(n.patch=!0),n}function i(e){if(!e)return{};for(var t=/<[^>]*>\s*(\s*;\s*[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*")))*(,|$)/g,n=/[^\(\)<>@,;:"\/\[\]\?={} \t]+=(([^\(\)<>@,;:"\/\[\]\?={} \t]+)|("[^"]*"))/g,r=e.match(t),i={},o=0;o<r.length;o++)for(var a=r[o].split(">"),s=a[0].substring(1),u=a[1],l=u.match(n),c=0;c<l.length;c++){var f=l[c],h=f.split("="),d=h[1].replace(/["']/g,"");i[d]||(i[d]=[]),i[d].push(s),i[d].length>1&&i[d].sort()}return i}function o(e){var t,n,r,i,o=e.split("//");return 2===o.length?(t=o[0],n=o[1]):n=e,i=n.split("/"),r=t?t+"//"+i[0]:i[0],e.startsWith("//")&&(r="//"+r),r}function a(e,t){return t&&"http"!==t.slice(0,4)?[e,t].map(function(e){return"/"===e[0]&&(e=e.slice(1)),"/"===e[e.length-1]&&(e=e.slice(0,e.length-1)),e}).join("/"):t}function s(e,t){var n="",r=!0;return e&&e.length>0&&(e=e.map(function(e){return u.statementToNT(e,r)}),n+="DELETE DATA { "+e.join(" . ")+" };\n"),
t&&t.length>0&&(t=t.map(function(e){return u.statementToNT(e,r)}),n+="INSERT DATA { "+t.join(" . ")+" };\n"),n}e.exports.composePatchQuery=s,e.exports.parseAllowedMethods=r,e.exports.parseLinkHeader=i,e.exports.absoluteUrl=a,e.exports.hostname=o;var u=n(163)},function(e,t,n){"use strict";function r(e){var t=e.namedNode(""),n=m(e),r=[e.triple(t,n.rdf("type"),n.solid("TypeIndex")),e.triple(t,n.rdf("type"),n.solid("UnlistedDocument"))],i={data:v.serializeStatements(r),graph:v.graphFromStatements(r,e),slug:"privateTypeIndex.ttl",uri:null};return i}function i(e){var t=e.namedNode(""),n=m(e),r=[e.triple(t,n.rdf("type"),n.solid("TypeIndex")),e.triple(t,n.rdf("type"),n.solid("ListedDocument"))],i={data:v.serializeStatements(r),graph:v.graphFromStatements(r,e),slug:"publicTypeIndex.ttl",uri:null};return i}function o(e,t,n){n=n||{};var i=t.rdf,o=m(i),a=e.typeRegistryDefaultContainer(),s=i.namedNode(e.webId),u=r(i);return t.post(a,u.data,u.slug).catch(function(e){throw new Error("Could not create privateIndex document:",e)}).then(function(r){u.uri=y.absoluteUrl(g.hostname(a),r.url);var l=[i.triple(s,o.solid("privateTypeIndex"),i.namedNode(u.uri))],c=[];return t.patch(e.privateProfileUri(),c,l,n)}).catch(function(e){throw new Error("Could not update profile with private index:"+e)}).then(function(t){return e.typeIndexUnlisted=u,e})}function a(e,t,n){n=n||{};var r=t.rdf,o=m(r),a=e.typeRegistryDefaultContainer(),s=r.namedNode(e.webId),u=i(r);return t.post(a,u.data,u.slug).catch(function(e){throw new Error("Could not create publicIndex document:",e)}).then(function(i){u.uri=y.absoluteUrl(g.hostname(a),i.url);var l=[r.triple(s,o.solid("publicTypeIndex"),r.namedNode(u.uri))],c=[];return t.patch(e.webId,c,l,n)}).catch(function(e){throw console.log(e),new Error("Could not update profile with public index:",e)}).then(function(t){return e.typeIndexListed=u,e})}function s(e,t,r,i,o,a){var s,u,l=n(158),c=i.rdf,f=m(c),h=l.unique(t.uri);if(a?(s=e.typeIndexListed.uri,u=e.typeIndexListed.graph):(s=e.typeIndexUnlisted.uri,u=e.typeIndexUnlisted.graph),!s)throw new Error("Cannot register type, registry URL missing");var d,p=c.namedNode(s+"#"+h);"instance"===o?d=f.solid("instance"):(d=f.solid("instanceContainer"),r.lastIndexOf("/")!==r.length-1&&(r+="/"));var y=[],g=[c.triple(p,f.rdf("type"),f.solid("TypeRegistration")),c.triple(p,f.solid("forClass"),t),c.triple(p,d,c.namedNode(r))];return i.patch(s,y,g).then(function(t){var n=v.graphFromStatements(g,c);return u?v.appendGraph(u,n):u=n,e})}function u(e,t,n){n=n||{},n.headers=n.headers||{},n.headers.Accept||(n.headers.Accept="text/turtle");var r=[];return e.typeIndexListed.uri&&r.push(e.typeIndexListed.uri),e.typeIndexUnlisted.uri&&r.push(e.typeIndexUnlisted.uri),t.loadParsedGraphs(r,n).then(function(t){return t.forEach(function(t){t&&t.value&&e.addTypeRegistry(t.value,t.uri)}),e})}function l(e,t,n,r,i,l){if(!e)throw new Error("No profile provided");if(!e.isLoaded)throw new Error("Profile is not loaded");if(!t||!n)throw new Error("Type registration requires type class and location");if(r=r||"container","container"!==r&&"instance"!==r)throw new Error("Invalid location type");return u(e,l).then(function(e){return i&&!e.hasTypeRegistryPublic()?a(e,l):i||e.hasTypeRegistryPrivate()?e:o(e,l)}).then(function(e){return s(e,t,n,l,r,i)})}function c(e,t,n){var r=[],i=!0;return r.concat(f(e.typeIndexListed.graph,t,i,n)).concat(f(e.typeIndexUnlisted.graph,t,!i,n))}function f(e,t,n,r){var i,o,a,s=m(r),u=[];if(!e)return u;var l=e.statementsMatching(null,null,t);return l.forEach(function(r){i=r.subject,o=e.statementsMatching(i,s.solid("instance")),o.forEach(function(e){u.push(new p(i.uri,t,"instance",e.object.uri,n))}),a=e.statementsMatching(i,s.solid("instanceContainer")),a.forEach(function(e){u.push(new p(i.uri,t,"container",e.object.uri,n))})}),u}function h(e,t,n,r,i){var o,a,s=n.rdf;if(r?(o=e.typeIndexListed.uri,a=e.typeIndexListed.graph):(o=e.typeIndexUnlisted.uri,a=e.typeIndexUnlisted.graph),!o)throw new Error("Cannot unregister type, registry URL missing");var u=f(a,t,r,s);if(0===u.length)return Promise.resolve(e);i&&(u=u.filter(function(e){return e.locationUri===i}));var l=[];u.forEach(function(e){a.statementsMatching(s.namedNode(e.registrationUri)).forEach(function(e){l.push(e)})});var c=[];return n.patch(o,l,c).then(function(t){return e.reloadTypeRegistry(n)})}function d(e,t,n,r,i){if(!e)throw new Error("No profile provided");if(!e.isLoaded)throw new Error("Profile is not loaded");if(!t)throw new Error("Unregistering a type requires type class");return u(e,i).then(function(e){if(n&&!e.typeIndexListed.graph)throw new Error("Profile has no Listed type index");if(!n&&!e.typeIndexUnlisted.graph)throw new Error("Profile has no Unlisted type index");return h(e,t,i,n,r)})}e.exports.blankPrivateTypeIndex=r,e.exports.blankPublicTypeIndex=i,e.exports.initTypeRegistryPrivate=o,e.exports.initTypeRegistryPublic=a,e.exports.loadTypeRegistry=u,e.exports.registerType=l,e.exports.typeRegistryForClass=c,e.exports.unregisterType=d;var p=n(166),y=n(164),v=n(163),g=n(164),m=n(160)},function(e,t){"use strict";function n(e,t,n,r,i){this.isListed=i,this.locationType=n,this.locationUri=r,this.rdfClass=t,this.registrationUri=e}e.exports=n,n.prototype.isContainer=function(){return"container"===this.locationType},n.prototype.isInstance=function(){return"instance"===this.locationType}},function(e,t,n){"use strict";function r(e,t){var n;return t.head(e).then(function(e){if(n=e.aclAbsoluteUrl(),!n)throw new Error("ACL URL not found for resource.");return t.del(n)})}function i(e,t,n){var r,i;return t.head(e).then(function(a){if(r=a.aclAbsoluteUrl(),!r)throw new Error("ACL URL not found for resource.");return i=new o(e,r,a.isContainer(),{rdf:n,webClient:t}),t.get(r).then(function(e){return e.parsedGraph()})}).then(function(e){return i.initFromGraph(e),i})}var o=n(168),a=n(169),s=n(172);e.exports.clearPermissions=r,e.exports.getPermissions=i,e.exports.PermissionSet=o,e.exports.Authorization=a,Object.assign(e.exports,s.acl)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return o(e)?e:e+h}function o(e){return e.endsWith(h)}function a(e){return"string"==typeof e?e.startsWith("mailto:"):e.object.value.startsWith("mailto:")}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(169),l=n(172),c=l.acl,f=n(170),h=".acl",d="text/turtle",p="resource",y="container",v="agents",g="groups",m=function(){function e(t,n,a){var s=arguments.length<=3||void 0===arguments[3]?{}:arguments[3];r(this,e),this.authorizations={},this.aclUrl=n,this.host=s.host,this.index={agents:{},groups:{}},this.rdf=s.rdf,this.resourceType=a?y:p,this.resourceUrl=t,this.strictOrigin=s.strictOrigin,this.origin=s.origin,this.webClient=s.webClient,this.aclUrlFor=s.aclUrlFor?s.aclUrlFor:i,this.aclUrlFor.bind(this),this.isAcl=s.isAcl?s.isAcl:o,this.isAcl.bind(this),s.graph&&this.initFromGraph(s.graph)}return s(e,[{key:"addAuthorization",value:function(e){var t=e.hashFragment();return t in this.authorizations?this.authorizations[t].mergeWith(e):this.authorizations[t]=e,!e.virtual&&e.allowsControl()&&this.addControlPermissionsFor(e),this.addToAgentIndex(e.webId(),e.accessType,e.resourceUrl,e),e.isPublic()&&this.addToPublicIndex(e.resourceUrl,e.accessType,e),this}},{key:"addAuthorizationFor",value:function(e,t,n,r){var i=arguments.length<=4||void 0===arguments[4]?[]:arguments[4],o=arguments.length<=5||void 0===arguments[5]?[]:arguments[5],a=new u(e,t);return a.setAgent(n),a.addMode(r),a.addOrigin(i),o.forEach(function(e){a.addMailTo(e)}),this.addAuthorization(a),a}},{key:"addControlPermissionsFor",value:function(e){var t=e.clone();t.resourceUrl=this.aclUrlFor(e.resourceUrl),t.virtual=!0,t.addMode(c.ALL_MODES),this.addAuthorization(t)}},{key:"addGroupPermission",value:function(e,t){var n=new u(this.resourceUrl,this.isAuthInherited());return n.setGroup(e),n.addMode(t),this.addAuthorization(n),this}},{key:"addPermission",value:function(e,t,n){if(!e)throw new Error("addPermission() requires a valid webId");if(!t)throw new Error("addPermission() requires a valid accessMode");var r=new u(this.resourceUrl,this.isAuthInherited());return r.setAgent(e),r.addMode(t),n&&r.addOrigin(n),this.addAuthorization(r),this}},{key:"addToAgentIndex",value:function(e,t,n,r){var i=this.index.agents;i[e]||(i[e]={}),i[e][t]||(i[e][t]={}),i[e][t][n]?i[e][t][n].mergeWith(r):i[e][t][n]=r}},{key:"addToGroupIndex",value:function(e,t,n,r){var i=this.index.groups;i[e]||(i[e]={}),i[e][t]||(i[e][t]={}),i[e][t][n]?i[e][t][n].mergeWith(r):i[e][t][n]=r}},{key:"addToPublicIndex",value:function(e,t,n){this.addToGroupIndex(c.EVERYONE,t,e,n)}},{key:"allAuthorizations",value:function(){var e,t=this,n=[];return Object.keys(this.authorizations).forEach(function(r){e=t.authorizations[r],n.push(e)}),n}},{key:"allowsPublic",value:function(e,t){t=t||this.resourceUrl;var n=this.findPublicAuth(t);return!!n&&(this.checkOrigin(n)&&n.allowsMode(e))}},{key:"buildGraph",value:function(e){var t=e.graph();return this.allAuthorizations().forEach(function(n){t.add(n.rdfStatements(e))}),t}},{key:"checkAccess",value:function(e,t,n){var r=void 0;if(this.allowsPublic(n,e))r=!0;else{var i=this.findAuthByAgent(t,e);r=i&&this.checkOrigin(i)&&i.allowsMode(n)}return Promise.resolve(r)}},{key:"checkOrigin",value:function(e){return!this.strictOrigin||!this.origin||this.origin===this.host||e.allowsOrigin(this.origin)}},{key:"clear",value:function(e){if(e=e||this.webClient,!e)return Promise.reject(new Error("Cannot clear - no web client"));var t=this.aclUrl;return t?e.del(t):Promise.reject(new Error("Cannot clear - unknown target url"))}},{key:"equals",value:function(e){var t=this,n=this.resourceUrl===e.resourceUrl,r=this.aclUrl===e.aclUrl,i=this.resourceType===e.resourceType,o=Object.keys(this.authorizations),a=Object.keys(e.authorizations);if(o.length!==a.length)return!1;var s,u,l=!0;return o.forEach(function(n){s=t.authorizations[n],u=e.authorizations[n],u||(l=!1),s.equals(u)||(l=!1)}),n&&r&&i&&l}},{key:"findAuthByAgent",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?v:arguments[2],r=this.index[n];if(!r[e])return!1;var i=r[e][c.ACCESS_TO],o=void 0;if(i&&(o=i[t]),o)return o;var a=r[e][c.DEFAULT],s=void 0;if(a&&(s=a[t],!s)){var u=Object.keys(a).sort().reverse(),l=!0,f=!1,h=void 0;try{for(var d,p=u[Symbol.iterator]();!(l=(d=p.next()).done);l=!0){var y=d.value;if(t.startsWith(y)){s=a[y];break}}}catch(e){f=!0,h=e}finally{try{!l&&p.return&&p.return()}finally{if(f)throw h}}}return s}},{key:"findPublicAuth",value:function(e){return this.findAuthByAgent(c.EVERYONE,e,g)}},{key:"forEach",value:function(e){var t=this;this.allAuthorizations().forEach(function(n){e.call(t,n)})}},{key:"initFromGraph",value:function(e){var t=this,n=f(this.rdf),r=e.match(null,null,n.acl("Authorization"));r.length?r=r.map(function(e){return e.subject}):!function(){var t={};r=e.match(null,n.acl("mode")),r.forEach(function(e){t[e.subject.value]=e.subject}),r=Object.keys(t).map(function(e){return t[e]})}(),r.forEach(function(r){var i=e.match(r,n.acl("mode")),o=e.match(r,n.acl("origin")),s=e.match(r,n.acl("agent")),u=s.filter(a);s=s.filter(function(e){return!a(e)});var l=e.match(r,n.acl("agentClass"),n.foaf("Agent")),f=e.match(r,n.acl("agentGroup")),h=s.concat(l).concat(f);h.forEach(function(a){var s=e.match(r,n.acl("accessTo"));s.forEach(function(e){var n=e.object.value;t.addAuthorizationFor(n,c.NOT_INHERIT,a,i,o,u)});var l=e.match(r,n.acl("default")).concat(e.match(r,n.acl("defaultForNew")));l.forEach(function(e){var n=e.object.value;t.addAuthorizationFor(n,c.INHERIT,a,i,o,u)})})})}},{key:"isAuthInherited",value:function(){return this.resourceType===y}},{key:"isEmpty",value:function(){return 0===this.count}},{key:"permissionFor",value:function(e,t){if(!e)return null;t=t||this.resourceUrl;var n=u.hashFragmentFor(e,t);return this.authorizations[n]}},{key:"removeAuthorization",value:function(e){var t=e.hashFragment();return delete this.authorizations[t],this}},{key:"removePermission",value:function(e,t){var n=this.permissionFor(e,this.resourceUrl);return n?(n.removeMode(t),n.isEmpty()&&this.removeAuthorization(n),this):this}},{key:"save",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=t.aclUrl||this.aclUrl,r=t.contentType||d;return n?this.webClient?this.serialize({contentType:r}).then(function(t){return e.webClient.put(n,t,r)}):Promise.reject(new Error("Cannot save - no web client")):Promise.reject(new Error("Cannot save - unknown target url"))}},{key:"serialize",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.contentType||d,n=e.rdf||this.rdf;if(!n)return Promise.reject(new Error("Cannot save - no rdf library"));var r=this.buildGraph(n),i=null,o=null;return new Promise(function(e,a){n.serialize(i,r,o,t,function(n,r){return n?a(n):r?void e(r):a(new Error("Error serializing the graph to "+t))})})}},{key:"count",get:function(){return Object.keys(this.authorizations).length}}]),e}();m.RESOURCE=p,m.CONTAINER=y,e.exports=m},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){var n=arguments.length<=2||void 0===arguments[2]?u.ACCESS_TO:arguments[2],r=e+"-"+t+"-"+n;return r}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(170),s=n(172),u=s.acl,l=function(){function e(t,n){r(this,e),this.accessModes={},this.accessType=n?u.DEFAULT:u.ACCESS_TO,this.agent=null,this.group=null,this.inherited=n,this.mailTo=[],this.originsAllowed={},this.resourceUrl=t,this.virtual=!1}return o(e,[{key:"addMailTo",value:function(e){"string"!=typeof e&&(e=e.object.value),e.startsWith("mailto:")&&(e=e.split(":")[1]),this.mailTo.push(e),this.mailTo.sort()}},{key:"addMode",value:function(e){var t=this;return Array.isArray(e)?e.forEach(function(e){t.addModeSingle(e)}):this.addModeSingle(e),this}},{key:"addModeSingle",value:function(e){return"string"!=typeof e&&(e=e.object.value),this.accessModes[e]=!0,this}},{key:"addOrigin",value:function(e){var t=this;return Array.isArray(e)?e.forEach(function(e){t.addOriginSingle(e)}):this.addOriginSingle(e),this}},{key:"addOriginSingle",value:function(e){return"string"!=typeof e&&(e=e.object.value),this.originsAllowed[e]=!0,this}},{key:"allModes",value:function(){return Object.keys(this.accessModes)}},{key:"allOrigins",value:function(){return Object.keys(this.originsAllowed)}},{key:"allowsMode",value:function(e){return e=u[e.toUpperCase()]||e,e===u.APPEND?this.allowsAppend():this.accessModes[e]}},{key:"allowsOrigin",value:function(e){return e in this.originsAllowed}},{key:"allowsRead",value:function(){return this.accessModes[u.READ]}},{key:"allowsWrite",value:function(){return this.accessModes[u.WRITE]}},{key:"allowsAppend",value:function(){return this.accessModes[u.APPEND]||this.accessModes[u.WRITE]}},{key:"allowsControl",value:function(){return this.accessModes[u.CONTROL]}},{key:"clone",value:function(){var t=new e;return Object.assign(t,JSON.parse(JSON.stringify(this))),t}},{key:"equals",value:function(e){var t=this.agent===e.agent,n=this.group===e.group,r=this.resourceUrl===e.resourceUrl,i=Object.keys(this.accessModes),o=Object.keys(e.accessModes),a=i.length===o.length,s=JSON.stringify(this.inherited)===JSON.stringify(e.inherited),u=!0;i.forEach(function(t){e.accessModes[t]||(u=!1)});var l=JSON.stringify(this.mailTo)===JSON.stringify(e.mailTo),c=JSON.stringify(this.originsAllowed)===JSON.stringify(e.originsAllowed);return t&&n&&r&&a&&u&&s&&l&&c}},{key:"hashFragment",value:function e(){if(!this.webId||!this.resourceUrl)throw new Error("Cannot call hashFragment() on an incomplete authorization");var e=i(this.webId(),this.resourceUrl,this.accessType);return e}},{key:"isAgent",value:function(){return this.agent}},{key:"isEmpty",value:function(){return 0===Object.keys(this.accessModes).length}},{key:"isPublic",value:function(){return this.group===u.EVERYONE}},{key:"isGroup",value:function(){return this.group}},{key:"isInherited",value:function(){return this.inherited}},{key:"isValid",value:function(){return this.webId()&&this.resourceUrl&&!this.isEmpty()}},{key:"mergeWith",value:function(e){if(this.hashFragment()!==e.hashFragment())throw new Error("Cannot merge authorizations with different agent id or resource url (accessTo)");for(var t in e.accessModes)this.addMode(t)}},{key:"rdfStatements",value:function(e){if(!this.webId()||!this.resourceUrl)return[];if(this.virtual)return[];var t,n=e.namedNode("#"+this.hashFragment()),r=a(e),i=[e.triple(n,r.rdf("type"),r.acl("Authorization"))];this.agent&&(t=e.triple(n,r.acl("agent"),e.namedNode(this.agent)),i.push(t)),this.mailTo.length>0&&this.mailTo.forEach(function(o){t=e.triple(n,r.acl("agent"),e.namedNode("mailto:"+o)),i.push(t)}),this.group&&(t=e.triple(n,r.acl("agentClass"),e.namedNode(this.group)),i.push(t)),t=e.triple(n,r.acl("accessTo"),e.namedNode(this.resourceUrl)),i.push(t);var o=Object.keys(this.accessModes);return o.forEach(function(o){t=e.triple(n,r.acl("mode"),e.namedNode(o)),i.push(t)}),this.inherited&&(t=e.triple(n,r.acl("defaultForNew"),e.namedNode(this.resourceUrl)),i.push(t)),this.allOrigins().forEach(function(o){t=e.triple(n,r.acl("origin"),e.namedNode(o)),i.push(t)}),i}},{key:"removeMode",value:function(e){var t=this;return Array.isArray(e)?e.forEach(function(e){t.removeModeSingle(e)}):this.removeModeSingle(e),this}},{key:"removeModeSingle",value:function(e){"string"!=typeof e&&(e=e.object.value),delete this.accessModes[e]}},{key:"removeOrigin",value:function(e){var t=this;return Array.isArray(e)?e.forEach(function(e){t.removeOriginSingle(e)}):this.removeOriginSingle(e),this}},{key:"removeOriginSingle",value:function(e){"string"!=typeof e&&(e=e.object.value),delete this.originsAllowed[e]}},{key:"setAgent",value:function(e){if("string"!=typeof e&&(e=e.object.value),e===u.EVERYONE)this.setPublic();else if(this.group)throw new Error("Cannot set agent, authorization already has a group set");e.startsWith("mailto:")?this.addMailTo(e):this.agent=e}},{key:"setGroup",value:function(e){if("string"!=typeof e&&(e=e.object.value),this.agent)throw new Error("Cannot set group, authorization already has an agent set");this.group=e}},{key:"setPublic",value:function(){this.setGroup(u.EVERYONE)}},{key:"webId",value:function(){return this.agent||this.group}}]),e}();l.hashFragmentFor=i,e.exports=l},[178,171],146,function(e,t,n){"use strict";var r=n(170),i=r(),o=i.acl("Read"),a=i.acl("Write"),s=i.acl("Append"),u=i.acl("Control"),l=i.foaf("Agent"),c=[o,a,u],f=!0,h=!f,d="accessTo",p="default";e.exports.acl={ALL_MODES:c,READ:o,WRITE:a,APPEND:s,CONTROL:u,EVERYONE:l,INHERIT:f,NOT_INHERIT:h,ACCESS_TO:d,DEFAULT:p}},function(e,t){"use strict";e.exports={authEndpoint:"https://databox.me/",signupEndpoint:"https://solid.github.io/solid-idps/",signupWindowHeight:600,signupWindowWidth:1024}},function(e,t,n){"use strict";var r=n(175);e.exports.version=function(){return r.version}},function(e,t){e.exports={name:"solid-client",version:"0.22.5",description:"Common library for writing Solid read-write-web applications",main:"./lib/index.js",files:["config.js","lib","dist"],scripts:{"build-lib":"babel src -d lib","build-full":"webpack --progress --config webpack.config.js --output-filename solid-client-full.js","build-with-rdflib":"webpack --progress --colors --optimize-minimize --optimize-occurrence-order --optimize-dedupe --config webpack.config.js","build-without-rdflib":"webpack --progress --colors --optimize-minimize --optimize-occurrence-order --optimize-dedupe --config webpack-no-rdflib.config.js","build-qunit-resources":"npm run clean && mkdir -p dist/resources && npm run build-full && browserify -r ./test/resources/profile-minimal.js:test-minimal-profile -o dist/resources/test-minimal-profile.js && browserify -r ./test/resources/profile-private.js:test-minimal-prefs -o dist/resources/test-minimal-prefs.js",build:"npm run clean && mkdir dist && npm run build-lib && npm run build-with-rdflib && npm run build-without-rdflib",clean:"rm -rf dist/",standard:"standard src/*",tape:"tape test/unit/*.js",test:"npm run standard && npm run tape",qunit:"npm run build-qunit-resources && open test/integration/index.html",preversion:"npm test",postversion:"git push --follow-tags",prepublish:"npm run test && npm run build"},babel:{presets:["es2015"]},repository:{type:"git",url:"https://github.com/solid/solid-client"},keywords:["solid","decentralized","web","rdf","ldp","linked","data"],author:"Andrei Sambra <andrei@fcns.eu>",maintainers:[{name:"Dmitri Zagidulin",url:"https://github.com/dmitrizagidulin/"}],license:"MIT",bugs:{url:"https://github.com/solid/solid-client/issues"},homepage:"https://github.com/solid/solid-client",dependencies:{rdflib:"^0.12.1",shorthash:"0.0.2","solid-auth-oidc":"0.0.1","solid-auth-tls":"0.0.4","solid-namespace":"^0.1.0","solid-permissions":"^0.5.0","solid-web-client":"0.0.9"},devDependencies:{"babel-cli":"^6.18.0","babel-core":"^6.21.0","babel-loader":"^6.2.5","babel-preset-es2015":"^6.18.0","json-loader":"^0.5.4",qunit:"^0.9.0",standard:"^5.4.1",tape:"^4.4.0",webpack:"^1.13.1"},standard:{globals:["$rdf","SolidClient","tabulator","QUnit"]}}},function(e,t){"use strict";function n(){return window.navigator.onLine}function r(e){window.addEventListener("offline",e,!1)}function i(e){window.addEventListener("online",e,!1)}e.exports.isOnline=n,e.exports.onOffline=r,e.exports.onOnline=i},function(e,t,n,r,i){(function(e,o){function a(e,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(n)?r.showHidden=n:n&&t._extend(r,n),k(r.showHidden)&&(r.showHidden=!1),k(r.depth)&&(r.depth=2),k(r.colors)&&(r.colors=!1),k(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),c(r,e,r.depth)}function s(e,t){var n=a.styles[t];return n?"["+a.colors[n][0]+"m"+e+"["+a.colors[n][1]+"m":e}function u(e,t){return e}function l(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function c(e,n,r){if(e.customInspect&&n&&R(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return x(i)||(i=c(e,i,r)),i}var o=f(e,n);if(o)return o;var a=Object.keys(n),s=l(a);if(e.showHidden&&(a=Object.getOwnPropertyNames(n)),N(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return h(n);if(0===a.length){if(R(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(T(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(E(n))return e.stylize(Date.prototype.toString.call(n),"date");if(N(n))return h(n)}var g="",m=!1,b=["{","}"];if(v(n)&&(m=!0,b=["[","]"]),R(n)){var w=n.name?": "+n.name:"";g=" [Function"+w+"]"}if(T(n)&&(g=" "+RegExp.prototype.toString.call(n)),E(n)&&(g=" "+Date.prototype.toUTCString.call(n)),N(n)&&(g=" "+h(n)),0===a.length&&(!m||0==n.length))return b[0]+g+b[1];if(r<0)return T(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special");e.seen.push(n);var _;return _=m?d(e,n,r,s,a):a.map(function(t){return p(e,n,r,s,t,m)}),e.seen.pop(),y(_,g,b)}function f(e,t){if(k(t))return e.stylize("undefined","undefined");if(x(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return w(t)?e.stylize(""+t,"number"):g(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,i){for(var o=[],a=0,s=t.length;a<s;++a)A(t,String(a))?o.push(p(e,t,n,r,String(a),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(p(e,t,n,r,i,!0))}),o}function p(e,t,n,r,i,o){var a,s,u;if(u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},u.get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),A(r,i)||(a="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=m(n)?c(e,u.value,null):c(e,u.value,n-1),s.indexOf("\n")>-1&&(s=o?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n"))):s=e.stylize("[Circular]","special")),k(a)){if(o&&i.match(/^\d+$/))return s;a=JSON.stringify(""+i),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function y(e,t,n){var r=0,i=e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function v(e){return Array.isArray(e)}function g(e){return"boolean"==typeof e}function m(e){return null===e}function b(e){return null==e}function w(e){return"number"==typeof e}function x(e){return"string"==typeof e}function _(e){return"symbol"==typeof e}function k(e){return void 0===e}function T(e){return S(e)&&"[object RegExp]"===O(e)}function S(e){return"object"==typeof e&&null!==e}function E(e){return S(e)&&"[object Date]"===O(e)}function N(e){return S(e)&&("[object Error]"===O(e)||e instanceof Error)}function R(e){return"function"==typeof e}function j(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function O(e){return Object.prototype.toString.call(e)}function I(e){return e<10?"0"+e.toString(10):e.toString(10)}function C(){var e=new Date,t=[I(e.getHours()),I(e.getMinutes()),I(e.getSeconds())].join(":");return[e.getDate(),U[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var L=/%[sdj%]/g;t.format=function(e){if(!x(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(a(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,i=r.length,o=String(e).replace(L,function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),s=r[n];n<i;s=r[++n])o+=m(s)||!S(s)?" "+s:" "+a(s);return o},t.deprecate=function(n,r){function i(){if(!a){if(o.throwDeprecation)throw new Error(r);o.traceDeprecation?console.trace(r):console.error(r),a=!0}return n.apply(this,arguments)}if(k(e.process))return function(){return t.deprecate(n,r).apply(this,arguments)};if(o.noDeprecation===!0)return n;var a=!1;return i};var D,P={};t.debuglog=function(e){if(k(D)&&(D=o.env.NODE_DEBUG||""),e=e.toUpperCase(),!P[e])if(new RegExp("\\b"+e+"\\b","i").test(D)){var n=o.pid;P[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else P[e]=function(){};return P[e]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=v,t.isBoolean=g,t.isNull=m,t.isNullOrUndefined=b,t.isNumber=w,t.isString=x,t.isSymbol=_,t.isUndefined=k,t.isRegExp=T,t.isObject=S,t.isDate=E,t.isError=N,t.isFunction=R,t.isPrimitive=j,t.isBuffer=n(r);var U=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.log=function(){console.log("%s - %s",C(),t.format.apply(t,arguments))},t.inherits=n(i),t._extend=function(e,t){if(!t||!S(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(t,function(){return this}(),n(13))},function(e,t,n,r){"use strict";function i(e){var t=n(r)(e),i={acl:t.base("http://www.w3.org/ns/auth/acl#"),app:t.base("http://www.w3.org/ns/solid/app#"),cert:t.base("http://www.w3.org/ns/auth/cert#"),dct:t.base("http://purl.org/dc/terms/"),foaf:t.base("http://xmlns.com/foaf/0.1/"),ldp:t.base("http://www.w3.org/ns/ldp#"),owl:t.base("http://www.w3.org/2002/07/owl#"),pim:t.base("http://www.w3.org/ns/pim/space#"),rdf:t.base("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),rdfs:t.base("http://www.w3.org/2000/01/rdf-schema#"),schema:t.base("http://schema.org/"),sioc:t.base("http://rdfs.org/sioc/ns#"),solid:t.base("http://www.w3.org/ns/solid/terms#"),stat:t.base("http://www.w3.org/ns/posix/stat#"),vcard:t.base("http://www.w3.org/2006/vcard/ns#"),xsd:t.base("http://www.w3.org/2001/XMLSchema#")};return i}e.exports=i}]));
//# sourceMappingURL=solid-client.min.js.map